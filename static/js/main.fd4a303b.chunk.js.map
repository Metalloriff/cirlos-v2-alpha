{"version":3,"sources":["Classes/Constants.js","Classes/Dispatcher.js","Classes/Types/Stores/UserStore.js","Assets/Logo.svg","Classes/Database.js","Classes/TimerClass.js","Components/Toasts.jsx","Components/LinkWrapper.jsx","Components/Modals.jsx","Components/Tooltip.jsx","Classes/Store.js","Components/ContextMenuHandler.jsx","Components/InlineLoading.jsx","Classes/Hooks.js","Components/Chat/MessageComponents/ImageRenderer.jsx","Classes/Types/Emote.jsx","Classes/Types/Stores/EmoteStore.js","Classes/MessageFormatter.jsx","Components/ErrorBoundary.jsx","Components/Modals/UserProfileModal.jsx","Classes/Types/User.jsx","Components/Chat/RichTextArea.jsx","Assets/WaveVector.svg","Components/Modals/AuthModal.jsx","Assets/TwemojiHeart.svg","Components/PageElements/PageFooter.jsx","Assets/icon50x50.png","Pages/Home.jsx","Classes/Types/Stores/CircleStore.js","Classes/Types/Stores/GroupStore.js","Classes/VoiceModule.js","Classes/Types/Group.jsx","Classes/Types/Circle.jsx","Classes/Types/Stores/CssStore.jsx","Components/Chat/ChatTextArea.jsx","Classes/Types/Message.jsx","Classes/Types/Stores/MessageStore.js","Components/Panels/ChatPanel.jsx","Components/Panels/GroupsPanel.jsx","Components/AppPages/CircleOverview.jsx","Components/AppPages/CirclePage.jsx","Components/AppPages/DmsPage.jsx","Components/Panels/CorePanel.jsx","Pages/AppPage.jsx","App.jsx","serviceWorker.js","index.js"],"names":["joinClassNames","final","i","arguments","length","Array","isArray","trim","getRandomKey","Math","random","toString","substr","getAcronym","input","split","slice","map","w","join","toUpperCase","formatDateString","date","options","prependOn","day","days","now","Date","daysPassed","round","toFixed","getDay","toLocaleDateString","openFileDialog","Promise","r","type","_","assign","document","createElement","accept","style","onchange","files","body","removeChild","appendChild","click","mib","value","kib","ActionTypes","PAGE_UPDATE","LOCAL_USER_UPDATE","USER_UPDATE","CIRCLE_UPDATE","CIRCLE_UPDATE_GROUPS","BATCH_UPDATE_DMS","GROUP_UPDATE","DM_UPDATE","UPDATE_CSS_VAR","BATCH_UPDATE_CSS_VARS","MESSAGE_CREATE","MESSAGE_UPDATE","MESSAGE_DELETE","CHAT_UPDATE","FETCH_EMOTE","GroupType","FOLDER","TEXT","VOICE","ANNOUNCEMENTS","UserStatus","OFFLINE","ONLINE","AWAY","BUSY","BOT","Dispatcher","_callbacks","event","callback","this","Set","add","unsubscribe","bind","delete","action","listener","actionType","condition","deps","React","useReducer","x","forceUpdate","useEffect","subscribe","data","dispatcher","localUser","cache","User","id","displayName","status","avatarUrl","CirlosLogo","profileBackgroundNsfw","feed","UserStoreClass","userId","fetchUser","loading","oneTime","unbind","Database","createSnapshotListener","doc","user","extend","dispatch","Store","UserStore","config","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","tosUrl","privacyPolicyUrl","app","initializeApp","auth","getAuth","db","getFirestore","storage","getStorage","storageCache","path","collection","ref","snapshot","_ref","_snapshot","a","getDoc","exists","formatDocument","getDocs","docs","onReady","onSnapshot","DocumentReference","changes","docChanges","change","items","_unbindListener","processor","useState","undefined","setData","obj","_new","setDoc","serializeObject","catch","e","console","error","stack","updateDoc","set","pathSegments","storageRef","getDownloadURL","url","file","uploadBytes","then","result","getStorageUrl","Timer","duration","playAutomatically","remainingTime","resume","startTime","clearTimeout","setTimeout","Toast","children","life","remove","color","fixedTime","handleRemove","setClosing","closing","timer","useMemo","progressBar","useRef","handleMouseEnter","pause","current","animationPlayState","handleMouseLeave","handleFocus","handleBlur","window","addEventListener","hasFocus","removeEventListener","className","onMouseEnter","onMouseLeave","onClick","end","cursor","backgroundColor","animationDuration","Toasts","state","toasts","instance","horizontalStyle","verticalStyle","setState","additionalOptions","toast","key","filter","t","Component","createRef","props","openModal","modal","Modals","push","closeModal","pop","copyToClipboard","text","navigator","clipboard","writeText","showToast","openStringModal","title","description","ImageModal","getSources","sources","u","indexOf","index","setIndex","nav","dir","setLoaded","setFailed","expanded","setExpandedState","target","currentTarget","onMouseDown","src","alt","onLoad","onError","Tooltip","replaceAll","display","href","openImageModal","async","resolve","StringModal","response","onBackdropClick","ErrorBoundary","handleBackdropClick","zIndex","m","yesText","noText","yesColor","noColor","onChange","rich","no","setNoState","yes","setYesState","dangerouslySetInnerHTML","__html","defaultValue","InlineLoading","getElementById","direction","visible","parentElement","classList","toLowerCase","actionHandlers","_listeners","_dispatcher","emitChange","_actionHandlers","factory","handleChange","addListener","removeListener","ContextMenu","docClickEv","contains","getElementsByClassName","close","activeWrapper","menu","open","Handler","Wrapper","handleContextMenu","preventDefault","top","overrideY","clientY","left","overrideX","clientX","innerWidth","ReactDOM","createPortal","publicProps","position","object","output","Object","exclusions","exclude","prevProps","prevState","rect","getBoundingClientRect","transform","y","height","innerHeight","wrapperClassName","openOnClick","onContextMenu","Item","handleClick","stopPropagation","autoClose","icon","SubMenuItem","width","right","label","mount","ToggleItem","checked","Divider","useInterval","delay","callInstantly","interval","setInterval","clearInterval","useMounted","useEventListener","eventType","dependencies","init","useOnMount","useMediaQuery","size","query","matchMedia","matches","ImageRenderer","message","loaded","failed","isMounted","image","onload","onerror","querySelectorAll","reverse","Emote","emote","setSize","EmoteStore","childNodes","EmoteStoreClass","packId","emoteId","get","fetchEmote","rules","defaultRules","order","match","exec","parse","capture","react","node","minimal","userMention","useForceUpdater","getUser","Mention","getEmote","video","controls","audio","youtube","allowFullScreen","parser","parserFor","render","reactFor","ruleOutput","content","inline","errorInfo","moreInfo","componentStack","msg","showErrorInfo","renderError","UserProfileModal","getLocalUser","bgRef","bgRefNsfw","editMode","setEditMode","isNsfwRevealed","revealNsfw","selectProfileBackground","nsfw","uploadStorage","err","profileBackground","opacity","isNsfwVerified","AvatarComponent","RichTextArea","MessageFormatter","about","field","Fragment","bio","update","tooltipDirection","lastOnline","toLocaleTimeString","nsfwVerified","containerRef","setValue","focused","setFocused","selection","setSelection","caret","events","onInput","onKeyDown","shiftKey","onSend","onFocus","onBlur","getSelection","anchorNode","selectionStart","selectionEnd","setImmediate","focus","omit","_defs","_g","_excluded","_extends","source","prototype","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","keys","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","SvgWaveVector","svgRef","titleId","xmlns","xmlnsXlink","isolation","viewBox","clipPath","d","fill","ForwardRef","AuthModal","signUpMode","setSignUpMode","busy","setBusy","handleSignUp","getElementsByTagName","emailField","passwordField","createUserWithEmailAndPassword","location","handleLogIn","signInWithEmailAndPassword","code","placeholder","marginLeft","PageFooter","contacts","website","github","twitter","email","discord","Heart","margin","getFullYear","HomePage","CircleStoreClass","circleId","fetchCircle","Circle","name","circle","CircleStore","groups","_groups","groupListeners","GroupStoreClass","groupId","appHashArgs","getGroup","fetchGroups","fetchDms","getCircle","group","Group","parent","groupPositions","orderBy","GroupDm","isDm","dms","GroupStore","VoiceEvents","VoiceModule","currentRoom","initialized","socket","WebSocket","hostname","log","send","JSON","stringify","iceOptions","iceServers","urls","iceCandidatePoolSize","ChatRoom","clients","Map","consumers","disconnect","handleMessage","connectToSocket","RTCPeerConnection","onicecandidate","handleIceCandidate","onnegotiationneeded","handleNegotiation","mediaDevices","getUserMedia","stream","handleRemoteTrack","localStream","localPeer","createPeer","getTracks","forEach","track","addTrack","consumeAll","srcObject","autoplay","muted","volume","candidate","payload","ice","consumerId","sdp","RTCSessionDescription","setRemoteDescription","peer","consumerTransport","client","addTransceiver","createOffer","offer","setLocalDescription","handleConsumerIceCandidate","ontrack","streams","createConsumeTransport","transport","localDescription","peers","consumeOnce","handleAnswer","handlePeers","handleConsume","handleNewProducer","removeUser","addDoc","senderId","creationDate","serverTimestamp","isNsfw","GroupFolder","GroupText","GroupVoice","GroupAnnouncements","pushHistoryState","lastLocation","getSelectedGroup","connect","sort","StatusText","iconUrl","getGroups","values","b","g","populate","localStorage","getItem","styles","toKebabCase","camelCase","replace","CssStoreClass","args","localUserListener","_databaseReference","_hasLoaded","entries","_save","debounce","CssStore","types","ChatTextArea","handleSend","sendMessage","dispatchEvent","KeyboardEvent","bubbles","Message","mentions","_time","time","toDate","cleanupCache","MessageStoreClass","messageId","fetchMessages","_messages","getMessages","lastMessage","currentGroup","isSeparateUser","isSeparateTime","messages","tick","limitToLast","getMessage","MessageStore","ChatPanel","getMessageGroups","isMobile","mobileEvents","onTouchStart","tapX","touches","tapY","getStyle","translation","lastTranslation","parseFloat","isNaN","handler","abs","clamp","tickCache","MessageGroup","marginTop","hour12","getCreationDate","editedAt","getContent","GroupsPanel","handleScaler","CircleOverview","ownerId","CirclePage","RightHandRenderer","renderGroups","DmsPage","lastMessageDate","CorePanel","AppPage","origin","Core","useSnapshot","getCircles","circles","initialize","LoadingOverlay","Renderer","hidden","BubbleComponent","fontSize","history","pushState","PageElement","hash","App","onAuthStateChanged","uid","Boolean","StrictMode","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.fd4a303b.chunk.js","sourcesContent":["import _ from \"lodash\";\r\n\r\nexport function joinClassNames() {\r\n\tlet final = \"\";\r\n\r\n\tfor (let i = 0; i < arguments.length; i++) {\r\n\t\tswitch (typeof (arguments[i])) {\r\n\t\t\tcase (Array.isArray(arguments[i]) && typeof (arguments[i][0]) === \"boolean\" && \"object\"):\r\n\t\t\t\tif (arguments[i][0] === true)\r\n\t\t\t\t\tfinal += arguments[i][1];\r\n\t\t\t\telse if (arguments[i][2])\r\n\t\t\t\t\tfinal += arguments[i][2];\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tfinal += arguments[i];\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tfinal += \" \";\r\n\t}\r\n\r\n\treturn final.trim();\r\n}\r\n\r\nexport function getRandomKey() { return Math.random().toString(36).substr(7); }\r\n\r\nexport function getAcronym(input) {\r\n\tconst split = input.split(/\\s/).slice(0, 2);\r\n\r\n\treturn split.map(w => w[0]).join(\"\").toUpperCase();\r\n}\r\n\r\nexport function formatDateString(date, options = {}) {\r\n\tconst { prependOn = true } = options;\r\n\r\n\tconst day = 86400000;\r\n\tconst days = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\r\n\r\n\tconst now = new Date();\r\n\tconst daysPassed = (Math.round(now - date) / day).toFixed(0);\r\n\r\n\tlet returnValue;\r\n\r\n\tif (daysPassed < 0)\r\n\t\treturnValue = \"in the future apparently\";\r\n\telse if (daysPassed === \"0\")\r\n\t\treturnValue = \"today\";\r\n\telse if (daysPassed === \"1\")\r\n\t\treturnValue = \"yesterday\";\r\n\telse if (daysPassed < 7)\r\n\t\treturnValue = (prependOn ? \"on \" : \"\") + days[date.getDay()];\r\n\telse\r\n\t\treturnValue = (prependOn ? \"on \" : \"\") + date.toLocaleDateString();\r\n\r\n\treturn returnValue;\r\n}\r\n\r\nexport function openFileDialog(options = {}) {\r\n\treturn new Promise(r => {\r\n\t\tconst { type = \"*\" } = options;\r\n\t\tconst input = _.assign(document.createElement(\"input\"), {\r\n\t\t\ttype: \"file\",\r\n\t\t\taccept: type,\r\n\t\t\tstyle: \"display:none\",\r\n\t\t\tonchange: () => (\r\n\t\t\t\tr(input.files),\r\n\r\n\t\t\t\tdocument.body.removeChild(input)\r\n\t\t\t)\r\n\t\t});\r\n\r\n\t\tdocument.body.appendChild(input);\r\n\t\tinput.click();\r\n\t});\r\n}\r\n\r\nexport function kib(value) {\r\n\treturn value * 1024;\r\n}\r\n\r\nexport function mib(value) {\r\n\treturn kib(value) * 1024;\r\n}\r\n\r\nexport const ActionTypes = {\r\n\tPAGE_UPDATE: \"PAGE_UPDATE\",\r\n\tLOCAL_USER_UPDATE: \"LOCAL_USER_UPDATE\",\r\n\tUSER_UPDATE: \"USER_UPDATE\",\r\n\tCIRCLE_UPDATE: \"CIRCLE_UPDATE\",\r\n\tCIRCLE_UPDATE_GROUPS: \"CIRCLE_UPDATE_GROUPS\",\r\n\tBATCH_UPDATE_DMS: \"BATCH_UPDATE_DMS\",\r\n\tGROUP_UPDATE: \"GROUP_UPDATE\",\r\n\tDM_UPDATE: \"DM_UPDATE\",\r\n\tUPDATE_CSS_VAR: \"UPDATE_CSS_VAR\",\r\n\tBATCH_UPDATE_CSS_VARS: \"BATCH_UPDATE_CSS_VARS\",\r\n\tMESSAGE_CREATE: \"MESSAGE_CREATE\",\r\n\tMESSAGE_UPDATE: \"MESSAGE_UPDATE\",\r\n\tMESSAGE_DELETE: \"MESSAGE_DELETE\",\r\n\tCHAT_UPDATE: \"CHAT_UPDATE\",\r\n\tFETCH_EMOTE: \"FETCH_EMOTE\"\r\n};\r\n\r\nexport const GroupType = {\r\n\tFOLDER: 0,\r\n\tTEXT: 1,\r\n\tVOICE: 2,\r\n\tANNOUNCEMENTS: 3\r\n};\r\n\r\nexport const UserStatus = {\r\n\tOFFLINE: 0,\r\n\tONLINE: 1,\r\n\tAWAY: 2,\r\n\tBUSY: 3,\r\n\tBOT: 100\r\n};","import React from \"react\";\r\n\r\nexport default class Dispatcher {\r\n\t_callbacks = {};\r\n\r\n\tsubscribe(event, callback) {\r\n\t\tif (!this._callbacks[event]) {\r\n\t\t\tthis._callbacks[event] = new Set;\r\n\t\t}\r\n\r\n\t\tthis._callbacks[event].add(callback);\r\n\r\n\t\treturn this.unsubscribe.bind(this, event, callback);\r\n\t}\r\n\r\n\tunsubscribe(event, callback) {\r\n\t\tif (!this._callbacks[event]) return;\r\n\r\n\t\tthis._callbacks[event].delete(callback);\r\n\t}\r\n\r\n\tdispatch(action) {\r\n\t\tconst event = action.type;\r\n\t\tif (!this._callbacks[event]) return;\r\n\r\n\t\tfor (const listener of this._callbacks[event]) {\r\n\t\t\tlistener(action);\r\n\t\t}\r\n\t}\r\n\r\n\tget useForceUpdater() {\r\n\t\treturn (actionType, condition = null, deps = []) => {\r\n\t\t\tconst [, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n\r\n\t\t\tReact.useEffect(() => {\r\n\t\t\t\treturn this.subscribe(actionType, data => {\r\n\t\t\t\t\tif (typeof (condition) === \"function\") {\r\n\t\t\t\t\t\tif (condition(data)) {\r\n\t\t\t\t\t\t\tforceUpdate();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse forceUpdate();\r\n\t\t\t\t});\r\n\t\t\t}, deps);\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport const dispatcher = new Dispatcher;","import _ from \"lodash\";\r\nimport { ActionTypes, UserStatus } from \"../../Constants\";\r\nimport Database from \"../../Database\";\r\nimport { dispatcher } from \"../../Dispatcher\";\r\nimport Store from \"../../Store\";\r\nimport User from \"../User\";\r\nimport CirlosLogo from \"../../../Assets/Logo.svg\";\r\n\r\nlet localUser;\r\nconst cache = {\r\n\t\"SYSTEM\": new User({\r\n\t\tid: \"SYSTEM\",\r\n\t\tdisplayName: \"System\",\r\n\t\tstatus: UserStatus.BOT,\r\n\t\tavatarUrl: CirlosLogo,\r\n\t\tprofileBackgroundNsfw: \"https://c.tenor.com/Z6gmDPeM6dgAAAAC/dance-moves.gif\",\r\n\t\tfeed: \"Giving friendly welcomes and farewells. ♥\"\r\n\t})\r\n};\r\n\r\nconst UserStoreClass = class UserStore extends Store {\r\n\tgetLocalUser() {\r\n\t\treturn localUser;\r\n\t}\r\n\r\n\tgetUser(userId) {\r\n\t\treturn cache[userId] ?? (\r\n\t\t\tthis.fetchUser(userId),\r\n\t\t\tcache[userId] = new User({\r\n\t\t\t\tid: userId,\r\n\t\t\t\tloading: true,\r\n\t\t\t\tdisplayName: \"...\"\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tgetUsers() {\r\n\t\treturn cache;\r\n\t}\r\n\r\n\tfetchUser(userId, oneTime = false) {\r\n\t\tif (!userId) return null;\r\n\r\n\t\treturn new Promise(r => {\r\n\t\t\tconst unbind = Database.createSnapshotListener(\r\n\t\t\t\tDatabase.doc(\"userdata\", userId),\r\n\t\t\t\tdoc => {\r\n\t\t\t\t\tif (cache[userId]?.loading)\r\n\t\t\t\t\t\tdelete cache[userId];\r\n\r\n\t\t\t\t\tconst user = doc\r\n\t\t\t\t\t\t? _.extend(cache[userId] ?? new User(), doc)\r\n\t\t\t\t\t\t: new User({\r\n\t\t\t\t\t\t\tid: userId,\r\n\t\t\t\t\t\t\tdisplayName: \"Deleted User\"\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\ttype: ActionTypes.USER_UPDATE,\r\n\t\t\t\t\t\tuser\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\toneTime && unbind();\r\n\r\n\t\t\t\t\tr(user);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nconst UserStore = new UserStoreClass(dispatcher, {\r\n\t[ActionTypes.LOCAL_USER_UPDATE]: ({ user }) => {\r\n\t\tlocalUser = user;\r\n\t},\r\n\t[ActionTypes.USER_UPDATE]: ({ user }) => {\r\n\t\tcache[user.id] = user;\r\n\t}\r\n});\r\n\r\nexport default UserStore;","export default __webpack_public_path__ + \"static/media/Logo.8c80fb7a.svg\";","import { initializeApp } from \"firebase/app\";\r\nimport { getAuth } from \"firebase/auth\";\r\nimport { getStorage, ref as storageRef, getDownloadURL, uploadBytes } from \"firebase/storage\";\r\nimport { getFirestore, doc, getDoc, setDoc, updateDoc, collection, onSnapshot, getDocs, DocumentReference } from \"firebase/firestore\";\r\nimport React from \"react\";\r\n\r\nconst config = {\r\n\tapiKey: \"AIzaSyCWL2SBBGhjsKq922QaI2W6XwDEeFZ-YQY\",\r\n\tauthDomain: \"www.cirlos.net\",\r\n\tprojectId: \"cirlos\",\r\n\tstorageBucket: \"cirlos.appspot.com\",\r\n\tmessagingSenderId: \"624454143510\",\r\n\tappId: \"1:624454143510:web:beb8a88238bc3b9ea72f37\",\r\n\tmeasurementId: \"G-ZYXVMY55WD\",\r\n\ttosUrl: \"https://www.cirlos.net/terms\",\r\n\tprivacyPolicyUrl: \"https://www.cirlos.net/privacy\"\r\n};\r\n\r\n// if (!firebase.apps.length)\r\n//     firebase.initializeApp(firebaseConfig);\r\n// firebase.analytics();\r\n// firebase.appCheck().activate(\"6LcWSkAbAAAAAL8MhDO1Fq5K7VyJYEEt7TvNu8m4\");\r\n\r\n// Long story short, I fucking hate the new Firebase API. (V9)\r\n// This is my attempt at at least making it tolerable.\r\nexport default new class Database {\r\n\tapp = initializeApp(config);\r\n\tauth = getAuth();\r\n\tdb = getFirestore();\r\n\tstorage = getStorage();\r\n\tstorageCache = {};\r\n\r\n\tdoc(...path) { return doc(this.db, ...path); }\r\n\tcollection(...path) { return collection(this.db, ...path); }\r\n\r\n\tformatDocument(ref, snapshot) {\r\n\t\treturn snapshot ? {\r\n\t\t\t_ref: ref,\r\n\t\t\t_snapshot: snapshot,\r\n\t\t\tid: snapshot.id,\r\n\t\t\t...snapshot.data()\r\n\t\t} : null;\r\n\t}\r\n\r\n\tasync getDoc(ref) {\r\n\t\tconst snapshot = await getDoc(ref);\r\n\t\tif (!snapshot.exists()) return null;\r\n\r\n\t\treturn this.formatDocument(ref, snapshot);\r\n\t}\r\n\r\n\tasync getDocs(ref) {\r\n\t\tconst snapshot = await getDocs(ref);\r\n\r\n\t\treturn snapshot.docs.map(\r\n\t\t\tdoc => (\r\n\t\t\t\tthis.formatDocument(doc.ref, doc)\r\n\t\t\t)\r\n\t\t);\r\n\t}\r\n\r\n\tcreateSnapshotListener(ref, callback, options = {}) {\r\n\t\tlet { onReady } = options;\r\n\r\n\t\tconst unbind = onSnapshot(ref, _snapshot => {\r\n\t\t\tconst snapshot = ref instanceof DocumentReference\r\n\t\t\t\t? this.formatDocument(ref, _snapshot)\r\n\t\t\t\t: {\r\n\t\t\t\t\tchanges: _snapshot.docChanges().map(change => ({\r\n\t\t\t\t\t\t...change,\r\n\t\t\t\t\t\tdata: this.formatDocument(change.doc.ref, change.doc)\r\n\t\t\t\t\t})),\r\n\t\t\t\t\titems: _snapshot.docs.map(doc => this.formatDocument(doc.ref, doc))\r\n\t\t\t\t};\r\n\r\n\t\t\tif (snapshot) {\r\n\t\t\t\tsnapshot._unbindListener = unbind;\r\n\t\t\t}\r\n\r\n\t\t\tcallback(snapshot);\r\n\r\n\t\t\tonReady?.(snapshot);\r\n\t\t\tonReady = null;\r\n\t\t});\r\n\r\n\t\treturn unbind;\r\n\t}\r\n\r\n\tget useSnapshot() {\r\n\t\treturn (ref, options = {}) => {\r\n\t\t\tconst { processor } = options;\r\n\t\t\tconst [data, setData] = React.useState(undefined);\r\n\r\n\t\t\tReact.useEffect(() => {\r\n\t\t\t\treturn this.createSnapshotListener(ref, async data => {\r\n\t\t\t\t\tif (typeof (processor) !== \"function\") return setData(data);\r\n\r\n\t\t\t\t\tif (Array.isArray(data.items)) {\r\n\t\t\t\t\t\tfor (const i in data.items) {\r\n\t\t\t\t\t\t\tdata.items[i] = await processor(data.items[i]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse data = await processor(data);\r\n\r\n\t\t\t\t\tsetData(data);\r\n\t\t\t\t}, options);\r\n\t\t\t}, []);\r\n\r\n\t\t\treturn data;\r\n\t\t};\r\n\t}\r\n\r\n\tserializeObject(obj) {\r\n\t\tconst _new = { ...obj };\r\n\r\n\t\tdelete _new._ref;\r\n\t\tdelete _new._snapshot;\r\n\t\tdelete _new._unbindListener;\r\n\t\tdelete _new.id;\r\n\r\n\t\treturn _new;\r\n\t}\r\n\r\n\tasync set(ref, data) {\r\n\t\treturn await setDoc(ref, this.serializeObject(data))\r\n\t\t\t.catch(e => console.error(`Error setting doc data at \"${ref.path}\"\\n${e.stack}`));\r\n\t}\r\n\r\n\tasync update(ref, data) {\r\n\t\t// TODO writing on error is very unsafe. Don't do that.\r\n\t\treturn await updateDoc(ref, this.serializeObject(data))\r\n\t\t\t.catch(() => this.set(ref, data))\r\n\t\t\t.catch(e => console.error(`Error updating doc data at \"${ref.path}\"\\n${e.stack}`));\r\n\t}\r\n\r\n\t// Storage\r\n\tasync getStorageUrl(...pathSegments) {\r\n\t\tconst path = pathSegments.join(\"/\");\r\n\t\t// if (this.storageCache[path]) return this.storageCache[path];\r\n\r\n\t\tconst ref = storageRef(this.storage, path);\r\n\t\tconst url = await getDownloadURL(ref);\r\n\r\n\t\treturn this.storageCache[path] = url;\r\n\t}\r\n\r\n\tuploadStorage(file, ...pathSegments) {\r\n\t\tconst path = pathSegments.join(\"/\");\r\n\t\tconst ref = storageRef(this.storage, path);\r\n\r\n\t\treturn uploadBytes(ref, file).then(async result => ({\r\n\t\t\tresult,\r\n\t\t\turl: await this.getStorageUrl(...pathSegments)\r\n\t\t}));\r\n\t}\r\n}","export default class Timer {\r\n    id;\r\n    startTime;\r\n    remainingTime;\r\n    callback;\r\n    duration;\r\n    \r\n    constructor(callback, duration, playAutomatically = true) {\r\n        this.callback = callback;\r\n        this.duration = duration;\r\n        this.remainingTime = duration;\r\n        \r\n        if (playAutomatically)\r\n            this.resume();\r\n    }\r\n    \r\n    resume() {\r\n        this.startTime = Date.now();\r\n        \r\n        clearTimeout(this.id);\r\n        this.id = setTimeout(this.callback, this.remainingTime);\r\n    }\r\n    \r\n    pause() {\r\n        clearTimeout(this.id);\r\n        this.remainingTime -= Date.now() - this.startTime;\r\n    }\r\n    \r\n    end() {\r\n        clearTimeout(this.id);\r\n        this.callback();\r\n    }\r\n}","import React from \"react\";\r\nimport \"./Toasts.scss\";\r\nimport { getRandomKey, joinClassNames } from \"../Classes/Constants\";\r\nimport Timer from \"../Classes/TimerClass\";\r\n\r\nexport function Toast({ children, type, life, remove, callback, color, fixedTime = false }) {\r\n\tconst handleRemove = () => {\r\n\t\tsetClosing(true);\r\n\r\n\t\tsetTimeout(remove, 500);\r\n\t};\r\n\t\r\n\tconst [closing, setClosing] = React.useState(false);\r\n\tconst timer = React.useMemo(() => new Timer(handleRemove, life * 1000, false), []);\r\n\tconst progressBar = React.useRef();\r\n\t\r\n\tconst handleMouseEnter = () => {\r\n\t\ttimer.pause();\r\n\t\tprogressBar.current.style.animationPlayState = \"paused\";\r\n\t};\r\n\t\r\n\tconst handleMouseLeave = () => {\r\n\t\ttimer.resume();\r\n\t\tprogressBar.current.style.animationPlayState = \"running\";\r\n\t};\r\n\t\r\n\tReact.useEffect(() => {\r\n\t\tconst handleFocus = () => !fixedTime && handleMouseLeave();\r\n\t\tconst handleBlur = () => !fixedTime && handleMouseEnter();\r\n\t\t\r\n\t\twindow.addEventListener(\"focus\", handleFocus);\r\n\t\twindow.addEventListener(\"blur\", handleBlur);\r\n\t\t\r\n\t\t(fixedTime || document.hasFocus()) && handleMouseLeave();\r\n\t\t\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener(\"focus\", handleFocus);\r\n\t\t\twindow.removeEventListener(\"blur\", handleBlur);\r\n\t\t};\r\n\t});\r\n\t\r\n\treturn (\r\n\t\t<div className={joinClassNames(\"Toast\", [closing, \"Closing\"], type)}\r\n\t\t\t onMouseEnter={fixedTime ? null : handleMouseEnter}\r\n\t\t\t onMouseLeave={fixedTime ? null : handleMouseLeave}\r\n\t\t\t onClick={callback ? e => { callback(e); timer.end(); } : () => { timer.end(); }}\r\n\t\t\t style={{ cursor: callback ? \"pointer\" : null, backgroundColor: color }}>\r\n\t\t\t{ children }\r\n\r\n\t\t\t<div className=\"ProgressBarContainer\">\r\n\t\t\t\t<div ref={progressBar} className=\"ProgressBar\" style={{ animationDuration: life + \"s\" }}/>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default class Toasts extends React.Component {\r\n\tstatic instance;\r\n\tstatic ref = React.createRef();\r\n\t\r\n\tstate = { toasts: [] };\r\n\r\n\tcomponentDidMount() {\r\n\t\tToasts.instance = this;\r\n\t}\r\n\t\r\n\tstatic showToast(children, type = \"\", life = 5, additionalOptions = {}) {\r\n\t\tconst { callback = null, color = null, fixedTime = false } = additionalOptions;\r\n\t\t\r\n\t\tconst toast = React.createElement(Toast, {\r\n\t\t\tkey: getRandomKey(),\r\n\t\t\tchildren, type, life, color, fixedTime,\r\n\t\t\tremove: () => {\r\n\t\t\t\tthis.instance.setState({ toasts: this.instance.state.toasts.filter(t => t !== toast) });\r\n\t\t\t},\r\n\t\t\tcallback\r\n\t\t});\r\n\r\n\t\tthis.instance.setState({ toasts: [ ...this.instance.state.toasts, toast ] });\r\n\t\treturn toast;\r\n\t}\r\n\t\r\n\tget horizontalStyle() {\r\n\t\treturn \"Center\";\r\n\t\t\r\n\t\t// switch (Settings.props.notifications.toasts.positionX) {\r\n\t\t// \tcase 0:\r\n\t\t// \t\treturn \"Left\";\r\n\t\t// \tcase 1:\r\n\t\t// \t\treturn \"Center\";\r\n\t\t// \tcase 2:\r\n\t\t// \t\treturn \"Right\";\r\n\t\t// }\r\n\t}\r\n\t\r\n\tget verticalStyle() {\r\n\t\treturn \"Bottom\";\r\n\t\t\r\n\t\t// switch (Settings.props.notifications.toasts.positionY) {\r\n\t\t// \tcase 0:\r\n\t\t// \t\treturn \"Top\";\r\n\t\t// \tcase 1:\r\n\t\t// \t\treturn \"Bottom\";\r\n\t\t// }\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div ref={Toasts.ref} className={joinClassNames(\"ToastsContainer\", this.horizontalStyle, this.verticalStyle)}>\r\n\t\t\t\t<div className={joinClassNames(\"ClearButton\", [!!this.state.toasts?.length, \"Visible\"])} onClick={() => this.setState({ toasts: [] })}>\r\n\t\t\t\t\t<u>Close all</u>\r\n\t\t\t\t</div>\r\n\t\t\t\t\r\n\t\t\t\t{ this.state.toasts }\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}","import React from \"react\";\r\nimport \"./LinkWrapper.scss\";\r\n\r\nexport default class extends React.Component {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<a className=\"LinkWrapper\" {...this.props}>\r\n\t\t\t\t{ this.props.children }\r\n\t\t\t</a>\r\n\t\t);\r\n\t}\r\n}","import React from \"react\";\r\nimport \"./Modals.scss\";\r\nimport ErrorBoundary from \"./ErrorBoundary\";\r\nimport Toasts from \"./Toasts\";\r\nimport InlineLoading from \"./InlineLoading\";\r\nimport { joinClassNames } from \"../Classes/Constants\";\r\nimport Tooltip from \"./Tooltip\";\r\nimport LinkWrapper from \"./LinkWrapper\";\r\nimport * as Feather from \"react-feather\";\r\n\r\n/**\r\n * Pushes a component to the modal stack.\r\n * @deprecated Use Modals.push(modal) instead.\r\n * @param modal The React component modal.\r\n */\r\nexport function openModal(modal) {\r\n\tModals.push(modal);\r\n}\r\n\r\n/**\r\n * Close the last modal in the stack.\r\n * @deprecated Use Modals.pop() instead.\r\n */\r\nexport function closeModal() {\r\n\tModals.pop().catch(console.error.bind(console, \"Failed to pop modal!\"));\r\n}\r\n\r\n/**\r\n * Copies the specified text to the clipboard\r\n * @param text The text to copy.\r\n * @returns {Promise<void>}\r\n */\r\nexport async function copyToClipboard(text) {\r\n\ttry {\r\n\t\tawait window.navigator.clipboard.writeText(text);\r\n\r\n\t\tToasts.showToast(<span><b>{text.length >= 100 ? text.substr(0, 100) + \"...\" : text}</b> copied to clipboard</span>, \"Success\");\r\n\t}\r\n\tcatch (e) {\r\n\t\topenStringModal({\r\n\t\t\ttitle: \"Failed To Copy\",\r\n\t\t\tdescription: \"Your browser does not support copying to clipboard, you can manually copy here.\",\r\n\t\t\tvalue: text\r\n\t\t});\r\n\t}\r\n}\r\n\r\n// TODO update this\r\nexport function ImageModal({ url, getSources }) {\r\n\t// Get the sources or create a single-item array\r\n\tconst sources = typeof(getSources) === \"function\" ? getSources().filter(u => u) : [url];\r\n\t\r\n\t// Create a state based on the index of the current url\r\n\tconst [index, setIndex] = React.useState(sources.indexOf(url));\r\n\t// Create a navigate function to handle safely navigating images\r\n\tconst nav = dir =>\r\n\t\tsources[index + dir]\r\n\t\t\t? (setLoaded(false), setFailed(false), setIndex(index + dir))\r\n\t\t\t: Toasts.showToast(\"No more images in this direction!\", \"Failure\");\r\n\t// Create an expanded state based on the serialized settings state\r\n\tconst [expanded, setExpandedState] = React.useState(false);\r\n\t\r\n\t// These are placeholders, I'm too lazy to add them\r\n\tconst [loading, setLoaded] = React.useState(false);\r\n\tconst [failed, setFailed] = React.useState(false);\r\n\t\r\n\t// Render bender\r\n\treturn (\r\n\t\t<div className=\"ImageModal\" onClick={e => e.target === e.currentTarget && Modals.pop()}>\r\n\t\t\t<div className={joinClassNames(\"ImageContainer\", [expanded, \"Expanded\"])}\r\n\t\t\t\t onMouseDown={Modals.pop.bind(Modals)}>\r\n\t\t\t\t<img src={sources[index]} alt=\"Image failed to load\"\r\n\t\t\t\t\t onLoad={() => (setLoaded(true), setFailed(false))}\r\n\t\t\t\t\t onError={() => (setLoaded(true), setFailed(true))}/>\r\n\t\t\t</div>\r\n\t\t\t\r\n\t\t\t<div className=\"Footer\">\r\n\t\t\t\t<div className={joinClassNames(\"Button Arrow Left\",\r\n\t\t\t\t\t[!sources.length || !index, \"Disabled\"])} onClick={() => nav(-1)}>\r\n\t\t\t\t\t<Feather.ChevronLeft/>\r\n\t\t\t\t\t<Tooltip>Previous Image</Tooltip>\r\n\t\t\t\t</div>\r\n\t\t\t\t\r\n\t\t\t\t<div className=\"Divider\"/>\r\n\t\t\t\t\r\n\t\t\t\t<div className=\"Filename\">{\r\n\t\t\t\t\tsources[index].split(\"?\")[0].split(\"/\").slice(-1)[0].split(\"_\").slice(-1)[0].replaceAll(\"%20\", \" \")\r\n\t\t\t\t}</div>\r\n\r\n\t\t\t\t<div className=\"Divider\"/>\r\n\t\t\t\t\r\n\t\t\t\t<div className=\"Button\" onClick={() => (setExpandedState(!expanded))}>\r\n\t\t\t\t\t{ expanded ? <Feather.Minimize2/> : <Feather.Maximize2/> }\r\n\t\t\t\t\t<Tooltip>{expanded ? \"Compress\" : \"Expand\"}</Tooltip>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"Button\">\r\n\t\t\t\t\t<Feather.Clipboard/>\r\n\t\t\t\t\t<Tooltip>Copy URL</Tooltip>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<LinkWrapper className=\"Button\" style={{ display: \"block\", color: \"white\" }}\r\n\t\t\t\t\t\t\t href={sources[index]}>\r\n\t\t\t\t\t<Feather.ExternalLink/>\r\n\t\t\t\t\t<Tooltip>Open In Browser</Tooltip>\r\n\t\t\t\t</LinkWrapper>\r\n\r\n\t\t\t\t<div className=\"Divider\"/>\r\n\t\t\t\t\r\n\t\t\t\t<div className={joinClassNames(\"Button Arrow Right\",\r\n\t\t\t\t\t[!sources.length || index + 1 >= sources.length, \"Disabled\"])} onClick={() => nav(1)}>\r\n\t\t\t\t\t<Feather.ChevronRight/>\r\n\t\t\t\t\t<Tooltip>Next Image</Tooltip>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n/**\r\n * Pushes an image modal to the modal stack.\r\n * @param url The URI for the image to focus.\r\n * @param getSources? An option callback function that returns an array of URIs.\r\n */\r\nexport function openImageModal(url, getSources = null) {\r\n\tModals.push(<ImageModal url={url} getSources={getSources}/>);\r\n}\r\n\r\n/**\r\n * Displays a two-choice modal to the user.\r\n * @param title\r\n * @param description\r\n * @param yesText\r\n * @param noText\r\n * @param yesColor\r\n * @param noColor\r\n * @returns {Promise<boolean>}\r\n */\r\nexport async function openBoolModal({\r\n\t  title = \"\",\r\n\t  description = \"\",\r\n\t  yesText = \"Yes\",\r\n\t  noText = \"No\",\r\n\t  yesColor = \"#ff6666\",\r\n\t  noColor = \"\"\r\n}) {\r\n\tconst response = await new Promise(resolve => {\r\n\t\tModals.push(\r\n\t\t\t<div className=\"BoolModal PrimaryBg\">\r\n\t\t\t\t<div className=\"Title\" dangerouslySetInnerHTML={{ __html: title }}/>\r\n\t\t\t\t<div className=\"Description\" dangerouslySetInnerHTML={{ __html: description }}/>\r\n\r\n\t\t\t\t<div className=\"Footer\">\r\n\t\t\t\t\t<div className=\"Button TertiaryBg\" onClick={() => resolve(false)} style={{ backgroundColor: noColor }}>{noText}</div>\r\n\t\t\t\t\t<div className=\"Button TertiaryBg\" onClick={() => resolve(true)} style={{ backgroundColor: yesColor }}>{yesText}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\t\r\n\tModals.pop();\r\n\r\n\treturn response;\r\n}\r\n\r\n/**\r\n * Displays a string choice modal to the user.\r\n * @param options\r\n * @returns {Promise<string | null>}\r\n */\r\nexport async function openStringModal(options = {}) {\r\n\tconst { async = false } = options;\r\n\r\n\tconst response = await new Promise(resolve => {\r\n\t\tModals.push(\r\n\t\t\t<StringModal resolve={resolve} {...options}/>\r\n\t\t);\r\n\t});\r\n\r\n\t!async && Modals.pop();\r\n\r\n\treturn response;\r\n}\r\n\r\nexport class Modals extends React.Component {\r\n\tstatic instance;\r\n\r\n\t/**\r\n\t * Pushes a component to the modal stack.\r\n\t * @param modal The React component modal.\r\n\t */\r\n\tstatic push(modal) {\r\n\t\tthis.instance.setState({ stack: [...this.instance.state.stack, modal] });\r\n\t}\r\n\r\n\t/**\r\n\t * Closes the last modal in the stack.\r\n\t * @returns {Promise<void>}\r\n\t */\r\n\tstatic async pop() {\r\n\t\t// Destructure the instance state\r\n\t\tconst { stack, closing } = this.instance.state;\r\n\t\tconst modal = stack[stack.length - 1];\r\n\t\t\r\n\t\t// If there is nothing to close, return\r\n\t\tif (!stack.length || !modal) return;\r\n\t\t\r\n\t\t// Push the modal to the closing state, activating the transition\r\n\t\tthis.instance.setState({ closing: [...closing, modal] });\r\n\t\t\r\n\t\t// Wait for the transition\r\n\t\tawait new Promise(r => setTimeout(r, 150));\r\n\t\t\r\n\t\t// Set the new state, removing the modal from both stack states\r\n\t\tthis.instance.setState({\r\n\t\t\tstack: this.instance.state.stack.filter(m => m !== modal),\r\n\t\t\tclosing: this.instance.state.closing.filter(m => m !== modal)\r\n\t\t});\r\n\t}\r\n\r\n\tstate = { stack: [], closing: [] };\r\n\r\n\tcomponentDidMount() {\r\n\t\t// Assign the static instance variable\r\n\t\tModals.instance = this;\r\n\t}\r\n\r\n\thandleBackdropClick(e) {\r\n\t\t// Ensure that we're actually clicking the modal background\r\n\t\tif (e.target !== e.currentTarget) return;\r\n\r\n\t\t// If the modal has an on backdrop click prop, run it and return\r\n\t\tconst { stack } = this.state;\r\n\t\tif (stack[stack.length - 1] && typeof(stack[stack.length - 1].props?.onBackdropClick) === \"function\")\r\n\t\t\treturn stack[stack.length - 1].props.onBackdropClick();\r\n\t\t\r\n\t\t// K I L L\r\n\t\tModals.pop().catch(console.error.bind(console, \"Failed to pop modal!\"));\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { stack, closing } = this.state;\r\n\t\t\r\n\t\treturn (\r\n\t\t\t<div className={\"ModalStack\" + (stack.length > closing.length ? \" Active\" : \"\")}>\r\n\t\t\t\t{ stack.map((modal, id) => (\r\n\t\t\t\t\t<ErrorBoundary>\r\n\t\t\t\t\t\t<div className={\"ModalContainer\" +\r\n\t\t\t\t\t\t\t (~closing.indexOf(modal) || id < stack.length - 1 ? \" Closing\" : \"\")}\r\n\t\t\t\t\t\t\t key={id}\r\n\t\t\t\t\t\t\t onMouseDown={this.handleBackdropClick.bind(this)}\r\n\t\t\t\t\t\t\t style={{ zIndex: id * 10 }}>{ modal }</div>\r\n\t\t\t\t\t</ErrorBoundary>\r\n\t\t\t\t)) }\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport function StringModal(props) {\r\n\tconst { title = \"\", description = \"\", yesText = \"Confirm\", noText = \"Cancel\", yesColor = \"\", noColor = \"\", value = \"\", onChange = null, rich = false, resolve, id } = props;\r\n\tconst [no, setNoState] = React.useState(false);\r\n\tconst [yes, setYesState] = React.useState(false);\r\n\t\r\n\treturn (\r\n\t\t<div className=\"StringModal PrimaryBg\">\r\n\t\t\t<div className=\"Title\" dangerouslySetInnerHTML={{ __html: title }}/>\r\n\t\t\t<div className=\"Description\" dangerouslySetInnerHTML={{ __html: description }}/>\r\n\t\t\t\r\n\t\t\t<input id={id} className=\"Field TertiaryBg\" defaultValue={value} onChange={onChange}/>\r\n\r\n\t\t\t<div className=\"Footer\">\r\n\t\t\t\t<div className=\"Button TertiaryBg\" onClick={() => (resolve(null), setNoState(true))} style={{ backgroundColor: noColor }}>{ no ? <InlineLoading/> : noText }</div>\r\n\t\t\t\t<div className=\"Button TertiaryBg\" onClick={() => (resolve(document.getElementById(id).value), setYesState(true))} style={{ backgroundColor: yesColor }}>{ yes ? <InlineLoading/> : yesText }</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport \"./Tooltip.scss\";\r\nimport { joinClassNames } from \"../Classes/Constants\";\r\nimport ReactDOM from \"react-dom\";\r\n\r\nexport default function Tooltip({ children = null, direction = \"up\", className = \"\", color, style = null, onClick = null }) {\r\n\tconst [visible, setVisible] = React.useState(false);\r\n\tconst ref = React.useRef();\r\n\r\n\tReact.useEffect(() => {\r\n\t\tref.current.parentElement.classList.add(\"HasTooltip\");\r\n\r\n\t\treturn () => {\r\n\t\t\tref.current && ref.current.parentElement.classList.remove(\"HasTooltip\");\r\n\t\t};\r\n\t}, [children, direction]);\r\n\r\n\treturn (\r\n\t\t<div ref={ref} className={joinClassNames(\"TooltipContainer\", direction.toLowerCase(), [visible, \"Visible\"], className)} style={style} onClick={onClick}>\r\n\t\t\t<div className=\"Tooltip\" style={{ backgroundColor: color }}>{children}</div>\r\n\t\t\t<div className=\"TooltipArrow\" style={{ backgroundColor: color }} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function DetachedTooltip({ children, direction = \"up\", className = \"\", color, style, onClick, parentRef }) {\r\n\tconst container = React.useMemo(() => document.getElementsByClassName(\"AppMain\")[0], []);\r\n\tconst [visible, setVisible] = React.useState(false);\r\n\tconst [styles, setStyles] = React.useState(null);\r\n\tconst ref = React.useRef();\r\n\r\n\tReact.useEffect(() => {\r\n\t\tconst parent = parentRef.current;\r\n\r\n\t\tconst events = {\r\n\t\t\tonMouseEnter: () => {\r\n\t\t\t\tif (visible) return;\r\n\r\n\t\t\t\tconst rect = parent.getBoundingClientRect();\r\n\t\t\t\tconst tooltipRect = ref.current.getBoundingClientRect();\r\n\r\n\t\t\t\tswitch (direction) {\r\n\t\t\t\t\tcase \"up\":\r\n\t\t\t\t\t\tsetStyles({\r\n\t\t\t\t\t\t\ttop: rect.y - rect.height - tooltipRect.height,\r\n\t\t\t\t\t\t\tleft: rect.x + (rect.width / 2)\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"left\":\r\n\t\t\t\t\t\tsetStyles({\r\n\t\t\t\t\t\t\ttop: rect.y - (rect.height / 2) + ((tooltipRect.height * 1.25) / 3),\r\n\t\t\t\t\t\t\tleft: rect.x - (tooltipRect.width * 1.25)\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"down\":\r\n\t\t\t\t\t\tsetStyles({\r\n\t\t\t\t\t\t\tbottom: rect.y - (tooltipRect.height * 1.25),\r\n\t\t\t\t\t\t\tleft: rect.x - ((tooltipRect.width * 1.25) / 2) + (rect.width / 2)\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"right\":\r\n\t\t\t\t\t\tsetStyles({\r\n\t\t\t\t\t\t\ttop: rect.y - ((tooltipRect.height * 1.25) / 2) + (rect.height / 2),\r\n\t\t\t\t\t\t\tright: rect.x - tooltipRect.width - 5\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsetVisible(true);\r\n\t\t\t},\r\n\t\t\tonMouseLeave: () => setVisible(false)\r\n\t\t};\r\n\r\n\t\tparent.addEventListener(\"mouseenter\", events.onMouseEnter);\r\n\t\tparent.addEventListener(\"mouseleave\", events.onMouseLeave);\r\n\r\n\t\treturn () => {\r\n\t\t\tparent.removeEventListener(\"mouseenter\", events.onMouseEnter);\r\n\t\t\tparent.removeEventListener(\"mouseleave\", events.onMouseLeave);\r\n\t\t};\r\n\t}, [children, direction]);\r\n\r\n\treturn ReactDOM.createPortal(\r\n\t\t<div ref={ref} className={joinClassNames(\"TooltipContainer Detached\", direction.toLowerCase(), [visible, \"Visible\"], className)}\r\n\t\t\tstyle={{ ...(styles ?? {}), ...(style ?? {}) }} onClick={onClick}>\r\n\t\t\t<div className=\"Tooltip\" style={{ backgroundColor: color }}>{children}</div>\r\n\t\t\t<div className=\"TooltipArrow\" style={{ backgroundColor: color }} />\r\n\t\t</div>,\r\n\t\tcontainer\r\n\t);\r\n}","import React from \"react\";\r\n\r\nexport default class Store {\r\n\t_listeners = new Set;\r\n\r\n\tconstructor(dispatcher, actionHandlers) {\r\n\t\tthis._dispatcher = dispatcher;\r\n\r\n\t\tif (typeof (actionHandlers) === \"object\") {\r\n\t\t\tfor (const event in actionHandlers) {\r\n\t\t\t\tdispatcher.subscribe(event, action => {\r\n\t\t\t\t\tactionHandlers[event]?.(action) !== false && this.emitChange();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._actionHandlers = actionHandlers;\r\n\t}\r\n\r\n\t/**\r\n\t * Forcefully emit an empty change.\r\n\t */\r\n\temitChange() {\r\n\t\t// @ts-ignore\r\n\t\tfor (const listener of this._listeners) {\r\n\t\t\tlistener();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Attach a listener to the store.\r\n\t * @param {Function} listener \r\n\t * @returns {Set}\r\n\t */\r\n\taddListener(listener) {\r\n\t\treturn this._listeners.add(listener);\r\n\t}\r\n\r\n\t/**\r\n\t * Detach a listener from the store.\r\n\t * @param {Function} listener \r\n\t * @returns {boolean}\r\n\t */\r\n\tremoveListener(listener) {\r\n\t\treturn this._listeners.delete(listener);\r\n\t}\r\n\r\n\tget useState() {\r\n\t\treturn (factory = _ => _, deps = []) => {\r\n\t\t\tconst [state, setState] = React.useState(factory(this));\r\n\r\n\t\t\tReact.useEffect(() => {\r\n\t\t\t\tconst handleChange = () => setState(factory(this));\r\n\r\n\t\t\t\tthis.addListener(handleChange);\r\n\r\n\t\t\t\treturn () => void this.removeListener(handleChange);\r\n\t\t\t}, [state, ...deps]);\r\n\r\n\t\t\treturn state;\r\n\t\t};\r\n\t}\r\n}","import React, { createRef } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { ChevronRight } from \"react-feather\";\r\nimport \"./ContextMenuHandler.scss\";\r\nimport ErrorBoundary from \"./ErrorBoundary\";\r\n\r\nfunction exclude(object, ...exclusions) {\r\n\tconst output = Object.assign({}, object);\r\n\r\n\tfor (const exclusion of exclusions) delete output[exclusion];\r\n\treturn output;\r\n}\r\n\r\nclass ContextMenu extends React.Component {\r\n\tref = createRef();\r\n\r\n\tdocClickEv = e => {\r\n\t\tif (this.ref.current && !this.ref.current.contains(e.target) && !document.getElementsByClassName(\"ContextMenu\")[0].contains(e.target)) {\r\n\t\t\tthis.close();\r\n\t\t}\r\n\t}\r\n\r\n\tclose() {\r\n\t\tif (ContextMenu.activeWrapper) {\r\n\t\t\tContextMenu.activeWrapper.setState({ menu: null, open: false });\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tdocument.addEventListener(\"click\", this.docClickEv);\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tdocument.removeEventListener(\"click\", this.docClickEv);\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<ErrorBoundary>\r\n\t\t\t\t<div className=\"ContextMenu\" {...this.props} ref={this.ref}>\r\n\t\t\t\t\t{this.props.children}\r\n\t\t\t\t</div>\r\n\t\t\t</ErrorBoundary>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nContextMenu.Handler = class extends React.Component {\r\n\tstatic ref = createRef();\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<ErrorBoundary>\r\n\t\t\t\t<div ref={ContextMenu.Handler.ref} className=\"ContextMenuWrapper MainContextMenuContainer\">\r\n\r\n\t\t\t\t</div>\r\n\t\t\t</ErrorBoundary>\r\n\t\t);\r\n\t}\r\n};\r\n\r\nContextMenu.Wrapper = class extends React.Component {\r\n\tstate = { menu: null, open: false };\r\n\tref = createRef();\r\n\r\n\tget publicProps() {\r\n\t\treturn exclude(this.props, \"menu\", \"openOnClick\", \"wrapperClassName\", \"overrideX\", \"overrideY\");\r\n\t}\r\n\r\n\thandleContextMenu = e => {\r\n\t\tif (typeof (e.preventDefault) === \"function\")\r\n\t\t\te.preventDefault();\r\n\r\n\t\tif (ContextMenu.activeWrapper) {\r\n\t\t\tif (this.ref.current.contains(ContextMenu.activeWrapper.ref.current) && ContextMenu.activeWrapper.props.menu !== this.props.menu)\r\n\t\t\t\treturn;\r\n\t\t\tContextMenu.activeWrapper.setState({ menu: null, open: false });\r\n\t\t}\r\n\r\n\t\tContextMenu.activeWrapper = this;\r\n\r\n\t\tlet top = this.props.menu.props.overrideY?.() || e.clientY;\r\n\t\tlet left = this.props.menu.props.overrideX?.() || e.clientX;\r\n\r\n\t\twhile (left + 200 > window.innerWidth)\r\n\t\t\tleft -= 10;\r\n\r\n\t\tthis.setState({\r\n\t\t\tmenu: ReactDOM.createPortal(\r\n\t\t\t\t<div className=\"ContextMenuContainer SecondaryBg\" {...this.publicProps} style={{\r\n\t\t\t\t\tposition: \"fixed\",\r\n\t\t\t\t\ttop, left\r\n\t\t\t\t}}>{this.props.menu}</div>, ContextMenu.Handler.ref.current), open: true\r\n\t\t});\r\n\t}\r\n\r\n\tasync componentDidUpdate(prevProps, prevState, snapshot) {\r\n\t\tif (ContextMenu.activeWrapper === this && !this.state.open)\r\n\t\t\tContextMenu.activeWrapper = null;\r\n\r\n\t\tif (this.state.open && this.ref.current) {\r\n\t\t\tconst [menu] = document.getElementsByClassName(\"ContextMenuContainer\");\r\n\t\t\tconst rect = menu.getBoundingClientRect();\r\n\r\n\t\t\tmenu.style.transform = rect.y + rect.height > window.innerHeight\r\n\t\t\t\t? `translateY(${window.innerHeight - (rect.y + rect.height) - 20}px)`\r\n\t\t\t\t: null;\r\n\t\t}\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn this.props.menu ? (\r\n\t\t\t<ErrorBoundary>\r\n\t\t\t\t<div ref={this.ref} className={\"ContextMenuWrapper \" + (this.props.wrapperClassName || \"\")} onClick={this.props.openOnClick ? e => {\r\n\t\t\t\t\tif (typeof (e.target.onClick) === \"function\")\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tthis.handleContextMenu(this.props.openOnClick());\r\n\t\t\t\t} : null}\r\n\t\t\t\t\t{...this.publicProps} onContextMenu={this.handleContextMenu}>\r\n\t\t\t\t\t{this.props.children}\r\n\r\n\t\t\t\t\t<ErrorBoundary>\r\n\t\t\t\t\t\t{this.state.open ? this.state.menu : null}\r\n\t\t\t\t\t</ErrorBoundary>\r\n\t\t\t\t</div>\r\n\t\t\t</ErrorBoundary>\r\n\t\t) : this.props.children;\r\n\t}\r\n}\r\n\r\nContextMenu.Item = class extends React.Component {\r\n\thandleClick = e => {\r\n\t\te.preventDefault();\r\n\t\te.stopPropagation();\r\n\r\n\t\tif (ContextMenu.activeWrapper && this.props.autoClose) {\r\n\t\t\tContextMenu.activeWrapper.setState({ menu: null, open: false });\r\n\t\t}\r\n\r\n\t\tif (this.props.onClick) {\r\n\t\t\tthis.props.onClick(this);\r\n\t\t}\r\n\t};\r\n\r\n\trender() {\r\n\t\tconst props = Object.assign({}, this.props);\r\n\r\n\t\tdelete props.autoClose;\r\n\t\tdelete props.icon;\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"ContextMenuItem\" {...props} onClick={this.handleClick}>\r\n\t\t\t\t{this.props.icon}\r\n\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nContextMenu.SubMenuItem = class extends React.Component {\r\n\tstate = { open: false };\r\n\r\n\thandleMouseEnter = () => {\r\n\t\tthis.setState({ open: true });\r\n\t}\r\n\r\n\thandleMouseLeave = () => {\r\n\t\tthis.setState({ open: false });\r\n\t}\r\n\r\n\thandleClick = e => {\r\n\t\tif (e.target !== e.currentTarget) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (ContextMenu.activeWrapper && this.props.autoClose) {\r\n\t\t\tContextMenu.activeWrapper.setState({ menu: null, open: false });\r\n\t\t}\r\n\r\n\t\tif (this.props.onClick) {\r\n\t\t\tthis.props.onClick(this);\r\n\t\t}\r\n\t}\r\n\r\n\tmount(menu) {\r\n\t\tif (!menu) return;\r\n\t\tconst rect = menu.getBoundingClientRect();\r\n\r\n\t\tmenu.style.transform = rect.y + rect.height > window.innerHeight\r\n\t\t\t? `translateY(${window.innerHeight - (rect.y + rect.height) - 20}px)`\r\n\t\t\t: null;\r\n\r\n\t\tif (rect.x + rect.width > window.innerWidth) {\r\n\t\t\tmenu.style.left = \"unset\";\r\n\t\t\tmenu.style.right = \"100%\";\r\n\t\t}\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst props = Object.assign({}, this.props);\r\n\r\n\t\tdelete props.autoClose;\r\n\t\tdelete props.label;\r\n\t\tdelete props.icon;\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"ContextMenuItem HasSubMenu\" {...props} onClick={this.handleClick} onMouseEnter={this.handleMouseEnter} onMouseLeave={this.handleMouseLeave}>\r\n\t\t\t\t{this.props.icon}\r\n\t\t\t\t{this.props.label} <ChevronRight className=\"ContextSubMenuChevron\" />\r\n\t\t\t\t{this.state.open ? (\r\n\t\t\t\t\t<div className=\"ContextMenuContainer SubMenuContainer SecondaryBg\" ref={this.mount}>\r\n\t\t\t\t\t\t<div className=\"ContextMenu SubMenu\">\r\n\t\t\t\t\t\t\t{this.props.children}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t) : null}\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nContextMenu.ToggleItem = class extends React.Component {\r\n\tstate = { checked: false };\r\n\r\n\tcallback = () => {\r\n\t\tif (ContextMenu.activeWrapper && this.props.autoClose) {\r\n\t\t\tContextMenu.activeWrapper.setState({ menu: null, open: false });\r\n\t\t}\r\n\r\n\t\tconst checked = !this.state.checked;\r\n\r\n\t\tif (this.props.callback) {\r\n\t\t\tthis.props.callback(checked);\r\n\t\t}\r\n\r\n\t\tthis.setState({ checked });\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.setState({ checked: this.props.checked });\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst props = Object.assign({}, this.props);\r\n\r\n\t\tdelete props.autoClose;\r\n\t\tdelete props.callback;\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"ContextMenuItem ToggleItem\" {...props} onClick={this.callback}>\r\n\t\t\t\t<div className={\"ToggleBox\" + (this.state.checked ? \" Checked\" : \"\")}>\r\n\t\t\t\t\t{this.state.checked ? (<div className=\"ToggleBoxTick\" />) : null}\r\n\t\t\t\t</div>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nContextMenu.Divider = class extends React.Component {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div className=\"ContextMenuDivider\" {...this.props} />\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default ContextMenu;","import React from \"react\";\r\nimport \"./InlineLoading.scss\";\r\n\r\nexport default function InlineLoading() {\r\n    return (\r\n        <div className=\"InlineLoadingContainer\">\r\n            <div className=\"Dot A\"/>\r\n            <div className=\"Dot B\"/>\r\n            <div className=\"Dot C\"/>\r\n        </div>\r\n    )\r\n}","import React from \"react\";\r\nimport App from \"../App\";\r\n\r\n/**\r\n * A setInterval hook for React components.\r\n * @param callback The function to call for the interval.\r\n * @param delay The delay between each call.\r\n * @param callInstantly Whether or not the callback will call instantly upon registering the hook.\r\n * @param deps The dependencies array for the hook.\r\n */\r\nexport function useInterval(callback, delay, callInstantly = false, deps = []) {\r\n\t// Create side effect\r\n\tReact.useEffect(() => {\r\n\t\t// Create interval based on delay\r\n\t\tconst interval = setInterval(callback, delay);\r\n\t\t// If call instantly is truthy, run the callback\r\n\t\tcallInstantly && callback();\r\n\r\n\t\t// On unmount, clear the interval\r\n\t\treturn () => clearInterval(interval);\r\n\t}, deps);\r\n}\r\n\r\nexport function useDependentState(factory, deps = []) {\r\n\tconst [state, setState] = React.useState(factory());\r\n\r\n\tReact.useMemo(() => {\r\n\t\tconst newState = factory(state);\r\n\r\n\t\tif (newState !== state) {\r\n\t\t\tsetState(newState);\r\n\t\t}\r\n\t}, [state, ...deps]);\r\n\r\n\treturn [state, setState];\r\n}\r\n\r\nexport function useMounted() {\r\n\tconst state = React.useRef(false);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tstate.current = true;\r\n\r\n\t\treturn () => void (state.current = false);\r\n\t}, []);\r\n\r\n\treturn state;\r\n}\r\n\r\nconst promiseCache = {};\r\nexport function usePromise(promise, useCache = true, deps = []) {\r\n\tconst [value, setValue] = useDependentState(\r\n\t\t() => useCache ? promiseCache[promise] : null,\r\n\t\t[promise, ...deps]\r\n\t);\r\n\tconst isMounted = useMounted();\r\n\r\n\tReact.useEffect(() => {\r\n\t\t!value && promise().then(v => (\r\n\t\t\tisMounted.current && setValue(v),\r\n\t\t\tpromiseCache[promise] = v\r\n\t\t));\r\n\t}, deps);\r\n\r\n\treturn value;\r\n}\r\n\r\nexport function useEventListener(eventType, callback, options = {}) {\r\n\tconst {\r\n\t\ttarget = document,\r\n\t\tdependencies = [],\r\n\t\tinit = false\r\n\t} = options;\r\n\r\n\tReact.useEffect(() => {\r\n\t\ttarget.addEventListener(eventType, callback);\r\n\t\tinit && callback();\r\n\r\n\t\treturn () => target.removeEventListener(eventType, callback);\r\n\t}, dependencies);\r\n}\r\n\r\nexport function useOnMount(callback) {\r\n\tReact.useEffect(() => {\r\n\t\tcallback();\r\n\t}, []);\r\n}\r\n\r\nexport function useOnUnmount(callback) {\r\n\tReact.useEffect(() => {\r\n\t\treturn callback;\r\n\t}, []);\r\n}\r\n\r\nexport function useMediaQuery(type, size) {\r\n\tconst query = React.useMemo(() => window.matchMedia(`(${type}: ${size}px)`), [type, size]);\r\n\tconst [state, setState] = React.useState(query.matches);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tconst listener = e => setState(e.matches);\r\n\r\n\t\tquery.addEventListener(\"change\", listener);\r\n\t\treturn () => query.removeEventListener(\"change\", listener);\r\n\t}, [type, size]);\r\n\r\n\treturn state;\r\n}","import React from \"react\";\r\nimport { AlertOctagon } from \"react-feather\";\r\nimport { useMounted } from \"../../../Classes/Hooks\";\r\nimport InlineLoading from \"../../InlineLoading\";\r\nimport { openImageModal } from \"../../Modals\";\r\nimport \"./Styles/ImageRenderer.scss\";\r\n\r\nexport default function ImageRenderer({ src, message = null }) {\r\n\tconst [loaded, setLoaded] = React.useState(false);\r\n\tconst [failed, setFailed] = React.useState(false);\r\n\tconst isMounted = useMounted();\r\n\r\n\tReact.useEffect(() => {\r\n\t\tconst image = Object.assign(\r\n\t\t\tdocument.createElement(\"img\"),\r\n\t\t\t{\r\n\t\t\t\tstyle: \"display:none\",\r\n\t\t\t\tsrc,\r\n\t\t\t\tonload: () => (isMounted && setLoaded(true), image.remove()),\r\n\t\t\t\tonerror: () => (isMounted && setFailed(true), image.remove())\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tdocument.body.appendChild(image);\r\n\r\n\t\treturn () => image.remove();\r\n\t}, [src]);\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"ImageContainer FlexCenter\"\r\n\t\t\tonClick={() => openImageModal(src, () =>\r\n\t\t\t\t[...document.querySelectorAll(\".ImageContainer > .Image\")]\r\n\t\t\t\t\t.reverse().map(e => e.src))}\r\n\t\t>\r\n\t\t\t{failed\r\n\t\t\t\t? (\r\n\t\t\t\t\t<div className=\"FailedPlaceholder FlexCenter\">\r\n\t\t\t\t\t\t<AlertOctagon />\r\n\t\t\t\t\t\t<h4>Image 404</h4>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)\r\n\t\t\t\t: (\r\n\t\t\t\t\tloaded\r\n\t\t\t\t\t\t? (\r\n\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\tclassName=\"Image\"\r\n\t\t\t\t\t\t\t\tsrc={src}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t: (\r\n\t\t\t\t\t\t\t<div className=\"LoadingPlaceholder FlexCenter\">\r\n\t\t\t\t\t\t\t\t<InlineLoading />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n}","import _ from \"lodash\";\r\nimport React from \"react\";\r\nimport { ActionTypes, joinClassNames } from \"../Constants\";\r\nimport { dispatcher } from \"../Dispatcher\";\r\nimport EmoteStore from \"./Stores/EmoteStore\";\r\nimport \"./Styles/Emote.scss\";\r\n\r\nexport default class Emote {\r\n\tid;\r\n\turl;\r\n\tpackId;\r\n\r\n\tconstructor(emote) {\r\n\t\t_.extend(this, emote);\r\n\t}\r\n\r\n\tget Component() {\r\n\t\treturn () => {\r\n\t\t\tconst ref = React.useRef();\r\n\t\t\tconst [size, setSize] = React.useState(\"1.25em\");\r\n\r\n\t\t\tconst url = EmoteStore.useState(() => this.url);\r\n\r\n\t\t\tReact.useEffect(() => {\r\n\t\t\t\tif (ref.current?.parentElement?.childNodes.length === 1) {\r\n\t\t\t\t\tsetSize(\"4em\");\r\n\t\t\t\t}\r\n\t\t\t}, []);\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"Emote\"\r\n\t\t\t\t\tref={ref}\r\n\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\twidth: size,\r\n\t\t\t\t\t\theight: size\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<img\r\n\t\t\t\t\t\tclassName=\"EmoteImage\"\r\n\r\n\t\t\t\t\t\tsrc={url}\r\n\t\t\t\t\t\talt=\"\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t};\r\n\t}\r\n}","import _ from \"lodash\";\r\nimport { ActionTypes } from \"../../Constants\";\r\nimport Database from \"../../Database\";\r\nimport { dispatcher } from \"../../Dispatcher\";\r\nimport Store from \"../../Store\";\r\nimport Emote from \"../Emote\";\r\n\r\nconst cache = {};\r\n\r\nexport const EmoteStoreClass = class EmoteStore extends Store {\r\n\tgetEmote(packId, emoteId) {\r\n\t\treturn _.get(cache, [packId, emoteId]) ?? (\r\n\t\t\tthis.fetchEmote(packId, emoteId),\r\n\t\t\t_.set(cache, [packId, emoteId], new Emote({ packId, id: emoteId, loading: true })),\r\n\t\t\t_.get(cache, [packId, emoteId])\r\n\t\t);\r\n\t}\r\n\r\n\tgetCachedEmotes() {\r\n\t\treturn cache;\r\n\t}\r\n\r\n\tasync fetchEmote(packId, emoteId) {\r\n\t\tconst doc = await Database.getDoc(\r\n\t\t\tDatabase.doc(\"emotepacks\", packId, \"emotes\", emoteId)\r\n\t\t);\r\n\r\n\t\tconst emote = _.extend(\r\n\t\t\t_.get(cache, [packId, emoteId]) ?? new Emote(),\r\n\t\t\t{\r\n\t\t\t\t...doc,\r\n\t\t\t\tpackId,\r\n\t\t\t\tloading: false\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tdispatcher.dispatch({\r\n\t\t\ttype: ActionTypes.FETCH_EMOTE,\r\n\t\t\tpackId, emoteId, emote\r\n\t\t});\r\n\r\n\t\treturn emote;\r\n\t}\r\n}\r\n\r\nconst EmoteStore = new EmoteStoreClass(dispatcher, {\r\n\t[ActionTypes.FETCH_EMOTE]: ({ packId, emoteId, emote }) => {\r\n\t\t_.set(cache, [packId, emoteId], emote);\r\n\t}\r\n});\r\n\r\nexport default EmoteStore;","import _ from \"lodash\";\r\nimport React from \"react\";\r\nimport { defaultRules, parserFor, reactFor, ruleOutput } from \"simple-markdown\";\r\nimport ImageRenderer from \"../Components/Chat/MessageComponents/ImageRenderer\";\r\nimport { ActionTypes } from \"./Constants\";\r\nimport { dispatcher } from \"./Dispatcher\";\r\nimport EmoteStore from \"./Types/Stores/EmoteStore\";\r\nimport UserStore from \"./Types/Stores/UserStore\";\r\n\r\nexport default new class MessageFormatter {\r\n\trules = _.extend(\r\n\t\t{},\r\n\t\tdefaultRules,\r\n\t\t{\r\n\t\t\timage: {\r\n\t\t\t\torder: 10,\r\n\t\t\t\tmatch: src => /^https:\\/\\/(\\S?)+\\.(jpe?g|png|gif|bmp)\\S*(\\s|$)/i.exec(src),\r\n\t\t\t\tparse: (capture, _, state) => ({\r\n\t\t\t\t\tsrc: capture[0].trim(),\r\n\t\t\t\t\tmessage: state?.message,\r\n\t\t\t\t\tstate\r\n\t\t\t\t}),\r\n\t\t\t\treact: (node, _, state) => (\r\n\t\t\t\t\tnode.state.minimal\r\n\t\t\t\t\t\t? <span className=\"MinimalTag\" key={state.key}>[image]</span>\r\n\t\t\t\t\t\t: <ImageRenderer key={state.key} src={node.src} message={node.message} />\r\n\t\t\t\t)\r\n\t\t\t},\r\n\t\t\tuserMention: {\r\n\t\t\t\torder: 10,\r\n\t\t\t\tmatch: src => /^@(\\S{28})/.exec(src),\r\n\t\t\t\tparse: (capture, _, state) => ({ userId: capture[1], state }),\r\n\t\t\t\treact: (node, _, state) => {\r\n\t\t\t\t\tdispatcher.useForceUpdater(\r\n\t\t\t\t\t\tActionTypes.USER_UPDATE,\r\n\t\t\t\t\t\t({ user }) => user.id === node.userId\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tconst user = UserStore.getUser(node.userId);\r\n\r\n\t\t\t\t\treturn user ? (\r\n\t\t\t\t\t\tReact.createElement(\r\n\t\t\t\t\t\t\tuser.Mention,\r\n\t\t\t\t\t\t\t{ key: state.key }\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t) : null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\temote: {\r\n\t\t\t\torder: 10,\r\n\t\t\t\tmatch: src => /^:(\\S+)\\.(\\S+):/.exec(src),\r\n\t\t\t\tparse: (capture, _, state) => ({ packId: capture[1], emoteId: capture[2], src: capture.src, state }),\r\n\t\t\t\treact: (node, _, state) => {\r\n\t\t\t\t\tconst emote = EmoteStore.getEmote(node.packId, node.emoteId);\r\n\r\n\t\t\t\t\treturn emote ? (\r\n\t\t\t\t\t\tReact.createElement(\r\n\t\t\t\t\t\t\temote.Component,\r\n\t\t\t\t\t\t\t{ key: state.key }\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t) : null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tvideo: {\r\n\t\t\t\torder: 10,\r\n\t\t\t\tmatch: src => /^https:\\/\\/(\\S?)+\\.(mp4|webm)(\\S?)+/.exec(src),\r\n\t\t\t\tparse: (capture, _, state) => ({ src: capture[0], state }),\r\n\t\t\t\treact: (node, _, state) => (\r\n\t\t\t\t\t// TODO add custom video component\r\n\t\t\t\t\t<video\r\n\t\t\t\t\t\tkey={state.key}\r\n\t\t\t\t\t\tsrc={node.src}\r\n\t\t\t\t\t\tcontrols\r\n\t\t\t\t\t/>\r\n\t\t\t\t)\r\n\t\t\t},\r\n\t\t\taudio: {\r\n\t\t\t\torder: 10,\r\n\t\t\t\tmatch: src => /^https:\\/\\/(\\S?)+\\.(ogg|mp3|wav)(\\S?)+/.exec(src),\r\n\t\t\t\tparse: (capture, _, state) => ({ src: capture[0], state }),\r\n\t\t\t\treact: (node, _, state) => (\r\n\t\t\t\t\t// TODO add custom audio component\r\n\t\t\t\t\t<audio\r\n\t\t\t\t\t\tkey={state.key}\r\n\t\t\t\t\t\tsrc={node.src}\r\n\t\t\t\t\t\tcontrols\r\n\t\t\t\t\t/>\r\n\t\t\t\t)\r\n\t\t\t},\r\n\t\t\tyoutube: {\r\n\t\t\t\torder: 10,\r\n\t\t\t\tmatch: src => /^https:\\/\\/(www\\.youtube\\.com\\/watch\\?v=|youtu\\.be\\/)(\\S+)/i.exec(src),\r\n\t\t\t\tparse: (capture, _, state) => ({ id: capture[2], state }),\r\n\t\t\t\treact: (node, _, state) => (\r\n\t\t\t\t\t<iframe\r\n\t\t\t\t\t\tkey={state.key}\r\n\t\t\t\t\t\tclassName=\"YouTubeEmbed\"\r\n\t\t\t\t\t\tsrc={`https://www.youtube.com/embed/${node.id}`}\r\n\t\t\t\t\t\tallowFullScreen\r\n\t\t\t\t\t/>\r\n\t\t\t\t)\r\n\t\t\t}\r\n\t\t\t// TODO add file renderer\r\n\t\t\t// TODO add replies\r\n\t\t\t// TODO add color tags\r\n\t\t\t// TODO add size attribute\r\n\t\t\t// TODO add group mention\r\n\t\t\t// TODO add list items\r\n\t\t\t// TODO add polls\r\n\t\t\t// TODO add code blocks\r\n\t\t\t// TODO add invite embeds\r\n\t\t\t// TODO add link embeds\r\n\t\t}\r\n\t);\r\n\r\n\tparser = parserFor(this.rules);\r\n\trender = reactFor(ruleOutput(this.rules, \"react\"));\r\n\r\n\tparse(content, message, props = {}) {\r\n\t\treturn this.render(\r\n\t\t\tthis.parser(\r\n\t\t\t\tcontent,\r\n\t\t\t\t{\r\n\t\t\t\t\tinline: true,\r\n\t\t\t\t\tmessage,\r\n\t\t\t\t\t...props\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t);\r\n\t}\r\n}","import React from \"react\";\r\nimport \"./ErrorBoundary.scss\";\r\nimport { closeModal, openModal } from \"./Modals\";\r\n\r\nexport default class ErrorBoundary extends React.Component {\r\n    state = { error: null, errorInfo: null, moreInfo: false };\r\n    \r\n    constructor(props) {\r\n        super(props);\r\n    }\r\n    \r\n    componentDidCatch(error, errorInfo) {\r\n        // console.error(error, errorInfo);\r\n        \r\n        this.setState({ error, errorInfo });\r\n    }\r\n    \r\n    showErrorInfo() {\r\n        const { error, errorInfo } = this.state;\r\n        \r\n        openModal(\r\n            <div className=\"ErrorInfoModal PrimaryBg\" onClick={() => closeModal()}>\r\n                <h1>{error.message}</h1>\r\n                { errorInfo.componentStack.split(\"\\n\").slice(0, 10).map((msg, i) => <h2 key={i}>{msg}</h2>) }\r\n            </div>\r\n        );\r\n    }\r\n    \r\n    renderError() {\r\n        const { moreInfo } = this.state;\r\n        \r\n        return (\r\n            <div className=\"ErrorBoundaryHandler\">\r\n                <h1>There was an error with this component!</h1>\r\n                <h2>This is due to a plugin error or application error.</h2>\r\n                \r\n                <div className=\"ErrorBoundaryFooter\">\r\n                    <div className=\"ErrorBoundaryButton TertiaryBg\" onClick={() => this.showErrorInfo()}>More Info</div>\r\n                    <div className=\"ErrorBoundaryButton BackgroundDanger\" onClick={() => this.setState({ error: null })}>Retry</div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    render() {\r\n        if (this.state.error)\r\n            return this.renderError();\r\n        \r\n        return this.props.children;\r\n    }\r\n}","import React from \"react\";\r\nimport { Check, Edit2, Edit3, Info, X } from \"react-feather\";\r\nimport { ActionTypes, joinClassNames, mib, openFileDialog, UserStatus } from \"../../Classes/Constants\";\r\nimport Database from \"../../Classes/Database\";\r\nimport { dispatcher } from \"../../Classes/Dispatcher\";\r\nimport MessageFormatter from \"../../Classes/MessageFormatter\";\r\nimport UserStore from \"../../Classes/Types/Stores/UserStore\";\r\nimport User from \"../../Classes/Types/User\";\r\nimport RichTextArea from \"../Chat/RichTextArea\";\r\nimport InlineLoading from \"../InlineLoading\";\r\nimport { Modals } from \"../Modals\";\r\nimport Toasts from \"../Toasts\";\r\nimport \"./UserProfileModal.scss\";\r\n\r\n// TODO add change confirmation when closing modal\r\nexport default function UserProfileModal({ userId }) {\r\n\tconst user = UserStore.useState(() => UserStore.getUser(userId));\r\n\tconst localUser = UserStore.getLocalUser();\r\n\r\n\tconst bgRef = React.useRef();\r\n\tconst bgRefNsfw = React.useRef();\r\n\r\n\tconst [editMode, setEditMode] = React.useState(false);\r\n\tconst [isNsfwRevealed, revealNsfw] = React.useState(false);\r\n\r\n\tdispatcher.useForceUpdater(\r\n\t\tActionTypes.USER_UPDATE,\r\n\t\t({ user }) => user.id === userId\r\n\t);\r\n\r\n\tasync function selectProfileBackground(nsfw = false) {\r\n\t\tconst [file] = await openFileDialog({ type: \"image/*\" });\r\n\t\tif (!file) return;\r\n\r\n\t\tif (file.size > mib(10))\r\n\t\t\treturn Toasts.showToast(\r\n\t\t\t\t\"You cannot upload a background above 10MiB\",\r\n\t\t\t\t\"Failure\"\r\n\t\t\t);\r\n\r\n\t\tDatabase.uploadStorage(file, nsfw ? \"profilebgNsfw\" : \"profilebg\", localUser.id)\r\n\t\t\t.then(r => (\r\n\t\t\t\tlocalUser[nsfw ? \"profileBackgroundNsfw\" : \"profileBackground\"] = r.url,\r\n\t\t\t\tToasts.showToast(\"Background updated - changes will show after confirming changes\", \"Warning\", 10)\r\n\t\t\t))\r\n\t\t\t.catch(err => (console.error(err), Toasts.showToast(\"There was an error uploading your background image\", \"Failure\")));\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"UserProfileModal Flex\">\r\n\t\t\t<div className=\"Background FlexCenter\">\r\n\t\t\t\t{user.profileBackground && <InlineLoading />}\r\n\r\n\t\t\t\t<img\r\n\t\t\t\t\tref={bgRef}\r\n\t\t\t\t\tclassName=\"Image\"\r\n\t\t\t\t\tsrc={user.profileBackground}\r\n\t\t\t\t\tonLoad={e => e.target.style.opacity = 1}\r\n\t\t\t\t/>\r\n\r\n\t\t\t\t{user.profileBackgroundNsfw && User.isNsfwVerified && (\r\n\t\t\t\t\t<img\r\n\t\t\t\t\t\tref={bgRefNsfw}\r\n\t\t\t\t\t\tclassName=\"Image\"\r\n\t\t\t\t\t\tsrc={user.profileBackgroundNsfw}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"LeftSection Flex\">\r\n\t\t\t\t<user.AvatarComponent size={250} />\r\n\r\n\t\t\t\t<h3 className=\"Username\">{user.displayName}</h3>\r\n\r\n\t\t\t\t{editMode\r\n\t\t\t\t\t? (\r\n\t\t\t\t\t\t<RichTextArea defaultValue={user.feed} id=\"UserFeed\">\r\n\t\t\t\t\t\t\tSpecify what you're up to currently with your user feed.\r\n\t\t\t\t\t\t</RichTextArea>\r\n\t\t\t\t\t)\r\n\t\t\t\t\t: (\r\n\t\t\t\t\t\tuser.feed && (\r\n\t\t\t\t\t\t\t<div className=\"Feed\">\r\n\t\t\t\t\t\t\t\t{MessageFormatter.parse(user.feed)}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t<div className=\"AboutFields\">\r\n\t\t\t\t\t{user.about?.map((about, index) => (\r\n\t\t\t\t\t\t<div className=\"AboutField\" key={index}>\r\n\t\t\t\t\t\t\t<h3 className=\"Title\">{about.title}</h3>\r\n\t\t\t\t\t\t\t<div className=\"Body\">{about.field}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t))}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t{editMode && (\r\n\t\t\t\t\t<React.Fragment>\r\n\t\t\t\t\t\t<h4\r\n\t\t\t\t\t\t\tclassName=\"Button\"\r\n\t\t\t\t\t\t\tonClick={() => selectProfileBackground()}\r\n\t\t\t\t\t\t>Pick Background Image</h4>\r\n\r\n\t\t\t\t\t\t<h4\r\n\t\t\t\t\t\t\tclassName=\"Button\"\r\n\t\t\t\t\t\t\tonClick={() => selectProfileBackground(true)}\r\n\t\t\t\t\t\t>Pick NSFW Background</h4>\r\n\t\t\t\t\t</React.Fragment>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t{user.profileBackgroundNsfw && User.isNsfwVerified && (\r\n\t\t\t\t\t<h4\r\n\t\t\t\t\t\tclassName=\"Button NsfwToggle\"\r\n\t\t\t\t\t\tonClick={() => (\r\n\t\t\t\t\t\t\trevealNsfw(!isNsfwRevealed),\r\n\t\t\t\t\t\t\tbgRefNsfw.current.style.opacity = isNsfwRevealed ? 0 : 1\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{isNsfwRevealed ? \"Hide\" : \"Show\"} NSFW Background\r\n\t\t\t\t\t</h4>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"RightSection Flex\">\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<h1 className=\"Header\">Bio</h1>\r\n\t\t\t\t\t<div className={joinClassNames(\"Bio MessageGroup\", [editMode, \"EditMode\"])}>\r\n\t\t\t\t\t\t{editMode\r\n\t\t\t\t\t\t\t? (\r\n\t\t\t\t\t\t\t\t<RichTextArea defaultValue={user.bio} id=\"UserBio\">\r\n\t\t\t\t\t\t\t\t\tDescribe yourself with a personal bio.\r\n\t\t\t\t\t\t\t\t</RichTextArea>\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t: (\r\n\t\t\t\t\t\t\t\tuser.bio\r\n\t\t\t\t\t\t\t\t\t? MessageFormatter.parse(user.bio)\r\n\t\t\t\t\t\t\t\t\t: (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"Placeholder\">\r\n\t\t\t\t\t\t\t\t\t\t\tThis user has no bio.\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"Buttons\">\r\n\t\t\t\t{user === localUser && (\r\n\t\t\t\t\teditMode\r\n\t\t\t\t\t\t? (\r\n\t\t\t\t\t\t\t<Check\r\n\t\t\t\t\t\t\t\tclassName=\"Button\"\r\n\t\t\t\t\t\t\t\tonClick={() => (\r\n\t\t\t\t\t\t\t\t\tsetEditMode(false),\r\n\t\t\t\t\t\t\t\t\tObject.assign(\r\n\t\t\t\t\t\t\t\t\t\tlocalUser,\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tfeed: document.getElementById(\"UserFeed\").value,\r\n\t\t\t\t\t\t\t\t\t\t\tbio: document.getElementById(\"UserBio\").value\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\t\tDatabase.update(\r\n\t\t\t\t\t\t\t\t\t\tlocalUser._ref,\r\n\t\t\t\t\t\t\t\t\t\tlocalUser\r\n\t\t\t\t\t\t\t\t\t).then(() => (\r\n\t\t\t\t\t\t\t\t\t\tToasts.showToast(\r\n\t\t\t\t\t\t\t\t\t\t\t\"Successfully updated profile\"\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t))\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t: (\r\n\t\t\t\t\t\t\t<Edit3\r\n\t\t\t\t\t\t\t\tclassName=\"Button\"\r\n\t\t\t\t\t\t\t\tonClick={() => setEditMode(true)}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t<X\r\n\t\t\t\t\tclassName=\"Button\"\r\n\t\t\t\t\tonClick={() => Modals.pop()}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport _ from \"lodash\";\r\nimport \"./Styles/User.scss\";\r\nimport { ActionTypes, formatDateString, joinClassNames, mib, openFileDialog, UserStatus } from \"../Constants\";\r\nimport UserStore from \"./Stores/UserStore\";\r\nimport Tooltip from \"../../Components/Tooltip\";\r\nimport { Image, MessageSquare, User as UserFeather } from \"react-feather\";\r\nimport ContextMenu from \"../../Components/ContextMenuHandler\";\r\nimport { Modals } from \"../../Components/Modals\";\r\nimport UserProfileModal from \"../../Components/Modals/UserProfileModal\";\r\nimport Toasts from \"../../Components/Toasts\";\r\nimport Database from \"../Database\";\r\n\r\nexport default class User {\r\n\tid = \"\";\r\n\tdisplayName = \"\";\r\n\tavatarUrl = \"\";\r\n\r\n\tconstructor(user) {\r\n\t\t_.extend(this, user);\r\n\t}\r\n\r\n\tget AvatarComponent() {\r\n\t\treturn ({ size = 40, className = \"\" }) => {\r\n\t\t\tconst avatarUrl = UserStore.useState(() => this.avatarUrl);\r\n\t\t\tconst displayName = UserStore.useState(() => this.displayName);\r\n\r\n\t\t\tconst [failed, setFailed] = React.useState(false);\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={joinClassNames(\"AvatarContainer StyleSquare FlexCenter\", className)}\r\n\t\t\t\t\tstyle={{ width: size, height: size }}\r\n\t\t\t\t>\r\n\t\t\t\t\t{failed\r\n\t\t\t\t\t\t? (\r\n\t\t\t\t\t\t\t<UserFeather\r\n\t\t\t\t\t\t\t\tclassName=\"DefaultAvatar\"\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t: (\r\n\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\tclassName=\"Avatar\"\r\n\t\t\t\t\t\t\t\tsrc={avatarUrl}\r\n\t\t\t\t\t\t\t\talt={displayName}\r\n\t\t\t\t\t\t\t\twidth={size} height={size}\r\n\r\n\t\t\t\t\t\t\t\tonError={() => setFailed(true)}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t};\r\n\t}\r\n\r\n\tget StatusText() {\r\n\t\treturn ({ tooltipDirection = \"right\" }) => {\r\n\t\t\tconst status = UserStore.useState(() => this.status);\r\n\t\t\tconst lastOnline = this.lastOnline ? new Date(this.lastOnline) : null;\r\n\r\n\t\t\tswitch (status) {\r\n\t\t\t\tdefault:\r\n\t\t\t\tcase UserStatus.OFFLINE: {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<div className=\"Flex StatusContainer\">\r\n\t\t\t\t\t\t\t<div className=\"Status Offline\" />\r\n\t\t\t\t\t\t\t<div>Offline</div>\r\n\r\n\t\t\t\t\t\t\t{lastOnline && tooltipDirection !== \"none\" && (\r\n\t\t\t\t\t\t\t\t<Tooltip direction={tooltipDirection}>\r\n\t\t\t\t\t\t\t\t\tLast online {formatDateString(lastOnline)} at {lastOnline.toLocaleTimeString(\"en-US\")}\r\n\t\t\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcase UserStatus.ONLINE: {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<div className=\"Flex StatusContainer\">\r\n\t\t\t\t\t\t\t<div className=\"Status Online\" />\r\n\t\t\t\t\t\t\t<div>Online</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcase UserStatus.AWAY: {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<div className=\"Flex StatusContainer\">\r\n\t\t\t\t\t\t\t<div className=\"Status Away\" />\r\n\t\t\t\t\t\t\t<div>Away</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcase UserStatus.BUSY: {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<div className=\"Flex StatusContainer\">\r\n\t\t\t\t\t\t\t<div className=\"Status Busy\" />\r\n\t\t\t\t\t\t\t<div>Busy</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcase UserStatus.BOT: {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<div className=\"Flex StatusContainer\">\r\n\t\t\t\t\t\t\t<div className=\"Status Bot\" />\r\n\t\t\t\t\t\t\t<div>Bot</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tget Mention() {\r\n\t\treturn () => {\r\n\t\t\tconst displayName = UserStore.useState(() => this.displayName);\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<ContextMenu.Wrapper\r\n\t\t\t\t\tmenu={<this.ContextMenu />}\r\n\t\t\t\t\twrapperClassName=\"UserMention\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<this.AvatarComponent size={19} />\r\n\t\t\t\t\t<div className=\"Username\">{displayName}</div>\r\n\t\t\t\t</ContextMenu.Wrapper>\r\n\t\t\t);\r\n\t\t};\r\n\t}\r\n\r\n\tget ContextMenu() {\r\n\t\treturn () => {\r\n\t\t\treturn (\r\n\t\t\t\t<ContextMenu>\r\n\t\t\t\t\t<ContextMenu.Item\r\n\t\t\t\t\t\ticon={<UserFeather />}\r\n\t\t\t\t\t\tonClick={() => Modals.push(<UserProfileModal userId={this.id} />)}\r\n\t\t\t\t\t\tautoClose\r\n\t\t\t\t\t>Profile</ContextMenu.Item>\r\n\r\n\t\t\t\t\t<ContextMenu.Item\r\n\t\t\t\t\t\ticon={<MessageSquare />}\r\n\t\t\t\t\t\tautoClose\r\n\t\t\t\t\t>Message</ContextMenu.Item>\r\n\r\n\t\t\t\t\t<ContextMenu.SubMenuItem\r\n\t\t\t\t\t\tlabel=\"Avatar\"\r\n\t\t\t\t\t\ticon={<Image />}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tyou're mom\r\n\t\t\t\t\t</ContextMenu.SubMenuItem>\r\n\t\t\t\t</ContextMenu>\r\n\t\t\t);\r\n\t\t};\r\n\t}\r\n\r\n\t// TODO add modal\r\n\tstatic async selectAvatar() {\r\n\t\tconst [file] = await openFileDialog({ type: \"image/*\" });\r\n\t\tif (!file) return;\r\n\r\n\t\tif (file.size > mib(8))\r\n\t\t\treturn Toasts.showToast(\r\n\t\t\t\t\"You cannot upload an avatar above 8MiB\",\r\n\t\t\t\t\"Failure\"\r\n\t\t\t);\r\n\r\n\t\tDatabase.uploadStorage(file, \"avatar\", UserStore.getLocalUser().id)\r\n\t\t\t.then(r => (this.avatarUrl = r.url, Toasts.showToast(\"Avatar updated\")))\r\n\t\t\t.catch(err => (console.error(err), Toasts.showToast(\"There was an error uploading your avatar\", \"Failure\")))\r\n\t}\r\n\r\n\tstatic get isNsfwVerified() {\r\n\t\treturn UserStore.getLocalUser()?.nsfwVerified;\r\n\t}\r\n}","import _ from \"lodash\";\r\nimport React from \"react\";\r\nimport \"./RichTextArea.scss\";\r\nimport { getRandomKey, joinClassNames } from \"../../Classes/Constants\";\r\nimport { useEventListener } from \"../../Classes/Hooks\";\r\nimport MessageFormatter from \"../../Classes/MessageFormatter\";\r\n\r\nexport default function RichTextArea(props) {\r\n\tconst containerRef = React.useRef();\r\n\tconst ref = React.useRef();\r\n\r\n\tconst [value, setValue] = React.useState(props.defaultValue ?? \"\");\r\n\tconst [focused, setFocused] = React.useState(false);\r\n\tconst [selection, setSelection] = React.useState([0, 0]);\r\n\r\n\tconst caret = React.useMemo(() =>\r\n\t\t<div className=\"Caret\" key={getRandomKey()} />, [value, selection]);\r\n\r\n\tconst events = {\r\n\t\tonInput: e => {\r\n\t\t\tprops.onInput?.(e);\r\n\r\n\t\t\tsetValue(e.target.value);\r\n\t\t},\r\n\t\tonKeyDown: async e => {\r\n\t\t\tprops.onKeyDown?.();\r\n\r\n\t\t\tswitch (e.key) {\r\n\t\t\t\tcase \"Enter\": {\r\n\t\t\t\t\tif (!e.shiftKey) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tif ((await props.onSend?.(value)) === true) {\r\n\t\t\t\t\t\t\tsetValue(\"\");\r\n\t\t\t\t\t\t\tref.current.value = \"\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} break;\r\n\t\t\t}\r\n\t\t},\r\n\t\tonFocus: () => setFocused(true),\r\n\t\tonBlur: () => setFocused(false)\r\n\t};\r\n\r\n\tuseEventListener(\"selectionchange\", () => {\r\n\t\tconst selection = document.getSelection();\r\n\r\n\t\tif (selection?.anchorNode === containerRef.current) {\r\n\t\t\tsetSelection([\r\n\t\t\t\tref.current.selectionStart,\r\n\t\t\t\tref.current.selectionEnd\r\n\t\t\t]);\r\n\t\t}\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tref={containerRef}\r\n\t\t\tclassName={joinClassNames(\"RichTextArea\", [focused, \"Focused\"])}\r\n\t\t\tonClick={() => setImmediate(() => ref.current.focus())}\r\n\t\t>\r\n\t\t\t<textarea\r\n\t\t\t\tref={ref}\r\n\t\t\t\t{..._.omit(\r\n\t\t\t\t\tprops,\r\n\t\t\t\t\t\"children\", \"onInput\", \"onChange\", \"onSend\",\r\n\t\t\t\t\t\"onKeyDown\"\r\n\t\t\t\t)}\r\n\t\t\t\t{...events}\r\n\t\t\t/>\r\n\r\n\t\t\t{value\r\n\t\t\t\t? (\r\n\t\t\t\t\t<div className=\"Renderer\">\r\n\t\t\t\t\t\t{MessageFormatter.parse(value.slice(0, selection[0]))}\r\n\r\n\t\t\t\t\t\t{selection[1] - selection[0] > 0 && (\r\n\t\t\t\t\t\t\t<span className=\"SelectedText\">\r\n\t\t\t\t\t\t\t\t{value.slice(selection[0], selection[1])}\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t{caret}\r\n\r\n\t\t\t\t\t\t{MessageFormatter.parse(value.slice(selection[1]))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)\r\n\t\t\t\t: (\r\n\t\t\t\t\t<div className=\"Renderer Placeholder\">\r\n\t\t\t\t\t\t{caret}\r\n\t\t\t\t\t\t{props.children}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n}","var _defs, _g;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgWaveVector(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    xmlnsXlink: \"http://www.w3.org/1999/xlink\",\n    style: {\n      isolation: \"isolate\"\n    },\n    viewBox: \"0 0 3840 1080\",\n    width: \"3840pt\",\n    height: \"1080pt\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _defs || (_defs = /*#__PURE__*/React.createElement(\"defs\", null, /*#__PURE__*/React.createElement(\"clipPath\", {\n    id: \"_clipPath_9ysGc3cj8hVy9CQFlwXLbt9IIMadCtby\"\n  }, /*#__PURE__*/React.createElement(\"rect\", {\n    width: 3840,\n    height: 1080\n  })))), _g || (_g = /*#__PURE__*/React.createElement(\"g\", {\n    clipPath: \"url(#_clipPath_9ysGc3cj8hVy9CQFlwXLbt9IIMadCtby)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \" M 0 540 Q 440.909 859.091 960 540 Q 1479.091 220.909 1920 540 L 1920 1080 L 0 1080 L 0 540 Z \",\n    fill: \"currentColor\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \" M 1920 540 Q 2360.909 859.091 2880 540 Q 3399.091 220.909 3840 540 L 3840 1080 L 1920 1080 L 1920 540 Z \",\n    fill: \"currentColor\"\n  }))));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgWaveVector);\nexport default __webpack_public_path__ + \"static/media/WaveVector.d8601ff9.svg\";\nexport { ForwardRef as ReactComponent };","import React from \"react\";\r\nimport \"./AuthModal.scss\";\r\nimport * as Feather from \"react-feather\";\r\nimport { Modals } from \"../Modals\";\r\nimport Toasts from \"../Toasts\";\r\nimport { createUserWithEmailAndPassword, signInWithEmailAndPassword } from \"firebase/auth\";\r\nimport Database from \"../../Classes/Database\";\r\nimport { useEventListener } from \"../../Classes/Hooks\";\r\n\r\n// TODO add password reset functionality.\r\n\r\nexport default function AuthModal() {\r\n\tconst [signUpMode, setSignUpMode] = React.useState(false);\r\n\tconst [busy, setBusy] = React.useState(false);\r\n\tconst ref = React.useRef();\r\n\r\n\t// Create an events object.\r\n\tconst events = {\r\n\t\thandleSignUp: () => {\r\n\t\t\tif (busy) return;\r\n\r\n\t\t\t// Get the input fields.\r\n\t\t\tconst [emailField, passwordField, confirmPasswordField] = ref.current.getElementsByTagName(\"input\");\r\n\r\n\t\t\t// If the passwords don't match, throw an error to the user and return.\r\n\t\t\tif (confirmPasswordField.value !== passwordField.value)\r\n\t\t\t\treturn Toasts.showToast(\"Passwords must match!\", \"Failure\");\r\n\t\t\t// If the email doesn't exist, throw an error to the user and return.\r\n\t\t\tif (!emailField.value.trim())\r\n\t\t\t\treturn Toasts.showToast(\"You must input an email address\", \"Failure\");\r\n\t\t\t// If the password is empty, throw an error to the user and return.\r\n\t\t\tif (!passwordField.value.trim())\r\n\t\t\t\treturn Toasts.showToast(\"You must input a password\", \"Failure\");\r\n\r\n\t\t\t// Set the busy state so users don't spam the API.\r\n\t\t\tsetBusy(true);\r\n\r\n\t\t\t// Create the user account.\r\n\t\t\tcreateUserWithEmailAndPassword(Database.auth, emailField.value, passwordField.value)\r\n\t\t\t\t// Then navigate to the settings.\r\n\t\t\t\t.then(() => (Modals.pop(), Toasts.showToast(\"Welcome to Cirlos!\", \"Success\"), window.location.assign(\"#app\")))\r\n\t\t\t\t// Catch any errors that may have occurred.\r\n\t\t\t\t.catch(e => {\r\n\t\t\t\t\tToasts.showToast(\"An unknown error has occured! Check console for details\", \"Failure\");\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t});\r\n\t\t},\r\n\t\thandleLogIn: () => {\r\n\t\t\tif (busy) return;\r\n\r\n\t\t\t// Get the input fields.\r\n\t\t\tconst [emailField, passwordField] = ref.current.getElementsByTagName(\"input\");\r\n\r\n\t\t\t// Set the busy state so users don't spam the API.\r\n\t\t\tsetBusy(true);\r\n\r\n\t\t\t// Attempt to log in.\r\n\t\t\tsignInWithEmailAndPassword(Database.auth, emailField.value, passwordField.value)\r\n\t\t\t\t// Then navigate to the main app\r\n\t\t\t\t.then(() => (Modals.pop(), window.location.assign(\"#app\")))\r\n\t\t\t\t// Catch any errors that may have occurred.\r\n\t\t\t\t.catch(e => {\r\n\t\t\t\t\tlet message = \"Unknown\";\r\n\r\n\t\t\t\t\tswitch (e.code) {\r\n\t\t\t\t\t\tcase \"auth/invalid-email\":\r\n\t\t\t\t\t\t\tmessage = \"Invalid email address\";\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase \"auth/user-not-found\":\r\n\t\t\t\t\t\t\tmessage = \"No user with this email found\";\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase \"auth/wrong-password\":\r\n\t\t\t\t\t\t\tmessage = \"Incorrect password\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tToasts.showToast(`Failed to sign in! Reason - ${message}`, \"Failure\", 10);\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tuseEventListener(\r\n\t\t\"keydown\",\r\n\t\te => e.key === \"Enter\" && (signUpMode ? events.handleSignUp() : events.handleLogIn())\r\n\t);\r\n\r\n\treturn (\r\n\t\t<div className=\"AuthModal\" ref={ref}>\r\n\t\t\t<Feather.X className=\"CloseButton\" onClick={Modals.pop.bind(Modals)} />\r\n\r\n\t\t\t{signUpMode ? (\r\n\t\t\t\t<React.Fragment>\r\n\t\t\t\t\t<div className=\"MainSection Flex\">\r\n\t\t\t\t\t\t<div className=\"HelpSection\">\r\n\t\t\t\t\t\t\t<div className=\"Title\">NOTE</div>\r\n\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\tBy creating an account,<br />\r\n\t\t\t\t\t\t\t\tyou agree to the following:<br />\r\n\t\t\t\t\t\t\t\t<a href=\"/terms\">Terms of Service</a><br />\r\n\t\t\t\t\t\t\t\t<a href=\"/guidelines\">Community Guidelines</a><br />\r\n\t\t\t\t\t\t\t\t<a href=\"/privacy\">Privacy Policy</a><br />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div className=\"Fields\">\r\n\t\t\t\t\t\t\t<h3>Sign Up</h3>\r\n\r\n\t\t\t\t\t\t\t<div className=\"FieldContainer\">\r\n\t\t\t\t\t\t\t\t<input type=\"email\" placeholder=\"Email Address\" />\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div className=\"FieldContainer\">\r\n\t\t\t\t\t\t\t\t<input type=\"password\" placeholder=\"Password\" />\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div className=\"FieldContainer\">\r\n\t\t\t\t\t\t\t\t<input type=\"password\" placeholder=\"Confirm Password\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"FooterSection Flex\">\r\n\t\t\t\t\t\t<div className=\"Button\" onClick={() => setSignUpMode(false)}>\r\n\t\t\t\t\t\t\t<Feather.LogIn />\r\n\t\t\t\t\t\t\t<div>Log In</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div className=\"Button\" style={{ marginLeft: \"auto\" }} onClick={events.handleSignUp}>\r\n\t\t\t\t\t\t\t<Feather.UserCheck />\r\n\t\t\t\t\t\t\t<div>Sign Up</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</React.Fragment>\r\n\t\t\t) : (\r\n\t\t\t\t<React.Fragment>\r\n\t\t\t\t\t<div className=\"MainSection Flex\">\r\n\t\t\t\t\t\t<div className=\"HelpSection\">\r\n\t\t\t\t\t\t\t<div className=\"Title\">Your</div>\r\n\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\tMom.\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div className=\"Fields\">\r\n\t\t\t\t\t\t\t<h3>Login</h3>\r\n\r\n\t\t\t\t\t\t\t<div className=\"FieldContainer\">\r\n\t\t\t\t\t\t\t\t<input type=\"email\" placeholder=\"Email Address\" />\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div className=\"FieldContainer\">\r\n\t\t\t\t\t\t\t\t<input type=\"password\" placeholder=\"Password\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"FooterSection Flex\">\r\n\t\t\t\t\t\t<div className=\"Button\" onClick={() => setSignUpMode(true)}>\r\n\t\t\t\t\t\t\t<Feather.UserPlus />\r\n\t\t\t\t\t\t\t<div>Sign Up</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div className=\"Button\" style={{ marginLeft: \"auto\" }}>\r\n\t\t\t\t\t\t\t<Feather.Key />\r\n\t\t\t\t\t\t\t<div>Reset Password</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div className=\"Button\" onClick={events.handleLogIn}>\r\n\t\t\t\t\t\t\t<Feather.LogIn />\r\n\t\t\t\t\t\t\t<div>Log In</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</React.Fragment>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t)\r\n}","export default __webpack_public_path__ + \"static/media/TwemojiHeart.a32c5071.svg\";","import React from \"react\";\r\nimport \"./PageFooter.scss\";\r\nimport * as Feather from \"react-feather\";\r\n\r\nimport Icon from \"../../Assets/icon50x50.png\";\r\nimport Heart from \"../../Assets/TwemojiHeart.svg\";\r\nimport Tooltip from \"../Tooltip\";\r\nimport { copyToClipboard } from \"../Modals\";\r\n\r\nexport default function PageFooter() {\r\n    const contacts = {\r\n        website: () => window.open(\"https://metalloriff.github.io/\", \"_blank\"),\r\n        github: () => window.open(\"https://github.com/metalloriff\", \"_blank\"),\r\n        twitter: () => window.open(\"https://twitter.com/Metalloriff\", \"_blank\"),\r\n        email: () => window.open(\"mailto:metalloriff@gmail.com\", \"_blank\"),\r\n        discord: () => copyToClipboard(\"Metalloriff 💕🌈#2891\")\r\n    };\r\n    \r\n    return (\r\n        <footer>\r\n            <div className=\"Flex\">\r\n                <div className=\"LeftSections\">\r\n                    <div className=\"HeadSection FlexCenter\">\r\n                        <img className=\"Logo\" src={Icon} alt=\"Logo\"/>\r\n\r\n                        <div>\r\n                            <h2>Metalloriff</h2>\r\n                            <div>\r\n                                Made with <img src={Heart} alt=\"♥\" width={15} height={15}/>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"ContactSection Flex\">\r\n                        <div className=\"ContactEntry\" onClick={contacts.website}>\r\n                            <Feather.Globe/>\r\n                            <Tooltip>Website</Tooltip>\r\n                        </div>\r\n\r\n                        <div className=\"ContactEntry\" onClick={contacts.github}>\r\n                            <Feather.GitHub/>\r\n                            <Tooltip>GitHub</Tooltip>\r\n                        </div>\r\n\r\n                        <div className=\"ContactEntry\" onClick={contacts.twitter}>\r\n                            <Feather.Twitter/>\r\n                            <Tooltip>Twitter</Tooltip>\r\n                        </div>\r\n\r\n                        <div className=\"ContactEntry\" onClick={contacts.email}>\r\n                            <Feather.Mail/>\r\n                            <Tooltip>Email</Tooltip>\r\n                        </div>\r\n\r\n                        <div className=\"ContactEntry\" onClick={contacts.discord}>\r\n                            <Feather.MessageSquare/>\r\n                            <Tooltip>Discord</Tooltip>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                \r\n                <div className=\"MiddleSection\">\r\n                    {/*  TODO add some shit here.  */}\r\n                </div>\r\n                \r\n                <div className=\"RightSections FlexCenter\">\r\n                    <div className=\"LinksSection\">\r\n                        <a href=\"#clearlyiforgottoaddthis\">Source Code</a>\r\n                        <a href=\"https://feathericons.com/\">Icons Used</a>\r\n                        <a href=\"https://metalloriff.github.io/city-fog\">Color Palette</a>\r\n                        <a href=\"https://paypal.me/israelboone\">\r\n                            <img src={Heart} alt=\"♥\" width={15} height={15}/>\r\n                            <span style={{ margin: \"0 7px\" }}>Donate</span>\r\n                            <img src={Heart} alt=\"♥\" width={15} height={15}/>\r\n                        </a>\r\n                        \r\n                        <div className=\"Copyright\">\r\n                            Copyright © {new Date().getFullYear()} Israel Boone\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </footer>\r\n    );\r\n}","export default \"data:image/png;base64,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\"","import React from \"react\";\r\nimport \"./Home.scss\";\r\n\r\nimport { ReactComponent as WaveVector } from \"../Assets/WaveVector.svg\";\r\nimport * as Feather from \"react-feather\";\r\nimport { Modals } from \"../Components/Modals\";\r\nimport AuthModal from \"../Components/Modals/AuthModal\";\r\nimport UserStore from \"../Classes/Types/Stores/UserStore\";\r\nimport PageFooter from \"../Components/PageElements/PageFooter\";\r\n\r\nexport default function HomePage() {\r\n\tconst localUser = UserStore.useState(UserStore.getLocalUser);\r\n\r\n\treturn (\r\n\t\t<div className=\"HomePage\">\r\n\t\t\t<div className=\"HomeBackgroundContainer\">\r\n\t\t\t\t<div className=\"HomeBackground\">\r\n\t\t\t\t\t<WaveVector />\r\n\t\t\t\t\t<WaveVector />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"Hero\">\r\n\t\t\t\t<h1>Cirlos</h1>\r\n\r\n\t\t\t\t<h3>\r\n\t\t\t\t\tA simpler way to connect with friends and family,<br />\r\n\t\t\t\t\twith powerful ways to personalize your experience.<br />\r\n\t\t\t\t</h3>\r\n\r\n\t\t\t\t<div className=\"Buttons\">\r\n\t\t\t\t\t{localUser !== null\r\n\t\t\t\t\t\t? <React.Fragment>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"Button Focus\"\r\n\t\t\t\t\t\t\t\tonClick={() => window.location.assign(\"#app\")}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<Feather.CheckCircle />\r\n\r\n\t\t\t\t\t\t\t\tContinue To App\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</React.Fragment>\r\n\r\n\t\t\t\t\t\t: <React.Fragment>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"Button Focus\"\r\n\t\t\t\t\t\t\t\tonClick={() => Modals.push(<AuthModal />)}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<Feather.Edit />\r\n\r\n\t\t\t\t\t\t\t\tSign Up\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"Button\"\r\n\t\t\t\t\t\t\t\tonClick={() => Modals.push(<AuthModal />)}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<Feather.LogIn />\r\n\r\n\t\t\t\t\t\t\t\tSign In\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</React.Fragment>}\r\n\r\n\t\t\t\t\t<div className=\"Button\">\r\n\t\t\t\t\t\t<Feather.Download />\r\n\r\n\t\t\t\t\t\tDownload\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div >\r\n\t);\r\n}","import _ from \"lodash\";\r\nimport { ActionTypes } from \"../../Constants\";\r\nimport Database from \"../../Database\";\r\nimport { dispatcher } from \"../../Dispatcher\";\r\nimport Store from \"../../Store\";\r\nimport Circle from \"../Circle\";\r\n\r\nconst cache = {};\r\n\r\nconst CircleStoreClass = class CircleStore extends Store {\r\n\tgetCircle(circleId) {\r\n\t\treturn cache[circleId] ?? (\r\n\t\t\tthis.fetchCircle(circleId),\r\n\t\t\tnew Circle({\r\n\t\t\t\tid: circleId,\r\n\t\t\t\tloading: true,\r\n\t\t\t\tname: \"...\"\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tgetCircles() {\r\n\t\treturn cache;\r\n\t}\r\n\r\n\tasync fetchCircle(circleId, oneTime = false) {\r\n\t\treturn new Promise(r => {\r\n\t\t\tconst unbind = Database.createSnapshotListener(\r\n\t\t\t\tDatabase.doc(\"circles\", circleId),\r\n\t\t\t\tdoc => {\r\n\t\t\t\t\tconst circle = doc\r\n\t\t\t\t\t\t? _.extend(cache[circleId] ?? new Circle(), doc)\r\n\t\t\t\t\t\t: new Circle({\r\n\t\t\t\t\t\t\tid: circleId,\r\n\t\t\t\t\t\t\tname: \"Invalid Circle\"\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\ttype: ActionTypes.CIRCLE_UPDATE,\r\n\t\t\t\t\t\tcircle\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\toneTime && unbind();\r\n\r\n\t\t\t\t\tr(circle);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nconst CircleStore = new CircleStoreClass(dispatcher, {\r\n\t[ActionTypes.CIRCLE_UPDATE]: ({ circle }) => {\r\n\t\tcache[circle.id] = circle;\r\n\t},\r\n\t[ActionTypes.CIRCLE_UPDATE_GROUPS]: ({ circle, groups }) => {\r\n\t\tcache[circle.id]._groups = groups;\r\n\t}\r\n});\r\n\r\nexport default CircleStore;","import { doc, limitToLast, orderBy, query } from \"@firebase/firestore\";\r\nimport _ from \"lodash\";\r\nimport { appHashArgs } from \"../../../App\";\r\nimport { ActionTypes } from \"../../Constants\";\r\nimport Database from \"../../Database\";\r\nimport { dispatcher } from \"../../Dispatcher\";\r\nimport Store from \"../../Store\";\r\nimport Group, { GroupDm } from \"../Group\";\r\nimport CircleStore from \"./CircleStore\";\r\nimport UserStore from \"./UserStore\";\r\n\r\nconst cache = {};\r\nconst groupListeners = {};\r\n\r\nconst GroupStoreClass = class GroupStore extends Store {\r\n\tgetGroup(circleId, groupId) {\r\n\t\treturn _.get(cache, [circleId, groupId]);\r\n\t}\r\n\r\n\tgetSelectedGroup() {\r\n\t\tif (appHashArgs[0] === \"dms\")\r\n\t\t\treturn this.getGroup(\"dms\", appHashArgs[1]);\r\n\r\n\t\treturn this.getGroup(appHashArgs[1], appHashArgs[3]);\r\n\t}\r\n\r\n\tgetGroups(circleId) {\r\n\t\tif (!cache[circleId]) {\r\n\t\t\tthis.fetchGroups(circleId);\r\n\t\t}\r\n\r\n\t\treturn cache[circleId];\r\n\t}\r\n\r\n\tasync fetchGroups(circleId) {\r\n\t\tif (groupListeners[circleId]) return;\r\n\t\tif (circleId === \"dms\") return await this.fetchDms();\r\n\r\n\t\tconst circle = CircleStore.getCircle(circleId);\r\n\t\tif (!circle) return console.error(\r\n\t\t\t`Can't fetch groups for uncached circle with ID \"${circleId}\"!`\r\n\t\t);\r\n\r\n\t\t// TODO make sure this actually completes\r\n\t\twhile (circle.loading)\r\n\t\t\tawait new Promise(r => setTimeout(r, 100));\r\n\r\n\t\treturn new Promise(r => {\r\n\t\t\tconst unbind = Database.createSnapshotListener(\r\n\t\t\t\tDatabase.collection(\"circles\", circleId, \"groups\"),\r\n\t\t\t\t({ items = [] } = {}) => {\r\n\t\t\t\t\tfor (const doc of items) {\r\n\t\t\t\t\t\tconst group = _.extend(\r\n\t\t\t\t\t\t\t_.get(cache, [circleId, doc.id]) ?? new Group(),\r\n\t\t\t\t\t\t\tdoc,\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tparent: circle.groupPositions?.[doc.id]?.[0],\r\n\t\t\t\t\t\t\t\tposition: circle.groupPositions?.[doc.id]?.[1]\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\t\ttype: ActionTypes.GROUP_UPDATE,\r\n\t\t\t\t\t\t\tcircle,\r\n\t\t\t\t\t\t\tgroup\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\ttype: ActionTypes.CIRCLE_UPDATE_GROUPS,\r\n\t\t\t\t\t\tcircle,\r\n\t\t\t\t\t\tgroups: cache[circleId]\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tr(cache[circleId]);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tgroupListeners[circleId] = unbind;\r\n\t\t});\r\n\t}\r\n\r\n\tasync fetchDms() {\r\n\t\tlet user;\r\n\t\twhile (!(user = UserStore.getLocalUser()))\r\n\t\t\tawait new Promise(r => setTimeout(r, 100));\r\n\r\n\t\treturn new Promise(r => {\r\n\t\t\tconst unbind = Database.createSnapshotListener(\r\n\t\t\t\tquery(\r\n\t\t\t\t\tDatabase.collection(\"userdata\", user.id, \"dms\"),\r\n\t\t\t\t\torderBy(\"lastMessageDate\", \"desc\")\r\n\t\t\t\t),\r\n\t\t\t\t({ items = [] } = {}) => {\r\n\t\t\t\t\tfor (const doc of items) {\r\n\t\t\t\t\t\tconst group = _.extend(\r\n\t\t\t\t\t\t\t_.get(cache, [\"dms\", doc.id]) ?? new GroupDm(),\r\n\t\t\t\t\t\t\tdoc,\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tcircleId: \"dms\",\r\n\t\t\t\t\t\t\t\tisDm: true,\r\n\t\t\t\t\t\t\t\tuserId: doc.id\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\t\ttype: ActionTypes.DM_UPDATE,\r\n\t\t\t\t\t\t\tgroup,\r\n\t\t\t\t\t\t\tuserId: doc.id\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\ttype: ActionTypes.BATCH_UPDATE_DMS,\r\n\t\t\t\t\t\tgroups: cache.dms\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tr(cache.dms);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tgroupListeners.dms = unbind;\r\n\t\t});\r\n\t}\r\n}\r\n\r\nconst GroupStore = new GroupStoreClass(dispatcher, {\r\n\t[ActionTypes.GROUP_UPDATE]: ({ circle, group }) => {\r\n\t\t_.set(cache, [circle.id, group.id], group);\r\n\t},\r\n\t[ActionTypes.DM_UPDATE]: ({ group, userId }) => {\r\n\t\t_.set(cache, [\"dms\", userId], group);\r\n\t}\r\n});\r\n\r\nexport default GroupStore;","import _ from \"lodash\";\r\nimport { Modals } from \"../Components/Modals\";\r\nimport GroupStore from \"./Types/Stores/GroupStore\";\r\nimport UserStore from \"./Types/Stores/UserStore\";\r\n\r\nexport const VoiceEvents = {\r\n\tDISCONNECT: \"disconnect\",\r\n\tCONNECT: \"connect\",\r\n\tANSWER: \"ANSWER\",\r\n\tPEERS: \"PEERS\",\r\n\tCONSUME: \"CONSUME\",\r\n\tNEW_PRODUCER: \"NEW_PRODUCER\",\r\n\tUSER_LEFT: \"user_left\"\r\n};\r\n\r\nconst VoiceModule = new class VoiceModule {\r\n\tcurrentRoom = null;\r\n\r\n\tinitialize() {\r\n\t\tif (this.initialized) return;\r\n\t\tthis.initialized = true;\r\n\r\n\t\tthis.socket = new WebSocket(`ws://${window.location.hostname}:5000`);\r\n\r\n\t\tconsole.log(\"socket\", this.socket);\r\n\r\n\t\tthis.socket.addEventListener(\"message\", message => {\r\n\t\t\tconsole.log(\r\n\t\t\t\t\"voice ws message\",\r\n\t\t\t\tmessage\r\n\t\t\t);\r\n\t\t});\r\n\r\n\t\tthis.socket.addEventListener(\"open\", () => {\r\n\t\t\tthis.socket.send(\r\n\t\t\t\tJSON.stringify({\r\n\t\t\t\t\ttype: \"init\",\r\n\t\t\t\t\tuserId: UserStore.getLocalUser().id\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nconst iceOptions = {\r\n\ticeServers: [{\r\n\t\turls: [\"stun:192.99.69.216:46235\"]\r\n\t}],\r\n\ticeCandidatePoolSize: 10\r\n};\r\n\r\n// TODO improve literally all of this because the person who wrote it has never used javascript\r\nexport class ChatRoom {\r\n\tclients = new Map();\r\n\tconsumers = new Map();\r\n\r\n\tconstructor(circleId, groupId) {\r\n\t\tconst group = GroupStore.getGroup(circleId, groupId);\r\n\r\n\t\tif (!group) {\r\n\t\t\tconsole.error(\"Unable to find voice group!\", { circleId, groupId });\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tthis.group = group;\r\n\t}\r\n\r\n\tasync connect() {\r\n\t\tif (VoiceModule.currentRoom)\r\n\t\t\tawait VoiceModule.currentRoom.disconnect();\r\n\r\n\t\tconsole.log(\"should connect\");\r\n\r\n\t\tVoiceModule.socket.addEventListener(\"message\", this.handleMessage.bind(this));\r\n\t\tawait this.connectToSocket();\r\n\r\n\t\tVoiceModule.currentRoom = this;\r\n\t}\r\n\r\n\tcreatePeer() {\r\n\t\treturn _.extend(\r\n\t\t\tnew RTCPeerConnection(iceOptions),\r\n\t\t\t{\r\n\t\t\t\tonicecandidate: this.handleIceCandidate.bind(this),\r\n\t\t\t\tonnegotiationneeded: this.handleNegotiation.bind(this)\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tasync connectToSocket() {\r\n\t\tconst stream = await navigator.mediaDevices.getUserMedia({\r\n\t\t\tvideo: false,\r\n\t\t\taudio: true\r\n\t\t});\r\n\r\n\t\tthis.handleRemoteTrack(stream, UserStore.getLocalUser().id);\r\n\t\tthis.localStream = stream;\r\n\r\n\t\tthis.localPeer = this.createPeer();\r\n\t\tthis.localStream.getTracks().forEach(track =>\r\n\t\t\tthis.localPeer.addTrack(track, this.localStream));\r\n\r\n\t\tawait this.consumeAll();\r\n\t}\r\n\r\n\tasync handleRemoteTrack(stream, userId) {\r\n\t\tconsole.log(\"remote tracK\", stream, userId);\r\n\r\n\t\tconst video = document.getElementById(userId) ?? document.createElement(\"video\");\r\n\r\n\t\tvideo.id = userId;\r\n\t\tvideo.srcObject = stream;\r\n\t\tvideo.autoplay = true;\r\n\t\tvideo.muted = (userId === UserStore.getLocalUser().id);\r\n\t\tvideo.volume = 0.35;\r\n\r\n\t\tdocument.body.appendChild(video);\r\n\t}\r\n\r\n\tasync handleIceCandidate({ candidate }) {\r\n\t\tif (candidate?.candidate?.length) {\r\n\t\t\tconst payload = {\r\n\t\t\t\ttype: \"ice\",\r\n\t\t\t\tice: candidate,\r\n\t\t\t\tuserId: UserStore.getLocalUser().id\r\n\t\t\t};\r\n\r\n\t\t\tVoiceModule.socket.send(JSON.stringify(payload));\r\n\t\t}\r\n\t}\r\n\r\n\tasync handleConsumerIceCandidate({ candidate }, id, consumerId) {\r\n\t\tif (candidate?.candidate?.length) {\r\n\t\t\tconst payload = {\r\n\t\t\t\ttype: \"consumer_ice\",\r\n\t\t\t\tice: candidate,\r\n\t\t\t\tconsumerId\r\n\t\t\t};\r\n\r\n\t\t\tVoiceModule.socket.send(JSON.stringify(payload));\r\n\t\t}\r\n\t}\r\n\r\n\thandleConsume({ sdp, id, consumerId }) {\r\n\t\tconst description = new RTCSessionDescription(sdp);\r\n\r\n\t\tthis.consumers.get(consumerId).setRemoteDescription(description)\r\n\t\t\t.catch(console.error);\r\n\t}\r\n\r\n\tasync createConsumeTransport(peer) {\r\n\t\tconst consumerId = UserStore.getLocalUser().id;\r\n\t\tconst consumerTransport = new RTCPeerConnection(iceOptions);\r\n\r\n\t\tconsole.log({ clients: this.clients, peer, client: this.clients.get(peer.userId) });\r\n\t\tthis.clients.get(peer.userId).consumerId = consumerId;\r\n\r\n\t\tconsumerTransport.userId = consumerId;\r\n\t\tconsumerTransport.peer = peer;\r\n\r\n\t\tthis.consumers.set(consumerId, consumerTransport);\r\n\t\tthis.consumers.get(consumerId).addTransceiver(\"video\", { direction: \"recvonly\" });\r\n\t\tthis.consumers.get(consumerId).addTransceiver(\"audio\", { direction: \"recvonly\" });\r\n\r\n\t\tconst offer = await this.consumers.get(consumerId).createOffer();\r\n\t\tawait this.consumers.get(consumerId).setLocalDescription(offer);\r\n\r\n\t\tthis.consumers.get(consumerId).onicecandidate = e =>\r\n\t\t\tthis.handleConsumerIceCandidate(e, peer.userId, consumerId);\r\n\r\n\t\tconsole.log(this.consumers);\r\n\t\tthis.consumers.get(consumerId).ontrack = e =>\r\n\t\t\tthis.handleRemoteTrack(e.streams[0], peer.userId);\r\n\r\n\t\treturn consumerTransport;\r\n\t}\r\n\r\n\tasync consumeOnce(peer) {\r\n\t\tconst transport = await this.createConsumeTransport(peer);\r\n\r\n\t\tconst payload = {\r\n\t\t\ttype: \"consume\",\r\n\t\t\tid: peer.userId,\r\n\t\t\tconsumerId: transport.userId,\r\n\t\t\tsdp: transport.localDescription\r\n\t\t};\r\n\r\n\t\tVoiceModule.socket.send(JSON.stringify(payload));\r\n\t}\r\n\r\n\tasync handlePeers({ peers }) {\r\n\t\tconsole.log({ peers });\r\n\t\tfor (const peer of peers) {\r\n\t\t\tthis.clients.set(peer.userId, peer);\r\n\r\n\t\t\tawait this.consumeOnce(peer);\r\n\t\t}\r\n\t}\r\n\r\n\thandleAnswer({ sdp }) {\r\n\t\tconst description = new RTCSessionDescription(sdp);\r\n\t\tthis.localPeer.setRemoteDescription(description)\r\n\t\t\t.catch(console.error);\r\n\t}\r\n\r\n\tasync handleNewProducer({ userId }) {\r\n\t\tconsole.log(\"new producer\", userId);\r\n\t\tif (userId === UserStore.getLocalUser().id) return;\r\n\r\n\t\tthis.clients.set(userId, { userId });\r\n\t\tawait this.consumeOnce({ userId });\r\n\t}\r\n\r\n\thandleMessage({ data }) {\r\n\t\tconst message = JSON.parse(data);\r\n\r\n\t\tswitch (message.type) {\r\n\t\t\tcase VoiceEvents.ANSWER:\r\n\t\t\t\treturn this.handleAnswer(message);\r\n\t\t\tcase VoiceEvents.PEERS:\r\n\t\t\t\treturn this.handlePeers(message);\r\n\t\t\tcase VoiceEvents.CONSUME:\r\n\t\t\t\treturn this.handleConsume(message);\r\n\t\t\tcase VoiceEvents.NEW_PRODUCER:\r\n\t\t\t\treturn this.handleNewProducer(message);\r\n\t\t\tcase VoiceEvents.USER_LEFT:\r\n\t\t\t\treturn this.removeUser(message);\r\n\t\t}\r\n\t}\r\n\r\n\tremoveUser() {\r\n\r\n\t}\r\n\r\n\tconsumeAll() {\r\n\t\tconst payload = {\r\n\t\t\ttype: \"getPeers\",\r\n\t\t\tuserId: UserStore.getLocalUser().id\r\n\t\t};\r\n\r\n\t\tVoiceModule.socket.send(JSON.stringify(payload));\r\n\t}\r\n\r\n\tasync handleNegotiation(peer, type) {\r\n\t\tconsole.log(\"negotatiing\");\r\n\r\n\t\tconst offer = await this.localPeer.createOffer();\r\n\t\tawait this.localPeer.setLocalDescription(offer);\r\n\r\n\t\tVoiceModule.socket.send(JSON.stringify({\r\n\t\t\ttype: VoiceEvents.CONNECT,\r\n\t\t\tsdp: this.localPeer.localDescription,\r\n\t\t\tuserId: UserStore.getLocalUser().id\r\n\t\t}));\r\n\t}\r\n\r\n\tasync disconnect() {\r\n\t\tconsole.log(\"should disconnect\");\r\n\r\n\t\tVoiceModule.currentRoom = null;\r\n\t}\r\n}\r\n\r\nexport default VoiceModule;","import _ from \"lodash\";\r\nimport \"./Styles/Groups.scss\";\r\nimport { ChevronDown, MessageSquare, Mic, Phone, Rss } from \"react-feather\";\r\nimport { ActionTypes, GroupType, joinClassNames } from \"../Constants\";\r\nimport { dispatcher } from \"../Dispatcher\";\r\nimport { pushHistoryState } from \"../../App\";\r\nimport { addDoc, collection, serverTimestamp } from \"@firebase/firestore\";\r\nimport UserStore from \"./Stores/UserStore\";\r\nimport GroupStore from \"./Stores/GroupStore\";\r\nimport Database from \"../Database\";\r\nimport CircleStore from \"./Stores/CircleStore\";\r\nimport User from \"./User\";\r\nimport VoiceModule, { ChatRoom } from \"../VoiceModule\";\r\n\r\nexport default class Group {\r\n\tid = \"\";\r\n\ttitle = \"\";\r\n\r\n\tconstructor(group) {\r\n\t\t_.extend(this, group);\r\n\t}\r\n\r\n\tget isNsfw() {\r\n\t\treturn this.nsfw;\r\n\t}\r\n\r\n\tget circle() {\r\n\t\treturn CircleStore.getCircle(this.circleId);\r\n\t}\r\n\r\n\tsendMessage(content) {\r\n\t\treturn addDoc(collection(this._ref, \"messages\"), {\r\n\t\t\tsenderId: UserStore.getLocalUser()?.id,\r\n\t\t\tcontent,\r\n\t\t\tcreationDate: serverTimestamp()\r\n\t\t\t// TODO add mentions\r\n\t\t});\r\n\t}\r\n\r\n\tget Component() {\r\n\t\treturn ({ children }) => {\r\n\t\t\tdispatcher.useForceUpdater(\r\n\t\t\t\tActionTypes.GROUP_UPDATE,\r\n\t\t\t\t({ circle, group }) => circle.id === this.circleId\r\n\t\t\t\t\t&& group.id === this.id\r\n\t\t\t);\r\n\r\n\t\t\tif (this.isNsfw && !User.isNsfwVerified)\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tswitch (this.type) {\r\n\t\t\t\tdefault: return null;\r\n\r\n\t\t\t\tcase GroupType.FOLDER: {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<GroupFolder group={this}>\r\n\t\t\t\t\t\t\t{children}\r\n\t\t\t\t\t\t</GroupFolder>\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcase GroupType.TEXT: {\r\n\t\t\t\t\treturn <GroupText group={this} />;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcase GroupType.VOICE: {\r\n\t\t\t\t\treturn <GroupVoice group={this} />;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcase GroupType.ANNOUNCEMENTS: {\r\n\t\t\t\t\treturn <GroupAnnouncements group={this} />;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}\r\n\r\nfunction GroupFolder({ group, children }) {\r\n\treturn (\r\n\t\t<div className=\"Group TypeFolder\">\r\n\t\t\t<div className=\"Title\">\r\n\t\t\t\t<ChevronDown /> {group.title}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"FolderContents\">\r\n\t\t\t\t{children}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction GroupText({ group }) {\r\n\tconst events = {\r\n\t\tonClick: () => {\r\n\t\t\tpushHistoryState(\r\n\t\t\t\tgroup.circle.lastLocation =\r\n\t\t\t\t`#app/circles/${group.circleId}/groups/${group.id}`\r\n\t\t\t)\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div className={\r\n\t\t\tjoinClassNames(\r\n\t\t\t\t\"Group\",\r\n\t\t\t\t\"TypeText\",\r\n\t\t\t\t[GroupStore.getSelectedGroup() === group, \"Selected\"]\r\n\t\t\t)\r\n\t\t}>\r\n\t\t\t<div className=\"Title\" {...events}>\r\n\t\t\t\t<MessageSquare /> {group.title}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction GroupVoice({ group }) {\r\n\tfunction selectText() {\r\n\t\tpushHistoryState(\r\n\t\t\tgroup.circle.lastLocation =\r\n\t\t\t`#app/circles/${group.circleId}/groups/${group.id}`\r\n\t\t);\r\n\t}\r\n\r\n\tfunction connectToVoice() {\r\n\t\tnew ChatRoom(group.circleId, group.id).connect();\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"Group TypeVoice\">\r\n\t\t\t<div className=\"Title\">\r\n\t\t\t\t<Mic /> {group.title}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"FolderContents\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={\r\n\t\t\t\t\t\tjoinClassNames(\r\n\t\t\t\t\t\t\t\"Group\",\r\n\t\t\t\t\t\t\t\"TypeText\",\r\n\t\t\t\t\t\t\t[GroupStore.getSelectedGroup() === group, \"Selected\"]\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonClick={selectText}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div className=\"Title\">\r\n\t\t\t\t\t\t<MessageSquare /> Text Chat\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={\r\n\t\t\t\t\t\tjoinClassNames(\r\n\t\t\t\t\t\t\t\"Group\",\r\n\t\t\t\t\t\t\t\"TypeText\",\r\n\t\t\t\t\t\t\t[VoiceModule.currentRoom?.group === group, \"Selected\"]\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonClick={connectToVoice}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div className=\"Title\">\r\n\t\t\t\t\t\t<Phone /> Join Room\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction GroupAnnouncements({ group }) {\r\n\treturn (\r\n\t\t<div className=\"Group TypeAnnouncement\">\r\n\t\t\t<div className=\"Title\">\r\n\t\t\t\t<Rss /> {group.title}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport class GroupDm extends Group {\r\n\tuserId = \"\";\r\n\tlastMessageDate;\r\n\r\n\tget isNsfw() {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tget _ref() {\r\n\t\treturn Database.doc(\r\n\t\t\t\"directmessages\",\r\n\t\t\t[UserStore.getLocalUser().id, this.userId].sort().join(\"_\")\r\n\t\t);\r\n\t}\r\n\r\n\tget Component() {\r\n\t\treturn () => {\r\n\t\t\tconst user = UserStore.useState(() => UserStore.getUser(this.userId));\r\n\r\n\t\t\treturn user?.displayName ? (\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"DirectMessageGroup UserSection Flex\"\r\n\t\t\t\t\tonClick={() => pushHistoryState(`#app/dms/${user.id}`)}\r\n\t\t\t\t>\r\n\t\t\t\t\t<user.AvatarComponent />\r\n\r\n\t\t\t\t\t<div className=\"Details\">\r\n\t\t\t\t\t\t<h3 className=\"Username\">{user.displayName}</h3>\r\n\r\n\t\t\t\t\t\t<user.StatusText tooltipDirection=\"none\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t) : null;\r\n\t\t};\r\n\t}\r\n}","import \"./Styles/Circles.scss\";\r\nimport _ from \"lodash\";\r\nimport Tooltip from \"../../Components/Tooltip\";\r\nimport { ActionTypes, getAcronym, joinClassNames } from \"../Constants\";\r\nimport { dispatcher } from \"../Dispatcher\";\r\nimport { appHashArgs, pushHistoryState } from \"../../App\";\r\nimport Database from \"../Database\";\r\nimport { collection } from \"@firebase/firestore\";\r\nimport Group from \"./Group\";\r\nimport GroupStore from \"./Stores/GroupStore\";\r\nimport { Compass } from \"react-feather\";\r\n\r\nlet fetchingGroups = false;\r\nexport default class Circle {\r\n\tid = \"\";\r\n\tname = \"\";\r\n\ticonUrl = \"\";\r\n\r\n\tconstructor(circle) {\r\n\t\t_.extend(this, circle);\r\n\t}\r\n\r\n\t_groups = null;\r\n\r\n\tgetGroups() {\r\n\t\treturn GroupStore.getGroups(this.id);\r\n\t}\r\n\r\n\trenderGroups() {\r\n\t\tconst _groups = this.getGroups();\r\n\r\n\t\tif (_groups) {\r\n\t\t\tconst groups = Object.values(_groups).sort((a, b) => a.position - b.position);\r\n\r\n\t\t\tconst populate = group => (\r\n\t\t\t\t<group.Component key={group.id}>\r\n\t\t\t\t\t{groups.filter(g => g.parent === group.id).map(populate)}\r\n\t\t\t\t</group.Component>\r\n\t\t\t);\r\n\r\n\t\t\treturn [\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={joinClassNames(\r\n\t\t\t\t\t\t\"Group TypeButton\",\r\n\t\t\t\t\t\t[appHashArgs[2] === \"overview\", \"Selected\"]\r\n\t\t\t\t\t)}\r\n\t\t\t\t\tkey=\"__overview\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"Title\"\r\n\t\t\t\t\t\tonClick={() => pushHistoryState(`#app/circles/${appHashArgs[1]}/overview`)}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Compass /> Overview\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>,\r\n\r\n\t\t\t\t...groups.filter(g => !g.parent || !_groups[g.parent]).map(populate)\r\n\t\t\t];\r\n\t\t}\r\n\t}\r\n\r\n\tget BubbleComponent() {\r\n\t\treturn () => {\r\n\t\t\tdispatcher.useForceUpdater(\r\n\t\t\t\tActionTypes.CIRCLE_UPDATE,\r\n\t\t\t\t({ circle }) => circle.id === this.id\r\n\t\t\t);\r\n\r\n\t\t\tconst events = {\r\n\t\t\t\tonClick: () => {\r\n\t\t\t\t\tconst group = localStorage.getItem(`lastGroup.${this.id}`) || \"overview\";\r\n\r\n\t\t\t\t\tpushHistoryState(this.lastLocation ?? `#app/circles/${this.id}/${group}`);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"Circle\" {...events}>\r\n\t\t\t\t\t{this.iconUrl\r\n\t\t\t\t\t\t? <img\r\n\t\t\t\t\t\t\tclassName=\"Icon\"\r\n\t\t\t\t\t\t\tsrc={this.iconUrl}\r\n\t\t\t\t\t\t\talt={this.name}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t: <h3 className=\"Icon Acronym\">\r\n\t\t\t\t\t\t\t{getAcronym(this.name)}\r\n\t\t\t\t\t\t</h3>}\r\n\r\n\t\t\t\t\t<Tooltip direction=\"right\">{this.name}</Tooltip>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t};\r\n\t}\r\n}","import _ from \"lodash\";\r\nimport React from \"react\";\r\nimport { ActionTypes } from \"../../Constants\";\r\nimport Database from \"../../Database\";\r\nimport { dispatcher } from \"../../Dispatcher\";\r\nimport Store from \"../../Store\";\r\nimport UserStore from \"./UserStore\";\r\n\r\nconst styles = {\r\n\t\"group-panel-size\": 250\r\n};\r\n\r\nfunction toKebabCase(camelCase) {\r\n\treturn camelCase.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g, \"$1-$2\").toLowerCase();\r\n}\r\n\r\nconst CssStoreClass = class CssStore extends Store {\r\n\tconstructor(...args) {\r\n\t\tsuper(...args);\r\n\r\n\t\tconst localUserListener = () => {\r\n\t\t\tconst localUser = UserStore.getLocalUser();\r\n\r\n\t\t\tif (localUser) {\r\n\t\t\t\tthis._databaseReference = Database.doc(\"usersettings\", UserStore.getLocalUser().id, \"v2\", \"cssVars\");\r\n\r\n\t\t\t\tDatabase.getDoc(\r\n\t\t\t\t\tthis._databaseReference,\r\n\t\t\t\t).then(data => {\r\n\t\t\t\t\tthis._hasLoaded = true;\r\n\r\n\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\ttype: ActionTypes.BATCH_UPDATE_CSS_VARS,\r\n\t\t\t\t\t\tentries: data ?? {}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tUserStore.removeListener(localUserListener);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tUserStore.addListener(localUserListener);\r\n\r\n\t\tthis._save = _.debounce(this._save.bind(this), 5000);\r\n\t}\r\n\r\n\t_save() {\r\n\t\tif (!this._hasLoaded) return;\r\n\r\n\t\tDatabase.set(this._databaseReference, styles)\r\n\t\t\t.catch(err => console.error(\"Error saving CSS variables!\", err.stack));\r\n\t}\r\n\r\n\tgetStyle(key) {\r\n\t\treturn styles[toKebabCase(key)];\r\n\t}\r\n\r\n\tgetStyles() {\r\n\t\treturn styles;\r\n\t}\r\n\r\n\tget Renderer() {\r\n\t\treturn () => {\r\n\t\t\tdispatcher.useForceUpdater(ActionTypes.UPDATE_CSS_VAR);\r\n\t\t\tdispatcher.useForceUpdater(ActionTypes.BATCH_UPDATE_CSS_VARS);\r\n\r\n\t\t\treturn React.createElement(\r\n\t\t\t\t\"style\",\r\n\t\t\t\t{},\r\n\t\t\t\t`#root {\r\n\t\t\t\t\t${Object.entries(styles).map(([key, value]) => `--${key}: ${value};`).join(\"\\n\")}\r\n\t\t\t\t}`\r\n\t\t\t);\r\n\t\t};\r\n\t}\r\n}\r\n\r\nconst CssStore = new CssStoreClass(dispatcher, {\r\n\t[ActionTypes.UPDATE_CSS_VAR]: ({ key, value }) => {\r\n\t\tstyles[toKebabCase(key)] = value;\r\n\r\n\t\tCssStore._save();\r\n\t},\r\n\t[ActionTypes.BATCH_UPDATE_CSS_VARS]: ({ entries }) => {\r\n\t\tfor (const key in entries) {\r\n\t\t\tconst types = [\"string\", \"number\"];\r\n\t\t\tif (!~types.indexOf(typeof (key)) || !~types.indexOf(typeof (entries[key])))\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tstyles[key] = entries[key];\r\n\t\t}\r\n\t}\r\n});\r\n\r\nexport default CssStore;","import React from \"react\";\r\nimport { Film, MessageSquare, Send } from \"react-feather\";\r\nimport GroupStore from \"../../Classes/Types/Stores/GroupStore\";\r\nimport Toasts from \"../Toasts\";\r\nimport \"./ChatTextArea.scss\";\r\nimport RichTextArea from \"./RichTextArea\";\r\n\r\nexport default function ChatTextArea() {\r\n\tconst events = {\r\n\t\thandleSend: async message => {\r\n\t\t\tif (message.trim()) {\r\n\t\t\t\tconst group = GroupStore.getSelectedGroup();\r\n\t\t\t\tif (!group) return Toasts.showToast(\"No selected group!\", \"Failure\");\r\n\r\n\t\t\t\tgroup.sendMessage(message);\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div className=\"ChatTextAreaContainer Flex\">\r\n\t\t\t<RichTextArea\r\n\t\t\t\tid=\"ChatTextArea\"\r\n\t\t\t\tclassName=\"ChatTextArea\"\r\n\t\t\t\tonSend={events.handleSend}\r\n\t\t\t><MessageSquare /> Say hi! </RichTextArea>\r\n\r\n\t\t\t<div className=\"Button\">\r\n\t\t\t\t<Film />\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"Button\" onClick={() => (\r\n\t\t\t\tdocument.getElementById(\"ChatTextArea\").dispatchEvent(\r\n\t\t\t\t\tnew KeyboardEvent(\"keydown\", {\r\n\t\t\t\t\t\tkey: \"Enter\",\r\n\t\t\t\t\t\tshiftKey: false,\r\n\t\t\t\t\t\tbubbles: true\r\n\t\t\t\t\t})\r\n\t\t\t\t)\r\n\t\t\t)}>\r\n\t\t\t\t<Send />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t)\r\n}","import _ from \"lodash\";\r\nimport { formatDateString } from \"../Constants\";\r\nimport MessageFormatter from \"../MessageFormatter\";\r\n\r\nexport default class Message {\r\n\tid = \"\";\r\n\tcontent = \"\";\r\n\tsenderId = \"\";\r\n\tcreationDate = null;\r\n\tmentions = [];\r\n\r\n\tconstructor(message) {\r\n\t\t_.extend(this, message);\r\n\t}\r\n\r\n\tgetContent(props = {}) {\r\n\t\treturn MessageFormatter.parse(this.content, this, props);\r\n\t}\r\n\r\n\tgetCreationDate(_time) {\r\n\t\tif (!_time && !this.creationDate) return \"\";\r\n\t\tconst time = _time?.toDate?.() ?? _time ?? this.creationDate.toDate();\r\n\r\n\t\treturn `${formatDateString(time)} at ${time.toLocaleTimeString(\"en-US\")}`\r\n\t}\r\n}","import { limitToLast, orderBy, query } from \"@firebase/firestore\";\r\nimport _ from \"lodash\";\r\nimport { ActionTypes } from \"../../Constants\";\r\nimport Database from \"../../Database\";\r\nimport { dispatcher } from \"../../Dispatcher\";\r\nimport Store from \"../../Store\";\r\nimport Message from \"../Message\";\r\nimport UserStore from \"./UserStore\";\r\n\r\nconst cache = {};\r\nconst cleanupCache = {};\r\n\r\nexport const MessageStoreClass = class MessageStore extends Store {\r\n\tgetMessage(circleId, groupId, messageId) {\r\n\t\treturn _.get(cache, [circleId, groupId, messageId]);\r\n\t}\r\n\r\n\tgetMessages(circleId, groupId) {\r\n\t\treturn _.get(cache, [circleId, groupId]) ?? (\r\n\t\t\tthis.fetchMessages(circleId, groupId),\r\n\t\t\tnull\r\n\t\t);\r\n\t}\r\n\r\n\tgetMessageGroups(circleId, groupId) {\r\n\t\t// TODO add unread divider\r\n\r\n\t\tconst _messages = this.getMessages(circleId, groupId);\r\n\t\tif (!_messages) return null;\r\n\r\n\t\tconst messages = Object.values(_messages);\r\n\t\tconst groups = [];\r\n\r\n\t\tlet lastMessage;\r\n\t\tlet currentGroup;\r\n\r\n\t\tfor (const message of messages) {\r\n\t\t\tconst isSeparateUser = lastMessage?.senderId !== message.senderId;\r\n\t\t\tconst isSeparateTime = message.creationDate - lastMessage?.creationDate > 600;\r\n\r\n\t\t\tif (!lastMessage || isSeparateUser || isSeparateTime) {\r\n\t\t\t\tcurrentGroup && lastMessage && groups.push({\r\n\t\t\t\t\tkey: \"mg-\" + lastMessage.id,\r\n\t\t\t\t\tuserId: lastMessage.senderId,\r\n\t\t\t\t\tmessages: currentGroup\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcurrentGroup = [];\r\n\t\t\t}\r\n\r\n\t\t\tcurrentGroup.push(message);\r\n\t\t\tlastMessage = message;\r\n\t\t}\r\n\r\n\t\tcurrentGroup && groups.push({\r\n\t\t\tkey: \"mg-\" + currentGroup[0].id,\r\n\t\t\tuserId: currentGroup[0].senderId,\r\n\t\t\tmessages: currentGroup\r\n\t\t});\r\n\r\n\t\treturn groups.reverse();\r\n\t}\r\n\r\n\tgetAllCachedMessages() {\r\n\t\treturn cache;\r\n\t}\r\n\r\n\ttickCache(circleId, groupId) {\r\n\t\tconst tick = _.get(cleanupCache, [circleId, groupId]);\r\n\r\n\t\ttick?.();\r\n\t}\r\n\r\n\tasync fetchMessages(circleId, groupId) {\r\n\t\treturn new Promise(r => {\r\n\t\t\tconst ref = circleId === \"dms\"\r\n\t\t\t\t? Database.collection(\r\n\t\t\t\t\t\"directmessages\",\r\n\t\t\t\t\t[UserStore.getLocalUser().id, groupId].sort().join(\"_\"),\r\n\t\t\t\t\t\"messages\"\r\n\t\t\t\t)\r\n\t\t\t\t: Database.collection(\r\n\t\t\t\t\t\"circles\",\r\n\t\t\t\t\tcircleId,\r\n\t\t\t\t\t\"groups\",\r\n\t\t\t\t\tgroupId,\r\n\t\t\t\t\t\"messages\"\r\n\t\t\t\t);\r\n\r\n\t\t\tconst unbind = Database.createSnapshotListener(\r\n\t\t\t\tquery(\r\n\t\t\t\t\tref,\r\n\t\t\t\t\torderBy(\"creationDate\"),\r\n\t\t\t\t\tlimitToLast(50)\r\n\t\t\t\t),\r\n\t\t\t\t({ changes = [] } = {}) => {\r\n\t\t\t\t\tfor (const change of changes) {\r\n\t\t\t\t\t\tswitch (change.type) {\r\n\t\t\t\t\t\t\tcase \"added\": {\r\n\t\t\t\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\t\t\t\ttype: ActionTypes.MESSAGE_CREATE,\r\n\t\t\t\t\t\t\t\t\tcircleId, groupId,\r\n\t\t\t\t\t\t\t\t\tmessage: new Message(change.data)\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} break;\r\n\r\n\t\t\t\t\t\t\tcase \"modified\": {\r\n\t\t\t\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\t\t\t\ttype: ActionTypes.MESSAGE_UPDATE,\r\n\t\t\t\t\t\t\t\t\tcircleId, groupId,\r\n\t\t\t\t\t\t\t\t\tmessage: _.extend(\r\n\t\t\t\t\t\t\t\t\t\tthis.getMessage(circleId, groupId)\r\n\t\t\t\t\t\t\t\t\t\t?? new Message(change.data),\r\n\t\t\t\t\t\t\t\t\t\tchange.data\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} break;\r\n\r\n\t\t\t\t\t\t\tcase \"removed\": {\r\n\t\t\t\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\t\t\t\ttype: ActionTypes.MESSAGE_DELETE,\r\n\t\t\t\t\t\t\t\t\tcircleId, groupId,\r\n\t\t\t\t\t\t\t\t\tmessageId: change.doc.id\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} break;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\ttype: ActionTypes.CHAT_UPDATE,\r\n\t\t\t\t\t\tcircleId, groupId\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tr(_.get(cache, [circleId, groupId]));\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\t_.set(cleanupCache, [circleId, groupId], _.debounce(() => {\r\n\t\t\t\tunbind();\r\n\r\n\t\t\t\tdelete cache[circleId][groupId];\r\n\t\t\t\tdelete cleanupCache[circleId][groupId];\r\n\t\t\t}, 10 * 60 * 1000));\r\n\t\t});\r\n\t}\r\n}\r\n\r\nconst MessageStore = new MessageStoreClass(dispatcher, {\r\n\t[ActionTypes.MESSAGE_CREATE]: ({ circleId, groupId, message }) => {\r\n\t\t_.set(cache, [circleId, groupId, message.id], message);\r\n\t},\r\n\t[ActionTypes.MESSAGE_UPDATE]: ({ circleId, groupId, message }) => {\r\n\t\t_.set(cache, [circleId, groupId, message.id], message);\r\n\t},\r\n\t[ActionTypes.MESSAGE_DELETE]: ({ circleId, groupId, messageId }) => {\r\n\t\tdelete cache[circleId]?.[groupId]?.[messageId];\r\n\t}\r\n})\r\n\r\nexport default MessageStore;","import _ from \"lodash\";\r\nimport React from \"react\";\r\nimport { ActionTypes, joinClassNames } from \"../../Classes/Constants\";\r\nimport { dispatcher } from \"../../Classes/Dispatcher\";\r\nimport { useInterval, useMediaQuery } from \"../../Classes/Hooks\";\r\nimport CssStore from \"../../Classes/Types/Stores/CssStore\";\r\nimport MessageStore from \"../../Classes/Types/Stores/MessageStore\";\r\nimport UserStore from \"../../Classes/Types/Stores/UserStore\";\r\nimport ContextMenu from \"../ContextMenuHandler\";\r\nimport InlineLoading from \"../InlineLoading\";\r\nimport Tooltip from \"../Tooltip\";\r\nimport \"./ChatPanel.scss\";\r\n\r\nexport default function ChatPanel({ circleId, groupId }) {\r\n\tdispatcher.useForceUpdater(\r\n\t\tActionTypes.CHAT_UPDATE,\r\n\t\te => e.circleId == circleId && e.groupId == groupId\r\n\t);\r\n\r\n\tconst ref = React.useRef();\r\n\r\n\tconst messages = MessageStore.getMessageGroups(circleId, groupId);\r\n\tconst isMobile = useMediaQuery(\"max-width\", 700);\r\n\r\n\tconst mobileEvents = React.useMemo(() => isMobile ? {\r\n\t\tonTouchStart: e => {\r\n\t\t\tconst tapX = e.touches[0].clientX;\r\n\t\t\tconst tapY = e.touches[0].clientY;\r\n\t\t\tconst target = CssStore.getStyle(\"groupPanelSize\") + 60;\r\n\r\n\t\t\tlet translation = 0;\r\n\t\t\tlet lastTranslation = parseFloat(ref.current.style.transform.match(/[0-9]+/g));\r\n\t\t\tif (isNaN(lastTranslation)) lastTranslation = 0;\r\n\r\n\t\t\tconst handler = e => {\r\n\t\t\t\tconst alias = 50;\r\n\t\t\t\ttranslation = e.touches[0].clientX - tapX;\r\n\r\n\t\t\t\tif (Math.abs(translation) < alias || Math.abs(e.touches[0].clientY - tapY) > 50) return;\r\n\t\t\t\tif (translation < 0) translation += alias;\r\n\t\t\t\telse translation -= alias;\r\n\r\n\t\t\t\tObject.assign(ref.current.style, {\r\n\t\t\t\t\ttransform: `translateX(${_.clamp(lastTranslation + translation, 0, target)}px)`\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tdocument.addEventListener(\"touchmove\", handler);\r\n\r\n\t\t\tlet remove;\r\n\t\t\tdocument.addEventListener(\"touchend\", remove = () => {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tObject.assign(ref.current.style, {\r\n\t\t\t\t\t\ttransform: translation > target / 3 ? `translateX(${target}px)` : \"none\"\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tdocument.removeEventListener(\"touchmove\", handler);\r\n\t\t\t\t\tdocument.removeEventListener(\"touchend\", remove);\r\n\t\t\t\t}, 100);\r\n\t\t\t});\r\n\t\t}\r\n\t} : {}, [isMobile]);\r\n\r\n\tuseInterval(\r\n\t\t() => MessageStore.tickCache(circleId, groupId),\r\n\t\t1000,\r\n\t\ttrue,\r\n\t\t[circleId, groupId]\r\n\t);\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"Panel PanelChat\"\r\n\t\t\tref={ref}\r\n\t\t\t{...mobileEvents}\r\n\t\t>\r\n\t\t\t{messages\r\n\t\t\t\t? (\r\n\t\t\t\t\t<div className=\"Messages\">\r\n\t\t\t\t\t\t{messages.map(group => (\r\n\t\t\t\t\t\t\t<MessageGroup {...group} />\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)\r\n\t\t\t\t: (\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"FlexCenter\"\r\n\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\tmarginTop: 50\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<InlineLoading />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function MessageGroup({ userId, messages }) {\r\n\tconst user = UserStore.useState(() => UserStore.getUser(userId));\r\n\r\n\treturn (\r\n\t\t<div className={\r\n\t\t\tjoinClassNames(\r\n\t\t\t\t\"MessageGroup\",\r\n\t\t\t\t[userId === UserStore.getLocalUser()?.id, \"LocalUser\"]\r\n\t\t\t)}\r\n\t\t>\r\n\t\t\t<ContextMenu.Wrapper\r\n\t\t\t\tmenu={<user.ContextMenu />}\r\n\t\t\t\twrapperClassName=\"UserSection Flex\"\r\n\t\t\t>\r\n\t\t\t\t{user && <user.AvatarComponent />}\r\n\r\n\t\t\t\t<div className=\"Details\">\r\n\t\t\t\t\t<h3 className=\"Username\">{user.displayName}</h3>\r\n\r\n\t\t\t\t\t<user.StatusText />\r\n\t\t\t\t</div>\r\n\t\t\t</ContextMenu.Wrapper>\r\n\r\n\t\t\t{messages.map(message => (\r\n\t\t\t\t<div className=\"Message Flex\" key={message.id}>\r\n\t\t\t\t\t<div className=\"TimestampContainer\">\r\n\t\t\t\t\t\t<span className=\"Timestamp\">\r\n\t\t\t\t\t\t\t{message.creationDate?.toDate().toLocaleTimeString(\"en-US\", { hour12: false }).slice(0, -3)}\r\n\t\t\t\t\t\t</span>\r\n\r\n\t\t\t\t\t\t<Tooltip direction=\"right\">\r\n\t\t\t\t\t\t\t<div>Sent {message.getCreationDate()}</div>\r\n\r\n\t\t\t\t\t\t\t{message.editedAt && (\r\n\t\t\t\t\t\t\t\t<div>Edited {message.getCreationDate(message.editedAt)}</div>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"MessageContent\">\r\n\t\t\t\t\t\t{message.getContent()}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t))}\r\n\t\t</div>\r\n\t);\r\n}","import _ from \"lodash\";\r\nimport React from \"react\";\r\nimport { ActionTypes } from \"../../Classes/Constants\";\r\nimport { dispatcher } from \"../../Classes/Dispatcher\";\r\n\r\nexport default function GroupsPanel({ children }) {\r\n\tconst ref = React.useRef();\r\n\r\n\tconst handleScaler = React.useMemo(() => e => {\r\n\t\tdispatcher.dispatch({\r\n\t\t\ttype: ActionTypes.UPDATE_CSS_VAR,\r\n\t\t\tkey: \"groupPanelSize\",\r\n\t\t\tvalue: _.clamp(\r\n\t\t\t\te.clientX - ref.current.getBoundingClientRect().x,\r\n\t\t\t\t100, 500\r\n\t\t\t)\r\n\t\t});\r\n\t}, [children]);\r\n\r\n\tconst events = {\r\n\t\tonMouseDown: () => {\r\n\t\t\tdocument.addEventListener(\"mousemove\", handleScaler);\r\n\r\n\t\t\tlet remove;\r\n\t\t\tdocument.addEventListener(\"mouseup\", remove = () => {\r\n\t\t\t\tdocument.removeEventListener(\"mousemove\", handleScaler);\r\n\t\t\t\tdocument.removeEventListener(\"mouseup\", remove);\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div className=\"Panel PanelGroups\" ref={ref}>\r\n\t\t\t{children}\r\n\r\n\t\t\t<div className=\"GroupsScaler\" {...events} />\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport { appHashArgs } from \"../../App\";\r\nimport { getAcronym } from \"../../Classes/Constants\";\r\nimport CircleStore from \"../../Classes/Types/Stores/CircleStore\";\r\nimport UserStore from \"../../Classes/Types/Stores/UserStore\";\r\nimport { openImageModal } from \"../Modals\";\r\nimport \"./CircleOverview.scss\";\r\n\r\nexport default function CircleOverview({ circleId }) {\r\n\tconst circle = CircleStore.getCircle(circleId);\r\n\tconst owner = UserStore.useState(() => UserStore.getUser(circle?.ownerId));\r\n\r\n\treturn circle ? (\r\n\t\t<div className=\"CircleOverview FlexCenter\">\r\n\t\t\t<div className=\"Hero FlexCenter\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"Circle\"\r\n\t\t\t\t\tonClick={() => openImageModal(circle.iconUrl)}\r\n\t\t\t\t>\r\n\t\t\t\t\t{circle.iconUrl\r\n\t\t\t\t\t\t? <img\r\n\t\t\t\t\t\t\tclassName=\"Icon\"\r\n\t\t\t\t\t\t\tsrc={circle.iconUrl}\r\n\t\t\t\t\t\t\talt={getAcronym(circle.name)}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t: <h3 className=\"Icon Acronym\">\r\n\t\t\t\t\t\t\t{getAcronym(circle.name)}\r\n\t\t\t\t\t\t</h3>}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"Banner\">\r\n\t\t\t\t\t{circle.iconUrl && (\r\n\t\t\t\t\t\t// TODO add banner images\r\n\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\tclassName=\"BannerImage Default\"\r\n\t\t\t\t\t\t\tsrc={circle.iconUrl}\r\n\t\t\t\t\t\t\talt=\"banner\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<h1 className=\"Title\">{circle.name}</h1>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t) : null;\r\n}","import _ from \"lodash\";\r\nimport React from \"react\";\r\nimport { appHashArgs } from \"../../App\";\r\nimport { ActionTypes } from \"../../Classes/Constants\";\r\nimport { dispatcher } from \"../../Classes/Dispatcher\";\r\nimport ChatPanel from \"../Panels/ChatPanel\";\r\nimport GroupsPanel from \"../Panels/GroupsPanel\";\r\nimport CircleOverview from \"./CircleOverview\";\r\nimport \"./CirclePage.scss\";\r\n\r\nexport default function CirclePage({ circle }) {\r\n\tdispatcher.useForceUpdater(ActionTypes.PAGE_UPDATE);\r\n\r\n\tdispatcher.useForceUpdater(\r\n\t\tActionTypes.CIRCLE_UPDATE_GROUPS,\r\n\t\te => e.circle.id === circle.id,\r\n\t\t[circle]\r\n\t);\r\n\r\n\tfunction RightHandRenderer() {\r\n\t\tswitch (appHashArgs[2]) {\r\n\t\t\tcase \"groups\": {\r\n\t\t\t\treturn <ChatPanel circleId={circle.id} groupId={appHashArgs[3]} />;\r\n\t\t\t}\r\n\r\n\t\t\tcase \"overview\": {\r\n\t\t\t\treturn <CircleOverview circleId={circle.id} />\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"CirclePage Flex\">\r\n\t\t\t<GroupsPanel>\r\n\t\t\t\t{circle.renderGroups()}\r\n\t\t\t</GroupsPanel>\r\n\r\n\t\t\t<RightHandRenderer />\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport \"./DmsPage.scss\";\r\nimport { appHashArgs } from \"../../App\";\r\nimport { ActionTypes } from \"../../Classes/Constants\";\r\nimport { dispatcher } from \"../../Classes/Dispatcher\";\r\nimport GroupStore from \"../../Classes/Types/Stores/GroupStore\";\r\nimport GroupsPanel from \"../Panels/GroupsPanel\";\r\nimport ChatPanel from \"../Panels/ChatPanel\";\r\n\r\nfunction renderGroups(_groups) {\r\n\tif (!_groups) return null;\r\n\tconst groups = Object.values(_groups).sort((a, b) => b.lastMessageDate - a.lastMessageDate);\r\n\r\n\treturn groups.map(group => (\r\n\t\t<group.Component key={group.groupId} />\r\n\t));\r\n}\r\n\r\nexport default function DmsPage() {\r\n\tdispatcher.useForceUpdater(ActionTypes.PAGE_UPDATE);\r\n\tdispatcher.useForceUpdater(ActionTypes.BATCH_UPDATE_DMS);\r\n\r\n\tconst groups = GroupStore.getGroups(\"dms\");\r\n\r\n\tfunction RightHandRenderer() {\r\n\t\tswitch (appHashArgs[1]?.trim() ?? \"\") {\r\n\t\t\tcase \"\": {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tdefault: {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<ChatPanel\r\n\t\t\t\t\t\tcircleId=\"dms\"\r\n\t\t\t\t\t\tgroupId={appHashArgs[1]}\r\n\t\t\t\t\t/>\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tconsole.log(groups);\r\n\r\n\treturn (\r\n\t\t<div className=\"DmsPage Flex\">\r\n\t\t\t<GroupsPanel>\r\n\t\t\t\t{renderGroups(groups)}\r\n\t\t\t</GroupsPanel>\r\n\r\n\t\t\t<RightHandRenderer />\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport { appHash, appHashArgs } from \"../../App\";\r\nimport { ActionTypes, joinClassNames } from \"../../Classes/Constants\";\r\nimport { dispatcher } from \"../../Classes/Dispatcher\";\r\nimport CircleStore from \"../../Classes/Types/Stores/CircleStore\";\r\nimport GroupStore from \"../../Classes/Types/Stores/GroupStore\";\r\nimport CirclePage from \"../AppPages/CirclePage\";\r\nimport DmsPage from \"../AppPages/DmsPage\";\r\nimport \"./CorePanel.scss\";\r\n\r\nexport default function CorePanel() {\r\n\tdispatcher.useForceUpdater(ActionTypes.PAGE_UPDATE);\r\n\r\n\tswitch (appHashArgs[0]) {\r\n\t\tcase undefined:\r\n\t\tcase \"\": {\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"AppHome FlexCenter\">\r\n\t\t\t\t\t<h2>\r\n\t\t\t\t\t\tWelcome to the new Cirlos!\r\n\t\t\t\t\t</h2>\r\n\r\n\t\t\t\t\t<p>\r\n\t\t\t\t\t\tCirlos has been completely redesigned and rewritten, from the ground up.\r\n\t\t\t\t\t</p>\r\n\r\n\t\t\t\t\t<p>\r\n\t\t\t\t\t\tThis means better UI/UX, stability, and performance.\r\n\t\t\t\t\t</p>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tcase \"circles\": {\r\n\t\t\tconst circle = CircleStore.getCircle(appHashArgs[1]);\r\n\r\n\t\t\tif (circle) {\r\n\t\t\t\tconsole.log(circle);\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<CirclePage circle={circle} />\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className=\"AppHome FlexCenter\">\r\n\t\t\t\t\t\t<h2>\r\n\t\t\t\t\t\t\tOops!\r\n\t\t\t\t\t\t</h2>\r\n\r\n\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\tThis circle could not be loaded properly.\r\n\t\t\t\t\t\t</p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcase \"dms\": {\r\n\t\t\t// const group = appHashArgs[1]\r\n\t\t\t// \t? GroupStore.getGroup(\"dms\", appHashArgs[1])\r\n\t\t\t// \t: null;\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<DmsPage />\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t// TODO add 404\r\n\treturn (\r\n\t\t<div className=\"AppHome Flex\">\r\n\r\n\t\t</div>\r\n\t);\r\n}","import _ from \"lodash\";\r\nimport React from \"react\";\r\nimport { Users } from \"react-feather\";\r\nimport { pushHistoryState } from \"../App\";\r\nimport { joinClassNames } from \"../Classes/Constants\";\r\nimport Database from \"../Classes/Database\";\r\nimport { useOnMount } from \"../Classes/Hooks\";\r\nimport Circle from \"../Classes/Types/Circle\";\r\nimport CircleStore from \"../Classes/Types/Stores/CircleStore\";\r\nimport CssStore from \"../Classes/Types/Stores/CssStore\";\r\nimport UserStore from \"../Classes/Types/Stores/UserStore\";\r\nimport VoiceModule, { initializeVoiceModule } from \"../Classes/VoiceModule\";\r\nimport ChatTextArea from \"../Components/Chat/ChatTextArea\";\r\nimport ContextMenu from \"../Components/ContextMenuHandler\";\r\nimport InlineLoading from \"../Components/InlineLoading\";\r\nimport CorePanel from \"../Components/Panels/CorePanel\";\r\nimport Toasts from \"../Components/Toasts\";\r\nimport Tooltip from \"../Components/Tooltip\";\r\nimport \"./AppPage.scss\";\r\n\r\nexport default function AppPage() {\r\n\tconst localUser = UserStore.useState(UserStore.getLocalUser);\r\n\r\n\tif (localUser === null) {\r\n\t\tToasts.showToast(\"You must be signed in to access the app\", \"Failure\");\r\n\r\n\t\twindow.location.assign(window.location.origin);\r\n\t}\r\n\r\n\treturn localUser ? (\r\n\t\t<div className=\"AppPage\">\r\n\t\t\t<Core localUser={localUser} />\r\n\t\t</div>\r\n\t) : null;\r\n}\r\n\r\nfunction Core({ localUser }) {\r\n\tconst { items: circles } = Database.useSnapshot(\r\n\t\tDatabase.collection(\"userdata\", localUser.id, \"circles\"),\r\n\t\t{\r\n\t\t\t// TODO handle circle stores\r\n\t\t\tprocessor: async doc => {\r\n\t\t\t\tconst circle = CircleStore.getCircles()[doc.id] ?? await CircleStore.fetchCircle(doc.id);\r\n\r\n\t\t\t\treturn _.assign(circle, doc);\r\n\t\t\t}\r\n\t\t}\r\n\t) ?? {};\r\n\r\n\tuseOnMount(() => {\r\n\t\tVoiceModule.initialize();\r\n\t});\r\n\r\n\tif (circles === undefined) {\r\n\t\treturn <LoadingOverlay />;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"Core\">\r\n\t\t\t<CssStore.Renderer />\r\n\t\t\t<LoadingOverlay hidden />\r\n\r\n\t\t\t<div className=\"Panel PanelMain Flex\">\r\n\t\t\t\t<div className=\"Panel PanelCircles\">\r\n\t\t\t\t\t{circles\r\n\t\t\t\t\t\t.sort((a, b) => a.position - b.position)\r\n\t\t\t\t\t\t.map(circle => circle instanceof Circle && (\r\n\t\t\t\t\t\t\t<circle.BubbleComponent key={circle.id} />\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"Panel PanelCore\">\r\n\t\t\t\t\t<CorePanel />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"Panel PanelFooter FlexCenter\">\r\n\t\t\t\t<div className=\"Circle\" onClick={() => pushHistoryState(\"#app/dms/\")}>\r\n\t\t\t\t\t<Users className=\"Icon\" />\r\n\r\n\t\t\t\t\t<Tooltip>DMs</Tooltip>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<ContextMenu.Wrapper\r\n\t\t\t\t\tmenu={<localUser.ContextMenu />}\r\n\t\t\t\t\twrapperClassName=\"LocalUserHead FlexCenter\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<div className=\"Circle\">\r\n\t\t\t\t\t\t<localUser.AvatarComponent className=\"Icon\" />\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"Details\">\r\n\t\t\t\t\t\t<h4 className=\"Username\">\r\n\t\t\t\t\t\t\t{localUser.displayName}\r\n\t\t\t\t\t\t</h4>\r\n\r\n\t\t\t\t\t\t<localUser.StatusText />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</ContextMenu.Wrapper>\r\n\r\n\t\t\t\t<div className=\"Divider\" />\r\n\r\n\t\t\t\t<ChatTextArea />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction LoadingOverlay({ hidden = false }) {\r\n\treturn (\r\n\t\t<div className={joinClassNames(\"LoadingOverlay\", \"FlexCenter\", [hidden, \"Hidden\"])}>\r\n\t\t\t<InlineLoading style={{ fontSize: \"2em\" }} />\r\n\t\t</div>\r\n\t);\r\n}","import React, { useEffect } from \"react\";\nimport \"./city-fog-theme.css\";\nimport \"./App.scss\";\nimport { Modals } from \"./Components/Modals\";\nimport HomePage from \"./Pages/Home\";\nimport Toasts from \"./Components/Toasts\";\nimport { ActionTypes, joinClassNames } from \"./Classes/Constants\";\nimport ContextMenu from \"./Components/ContextMenuHandler\";\nimport PageFooter from \"./Components/PageElements/PageFooter\";\nimport { dispatcher } from \"./Classes/Dispatcher\";\nimport { onAuthStateChanged } from \"@firebase/auth\";\nimport Database from \"./Classes/Database\";\nimport AppPage from \"./Pages/AppPage\";\nimport UserStore from \"./Classes/Types/Stores/UserStore\";\n\nwindow.addEventListener(\"popstate\", () => {\n\tdispatcher.dispatch({\n\t\ttype: ActionTypes.PAGE_UPDATE\n\t});\n});\n\nexport function pushHistoryState(path) {\n\twindow.history.pushState({}, null, path);\n\n\tdispatcher.dispatch({\n\t\ttype: ActionTypes.PAGE_UPDATE\n\t});\n}\n\nexport function replaceHistoryState(path) {\n\twindow.history.replaceState({}, null, path);\n\n\tdispatcher.dispatch({\n\t\ttype: ActionTypes.PAGE_UPDATE\n\t});\n}\n\nexport let appHash = \"\";\nexport let appHashArgs = [];\n\nfunction PageElement() {\n\t// Use the force updater from the page update dispatch.\n\tdispatcher.useForceUpdater(ActionTypes.PAGE_UPDATE);\n\n\t// Store the formatted hash in a variable.\n\tconst [hash, ...args] = (window.location.hash\n\t\t.split(/#\\/?/)[1] ?? \"\")\n\t\t.split(\"?\")[0]\n\t\t.split(\"/\");\n\n\t// Set the app hash value.\n\tappHash = hash;\n\tappHashArgs = args;\n\n\t// Zhu Li, do the thing!\n\tswitch (hash) {\n\t\tdefault: return <HomePage />;\n\t\tcase \"app\": return <AppPage />;\n\t}\n}\n\nexport default function App() {\n\tdispatcher.useForceUpdater(ActionTypes.PAGE_UPDATE);\n\n\tReact.useEffect(() => {\n\t\t// Check if the user is signed in.\n\t\tonAuthStateChanged(Database.auth, async localUser => {\n\t\t\tlet user = null;\n\n\t\t\tif (localUser?.uid)\n\t\t\t\tuser = await UserStore.fetchUser(localUser.uid);\n\n\t\t\tdispatcher.dispatch({\n\t\t\t\ttype: ActionTypes.LOCAL_USER_UPDATE,\n\t\t\t\tuser\n\t\t\t});\n\t\t});\n\t}, []);\n\n\treturn (\n\t\t<div className=\"App\">\n\t\t\t<div className=\"Main\">\n\t\t\t\t<PageElement />\n\t\t\t</div>\n\n\t\t\t{window.location.hash.split(\"/\")[0].split(\"?\")[0] !== \"#app\" && <PageFooter />}\n\n\t\t\t<Modals />\n\t\t\t<Toasts />\n\t\t\t<ContextMenu.Handler />\n\t\t</div>\n\t);\n}","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<App />\n\t</React.StrictMode>,\n\tdocument.getElementById(\"root\")\n);\n\nserviceWorker.unregister();"],"sourceRoot":""}