{"version":3,"sources":["Classes/Constants.js","Classes/Dispatcher.js","Classes/Types/Stores/UserStore.js","Assets/Logo.svg","Classes/Database.js","Components/LinkWrapper.jsx","Components/Modals.jsx","Classes/TimerClass.js","Components/Toasts.jsx","Classes/Types/Stores/GroupStore.js","Assets/WaveVector.svg","Assets/TwemojiHeart.svg","Components/PageElements/PageFooter.jsx","Assets/icon50x50.png","Pages/Home.jsx","Classes/Types/Stores/CssStore.jsx","Components/Chat/ChatTextArea.jsx","Components/Panels/CallPanel.jsx","Classes/Types/Stores/MessageReadStore.js","Components/Panels/ChatPanel.jsx","Components/Panels/GroupsPanel.jsx","Components/AppPages/CircleOverview.jsx","Components/AppPages/CirclePage.jsx","Components/AppPages/DmsPage.jsx","Components/Panels/CorePanel.jsx","Assets/Audio/alert.ogg","Classes/Types/Stores/SettingsStore.js","Components/Modals/SettingsModal.jsx","Pages/AppPage.jsx","Components/PageElements/BannerNotifications.jsx","App.jsx","Classes/Store.js","Components/Tooltip.jsx","Components/ContextMenuHandler.jsx","Classes/Hooks.js","Classes/Types/Stores/MessageCountStore.js","Components/InlineLoading.jsx","Classes/Types/Stores/CircleStore.js","Classes/VoiceModule.js","Components/Modals/UserProfileModal.jsx","Classes/Types/User.jsx","Classes/Types/Stores/TypingStore.js","Classes/Types/Group.jsx","Classes/Types/Circle.jsx","Classes/Types/Stores/MessageStore.js","Components/Chat/MessageComponents/ImageRenderer.jsx","Classes/Types/Emote.jsx","Classes/Types/Stores/EmoteStore.js","Classes/MessageFormatter.jsx","Classes/RealtimeDatabase.js","Components/ErrorBoundary.jsx","Components/Chat/RichTextArea.jsx","Assets/Audio/ascend.ogg","Assets/Audio/descend.ogg","Classes/Types/Stores/VoiceMemberStore.js","Components/Modals/AuthModal.jsx","Classes/Types/Message.jsx","serviceWorker.js","index.js"],"names":["joinClassNames","final","i","arguments","length","Array","isArray","trim","getRandomKey","Math","random","toString","substr","getAcronym","input","split","slice","map","w","join","toUpperCase","formatDateString","date","options","prependOn","day","days","now","Date","daysPassed","round","toFixed","getDay","toLocaleDateString","openFileDialog","Promise","r","type","_","assign","document","createElement","accept","style","onchange","files","body","removeChild","appendChild","click","fetchToBase64","url","resolve","fetch","then","res","blob","reader","FileReader","onload","result","readAsDataURL","spaghettiAudioCache","playSound","src","volume","a","base64","data","audio","Object","Audio","addEventListener","play","catch","err","console","error","mib","value","kib","formatCamelCase","camelCase","replace","charAt","formatTimestamp","_time","time","toDate","toLocaleTimeString","ActionTypes","PAGE_UPDATE","LOCAL_USER_UPDATE","USER_UPDATE","CIRCLE_UPDATE","CIRCLES_UPDATE","CIRCLE_UPDATE_GROUPS","BATCH_UPDATE_DMS","GROUP_UPDATE","UPDATE_VOICE_MEMBERS","UPDATE_CURRENT_CALL","DM_UPDATE","UPDATE_MESSAGE_COUNT","UPDATE_READ_COUNT","UPDATE_CSS_VAR","BATCH_UPDATE_CSS_VARS","UPDATE_SETTING","BATCH_UPDATE_SETTINGS","MESSAGE_CREATE","MESSAGE_UPDATE","MESSAGE_DELETE","CHAT_UPDATE","FETCH_EMOTE","UPDATE_READS","UPDATE_TYPING_INDICATORS","DISPLAY_BANNER_NOTIFICATION","GroupType","FOLDER","TEXT","VOICE","ANNOUNCEMENTS","UserStatus","OFFLINE","ONLINE","AWAY","BUSY","BOT","Dispatcher","_callbacks","event","callback","this","Set","add","unsubscribe","bind","delete","action","listener","actionType","condition","deps","React","useReducer","x","forceUpdate","useEffect","subscribe","dispatcher","localUser","cache","User","id","displayName","status","avatarUrl","CirlosLogo","profileBackgroundNsfw","feed","UserStoreClass","userId","fetchUser","loading","oneTime","unbind","Database","createSnapshotListener","doc","user","extend","dispatch","Store","UserStore","config","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","tosUrl","privacyPolicyUrl","app","initializeApp","auth","getAuth","db","getFirestore","storage","getStorage","storageCache","freeze","path","collection","ref","snapshot","_ref","_snapshot","getDoc","exists","formatDocument","getDocs","docs","onReady","onSnapshot","DocumentReference","changes","docChanges","change","items","_unbindListener","processor","useState","undefined","setData","obj","omit","setDoc","serializeObject","e","stack","deleteDoc","updateDoc","pathSegments","storageRef","getDownloadURL","file","uploadBytes","getStorageUrl","className","props","children","Component","openModal","modal","Modals","push","closeModal","pop","copyToClipboard","text","window","navigator","clipboard","writeText","Toasts","showToast","openStringModal","title","description","ImageModal","getSources","sources","filter","u","indexOf","index","setIndex","nav","dir","setLoaded","setFailed","expanded","setExpandedState","onClick","target","currentTarget","onMouseDown","alt","onLoad","onError","Tooltip","replaceAll","display","color","href","openImageModal","openBoolModal","yesText","noText","yesColor","noColor","dangerouslySetInnerHTML","__html","backgroundColor","response","async","StringModal","state","closing","handleKey","key","instance","removeEventListener","onBackdropClick","ErrorBoundary","handleBackdropClick","zIndex","setState","setTimeout","m","onChange","rich","no","setNoState","yes","setYesState","defaultValue","InlineLoading","getElementById","Timer","duration","playAutomatically","remainingTime","resume","startTime","clearTimeout","Toast","life","remove","fixedTime","handleRemove","setClosing","timer","useMemo","progressBar","useRef","handleMouseEnter","pause","current","animationPlayState","handleMouseLeave","handleFocus","handleBlur","hasFocus","onMouseEnter","onMouseLeave","end","cursor","animationDuration","toasts","horizontalStyle","verticalStyle","additionalOptions","toast","t","createRef","groupListeners","GroupStoreClass","circleId","groupId","group","get","appHashArgs","getGroup","fetchGroups","fetchDms","circle","CircleStore","getCircle","Group","parent","groupPositions","position","groups","getLocalUser","query","orderBy","GroupDm","isDm","dms","GroupStore","set","_defs","_g","_excluded","_extends","source","prototype","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","keys","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","SvgWaveVector","svgRef","titleId","xmlns","xmlnsXlink","isolation","viewBox","width","height","clipPath","d","fill","ForwardRef","PageFooter","contacts","website","open","github","twitter","email","discord","Heart","margin","getFullYear","HomePage","Fragment","location","AuthModal","signUp","styles","toKebabCase","toLowerCase","CssStoreClass","args","localUserListener","_databaseReference","_hasLoaded","entries","removeListener","addListener","_save","debounce","useForceUpdater","CssStore","types","ChatTextArea","events","handleSend","message","getSelectedGroup","sendMessage","TypingStore","stopTyping","RichTextArea","onSend","onInput","startTyping","containerChildren","TypingIndicators","dispatchEvent","KeyboardEvent","shiftKey","bubbles","some","includes","typingUserIds","getTypingUsersForGroup","getUser","convertToYou","CallPanel","VoiceModule","currentRoom","memberIds","VoiceMemberStore","getVoiceMembers","VoiceCallMember","AvatarComponent","size","MessageReadStoreClass","messageId","reads","getReads","timestamp","MessageReadStore","read","pick","ChatPanel","messages","MessageStore","getMessageGroups","isMobile","useMediaQuery","mobileEvents","onTouchStart","tapX","touches","clientX","tapY","clientY","getStyle","translation","lastTranslation","parseFloat","transform","match","isNaN","handler","abs","clamp","useInterval","tickCache","MessageGroup","marginTop","Wrapper","menu","ContextMenu","wrapperClassName","StatusText","MessageComponent","getReadsForMessage","creationDate","hour12","direction","getCreationDate","editedAt","getContent","GroupsPanel","handleScaler","getBoundingClientRect","CircleOverview","ownerId","iconUrl","name","CirclePage","RightHandRenderer","renderGroups","DmsPage","_groups","getGroups","log","values","sort","b","lastMessageDate","CorePanel","defaultSettingsSchematic","account","__icon","profile","privacy","logOut","appearance","colors","background","image","label","note","notifications","communication","voice","video","emotes","library","store","extensions","plugins","themes","customStyles","miscellaneous","aboutMe","changeLogs","developerTools","help","guides","markdownRules","shortcutsMap","legal","guidelines","termsOfService","privacyPolicy","cookiesPolicy","__properties","settings","SettingsStoreClass","settingsDispatcher","def","SettingsStore","warn","SettingsCssRenderer","renderers","getSettingValue","SettingsModal","selected","_select","opacity","setOpacity","search","transitioning","select","category","filters","root","subCategory","schema","sub","item","placeholder","startsWith","s","Section","cat","Field","setting","field","onBlur","AppPage","origin","Core","lastCircles","tickAwayStatus","update","useSnapshot","getCircles","fetchCircle","circles","useOnMount","initialize","useEventListener","selectedGroup","markAsRead","getMessages","getAllCachedReads","getId","serverTimestamp","LoadingOverlay","Renderer","hidden","Circle","BubbleComponent","DmBubbles","pushHistoryState","fontSize","unreads","dm","MessageCountStore","getUnreadMessageCount","icon","unreadCount","DmBubble","markRead","AlertSound","BannerNotifications","setNotifications","notification","formatUrl","history","pushState","last","hash","lastTime","PageElement","App","onAuthStateChanged","uid","offlineListener","RealtimeDatabase","createDisconnectListener","setWithPriority","o","userAgent","Handler","actionHandlers","_listeners","_dispatcher","emitChange","_actionHandlers","factory","handleChange","visible","parentElement","classList","docClickEv","contains","getElementsByClassName","close","activeWrapper","handleContextMenu","preventDefault","top","overrideY","left","overrideX","innerWidth","ReactDOM","createPortal","publicProps","object","output","exclusions","exclude","prevProps","prevState","rect","y","innerHeight","openOnClick","onContextMenu","Item","handleClick","stopPropagation","autoClose","SubMenuItem","right","mount","ToggleItem","checked","Divider","delay","callInstantly","interval","setInterval","clearInterval","useMounted","eventType","dependencies","init","matchMedia","matches","readCounts","listeners","readCountListenerInitialized","MessageCountStoreClass","fromDb","_initializeListenerFor","total","getMessageCount","currentTotal","updateDatabase","_initializeReadListener","CircleStoreClass","tryCreateListenerFor","cleanups","getCleanupCache","cleanup","VoiceEvents","initialized","hostname","newSocket","WebSocket","socket","onerror","JSON","parse","circleIds","c","readyState","OPEN","setImmediate","send","stringify","iceOptions","iceServers","urls","iceCandidatePoolSize","ChatRoom","connections","handleMessage","disconnect","initializePeerConnection","RTCPeerConnection","onicecandidate","handleIceCandidate","onnegotiationneeded","handleNegotiation","candidate","emitSocket","ice","peer","pc","createOffer","offer","setLocalDescription","mediaDevices","getUserMedia","stream","handleTrack","localStream","createPeerConnection","addTransceiver","onicecandidateerror","getTracks","track","addTrack","srcObject","autoplay","transceiverOptions","ontrack","streams","sdp","RTCSessionDescription","answer","setRemoteDescription","users","requestConsumer","UserProfileModal","bgRef","bgRefNsfw","editMode","setEditMode","isNsfwRevealed","revealNsfw","selectProfileBackground","nsfw","uploadStorage","profileBackground","isNsfwVerified","MessageFormatter","about","bio","UserAvatarComponent","UserStatusText","Mention","UserMention","UserContextMenu","nsfwVerified","failed","tooltipDirection","lastOnline","cleanupCache","TypingStoreClass","stopTypingSoft","Error","typingRefPath","_getRefPath","disconnectListener","createListener","val","indicators","cancel","GroupComponent","content","addDoc","senderId","isNsfw","GroupFolder","GroupText","GroupVoice","GroupAnnouncements","selectGroup","lastLocation","GroupUnreadBlips","typingCount","members","connect","VoiceRoomMember","room","DmGroupComponent","CircleBubble","CircleContextMenu","destroyCircle","g","populate","inviteId","joinDate","leaveCircle","localStorage","getItem","fetching","MessageStoreClass","fetchMessages","_messages","lastMessage","currentGroup","isSeparateUser","isSeparateTime","reverse","tick","instantly","dmId","limitToLast","Message","pushValue","getMessage","readRef","unbindReadListener","ImageRenderer","loaded","isMounted","querySelectorAll","Emote","emote","EmoteComponent","setSize","EmoteStore","childNodes","EmoteStoreClass","packId","emoteId","fetchEmote","rules","defaultRules","order","exec","capture","react","node","minimal","userMention","getEmote","controls","youtube","allowFullScreen","parser","parserFor","render","reactFor","ruleOutput","inline","getDatabase","onValue","onDisconnect","errorInfo","moreInfo","componentStack","msg","showErrorInfo","renderError","containerRef","rendererRef","setHeight","setValue","focused","setFocused","selection","setSelection","caret","onKeyDown","onFocus","getSelection","anchorNode","selectionStart","selectionEnd","focus","VoiceMemberStoreClass","Descend","Ascend","signUpMode","setSignUpMode","busy","setBusy","handleSignUp","getElementsByTagName","usernameField","emailField","passwordField","confirmPasswordField","createUserWithEmailAndPassword","updateProfile","normalizedName","handleLogIn","signInWithEmailAndPassword","code","maxLength","marginLeft","mentions","Boolean","StrictMode","serviceWorker","ready","registration","unregister"],"mappings":"2iBAEO,SAASA,IAGf,IAFA,IAAIC,EAAQ,GAEHC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAC1C,UAAgBC,UAAUD,MACnBG,MAAMC,QAAQH,UAAUD,KAAoC,mBAArBC,UAAUD,GAAG,IAAqB,WACtD,IAApBC,UAAUD,GAAG,GAChBD,GAASE,UAAUD,GAAG,GACdC,UAAUD,GAAG,KACrBD,GAASE,UAAUD,GAAG,SAIvBD,GAASE,UAAUD,GAIrBD,GAAS,IAGV,OAAOA,EAAMM,OAGP,SAASC,IAAiB,OAAOC,KAAKC,SAASC,SAAS,IAAIC,OAAO,GAEnE,SAASC,EAAWC,GAG1B,OAFcA,EAAMC,MAAM,MAAMC,MAAM,EAAG,GAE5BC,KAAI,SAAAC,GAAC,OAAIA,EAAE,MAAIC,KAAK,IAAIC,cAG/B,SAASC,EAAiBC,GAAqB,IAAfC,EAAc,uDAAJ,GAChD,EAA6BA,EAArBC,iBAAR,SAEMC,EAAM,MACNC,EAAO,CAAC,SAAU,SAAU,UAAW,YAAa,WAAY,SAAU,YAE1EC,EAAM,IAAIC,KACVC,GAAcpB,KAAKqB,MAAMH,EAAML,GAAQG,GAAKM,QAAQ,GAe1D,OAXIF,EAAa,EACF,2BACS,MAAfA,EACM,QACS,MAAfA,EACM,YACNA,EAAa,GACNL,EAAY,MAAQ,IAAME,EAAKJ,EAAKU,WAEpCR,EAAY,MAAQ,IAAMF,EAAKW,qBAKzC,SAASC,IAA8B,IAAfX,EAAc,uDAAJ,GACxC,OAAO,IAAIY,SAAQ,SAAAC,GAClB,MAAuBb,EAAfc,YAAR,MAAe,IAAf,EACMvB,EAAQwB,IAAEC,OAAOC,SAASC,cAAc,SAAU,CACvDJ,KAAM,OACNK,OAAQL,EACRM,MAAO,eACPC,SAAU,kBACTR,EAAEtB,EAAM+B,OAERL,SAASM,KAAKC,YAAYjC,MAI5B0B,SAASM,KAAKE,YAAYlC,GAC1BA,EAAMmC,WAID,SAASC,EAAcC,GAC7B,OAAO,IAAIhB,SAAQ,SAAAiB,GAAO,OACzBC,MAAMF,GAAKG,MAAK,SAAAC,GAAG,OAAIA,EAAIC,UACzBF,MAAK,SAAAE,GACL,IAAMC,EAAS,IAAIC,WAEnBD,EAAOE,OAAS,kBAAMP,EAAQK,EAAOG,SACrCH,EAAOI,cAAcL,SAIzB,IAAMM,EAAsB,GAErB,SAASC,EAAUC,GAAkB,IAAbC,EAAY,uDAAH,EACvC,OAAO,IAAI9B,QAAJ,uCAAY,WAAMiB,GAAN,mBAAAc,EAAA,mEACLJ,EAAoBE,UADf,mEAC6Bd,EAAcc,GAAKV,MAAK,SAAAa,GAAM,OAAIL,EAAoBE,GAAOG,KAD1F,0BACZC,EADY,MAEZC,EAAQC,OAAO/B,OAAO,IAAIgC,MAAMH,GAAO,CAAEH,YAEzCO,iBAAiB,QAASpB,GAChCiB,EAAMI,OAAOC,OAAM,SAAAC,GAAG,OAAIC,QAAQC,MAAM,uBAAwBb,EAAKW,MALnD,4CAAZ,uDA4BD,SAASG,EAAIC,GACnB,OAAoB,KALd,SAAaA,GACnB,OAAe,KAARA,EAIAC,CAAID,GAGL,SAASE,EAAgBC,GAC/B,IAAM9C,EAAI8C,EAAUC,QAAQ,WAAY,OAExC,OAAO/C,EAAEgD,OAAO,GAAGhE,cAAgBgB,EAAEpB,MAAM,GAGrC,SAASqE,EAAgBC,GAAQ,IAAD,IACtC,IAAKA,EAAO,MAAO,GACnB,IAAMC,EAAI,iBAAGD,QAAH,IAAGA,GAAH,UAAGA,EAAOE,cAAV,aAAG,OAAAF,UAAH,QAAwBA,EAElC,MAAM,GAAN,OAAUjE,EAAiBkE,GAA3B,eAAuCA,EAAKE,mBAAmB,UAGzD,IAAMC,EAAc,CAC1BC,YAAa,cACbC,kBAAmB,oBACnBC,YAAa,cACbC,cAAe,gBACfC,eAAgB,iBAChBC,qBAAsB,uBACtBC,iBAAkB,mBAClBC,aAAc,eACdC,qBAAsB,uBACtBC,oBAAqB,sBACrBC,UAAW,YACXC,qBAAsB,uBACtBC,kBAAmB,oBACnBC,eAAgB,iBAChBC,sBAAuB,wBACvBC,eAAgB,iBAChBC,sBAAuB,wBACvBC,eAAgB,iBAChBC,eAAgB,iBAChBC,eAAgB,iBAChBC,YAAa,cACbC,YAAa,cACbC,aAAc,eACdC,yBAA0B,6BAC1BC,4BAA6B,+BAGjBC,EAAY,CACxBC,OAAQ,EACRC,KAAM,EACNC,MAAO,EACPC,cAAe,GAGHC,EAAa,CACzBC,QAAS,EACTC,OAAQ,EACRC,KAAM,EACNC,KAAM,EACNC,IAAK,M,uJC9KeC,E,iDACpBC,WAAa,G,6CAEb,SAAUC,EAAOC,GAOhB,OANKC,KAAKH,WAAWC,KACpBE,KAAKH,WAAWC,GAAS,IAAIG,KAG9BD,KAAKH,WAAWC,GAAOI,IAAIH,GAEpBC,KAAKG,YAAYC,KAAKJ,KAAMF,EAAOC,K,yBAG3C,SAAYD,EAAOC,GACbC,KAAKH,WAAWC,IAErBE,KAAKH,WAAWC,GAAOO,OAAON,K,sBAG/B,SAASO,GACR,IAAMR,EAAQQ,EAAOpG,KACrB,GAAK8F,KAAKH,WAAWC,GAArB,CAFgB,oBAIOE,KAAKH,WAAWC,IAJvB,IAIhB,2BAA+C,EAC9CS,EAD8C,SACrCD,IALM,kC,2BASjB,WAAuB,IAAD,OACrB,OAAO,SAACE,GAA6C,IAAjCC,EAAgC,uDAApB,KAAMC,EAAc,uDAAP,GAC5C,EAAwBC,IAAMC,YAAW,SAAAC,GAAC,OAAIA,EAAI,IAAG,GAArD,mBAASC,EAAT,KAEAH,IAAMI,WAAU,WACf,OAAO,EAAKC,UAAUR,GAAY,SAAAvE,GACN,oBAAfwE,EACPA,EAAUxE,IACb6E,IAGGA,SAEJJ,Q,KAKOO,EAAa,IAAIrB,G,oCCxC1BsB,E,6FCRW,MAA0B,iCDSnCC,EAAQ,CACb,OAAU,IAAIC,IAAK,CAClBC,GAAI,SACJC,YAAa,SACbC,OAAQjC,IAAWK,IACnB6B,UAAWC,EACXC,sBAAuB,uDACvBC,KAAM,oDAIFC,EAAc,kKACnB,WACC,OAAOV,IAFW,qBAKnB,SAAQW,GAAS,IAAD,EACf,iBAAOV,EAAMU,UAAb,SACC7B,KAAK8B,UAAUD,GACfV,EAAMU,GAAU,IAAIT,IAAK,CACxBC,GAAIQ,EACJE,SAAS,EACTT,YAAa,WAXG,sBAgBnB,WACC,OAAOH,IAjBW,uBAoBnB,SAAUU,GAA0B,IAAlBG,EAAiB,wDAClC,OAAKH,EAEE,IAAI7H,SAAQ,SAAAC,GAClB,IAAMgI,EAASC,IAASC,uBACvBD,IAASE,IAAI,WAAYP,IACzB,SAAAO,GAAQ,IAAD,KACN,UAAIjB,EAAMU,UAAV,aAAI,EAAeE,iBACXZ,EAAMU,GAGd,IAAMQ,EAAOD,EACVjI,IAAEmI,OAAF,UAASnB,EAAMU,UAAf,QAA0B,IAAIT,IAAQgB,GACtC,IAAIhB,IAAK,CACVC,GAAIQ,EACJP,YAAa,iBAGfL,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYG,YAClB2E,SAGDL,GAAWC,IAEXhI,EAAEoI,SAxBe,SArBF,GAA2BG,KAoDzCC,EAAY,IAAIb,EAAeX,KAAnB,mBAChB1D,IAAYE,mBAAoB,YAAe,IAAZ4E,EAAW,EAAXA,KACnCnB,EAAYmB,KAFI,cAIhB9E,IAAYG,aAAc,YAAe,IAAZ2E,EAAW,EAAXA,KAC7BlB,EAAMkB,EAAKhB,IAAMgB,KALD,IASHI,O,uJE1ETC,EAAS,CACdC,OAAQ,0CACRC,WAAY,iBACZC,UAAW,SACXC,cAAe,qBACfC,kBAAmB,eACnBC,MAAO,4CACPC,cAAe,eACfC,OAAQ,+BACRC,iBAAkB,kCAUJ,mBAOd,aAAe,yBANfC,IAAMC,YAAcX,GAMN,KALdY,KAAOC,cAKO,KAJdC,GAAKC,cAIS,KAHdC,QAAUC,cAGI,KAFdC,aAAe,GAGdzH,OAAO0H,OAAO7D,MARD,uCAWd,WAAc,IAAD,uBAAN8D,EAAM,yBAANA,EAAM,gBAAE,OAAO1B,IAAG,WAAH,GAAIpC,KAAKwD,IAAT,OAAgBM,MAXxB,wBAYd,WAAqB,IAAD,uBAANA,EAAM,yBAANA,EAAM,gBAAE,OAAOC,IAAU,WAAV,GAAW/D,KAAKwD,IAAhB,OAAuBM,MAZtC,4BAcd,SAAeE,EAAKC,GACnB,OAAOA,EAAQ,aACdC,KAAMF,EACNG,UAAWF,EACX5C,GAAI4C,EAAS5C,IACV4C,EAAShI,QACT,OApBS,2DAuBd,WAAa+H,GAAb,eAAAjI,EAAA,sEACwBqI,YAAOJ,GAD/B,WACOC,EADP,QAEeI,SAFf,yCAEgC,MAFhC,gCAIQrE,KAAKsE,eAAeN,EAAKC,IAJjC,gDAvBc,mHA8Bd,WAAcD,GAAd,sBAAAjI,EAAA,sEACwBwI,YAAQP,GADhC,cACOC,EADP,yBAGQA,EAASO,KAAK1L,KACpB,SAAAsJ,GAAG,OACF,EAAKkC,eAAelC,EAAI4B,IAAK5B,OALhC,2CA9Bc,2FAwCd,SAAuB4B,EAAKjE,GAAyB,IAAD,OAAd3G,EAAc,uDAAJ,GACzCqL,EAAYrL,EAAZqL,QAEAxC,EAASyC,YAAWV,GAAK,SAAAG,GAAc,IAAD,EACrCF,EAAWD,aAAeW,IAC7B,EAAKL,eAAeN,EAAKG,GACzB,CACDS,QAAST,EAAUU,aAAa/L,KAAI,SAAAgM,GAAM,kCACtCA,GADsC,IAEzC7I,KAAM,EAAKqI,eAAeQ,EAAO1C,IAAI4B,IAAKc,EAAO1C,UAElD2C,MAAOZ,EAAUK,KAAK1L,KAAI,SAAAsJ,GAAG,OAAI,EAAKkC,eAAelC,EAAI4B,IAAK5B,OAG5D6B,IACHA,EAASe,gBAAkB/C,GAG5BlC,EAASkE,GAEF,QAAP,EAAAQ,SAAA,SAAUR,GACVQ,EAAU,QAGX,OAAOxC,IAhEM,uBAmEd,WAAmB,IAAD,OACjB,OAAO,SAAC+B,GAAuB,IAAlB5K,EAAiB,uDAAP,GACd6L,EAAc7L,EAAd6L,UACR,EAAwBtE,IAAMuE,cAASC,GAAvC,mBAAOlJ,EAAP,KAAamJ,EAAb,KAiBA,OAfAzE,IAAMI,WAAU,WACf,OAAO,EAAKoB,uBAAuB6B,EAA5B,uCAAiC,WAAM/H,GAAN,eAAAF,EAAA,yDACZ,oBAAfkJ,EAD2B,yCACOG,EAAQnJ,IADf,WAGnC/D,MAAMC,QAAQ8D,EAAK8I,OAHgB,wBAAAhJ,EAAA,KAItBE,EAAK8I,OAJiB,qDAI3BhN,EAJ2B,oBAKfkN,EAAUhJ,EAAK8I,MAAMhN,IALN,OAKrCkE,EAAK8I,MAAMhN,GAL0B,uEAQrBkN,EAAUhJ,GARW,QAQlCA,EARkC,eAUvCmJ,EAAQnJ,GAV+B,4CAAjC,kCAAA+D,KAAA,eAWJ5G,KACD,IAEI6C,KAvFK,6BA2Fd,SAAgBoJ,GACf,OAAOlL,IAAEmL,KAAF,eAAYD,GAAO,CACzB,OACA,YACA,kBACA,SAhGY,wDAoGd,WAAUrB,EAAK/H,GAAf,SAAAF,EAAA,sEACcwJ,YAAOvB,EAAKhE,KAAKwF,gBAAgBvJ,IAC5CM,OAAM,SAAAkJ,GAAC,OAAIhJ,QAAQC,MAAR,qCAA4CsH,EAAIF,KAAhD,cAA0D2B,EAAEC,WAF1E,wFApGc,oHAyGd,WAAa1B,EAAK/H,GAAlB,SAAAF,EAAA,sEACc4J,YAAU3B,GACrBzH,OAAM,SAAAkJ,GAAC,OAAIhJ,QAAQC,MAAR,iCAAwCsH,EAAIF,KAA5C,cAAsD2B,EAAEC,WAFtE,mFAzGc,oHA8Gd,WAAa1B,EAAK/H,GAAlB,SAAAF,EAAA,sEACc6J,YAAU5B,EAAKhE,KAAKwF,gBAAgBvJ,IAE/CM,OAAM,SAAAkJ,GAAC,OAAIhJ,QAAQC,MAAR,sCAA6CsH,EAAIF,KAAjD,cAA2D2B,EAAEC,WAH3E,wFA9Gc,2HAqHd,kDAAA3J,EAAA,qEAAuB8J,EAAvB,yBAAuBA,EAAvB,eACO/B,EAAO+B,EAAa7M,KAAK,KAGzBgL,EAAM8B,YAAW9F,KAAK0D,QAASI,GAJtC,SAKmBiC,YAAe/B,GALlC,cAKOhJ,EALP,yBAOQgF,KAAK4D,aAAaE,GAAQ9I,GAPlC,gDArHc,iFA+Hd,SAAcgL,GAAuB,IAAC,IAAD,0BAAdH,EAAc,iCAAdA,EAAc,kBACpC,IAAM/B,EAAO+B,EAAa7M,KAAK,KACzBgL,EAAM8B,YAAW9F,KAAK0D,QAASI,GAErC,OAAOmC,YAAYjC,EAAKgC,GAAM7K,KAAvB,uCAA4B,WAAMM,GAAN,SAAAM,EAAA,kEAClCN,EADkC,SAEvB,EAAKyK,cAAL,QAAsBL,GAFC,6CAClCpK,OADkC,KAElCT,IAFkC,kDAA5B,2DAnIM,O,yiBCtBd,WACC,OACC,2CAAGmL,UAAU,eAAkBnG,KAAKoG,OAApC,aACGpG,KAAKoG,MAAMC,gB,GAJY1F,IAAM2F,W,sDCY5B,SAASC,EAAUC,GACzBC,EAAOC,KAAKF,GAON,SAASG,IACfF,EAAOG,MAAMrK,MAAME,QAAQC,MAAM0D,KAAK3D,QAAS,yBAQzC,SAAeoK,EAAtB,kC,4CAAO,WAA+BC,GAA/B,SAAA/K,EAAA,+EAECgL,OAAOC,UAAUC,UAAUC,UAAUJ,GAFtC,OAILK,IAAOC,UAAU,iCAAM,4BAAIN,EAAK7O,QAAU,IAAM6O,EAAKrO,OAAO,EAAG,KAAO,MAAQqO,IAA7D,0BAAmG,WAJ/G,+CAOLO,EAAgB,CACfC,MAAO,iBACPC,YAAa,kFACb3K,MAAOkK,IAVH,yD,sBAgBA,SAASU,EAAT,GAA0C,IAApBxM,EAAmB,EAAnBA,IAAKyM,EAAc,EAAdA,WAE3BC,EAAkC,oBAAhBD,EAA6BA,IAAaE,QAAO,SAAAC,GAAC,OAAIA,KAAK,CAAC5M,GAGpF,EAA0B2F,IAAMuE,SAASwC,EAAQG,QAAQ7M,IAAzD,mBAAO8M,EAAP,KAAcC,EAAd,KAEMC,EAAM,SAAAC,GAAG,OACdP,EAAQI,EAAQG,IACZC,GAAU,GAAQC,GAAU,GAAQJ,EAASD,EAAQG,IACtDd,IAAOC,UAAU,oCAAqC,YAE1D,EAAqCzG,IAAMuE,UAAS,GAApD,mBAAOkD,EAAP,KAAiBC,EAAjB,KAGA,EAA6B1H,IAAMuE,UAAS,GAA5C,mBAAgBgD,GAAhB,WACA,EAA4BvH,IAAMuE,UAAS,GAA3C,mBAAeiD,GAAf,WAGA,OACC,sBAAKhC,UAAU,aAAamC,QAAS,SAAA7C,GAAC,OAAIA,EAAE8C,SAAW9C,EAAE+C,eAAiB/B,EAAOG,OAAjF,UACC,qBAAKT,UAAWtO,YAAe,iBAAkB,CAACuQ,EAAU,aAC3DK,YAAahC,EAAOG,IAAIxG,KAAKqG,GAD9B,SAEC,qBAAK5K,IAAK6L,EAAQI,GAAQY,IAAI,uBAC7BC,OAAQ,kBAAOT,GAAU,GAAOC,GAAU,IAC1CS,QAAS,kBAAOV,GAAU,GAAOC,GAAU,QAG7C,sBAAKhC,UAAU,SAAf,UACC,sBAAKA,UAAWtO,YAAe,oBAC9B,EAAE6P,EAAQzP,SAAW6P,EAAO,aAAcQ,QAAS,kBAAMN,GAAK,IAD/D,UAEC,cAAC,IAAD,IACA,cAACa,EAAA,EAAD,gCAGD,qBAAK1C,UAAU,YAEf,qBAAKA,UAAU,WAAf,SACCuB,EAAQI,GAAOlP,MAAM,KAAK,GAAGA,MAAM,KAAKC,OAAO,GAAG,GAAGD,MAAM,KAAKC,OAAO,GAAG,GAAGiQ,WAAW,MAAO,OAGhG,qBAAK3C,UAAU,YAEf,sBAAKA,UAAU,SAASmC,QAAS,kBAAOD,GAAkBD,IAA1D,UACEA,EAAW,cAAC,IAAD,IAAwB,cAAC,IAAD,IACpC,cAACS,EAAA,EAAD,UAAUT,EAAW,WAAa,cAGnC,sBAAKjC,UAAU,SAAf,UACC,cAAC,IAAD,IACA,cAAC0C,EAAA,EAAD,0BAGD,eAAC,EAAD,CAAa1C,UAAU,SAAS3L,MAAO,CAAEuO,QAAS,QAASC,MAAO,SACjEC,KAAMvB,EAAQI,GADf,UAEC,cAAC,IAAD,IACA,cAACe,EAAA,EAAD,iCAGD,qBAAK1C,UAAU,YAEf,sBAAKA,UAAWtO,YAAe,qBAC9B,EAAE6P,EAAQzP,QAAU6P,EAAQ,GAAKJ,EAAQzP,OAAQ,aAAcqQ,QAAS,kBAAMN,EAAI,IADnF,UAEC,cAAC,IAAD,IACA,cAACa,EAAA,EAAD,kCAYE,SAASK,EAAelO,GAAyB,IAApByM,EAAmB,uDAAN,KAChDhB,EAAOC,KAAK,cAACc,EAAD,CAAYxM,IAAKA,EAAKyM,WAAYA,KAaxC,SAAe0B,EAAtB,kC,4CAAO,qDAAApN,EAAA,iEACNuL,aADM,MACE,GADF,MAENC,mBAFM,MAEQ,GAFR,MAGN6B,eAHM,MAGI,MAHJ,MAINC,cAJM,MAIG,KAJH,MAKNC,gBALM,MAKK,oBALL,MAMNC,eANM,MAMI,GANJ,WAQiB,IAAIvP,SAAQ,SAAAiB,GAClCwL,EAAOC,KACN,sBAAKP,UAAU,sBAAf,UACC,qBAAKA,UAAU,QAAQqD,wBAAyB,CAAEC,OAAQnC,KAC1D,qBAAKnB,UAAU,cAAcqD,wBAAyB,CAAEC,OAAQlC,KAEhE,sBAAKpB,UAAU,SAAf,UACC,qBAAKA,UAAU,oBAAoBmC,QAAS,kBAAMrN,GAAQ,IAAQT,MAAO,CAAEkP,gBAAiBH,GAA5F,SAAwGF,IACxG,qBAAKlD,UAAU,oBAAoBmC,QAAS,kBAAMrN,GAAQ,IAAOT,MAAO,CAAEkP,gBAAiBJ,GAA3F,SAAwGF,cAhBtG,cAQAO,EARA,OAsBNlD,EAAOG,MAtBD,kBAwBC+C,GAxBD,4C,sBAgCA,SAAetC,IAAtB,+B,4CAAO,qBAAAuC,EAAA,uBAAA7N,EAAA,6DAA+B3C,EAA/B,+BAAyC,GAAzC,EACoBA,EAAlBwQ,aADF,kBAGiB,IAAI5P,SAAQ,SAAAiB,GAClCwL,EAAOC,KACN,cAACmD,EAAD,aAAa5O,QAASA,GAAa7B,QAL/B,cAGAuQ,EAHA,QASLC,GAASnD,EAAOG,MATX,kBAWC+C,GAXD,2C,wBAcA,IAAMlD,EAAb,4MAoCCqD,MAAQ,CAAEpE,MAAO,GAAIqE,QAAS,IApC/B,EAiDCC,UAAY,SAAAvE,GACG,WAAVA,EAAEwE,KACLxD,EAAOG,OAnDV,uDAsCC,WAECH,EAAOyD,SAAWlK,KAElB3F,SAASgC,iBAAiB,UAAW2D,KAAKgK,aA1C5C,kCA6CC,WACC3P,SAAS8P,oBAAoB,UAAWnK,KAAKgK,aA9C/C,iCAuDC,SAAoBvE,GAAI,IAAD,EAEtB,GAAIA,EAAE8C,SAAW9C,EAAE+C,cAAnB,CAGA,IAAQ9C,EAAU1F,KAAK8J,MAAfpE,MACR,GAAIA,EAAMA,EAAMzN,OAAS,IAAkE,oBAA5D,UAAQyN,EAAMA,EAAMzN,OAAS,GAAGmO,aAAhC,aAAQ,EAA+BgE,iBACrE,OAAO1E,EAAMA,EAAMzN,OAAS,GAAGmO,MAAMgE,kBAGtC3D,EAAOG,MAAMrK,MAAME,QAAQC,MAAM0D,KAAK3D,QAAS,4BAjEjD,oBAoEC,WAAU,IAAD,OACR,EAA2BuD,KAAK8J,MAAxBpE,EAAR,EAAQA,MAAOqE,EAAf,EAAeA,QAEf,OACC,qBAAK5D,UAAW,cAAgBT,EAAMzN,OAAS8R,EAAQ9R,OAAS,UAAY,IAA5E,SACEyN,EAAM5M,KAAI,SAAC0N,EAAOnF,GAAR,OACV,cAACgJ,EAAA,EAAD,UACC,qBAAKlE,UAAW,mBACb4D,EAAQlC,QAAQrB,IAAUnF,EAAKqE,EAAMzN,OAAS,EAAI,WAAa,IAEjEwQ,YAAa,EAAK6B,oBAAoBlK,KAAK,GAC3C5F,MAAO,CAAE+P,OAAa,GAALlJ,GAJlB,SAI8BmF,GAFxBnF,aA7EZ,mBAOC,SAAYmF,GACXxG,KAAKkK,SAASM,SAAS,CAAE9E,MAAM,GAAD,mBAAM1F,KAAKkK,SAASJ,MAAMpE,OAA1B,CAAiCc,QARjE,wDAeC,+FAE4BxG,KAAKkK,SAASJ,MAAjCpE,EAFT,EAESA,MAAOqE,EAFhB,EAEgBA,QACTvD,EAAQd,EAAMA,EAAMzN,OAAS,GAG9ByN,EAAMzN,QAAWuO,EANvB,wDASCxG,KAAKkK,SAASM,SAAS,CAAET,QAAQ,GAAD,mBAAMA,GAAN,CAAevD,MAThD,SAYO,IAAIxM,SAAQ,SAAAC,GAAC,OAAIwQ,WAAWxQ,EAAG,QAZtC,OAeC+F,KAAKkK,SAASM,SAAS,CACtB9E,MAAO1F,KAAKkK,SAASJ,MAAMpE,MAAMiC,QAAO,SAAA+C,GAAC,OAAIA,IAAMlE,KACnDuD,QAAS/J,KAAKkK,SAASJ,MAAMC,QAAQpC,QAAO,SAAA+C,GAAC,OAAIA,IAAMlE,OAjBzD,gDAfD,2DAA4B7F,IAAM2F,WAuF3B,SAASuD,EAAYzD,GAC3B,MAAsKA,EAA9JkB,aAAR,MAAgB,GAAhB,IAAsKlB,EAAlJmB,mBAApB,MAAkC,GAAlC,IAAsKnB,EAAhIgD,eAAtC,MAAgD,UAAhD,IAAsKhD,EAA3GiD,cAA3D,MAAoE,SAApE,IAAsKjD,EAAxFkD,gBAA9E,MAAyF,GAAzF,IAAsKlD,EAAzEmD,eAA7F,MAAuG,GAAvG,IAAsKnD,EAA3DxJ,aAA3G,MAAmH,GAAnH,IAAsKwJ,EAA/CuE,gBAAvH,MAAkI,KAAlI,EAAsJ1P,GAAgBmL,EAA9BwE,KAA8BxE,EAAhBnL,SAASoG,EAAO+E,EAAP/E,GAC/J,EAAyBV,IAAMuE,UAAS,GAAxC,mBAAO2F,EAAP,KAAWC,EAAX,KACA,EAA2BnK,IAAMuE,UAAS,GAA1C,mBAAO6F,EAAP,KAAYC,EAAZ,KAEA,OACC,sBAAK7E,UAAU,wBAAf,UACC,qBAAKA,UAAU,QAAQqD,wBAAyB,CAAEC,OAAQnC,KAC1D,qBAAKnB,UAAU,cAAcqD,wBAAyB,CAAEC,OAAQlC,KAEhE,uBAAOlG,GAAIA,EAAI8E,UAAU,mBAAmB8E,aAAcrO,EAAO+N,SAAUA,IAE3E,sBAAKxE,UAAU,SAAf,UACC,qBAAKA,UAAU,oBAAoBmC,QAAS,kBAAOrN,EAAQ,MAAO6P,GAAW,IAAQtQ,MAAO,CAAEkP,gBAAiBH,GAA/G,SAA2HsB,EAAK,cAACK,EAAA,EAAD,IAAoB7B,IACpJ,qBAAKlD,UAAU,oBAAoBmC,QAAS,kBAAOrN,EAAQZ,SAAS8Q,eAAe9J,GAAIzE,OAAQoO,GAAY,IAAQxQ,MAAO,CAAEkP,gBAAiBJ,GAA7I,SAA0JyB,EAAM,cAACG,EAAA,EAAD,IAAoB9B,Y,gJC7RnKgC,E,WAOjB,WAAYrL,EAAUsL,GAAqC,IAA3BC,IAA0B,6EACtDtL,KAAKD,SAAWA,EAChBC,KAAKqL,SAAWA,EAChBrL,KAAKuL,cAAgBF,EAEjBC,GACAtL,KAAKwL,S,0CAGb,WACIxL,KAAKyL,UAAYhS,KAAKD,MAEtBkS,aAAa1L,KAAKqB,IAClBrB,KAAKqB,GAAKoJ,WAAWzK,KAAKD,SAAUC,KAAKuL,iB,mBAG7C,WACIG,aAAa1L,KAAKqB,IAClBrB,KAAKuL,eAAiB9R,KAAKD,MAAQwG,KAAKyL,Y,iBAG5C,WACIC,aAAa1L,KAAKqB,IAClBrB,KAAKD,e,YCzBN,SAAS4L,EAAT,GAAsF,IAArEtF,EAAoE,EAApEA,SAAUnM,EAA0D,EAA1DA,KAAM0R,EAAoD,EAApDA,KAAMC,EAA8C,EAA9CA,OAAQ9L,EAAsC,EAAtCA,SAAUiJ,EAA4B,EAA5BA,MAA4B,IAArB8C,iBAAqB,SACrFC,EAAe,WACpBC,GAAW,GAEXvB,WAAWoB,EAAQ,MAGpB,EAA8BlL,IAAMuE,UAAS,GAA7C,mBAAO6E,EAAP,KAAgBiC,EAAhB,KACMC,EAAQtL,IAAMuL,SAAQ,kBAAM,IAAId,EAAMW,EAAqB,IAAPH,GAAa,KAAQ,IACzEO,EAAcxL,IAAMyL,SAEpBC,EAAmB,WACxBJ,EAAMK,QACNH,EAAYI,QAAQ/R,MAAMgS,mBAAqB,UAG1CC,EAAmB,WACxBR,EAAMT,SACNW,EAAYI,QAAQ/R,MAAMgS,mBAAqB,WAkBhD,OAfA7L,IAAMI,WAAU,WACf,IAAM2L,EAAc,kBAAOZ,GAAaW,KAClCE,EAAa,kBAAOb,GAAaO,KAOvC,OALAtF,OAAO1K,iBAAiB,QAASqQ,GACjC3F,OAAO1K,iBAAiB,OAAQsQ,IAE/Bb,GAAazR,SAASuS,aAAeH,IAE/B,WACN1F,OAAOoD,oBAAoB,QAASuC,GACpC3F,OAAOoD,oBAAoB,OAAQwC,OAKpC,sBAAKxG,UAAWtO,YAAe,QAAS,CAACkS,EAAS,WAAY7P,GAC5D2S,aAAcf,EAAY,KAAOO,EACjCS,aAAchB,EAAY,KAAOW,EACjCnE,QAASvI,EAAW,SAAA0F,GAAO1F,EAAS0F,GAAIwG,EAAMc,OAAW,WAAQd,EAAMc,OACvEvS,MAAO,CAAEwS,OAAQjN,EAAW,UAAY,KAAM2J,gBAAiBV,GAJjE,UAKG3C,EAEF,qBAAKF,UAAU,uBAAf,SACC,qBAAKnC,IAAKmI,EAAahG,UAAU,cAAc3L,MAAO,CAAEyS,kBAAmBrB,EAAO,Y,IAMjEzE,E,4MAIpB2C,MAAQ,CAAEoD,OAAQ,I,uDAElB,WACC/F,EAAO+C,SAAWlK,O,2BAmBnB,WACC,MAAO,W,yBAYR,WACC,MAAO,W,oBAUR,WAAU,IAAD,SACR,OACC,sBAAKgE,IAAKmD,EAAOnD,IAAKmC,UAAWtO,YAAe,kBAAmBmI,KAAKmN,gBAAiBnN,KAAKoN,eAA9F,UACC,qBAAKjH,UAAWtO,YAAe,cAAe,IAAE,UAACmI,KAAK8J,MAAMoD,cAAZ,aAAC,EAAmBjV,QAAQ,YAAaqQ,QAAS,kBAAM,EAAKkC,SAAS,CAAE0C,OAAQ,MAAhI,SACC,4CAGClN,KAAK8J,MAAMoD,a,wBA/ChB,SAAiB7G,GAAwD,IAAD,OAA7CnM,EAA6C,uDAAtC,GAAI0R,EAAkC,uDAA3B,EAAGyB,EAAwB,uDAAJ,GACnE,EAA6DA,EAArDtN,gBAAR,MAAmB,KAAnB,IAA6DsN,EAApCrE,aAAzB,MAAiC,KAAjC,IAA6DqE,EAAtBvB,iBAAvC,SAEMwB,EAAQ3M,IAAMrG,cAAcqR,EAAO,CACxC1B,IAAK5R,cACLgO,WAAUnM,OAAM0R,OAAM5C,QAAO8C,YAC7BD,OAAQ,WACP,EAAK3B,SAASM,SAAS,CAAE0C,OAAQ,EAAKhD,SAASJ,MAAMoD,OAAOvF,QAAO,SAAA4F,GAAC,OAAIA,IAAMD,QAE/EvN,aAID,OADAC,KAAKkK,SAASM,SAAS,CAAE0C,OAAO,GAAD,mBAAOlN,KAAKkK,SAASJ,MAAMoD,QAA3B,CAAmCI,MAC3DA,M,GAvB2B3M,IAAM2F,WAArBa,EAEbnD,IAAMrD,IAAM6M,a,+LC/CdrM,EAAQ,GACRsM,EAAiB,GAEjBC,EAAe,8JACpB,SAASC,EAAUC,GAClB,GAAiB,MAAbD,EACH,IAAK,IAAMA,KAAYxM,EAAO,CAC7B,IAAM0M,EAAQ1M,EAAMwM,GAAUC,GAE9B,GAAIC,EAAO,OAAOA,EAIpB,OAAO1T,IAAE2T,IAAI3M,EAAO,CAACwM,EAAUC,MAVZ,8BAapB,WACC,MAAuB,QAAnBG,IAAY,GACR/N,KAAKgO,SAAS,MAAOD,IAAY,IAElC/N,KAAKgO,SAASD,IAAY,GAAIA,IAAY,MAjB9B,uBAoBpB,SAAUJ,GAKT,OAJKxM,EAAMwM,IACV3N,KAAKiO,YAAYN,GAGXxM,EAAMwM,KAzBM,gEA4BpB,WAAkBA,GAAlB,eAAA5R,EAAA,0DACK0R,EAAeE,GADpB,oDAEkB,QAAbA,EAFL,gCAEsC3N,KAAKkO,WAF3C,kDAIOC,EAASC,IAAYC,UAAUV,GAJtC,yCAKqBlR,QAAQC,MAAR,2DACgCiR,EADhC,QALrB,WAUQQ,EAAOpM,QAVf,kCAWQ,IAAI/H,SAAQ,SAAAC,GAAC,OAAIwQ,WAAWxQ,EAAG,QAXvC,wDAaQ,IAAID,SAAQ,SAAAC,GAClB,IAAMgI,EAASC,IAASC,uBACvBD,IAAS6B,WAAW,UAAW4J,EAAU,WACzC,WAA0B,IAAD,2DAAP,GAAO,IAAtB5I,aAAsB,MAAd,GAAc,gBACNA,GADM,IACxB,2BAAyB,CAAC,IAAD,UAAd3C,EAAc,QAClByL,EAAQ1T,IAAEmI,OAAF,UACbnI,IAAE2T,IAAI3M,EAAO,CAACwM,EAAUvL,EAAIf,YADf,QACuB,IAAIiN,IACxClM,EACA,CACCmM,OAAM,UAAEJ,EAAOK,sBAAT,iBAAE,EAAwBpM,EAAIf,WAA9B,aAAE,EAAkC,GAC1CoN,SAAQ,UAAEN,EAAOK,sBAAT,iBAAE,EAAwBpM,EAAIf,WAA9B,aAAE,EAAkC,KAI9CJ,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYQ,aAClBoQ,SACAN,WAdsB,8BAkBxB5M,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYM,qBAClBsQ,SACAO,OAAQvN,EAAMwM,KAGf1T,EAAEkH,EAAMwM,OAIVF,EAAeE,GAAY1L,MA5C7B,iDA5BoB,oHA4EpB,4BAAAlG,EAAA,yDAEUsG,EAAOI,IAAUkM,eAF3B,gCAGQ,IAAI3U,SAAQ,SAAAC,GAAC,OAAIwQ,WAAWxQ,EAAG,QAHvC,sDAKQ,IAAID,SAAQ,SAAAC,GAClB,IAAMgI,EAASC,IAASC,uBACvByM,YACC1M,IAAS6B,WAAW,WAAY1B,EAAKhB,GAAI,OACzCwN,YAAQ,kBAAmB,UAE5B,WAA0B,IAAD,2DAAP,GAAO,IAAtB9J,aAAsB,MAAd,GAAc,gBACNA,GADM,IACxB,2BAAyB,CAAC,IAAD,EAAd3C,EAAc,QAClByL,EAAQ1T,IAAEmI,OAAF,UACbnI,IAAE2T,IAAI3M,EAAO,CAAC,MAAOiB,EAAIf,YADZ,QACoB,IAAIyN,IACrC1M,EACA,CACCuL,SAAU,MACVoB,MAAM,EACNlN,OAAQO,EAAIf,KAIdJ,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYW,UAClB2P,QACAhM,OAAQO,EAAIf,MAfU,8BAmBxBJ,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYO,iBAClB4Q,OAAQvN,EAAM6N,MAGf/U,EAAEkH,EAAM6N,QAIVvB,EAAeuB,IAAM/M,MAvCvB,2CA5EoB,2DAA4BO,KAwH3CyM,EAAa,IAAIvB,EAAgBzM,KAApB,mBACjB1D,IAAYQ,cAAe,YAAwB,IAArBoQ,EAAoB,EAApBA,OAAQN,EAAY,EAAZA,MACtC1T,IAAE+U,IAAI/N,EAAO,CAACgN,EAAO9M,GAAIwM,EAAMxM,IAAKwM,MAFnB,cAIjBtQ,IAAYW,WAAY,YAAwB,IAArB2P,EAAoB,EAApBA,MAAOhM,EAAa,EAAbA,OAClC1H,IAAE+U,IAAI/N,EAAO,CAAC,MAAOU,GAASgM,MALb,IASJoB,O,2IC/IXE,EAAOC,E,qEAEPC,G,MAAY,CAAC,QAAS,YAE1B,SAASC,IAA2Q,OAA9PA,EAAWnT,OAAO/B,QAAU,SAAUmO,GAAU,IAAK,IAAIxQ,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIwX,EAASvX,UAAUD,GAAI,IAAK,IAAIkS,KAAOsF,EAAcpT,OAAOqT,UAAUC,eAAeC,KAAKH,EAAQtF,KAAQ1B,EAAO0B,GAAOsF,EAAOtF,IAAY,OAAO1B,GAAkB+G,EAASK,MAAM3P,KAAMhI,WAEhT,SAAS4X,EAAyBL,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkEtF,EAAKlS,EAAnEwQ,EAEzF,SAAuCgH,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2DtF,EAAKlS,EAA5DwQ,EAAS,GAAQuH,EAAa3T,OAAO4T,KAAKR,GAAqB,IAAKxX,EAAI,EAAGA,EAAI+X,EAAW7X,OAAQF,IAAOkS,EAAM6F,EAAW/X,GAAQ8X,EAAShI,QAAQoC,IAAQ,IAAa1B,EAAO0B,GAAOsF,EAAOtF,IAAQ,OAAO1B,EAFxMyH,CAA8BT,EAAQM,GAAuB,GAAI1T,OAAO8T,sBAAuB,CAAE,IAAIC,EAAmB/T,OAAO8T,sBAAsBV,GAAS,IAAKxX,EAAI,EAAGA,EAAImY,EAAiBjY,OAAQF,IAAOkS,EAAMiG,EAAiBnY,GAAQ8X,EAAShI,QAAQoC,IAAQ,GAAkB9N,OAAOqT,UAAUW,qBAAqBT,KAAKH,EAAQtF,KAAgB1B,EAAO0B,GAAOsF,EAAOtF,IAAU,OAAO1B,EAMne,SAAS6H,EAAclM,EAAMmM,GAC3B,IAAI/I,EAAQpD,EAAKoD,MACbgJ,EAAUpM,EAAKoM,QACflK,EAAQwJ,EAAyB1L,EAAMmL,GAE3C,OAAoB,gBAAoB,MAAOC,EAAS,CACtDiB,MAAO,6BACPC,WAAY,+BACZhW,MAAO,CACLiW,UAAW,WAEbC,QAAS,gBACTC,MAAO,SACPC,OAAQ,SACR5M,IAAKqM,EACL,kBAAmBC,GAClBlK,GAAQkB,EAAqB,gBAAoB,QAAS,CAC3DjG,GAAIiP,GACHhJ,GAAS,KAAM6H,IAAUA,EAAqB,gBAAoB,OAAQ,KAAmB,gBAAoB,WAAY,CAC9H9N,GAAI,8CACU,gBAAoB,OAAQ,CAC1CsP,MAAO,KACPC,OAAQ,UACHxB,IAAOA,EAAkB,gBAAoB,IAAK,CACvDyB,SAAU,oDACI,gBAAoB,OAAQ,CAC1CC,EAAG,iGACHC,KAAM,iBACS,gBAAoB,OAAQ,CAC3CD,EAAG,4GACHC,KAAM,oBAIV,IAAIC,EAA0B,aAAiBZ,G,GAChC,I,uGC/CA,MAA0B,yC,eCS1B,SAASa,IACpB,IAAMC,EAAW,CACbC,QAAS,kBAAMpK,OAAOqK,KAAK,iCAAkC,WAC7DC,OAAQ,kBAAMtK,OAAOqK,KAAK,iCAAkC,WAC5DE,QAAS,kBAAMvK,OAAOqK,KAAK,kCAAmC,WAC9DG,MAAO,kBAAMxK,OAAOqK,KAAK,+BAAgC,WACzDI,QAAS,kBAAM3K,YAAgB,+CAGnC,OACI,iCACI,sBAAKV,UAAU,OAAf,UACI,sBAAKA,UAAU,eAAf,UACI,sBAAKA,UAAU,yBAAf,UACI,qBAAKA,UAAU,OAAOtK,ICvB/B,q8EDuB0C6M,IAAI,SAErC,gCACI,6CACA,6CACc,qBAAK7M,IAAK4V,EAAO/I,IAAI,SAAIiI,MAAO,GAAIC,OAAQ,cAKlE,sBAAKzK,UAAU,sBAAf,UACI,sBAAKA,UAAU,eAAemC,QAAS4I,EAASC,QAAhD,UACI,cAAC,IAAD,IACA,cAACtI,EAAA,EAAD,yBAGJ,sBAAK1C,UAAU,eAAemC,QAAS4I,EAASG,OAAhD,UACI,cAAC,IAAD,IACA,cAACxI,EAAA,EAAD,wBAGJ,sBAAK1C,UAAU,eAAemC,QAAS4I,EAASI,QAAhD,UACI,cAAC,IAAD,IACA,cAACzI,EAAA,EAAD,yBAGJ,sBAAK1C,UAAU,eAAemC,QAAS4I,EAASK,MAAhD,UACI,cAAC,IAAD,IACA,cAAC1I,EAAA,EAAD,uBAGJ,sBAAK1C,UAAU,eAAemC,QAAS4I,EAASM,QAAhD,UACI,cAAC,IAAD,IACA,cAAC3I,EAAA,EAAD,+BAKZ,qBAAK1C,UAAU,kBAIf,qBAAKA,UAAU,2BAAf,SACI,sBAAKA,UAAU,eAAf,UACI,mBAAG8C,KAAK,2BAAR,yBACA,mBAAGA,KAAK,4BAAR,wBACA,mBAAGA,KAAK,yCAAR,2BACA,oBAAGA,KAAK,gCAAR,UACI,qBAAKpN,IAAK4V,EAAO/I,IAAI,SAAIiI,MAAO,GAAIC,OAAQ,KAC5C,sBAAMpW,MAAO,CAAEkX,OAAQ,SAAvB,oBACA,qBAAK7V,IAAK4V,EAAO/I,IAAI,SAAIiI,MAAO,GAAIC,OAAQ,QAGhD,sBAAKzK,UAAU,YAAf,6BACiB,IAAI1M,MAAOkY,cAD5B,6BElET,SAASC,IACvB,IAAM1Q,EAAYuB,IAAUyC,SAASzC,IAAUkM,cAE/C,OACC,sBAAKxI,UAAU,WAAf,UACC,qBAAKA,UAAU,0BAAf,SACC,sBAAKA,UAAU,iBAAf,UACC,cAAC,EAAD,IACA,cAAC,EAAD,SAIF,sBAAKA,UAAU,OAAf,UACC,wCAEA,mFACkD,uBADlD,qDAEmD,0BAGnD,sBAAKA,UAAU,UAAf,UACgB,OAAdjF,EACE,cAAC,IAAM2Q,SAAP,UACD,sBACC1L,UAAU,eACVmC,QAAS,kBAAMvB,OAAO+K,SAAS1X,OAAO,SAFvC,UAIC,cAAC,IAAD,IAJD,uBAUC,eAAC,IAAMyX,SAAP,WACD,sBACC1L,UAAU,eACVmC,QAAS,kBAAM7B,IAAOC,KAAK,cAACqL,EAAA,EAAD,CAAWC,QAAM,MAF7C,UAIC,cAAC,IAAD,IAJD,aASA,sBACC7L,UAAU,SACVmC,QAAS,kBAAM7B,IAAOC,KAAK,cAACqL,EAAA,EAAD,MAF5B,UAIC,cAAC,IAAD,IAJD,gBAUF,sBAAK5L,UAAU,SAAf,UACC,cAAC,IAAD,IADD,uB,uLCvDC8L,GAAS,CACd,mBAAoB,KAGrB,SAASC,GAAYnV,GACpB,OAAOA,EAAUC,QAAQ,+BAAgC,SAASmV,cAGnE,IAAMC,GAAa,mDAClB,aAAsB,IAAD,iDAANC,EAAM,yBAANA,EAAM,gBACpB,+BAASA,IAET,IAAMC,EAAoB,SAApBA,IACa7P,IAAUkM,iBAG3B,EAAK4D,mBAAqBrQ,IAASE,IAAI,eAAgBK,IAAUkM,eAAetN,GAAI,KAAM,WAE1Fa,IAASkC,OACR,EAAKmO,oBACJpX,MAAK,SAAAc,GACN,EAAKuW,YAAa,EAElBvR,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYe,sBAClBmU,QAAO,OAAExW,QAAF,IAAEA,IAAQ,QAInBwG,IAAUiQ,eAAeJ,KApBP,OAwBpB7P,IAAUkQ,YAAYL,GAEtB,EAAKM,MAAQzY,IAAE0Y,SAAS,EAAKD,MAAMxS,KAAX,gBAAuB,KA1B3B,EADH,yCA8BlB,WACMJ,KAAKwS,YAEVtQ,IAASgN,IAAIlP,KAAKuS,mBAAoBN,IACpC1V,OAAM,SAAAC,GAAG,OAAIC,QAAQC,MAAM,8BAA+BF,EAAIkJ,YAlC/C,sBAqClB,SAASuE,GACR,OAAOgI,GAAOC,GAAYjI,MAtCT,uBAyClB,WACC,OAAOgI,KA1CU,oBA6ClB,WACC,OAAO,WAIN,OAHAhR,IAAW6R,gBAAgBvV,IAAYc,gBACvC4C,IAAW6R,gBAAgBvV,IAAYe,uBAEhCqC,IAAMrG,cACZ,QACA,GAFM,6BAIH6B,OAAOsW,QAAQR,IAAQnZ,KAAI,mCAAEmR,EAAF,KAAOrN,EAAP,uBAAuBqN,EAAvB,aAA+BrN,EAA/B,QAAyC5D,KAAK,MAJtE,qBAlDS,GAA0BwJ,MA6DvCuQ,GAAW,IAAIX,GAAcnR,KAAlB,mBACf1D,IAAYc,gBAAiB,YAAqB,IAAlB4L,EAAiB,EAAjBA,IAAKrN,EAAY,EAAZA,MACrCqV,GAAOC,GAAYjI,IAAQrN,EAE3BmW,GAASH,WAJM,cAMfrV,IAAYe,uBAAwB,YAAkB,IAAfmU,EAAc,EAAdA,QACvC,IAAK,IAAMxI,KAAOwI,EAAS,CAC1B,IAAMO,EAAQ,CAAC,SAAU,WACnBA,EAAMnL,eAAgBoC,KAAW+I,EAAMnL,eAAgB4K,EAAQxI,MAGrEgI,GAAOhI,GAAOwI,EAAQxI,QAZR,IAiBF8I,M,mFClFA,SAASE,KACvB,IAAMC,EAAS,CACdC,WAAW,WAAD,4BAAE,WAAMC,GAAN,eAAArX,EAAA,0DACPqX,EAAQhb,OADD,mBAEJyV,EAAQoB,KAAWoE,mBAFf,yCAGSlM,IAAOC,UAAU,qBAAsB,YAHhD,OAKVyG,EAAMyF,YAAYF,GAClBG,KAAYC,WAAW3F,EAAMF,SAAUE,EAAMxM,IANnC,iCASJ,GATI,2CAAF,mDAAC,IAaZ,OACC,sBAAK8E,UAAU,6BAAf,UACC,eAACsN,GAAA,EAAD,CACCpS,GAAG,eACH8E,UAAU,eACVuN,OAAQR,EAAOC,WACfQ,QAAS,SAAAlO,GAAC,OAAIA,EAAE8C,OAAO3L,MAAQ2W,KAAYK,cAAgBL,KAAYC,cACvEK,kBAAmB,cAACC,GAAD,IALpB,UAMC,cAAC,IAAD,IAND,eAQA,qBAAK3N,UAAU,SAAf,SACC,cAAC,KAAD,MAGD,qBAAKA,UAAU,SAASmC,QAAS,kBAChCjO,SAAS8Q,eAAe,gBAAgB4I,cACvC,IAAIC,cAAc,UAAW,CAC5B/J,IAAK,QACLgK,UAAU,EACVC,SAAS,MALZ,SASC,cAAC,KAAD,SAMJ,SAASJ,KAAoB,IAAD,IAC3B7S,IAAW6R,gBAAgBvV,IAAYC,aACvCyD,IAAW6R,gBACVvV,IAAYwB,0BACZ,kBACC,CADD,EAAG4O,SAAH,EAAa9L,QACOsS,MAAK,SAAA9S,GAAE,OAAI0F,OAAO+K,SAAS7I,KAAKmL,SAAS/S,SAG9D,IAAMwM,EAAK,UAAGoB,KAAWoE,0BAAd,QAAoC,GAEzCgB,EAAgBlY,OAAO4T,KAAP,UACrBwD,KAAYe,uBAAuBzG,EAAMF,SAAUE,EAAMxM,WADpC,QAC2C,IAGjE,OACC,sBACC8E,UACCtO,YACC,mBACA,GAAGwc,EAAcpc,OAAQ,WAJ5B,UAQEoc,EAAcvb,KAAI,SAAC+I,EAAQ9J,GAAT,OAClB,eAAC,IAAM8Z,SAAP,WACC,cAACzQ,GAAA,EAAD,CAAaiB,KAAMI,IAAU8R,QAAQ1S,GAAS2S,cAAY,IAEzDzc,IAAMsc,EAAcpc,OAAS,GAC7B,sBAAKkO,UAAU,QAAf,eACIpO,IAAMsc,EAAcpc,OAAS,GAAK,WALnB4J,MAWrBwS,EAAcpc,OAAS,IAAMoc,EAAcxM,QAAQpF,IAAUkM,eAAetN,IAC1E,OACA,MAtBJ,gB,uCC9Da,SAASoT,KAAa,IAAD,EACnCxT,IAAW6R,gBAAgBvV,IAAYU,qBAEvC,IAAMyR,EAAOgF,KAAYC,YAEzB1T,IAAW6R,gBACVvV,IAAYS,sBACZ,qBAAG4P,WAAqB,OAAK8B,QAAL,IAAKA,OAAL,EAAKA,EAAM7B,MAAMxM,OAG1C,IAAMuT,EAAS,WAAQ,OAAJlF,QAAI,IAAJA,OAAA,EAAAA,EAAM7B,OACtBgH,KAAiBC,gBAAgBpF,EAAK7B,MAAMF,SAAU+B,EAAK7B,MAAMxM,IACjE,UAFY,QAEL,GAEV,OAAOqO,EAEL,qBAAKvJ,UAAU,kBAAf,SACC,qBAAKA,UAAU,qBAAf,SACEyO,EAAU9b,KAAI,SAAA+I,GAAM,OACpB,cAACkT,GAAD,CAA8BlT,OAAQA,GAAhBA,UAMzB,sBAAKsE,UAAU,yBAAf,UACC,cAAC,KAAD,IADD,kBAMH,SAAS4O,GAAT,GAAsC,IAAXlT,EAAU,EAAVA,OACpBQ,EAAOI,IAAUyC,UAAS,kBAAMzC,IAAU8R,QAAQ1S,MAExD,OAAOQ,EACN,sBAAK8D,UAAU,cAAf,UACC,cAAC9D,EAAK2S,gBAAN,CAAsBC,KAAM,MAE5B,oBAAI9O,UAAU,WAAd,SAA0B9D,EAAKf,iBAE7B,K,gCC3CCH,GAAQ,GAER+T,GAAqB,+JAC1B,SAASvH,EAAUC,GAClB,OAAOzT,IAAE2T,IAAI3M,GAAO,CAACwM,EAAUC,MAFN,gCAK1B,SAAmBD,EAAUC,EAASuH,GAAY,IAAD,EAC1CC,EAAK,UAAGpV,KAAKqV,SAAS1H,EAAUC,UAA3B,QAAuC,GAElD,OAAOzR,OAAOsW,QAAQ2C,GACpBzN,QAAO,uCAAmBwN,YAAcA,KACxCrc,KAAI,yCAAqB,CACzB+I,OADI,KAEJyT,UAFI,KAEYA,gBAZO,+BAgB1B,WACC,OAAOnU,OAjBkB,GAAkCqB,MAoC9C+S,GAfU,IAAIL,GAAsBjU,IAA1B,eACvB1D,IAAYuB,cAAe,YAAmC,IAAhC6O,EAA+B,EAA/BA,SAAUC,EAAqB,EAArBA,QAASwH,EAAY,EAAZA,MAE5Cjb,IAAE2T,IAAI3M,GAAO,CAACwM,EAAUC,KAC5BzT,IAAE+U,IAAI/N,GAAO,CAACwM,EAAUC,GAAU,IAH0B,qBAO1CwH,GAP0C,IAO7D,2BAA0B,CAAC,IAAhBI,EAAe,QACzBrU,GAAMwM,GAAUC,GAAS4H,EAAKnU,IAC7BlH,IAAEsb,KAAKD,EAAM,YAAa,cATiC,mC,gBCbhD,SAASE,GAAT,GAA2C,IAAtB/H,EAAqB,EAArBA,SAAUC,EAAW,EAAXA,QAC7C3M,IAAW6R,gBACVvV,IAAYqB,aACZ,SAAA6G,GAAC,OAAIA,EAAEkI,UAAYA,GAAYlI,EAAEmI,SAAWA,KAG7C,IAAM5J,EAAMrD,IAAMyL,SAEZuJ,EAAWC,KAAaC,iBAAiBlI,EAAUC,GACnDkI,EAAWC,YAAc,YAAa,KAEtCC,EAAerV,IAAMuL,SAAQ,kBAAM4J,EAAW,CACnDG,aAAc,SAAAxQ,GACb,IAAMyQ,EAAOzQ,EAAE0Q,QAAQ,GAAGC,QACpBC,EAAO5Q,EAAE0Q,QAAQ,GAAGG,QACpB/N,EAASwK,GAASwD,SAAS,kBAAoB,GAEjDC,EAAc,EACdC,EAAkBC,WAAW1S,EAAIuI,QAAQ/R,MAAMmc,UAAUC,MAAM,YAC/DC,MAAMJ,KAAkBA,EAAkB,GAE9C,IAeI5K,EAfEiL,EAAU,SAAArR,GAEf+Q,EAAc/Q,EAAE0Q,QAAQ,GAAGC,QAAUF,EAEjC5d,KAAKye,IAAIP,GAHC,IAGuBle,KAAKye,IAAItR,EAAE0Q,QAAQ,GAAGG,QAAUD,GAAQ,KACzEG,EAAc,EAAGA,GAJP,GAKTA,GALS,GAOdra,OAAO/B,OAAO4J,EAAIuI,QAAQ/R,MAAO,CAChCmc,UAAU,cAAD,OAAgBxc,IAAE6c,MAAMP,EAAkBD,EAAa,EAAGjO,GAA1D,WAIXlO,SAASgC,iBAAiB,YAAaya,GAGvCzc,SAASgC,iBAAiB,WAAYwP,EAAS,WAC9CpB,YAAW,WACVtO,OAAO/B,OAAO4J,EAAIuI,QAAQ/R,MAAO,CAChCmc,UAAWH,EAAcjO,EAAS,EAAvB,qBAAyCA,EAAzC,OAAuD,SAGnElO,SAAS8P,oBAAoB,YAAa2M,GAC1Czc,SAAS8P,oBAAoB,WAAY0B,KACvC,SAGF,KAAI,CAACiK,IAST,OAPAmB,aACC,kBAAMrB,KAAasB,UAAUvJ,EAAUC,KACvC,KACA,EACA,CAACD,EAAUC,IAIX,+CACCzH,UAAU,kBACVnC,IAAKA,GACDgS,GAHL,aAKEL,EAEC,qBAAKxP,UAAU,WAAf,SACEwP,EAAS7c,KAAI,SAAA+U,GAAK,OAClB,cAACsJ,GAAD,gBAAkBtJ,SAKpB,qBACC1H,UAAU,aACV3L,MAAO,CACN4c,UAAW,IAHb,SAMC,cAAClM,GAAA,EAAD,SAOC,SAASiM,GAAT,GAA6C,IAAD,EAApBtV,EAAoB,EAApBA,OAAQ8T,EAAY,EAAZA,SAChCtT,EAAOI,IAAUyC,UAAS,kBAAMzC,IAAU8R,QAAQ1S,MAExD,OACC,sBAAKsE,UACJtO,YACC,eACA,CAACgK,KAAM,UAAKY,IAAUkM,sBAAf,aAAK,EAA0BtN,IAAI,cAH5C,UAMC,eAAC,IAAYgW,QAAb,CACCC,KAAM,cAACjV,EAAKkV,YAAN,IACNC,iBAAiB,mBAFlB,UAIEnV,GAAQ,cAACA,EAAK2S,gBAAN,IAET,sBAAK7O,UAAU,UAAf,UACC,oBAAIA,UAAU,WAAd,SAA0B9D,EAAKf,cAE/B,cAACe,EAAKoV,WAAN,UAID9B,EAAS7c,KAAI,SAAAsa,GAAO,OACpB,cAACsE,GAAD,CAAkBtE,QAASA,GAAcA,EAAQ/R,UAMrD,SAASqW,GAAT,GAAwC,IAAD,EAAXtE,EAAW,EAAXA,QACrBvF,EAAQoB,KAAWoE,mBAEzBpS,IAAW6R,gBACVvV,IAAYuB,cACZ,gBAAG6O,EAAH,EAAGA,SAAUC,EAAb,EAAaA,QAAb,OACM,OAALC,QAAK,IAALA,OAAA,EAAAA,EAAOF,YAAaA,IAAiB,OAALE,QAAK,IAALA,OAAA,EAAAA,EAAOxM,MAAOuM,KAGhD,IAAMwH,EAAQG,GAAiBoC,mBAAjB,OACb9J,QADa,IACbA,OADa,EACbA,EAAOF,SADM,OAEbE,QAFa,IAEbA,OAFa,EAEbA,EAAOxM,GACP+R,EAAQ/R,IACPsG,QAAO,qBAAG9F,SAAwBY,IAAUkM,eAAetN,MAE7D,OACC,sBAAK8E,UAAU,eAAf,UACC,sBAAKA,UAAU,qBAAf,UACC,sBAAMA,UAAU,YAAhB,mBACEiN,EAAQwE,oBADV,aACE,EAAsBva,SAASC,mBAAmB,QAAS,CAAEua,QAAQ,IAAShf,MAAM,GAAI,KAG1F,eAACgQ,EAAA,EAAD,CAASiP,UAAU,QAAnB,UACC,wCAAW1E,EAAQ2E,qBAElB3E,EAAQ4E,UACR,0CAAa5E,EAAQ2E,gBAAgB3E,EAAQ4E,mBAKhD,qBAAK7R,UAAU,iBAAf,SACEiN,EAAQ6E,iBAGP7C,EAAMnd,QACR,sBAAKkO,UAAU,iBAAf,UACC,cAAC,KAAD,CAAOA,UAAU,SAEjB,eAAC0C,EAAA,EAAD,CAASiP,UAAU,OAAnB,UACC,yCAEA,qBAAK3R,UAAU,kBAAf,SACEiP,EAAMtc,KAAI,gBAAG+I,EAAH,EAAGA,OAAQyT,EAAX,EAAWA,UAAX,OACV,gCACC,cAAClU,GAAA,EAAD,CAAaiB,KAAMI,IAAU8R,QAAQ1S,KADtC,IACmD3E,YAAgBoY,KADzDzT,gBA5BmBuR,EAAQ/R,IC/I9B,SAAS6W,GAAT,GAAoC,IAAb7R,EAAY,EAAZA,SAC/BrC,EAAMrD,IAAMyL,SAEZ+L,EAAexX,IAAMuL,SAAQ,kBAAM,SAAAzG,GACxCxE,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYc,eAClB4L,IAAK,iBACLrN,MAAOzC,IAAE6c,MACRvR,EAAE2Q,QAAUpS,EAAIuI,QAAQ6L,wBAAwBvX,EAChD,IAAK,UAGL,CAACwF,IAEE6M,EAAS,CACdzK,YAAa,WAGZ,IAAIoD,EAFJxR,SAASgC,iBAAiB,YAAa8b,GAGvC9d,SAASgC,iBAAiB,UAAWwP,EAAS,WAC7CxR,SAAS8P,oBAAoB,YAAagO,GAC1C9d,SAAS8P,oBAAoB,UAAW0B,OAK3C,OACC,sBAAK1F,UAAU,oBAAoBnC,IAAKA,EAAxC,UACEqC,EAED,kCAAKF,UAAU,gBAAmB+M,O,OC3BtB,SAASmF,GAAT,GAAuC,IAAb1K,EAAY,EAAZA,SAClCQ,EAASC,IAAYC,UAAUV,GACvBlL,IAAUyC,UAAS,kBAAMzC,IAAU8R,QAAV,OAAkBpG,QAAlB,IAAkBA,OAAlB,EAAkBA,EAAQmK,YAEjE,OAAOnK,EACN,qBAAKhI,UAAU,4BAAf,SACC,sBAAKA,UAAU,kBAAf,UACC,qBACCA,UAAU,SACVmC,QAAS,kBAAMY,YAAeiF,EAAOoK,UAFtC,SAIEpK,EAAOoK,QACL,qBACDpS,UAAU,OACVtK,IAAKsS,EAAOoK,QACZ7P,IAAKhQ,YAAWyV,EAAOqK,QAEtB,oBAAIrS,UAAU,eAAd,SACAzN,YAAWyV,EAAOqK,UAItB,qBAAKrS,UAAU,SAAf,SACEgI,EAAOoK,SAEP,qBACCpS,UAAU,sBACVtK,IAAKsS,EAAOoK,QACZ7P,IAAI,aAKP,oBAAIvC,UAAU,QAAd,SAAuBgI,EAAOqK,YAG7B,K,OCjCU,SAASC,GAAT,GAAiC,IAAXtK,EAAU,EAAVA,OASpC,SAASuK,IACR,OAAQ3K,GAAY,IACnB,IAAK,SACJ,OAAO,cAAC,GAAD,CAAWJ,SAAUQ,EAAO9M,GAAIuM,QAASG,GAAY,KAG7D,IAAK,WACJ,OAAO,cAAC,GAAD,CAAgBJ,SAAUQ,EAAO9M,KAGzC,IAAK,OACJ,OAAO,cAAC,GAAD,IAIT,OAAO,KAGR,OA1BAJ,IAAW6R,gBAAgBvV,IAAYC,aAEvCyD,IAAW6R,gBACVvV,IAAYM,sBACZ,SAAA4H,GAAC,OAAIA,EAAE0I,OAAO9M,KAAO8M,EAAO9M,KAC5B,CAAC8M,IAsBD,sBAAKhI,UAAU,kBAAf,UACC,cAAC+R,GAAD,UACE/J,EAAOwK,iBAGT,cAACD,EAAD,O,OC1BY,SAASE,KACvB3X,IAAW6R,gBAAgBvV,IAAYC,aACvCyD,IAAW6R,gBAAgBvV,IAAYO,kBAEvC,IAbqB+a,EAafnK,EAASO,KAAW6J,UAAU,OAEpC,SAASJ,IAAqB,IAAD,IAC5B,MACM,MADN,oBAAQ3K,GAAY,UAApB,aAAQ,EAAgB3V,cAAxB,QAAkC,IAEzB,KAKN,cAAC,GAAD,CACCuV,SAAS,MACTC,QAASG,GAAY,KAS1B,OAFAtR,QAAQsc,IAAIrK,GAGX,sBAAKvI,UAAU,eAAf,UACC,cAAC+R,GAAD,WApCmBW,EAqCJnK,EApCZmK,EACU1c,OAAO6c,OAAOH,GAASI,MAAK,SAACld,EAAGmd,GAAJ,OAAUA,EAAEC,gBAAkBpd,EAAEod,mBAE7DrgB,KAAI,SAAA+U,GAAK,OACtB,cAACA,EAAMvH,UAAP,GAAsBuH,EAAMD,YAJR,QAuCnB,cAAC8K,EAAD,O,OCxCY,SAASU,KAGvB,OAFAnY,IAAW6R,gBAAgBvV,IAAYC,aAE/BuQ,GAAY,IACnB,UAAK5I,EACL,IAAK,GACJ,OACC,sBAAKgB,UAAU,qBAAf,UACC,4DAIA,yGAIA,wFAOH,IAAK,UACJ,IAAMgI,EAASC,IAAYC,UAAUN,GAAY,IAEjD,OAAII,EAEF,cAAC,GAAD,CAAYA,OAAQA,IAKpB,sBAAKhI,UAAU,qBAAf,UACC,uCAIA,6EAQJ,IAAK,MACJ,OAAO,cAAC,GAAD,IAIT,OACC,qBAAKA,UAAU,qBAAf,uCC7Da,I,GAAA,OAA0B,kC,mGCQ5BkT,GAA2B,CACvCC,QAAS,CACRC,OAAQ,cAAC,KAAD,IAERC,QAAS,GAITC,QAAS,GAITC,OAAQ,IAKTC,WAAY,CACXJ,OAAQ,cAAC,KAAD,IAERK,OAAQ,GAIR3H,OAAQ,GAIR4H,WAAY,CACXC,MAAO,CACNC,MAAO,YACPC,KAAM,kCACN9f,KAAM,SACN0C,MAAO,MAKVqd,cAAe,CACdV,OAAQ,cAAC,KAAD,IAERrM,OAAQ,GAIRhR,MAAO,IAKRge,cAAe,CACdX,OAAQ,cAAC,KAAD,IAERY,MAAO,GAIPC,MAAO,IAKRC,OAAQ,CACPd,OAAQ,cAAC,KAAD,IAERe,QAAS,GAITC,MAAO,IAKRC,WAAY,CACXjB,OAAQ,cAAC,KAAD,IAERgB,MAAO,GAIPE,QAAS,GAITC,OAAQ,GAIRC,aAAc,IAKfC,cAAe,CACdrB,OAAQ,cAAC,KAAD,IAERsB,QAAS,GAITC,WAAY,GAIZC,eAAgB,IAKjBC,KAAM,CACLzB,OAAQ,cAAC,KAAD,IAER0B,OAAQ,GAIRC,cAAe,GAIfC,aAAc,IAKfC,MAAO,CACN7B,OAAQ,cAAC,KAAD,IAER8B,WAAY,GAIZC,eAAgB,GAIhBC,cAAe,GAIfC,cAAe,IAKhBC,aAAc,IAKTC,GAAW,GAEXC,GAAkB,mDACvB,aAAsB,IAAD,iDAANtJ,EAAM,yBAANA,EAAM,gBACpB,+BAASA,IAET,IAAMC,EAAoB,SAApBA,IACa7P,IAAUkM,iBAG3B,EAAK4D,mBAAqBrQ,IAASE,IAAI,eAAgBK,IAAUkM,eAAetN,GAAI,KAAM,cAE1Fa,IAASkC,OACR,EAAKmO,oBACJpX,MAAK,SAAAc,GACN,EAAKuW,YAAa,EAElBoJ,GAAmBrZ,SAAS,CAC3BrI,KAAMqD,IAAYiB,sBAClBiU,QAAO,OAAExW,QAAF,IAAEA,IAAQ,QAInBwG,IAAUiQ,eAAeJ,KApBP,OAwBpB7P,IAAUkQ,YAAYL,GAEtB,EAAKM,MAAQzY,IAAE0Y,SAAS,EAAKD,MAAMxS,KAAX,gBAAuB,KA1B3B,EADE,yCA8BvB,WACMJ,KAAKwS,YAEVtQ,IAASgN,IAAIlP,KAAKuS,mBAAoBmJ,IACpCnf,OAAM,SAAAC,GAAG,OAAIC,QAAQC,MAAM,yBAA0BF,EAAIkJ,YAlCrC,6BAqCvB,WAA0B,IAAD,uBAAN5B,EAAM,yBAANA,EAAM,gBAEpB5L,MAAMC,QAAQ2L,EAAK,MAAKA,EAAOA,EAAK,IAExC,IAAM+X,EAAM1hB,IAAE2T,IAAIuL,GAA0BvV,GAE5C,MAAqB,qBAAT+X,EACJpf,QAAQC,MAAM,qBAAsBoH,EAAK9K,KAAK,MAG/CmB,IAAE2T,IAAI4N,GAAN,sBAAoB5X,GAApB,CAA0B,UAAU+X,EAAIjf,WA/CzB,GAA+B4F,MAmD1CoZ,GAAqB,IAAIhc,IAEhCkc,GAAgB,IAAIH,GAAmBC,IAAvB,qBACpBre,IAAYgB,gBAAiB,YAAsB,IAAnBuF,EAAkB,EAAlBA,KAAMlH,EAAY,EAAZA,MAClCzC,IAAE2T,IAAIuL,GAA0BvV,IACnC3J,IAAE+U,IAAIwM,GAAN,sBAAoB5X,GAApB,CAA0B,UAAUlH,GAEpCkf,GAAclJ,SAGdnW,QAAQsf,KAAK,8BAA+B,CAAEjY,OAAMlH,aARjC,eAWpBW,IAAYiB,uBAAwB,YAAkB,IAAfiU,EAAc,EAAdA,QACvCtY,IAAEmI,OAAOoZ,GAAUjJ,MAZC,KAgBPqJ,MAER,SAASE,KACfJ,GAAmB9I,gBAAgBvV,IAAYgB,gBAC/Cqd,GAAmB9I,gBAAgBvV,IAAYiB,uBAE/C,IAAMyd,EAAY,CACjB,8BAA+B,SAAArf,GAAK,OAAIA,GAAK,yHAKlBA,EALkB,uiBAiC9C,OACC,gCACET,OAAO4T,KAAKkM,GAAWnjB,KAAI,SAAAgL,GAAI,OAC/BmY,EAAUnY,GAAMgY,GAAcI,gBAAd,MAAAJ,GAAa,YAAoBhY,EAAKlL,MAAM,WAC1DI,KAAK,Q,+BC3QI,SAASmjB,KACvB,MAA4Bxb,IAAMuE,SAAS,MAA3C,mBAAOkX,EAAP,KAAiBC,EAAjB,KACA,EAA8B1b,IAAMuE,SAAS,GAA7C,mBAAOoX,EAAP,KAAgBC,EAAhB,KACA,EAAwB5b,IAAMuE,SAAS,IAAvC,mBAAO0J,EAAP,KAAc4N,EAAd,KAEIC,GAAgB,EALmB,SAMxBC,EANwB,8EAMvC,WAAsBC,GAAtB,SAAA5gB,EAAA,0DACK0gB,EADL,wDAECA,GAAgB,EAEhBF,EAAW,GAJZ,SAMO,IAAIviB,SAAQ,SAAAC,GAAC,OAAIwQ,WAAWxQ,EAAG,QANtC,OAQCoiB,EAAQM,GACRJ,EAAW,GATZ,4CANuC,sBAkBvC,IAAMK,EAAU,CACfC,KAAM,SAAAF,GACL,IAAK/N,EAAO,OAAO,EACnB,GAAI+N,EAASxK,cAAciC,SAASxF,GAAQ,OAAO,EAEnD,IAAK,IAAMkO,KAAeC,GAAOJ,GAAW,CAC3C,GAAIC,EAAQI,IAAIF,GACf,OAAO,EAGR,GAAIF,EAAQ7X,MAAM4X,EAAUG,GAAc,OAAO,EAGlD,OAAO,GAERE,IAAK,SAAAF,GACJ,OAAKlO,MACDkO,EAAY3K,cAAciC,SAASxF,SAAvC,IAED7J,MAAO,SAAC8X,EAAMG,GACb,IAAKpO,EAAO,OAAO,EAEnB,IAAK,IAAMqO,KAAQF,GAAOF,GAAMG,GAC/B,GAAIC,EAAK9K,cAAciC,SAASxF,GAC/B,OAAO,EAIT,OAAO,IAIT,OACC,sBAAKzI,UAAU,2CAAf,UACC,sBAAKA,UAAU,QAAf,UACC,uBACCjM,KAAK,OACLiM,UAAU,cACV+W,YAAY,YACZvJ,QAAS,SAAAlO,GAAC,OAAI+W,EAAO/W,EAAE8C,OAAO3L,MAAMuV,kBAGrC,sBAAK3X,MAAO,CAAE8hB,WAAWnW,UAAU,WAAnC,WACGiW,GACD,qBAAKjW,UAAU,wBAAf,SACEhK,OAAO4T,KAAKgN,IAAQpV,OAAOiV,EAAQC,MAAM/jB,KAAI,SAAA6jB,GAAQ,OAAKA,EAASQ,WAAW,OAC9E,sBACChX,UAAU,iBAEVmC,QAAS,kBAAMoU,EAAOC,IAHvB,UAKC,sBAAKxW,UAAU,aAAf,UACE4W,GAAOJ,GAAUpD,OAElB,oBAAIpT,UAAU,QAAd,SACErJ,YAAgB6f,QAInB,qBAAKxW,UAAU,WAAf,SACEhK,OAAO4T,KAAKgN,GAAOJ,IAAW7jB,KAAI,SAAAgkB,GAAW,OAC7ChgB,YAAgBggB,GAAa3K,iBAC3BxK,QAAO,SAAAyV,GAAC,OAAKA,EAAED,WAAW,SAAOnkB,KAAK,UAdrC2jB,QAqBRP,GACA,eAAC,IAAMvK,SAAP,WACC,qBAAK1L,UAAU,mCAAf,SACC,qBACCA,UAAU,iBACVmC,QAAS,kBAAMoU,EAAO,OAFvB,SAIC,sBAAKvW,UAAU,aAAf,UACC,cAAC,KAAD,IAEA,oBAAIA,UAAU,QAAd,kCAKH,qBAAKA,UAAU,WAAf,SACEhK,OAAO4T,KAAKgN,GAAOX,IAAWtjB,KAAI,SAAAkkB,GAAG,QACnC7gB,OAAO4T,KAAKgN,GAAOX,GAAUY,IAAM/kB,SAAW+kB,EAAIG,WAAW,OAC9D,cAACE,GAAD,CAECC,IAAKlB,EACLY,IAAKA,GAFAA,iBAab,qBAAK7W,UAAU,UAAf,SACC,cAAC,KAAD,CACCA,UAAU,SACVmC,QAAS,kBAAM7B,IAAOG,cAO3B,SAASyW,GAAT,GAAgC,IAAbC,EAAY,EAAZA,IAAKN,EAAO,EAAPA,IACvB,OACC,sBAAK7W,UAAU,UAAf,UACC,oBAAIA,UAAU,QAAd,SAAuBrJ,YAAgBkgB,KAEvC,qBAAK7W,UAAU,SAAf,SACEhK,OAAOsW,QAAQsK,GAAOO,GAAKN,IAAMlkB,KAAI,SAAA2M,GAAC,OACtC,cAAC8X,GAAD,CAECzZ,KAAM,CAACwZ,EAAKN,EAAKvX,EAAE,IACnB+X,QAAS/X,EAAE,IAFNA,EAAE,YAUb,SAAS8X,GAAT,GAAmC,IAAlBzZ,EAAiB,EAAjBA,KAAM0Z,EAAW,EAAXA,QAChB5gB,EAAQkf,GAAcI,gBAAgBpY,GAEtC2Z,EAAQ9c,IAAMuL,SAAQ,WAIV,IAAD,EAHhB,MAGM,WAHEsR,EAAQtjB,KAKb,oCACCiM,UAAU,yBACV8E,aAAcrO,EACd8gB,OAAQ,SAAAjY,GAAC,OAAImW,GAAmBrZ,SAAS,CACxCrI,KAAMqD,IAAYgB,eAClB3B,MAAO6I,EAAE8C,OAAO3L,MAChBkH,WANF,UAQM0Z,EAAQpX,aARd,QAQuB,KAZT,OAiBf,IAEH,OACC,sBAAKD,UAAU,eAAf,UACC,oBAAIA,UAAU,QAAd,SACErJ,YAAgBgH,EAAKA,EAAK7L,OAAS,MAGpCulB,EAAQxD,MACR,qBAAK7T,UAAU,OAAf,SACEqX,EAAQxD,OAIX,qBAAK7T,UAAU,QAAf,SACEsX,O,sBChKU,SAASE,KACvB,IAAMzc,EAAYuB,IAAUyC,SAASzC,IAAUkM,cAQ/C,OANkB,OAAdzN,IACHiG,IAAOC,UAAU,0CAA2C,WAE5DL,OAAO+K,SAAS1X,OAAO2M,OAAO+K,SAAS8L,SAGjC1c,EACN,qBAAKiF,UAAU,UAAf,SACC,cAAC0X,GAAD,CAAM3c,UAAWA,MAEf,KAGL,IAUI4c,GAVEC,GAAiB5jB,IAAE0Y,UAAS,WACjC,IAAM3R,EAAYuB,IAAUkM,eAExBzN,EAAUK,SAAWjC,IAAWE,QACnC0C,IAAS8b,OAAO9c,EAAUgD,KAAM,CAC/B3C,OAAQjC,IAAWG,SAGnB,KAGH,SAASoe,GAAT,GAA8B,IAAD,EAAb3c,EAAa,EAAbA,UACf,YAA2BgB,IAAS+b,YACnC/b,IAAS6B,WAAW,WAAY7C,EAAUG,GAAI,WAC9C,CAEC4D,UAAU,WAAD,4BAAE,WAAM7C,GAAN,iBAAArG,EAAA,mEACKqS,IAAY8P,aAAa9b,EAAIf,WADlC,mEAC+C+M,IAAY+P,YAAY/b,EAAIf,IAD3E,iCACJ8M,EADI,uBAGHhU,IAAEC,OAAO+T,EAAQ/L,IAHd,2CAAF,mDAAC,YAJZ,QAUK,GAVUgc,EAAf,EAAQrZ,MAkFR,OAtEIqZ,GAAWN,KAAgBM,IAC9Bnd,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYK,eAClBwgB,YAGDN,GAAcM,GAGfC,aAAW,WACV3J,KAAY4J,gBAGbC,YAAiB,SAAS,WACzB,IAAMC,EAAgBvP,KAAWoE,mBACpB,OAAbmL,QAAa,IAAbA,KAAeC,eACb,CAAElW,OAAQxB,SAGbkQ,aAAY,WAEX,IAAM/V,EAAYuB,IAAUkM,eAE5B,GAAItU,SAASuS,YAAc1L,IAE1B6c,MAGK,CAACze,IAAWG,KAAMH,IAAWC,aAAS4F,GAAW0C,QAAQ3G,EAAUK,SACvEW,IAAS8b,OAAO9c,EAAUgD,KAAM,CAC/B3C,OAAQjC,IAAWE,SAKjB0B,EAAUK,SAAWjC,IAAWG,MAAM,CAAC,IAAD,EAEnCoO,EAAQoB,KAAWoE,mBACzB,IAAKxF,EAAO,OAGZ,IAOG,EAPGsH,EAAYhZ,OAAO4T,KAAP,UAAY6F,KAAa8I,YAAY7Q,EAAMF,SAAUE,EAAMxM,WAA3D,QAAkE,IAClFxI,OAAO,GAAG,GAGZ,GAAIsc,GAAahb,IAAE2T,IAClByH,GAAiBoJ,oBACjB,CAAC9Q,EAAMF,SAAUE,EAAMxM,KAGvB,IAAM,UAAAlH,IAAE2T,IACPyH,GAAiBF,SAASxH,EAAMF,SAAUE,EAAMxM,IAChD,CAACH,EAAUG,YAFN,eAGH8T,aAAcA,EAAY,CAC5B,IAAMnR,EAAM9B,IAASE,IAAT,MAAAF,IAAQ,YACnB2L,EAAMkB,KACH,CAAC,iBAAkBD,KAAQ8P,MAAM/Q,EAAMxM,KACvC,CAAC,UAAWwM,EAAMF,SAAU,SAAUE,EAAMxM,KAH5B,QAIjB,WAAYH,EAAUG,MAEzBa,IAASgN,IAAIlL,EAAK,CACjBmR,YACAG,UAAWuJ,qBAMd,UAEa1Z,IAAZiZ,EACI,cAACU,GAAD,IAIP,sBAAK3Y,UAAU,OAAf,UACC,cAAC,GAAS4Y,SAAV,IACA,cAAC/C,GAAD,IAEA,cAAC8C,GAAD,CAAgBE,QAAM,IAEtB,sBAAK7Y,UAAU,uBAAf,UACC,sBAAKA,UAAU,qBAAf,UACC,qBAAKA,UAAU,UAAf,SACEiY,EACCnF,MAAK,SAACld,EAAGmd,GAAJ,OAAUnd,EAAE0S,SAAWyK,EAAEzK,YAC9B3V,KAAI,SAAAqV,GAAM,OAAIA,aAAkB8Q,KAChC,cAAC9Q,EAAO+Q,gBAAR,GAA6B/Q,EAAO9M,SAIvC,cAAC8d,GAAD,OAGD,qBAAKhZ,UAAU,kBAAf,SACC,cAAC,GAAD,SAIF,sBAAKA,UAAU,+BAAf,UACC,sBAAKA,UAAU,SAASmC,QAAS,kBAAM8W,GAAiB,aAAxD,UACC,cAAC,IAAD,CAAOjZ,UAAU,SAEjB,cAAC0C,EAAA,EAAD,qBAGD,eAAC,IAAYwO,QAAb,CACCC,KAAM,cAACpW,EAAUqW,YAAX,IACNC,iBAAiB,2BAFlB,UAIC,qBAAKrR,UAAU,SAAf,SACC,cAACjF,EAAU8T,gBAAX,CAA2B7O,UAAU,WAGtC,sBAAKA,UAAU,UAAf,UACC,oBAAIA,UAAU,WAAd,SACEjF,EAAUI,cAGZ,cAACJ,EAAUuW,WAAX,UAIF,qBAAKtR,UAAU,YAEf,cAAC,GAAD,UAMJ,SAAS2Y,GAAT,GAA6C,IAAD,IAAlBE,cAAkB,SAC3C,OACC,qBAAK7Y,UAAWtO,YAAe,iBAAkB,aAAc,CAACmnB,EAAQ,WAAxE,SACC,cAAC9T,GAAA,EAAD,CAAe1Q,MAAO,CAAE6kB,SAAU,WAKrC,SAASF,KACR,IAAMje,EAAYuB,IAAUyC,UAAS,kBAAMzC,IAAUkM,kBAErD1N,IAAW6R,gBACVvV,IAAYY,sBACZ,qBAAGwP,SAAyB/U,MAAM,KAAKiP,QAApB,OAA4B3G,QAA5B,IAA4BA,OAA5B,EAA4BA,EAAWG,OAG3DJ,IAAW6R,gBACVvV,IAAYa,mBACZ,qBAAGuP,SAAyB/U,MAAM,KAAKiP,QAApB,OAA4B3G,QAA5B,IAA4BA,OAA5B,EAA4BA,EAAWG,OAG3DJ,IAAW6R,gBAAgBvV,IAAYO,kBAEvC,IAAMkR,EAAMC,KAAW6J,UAAU,OAC3BwG,EAAUnjB,OAAO6c,OAAP,OAAchK,QAAd,IAAcA,IAAO,IAAIlW,KAAI,SAAAymB,GAAE,MAC9C,CAACA,EAAGle,GAAIme,KAAkBC,sBAAsBF,EAAG3R,YACjD,IAEH,OACC,sBAAKzH,UAAU,YAAf,UACC,cAAC8Y,EAAA,EAAD,CACC9Q,OAAQ,CACP9M,GAAI,aACJmX,KAAM,YAGPkH,KAAM,cAAC,IAAD,IACNpX,QAAS,kBAAM7B,IAAOC,KAAK,cAAC,GAAD,QAG3B4Y,EAAQxmB,KAAI,mCAAE+I,EAAF,KAAU8d,EAAV,YAA2BA,EAAc,GACrD,cAACC,GAAD,CAAuB/d,OAAQA,EAAQ8d,YAAaA,GAArC9d,SAKnB,SAAS+d,GAAT,GAA4C,IAAxB/d,EAAuB,EAAvBA,OAAQ8d,EAAe,EAAfA,YACrBtd,EAAOI,IAAU8R,QAAQ1S,GAEzB2c,EAAgBvP,KAAWoE,mBAgBjC,OAfa,OAAbmL,QAAa,IAAbA,OAAA,EAAAA,EAAend,MAAOQ,GAAU2d,KAAkBK,SAASrB,EAAc5Q,SAEzE3M,IAAW6R,gBACVvV,IAAYG,aACZ,qBAAG2E,KAAgBhB,KAAOQ,KAG3BlB,IAAMI,WAAU,WACX4e,GAAe,IAEF,OAAbnB,QAAa,IAAbA,OAAA,EAAAA,EAAend,MAAOQ,GAAWxH,SAASuS,YAC7ChR,YAAUkkB,GAAY,MAErB,CAACH,IAEGtd,EACN,sBACC8D,UAAU,kBAEVmC,QAAS,kBAAM8W,GAAiB,YAAD,OAAavd,KAH7C,UAKElB,IAAMrG,cACN+H,EAAK2S,gBACL,CAAEC,KAAM,KAGT,qBAAK9O,UAAU,mBAAf,SACC,qBAAKA,UAAU,eAAf,SACEwZ,EAAc,IAAd,UACKrnB,KAAKqB,MAAMgmB,EAAc,KAD9B,KAEEA,MAIL,cAAC9W,EAAA,EAAD,CAASiP,UAAU,QAAnB,SAA4BzV,EAAKf,gBAhB5BO,GAkBH,K,oBC1RU,SAASke,KAAuB,IAAD,EAC7C,EAA0Cpf,IAAMuE,SAAS,IAAzD,mBAAO+U,EAAP,KAAsB+F,EAAtB,KAWA,OATArf,IAAMI,WAAU,WACf,IAAMhB,EAAW,SAAC,GAAsB,IAApBkgB,EAAmB,EAAnBA,aACnBD,EAAiB,GAAD,mBAAK/F,GAAL,CAAoBgG,MAIrC,OADAhf,IAAWD,UAAUzD,IAAYyB,4BAA6Be,GACvD,kBAAMkB,IAAWd,YAAY5C,IAAYyB,4BAA6Be,MAC3E,CAACka,IAGH,qBAAK9T,UAAU,sBAAf,WACI8T,EAAchiB,QAChB,sBAAKkO,UAAU,mBAAf,UACC,qBAAKA,UAAU,WAAf,SACExF,IAAMrG,cAAN,UAAoB2f,EAAc,UAAlC,QAAwC,MAG1C,cAAC,KAAD,CACC9T,UAAU,qBACVmC,QAAS,kBAAM0X,EAAiB/F,EAAcphB,MAAM,YCJ1D,SAASqnB,GAAUpc,GAClB,OAAOA,EAAKqZ,WAAW,KAAOrZ,EAAvB,WAAkCA,GAGnC,SAASsb,GAAiBtb,GAChCA,EAAOoc,GAAUpc,GAEjBiD,OAAOoZ,QAAQC,UAAU,CAAEC,KAAMtZ,OAAO+K,SAASwO,KAAMC,SAAU9mB,KAAKD,OAAS,KAAMsK,GAErF7C,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYC,cAjBpBuJ,OAAO1K,iBAAiB,YAAY,WACnC4E,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYC,iBA6Bb,IACIuQ,GAAc,GAEzB,SAASyS,KAAe,IAAD,EAEtBvf,IAAW6R,gBAAgBvV,IAAYC,aAGvC,OAAwB,UAACuJ,OAAO+K,SAASwO,KACvC1nB,MAAM,QAAQ,UADQ,QACF,IACpBA,MAAM,KAAK,GACXA,MAAM,KAHR,iBAAO0nB,EAAP,KAAgBjO,EAAhB,WAUA,OAJUiO,EACVvS,GAAcsE,EAKR,QAFEiO,EAEY,cAAC,GAAD,IADH,cAAC1O,EAAD,IAKH,SAAS6O,KAqCvB,OApCAxf,IAAW6R,gBAAgBvV,IAAYC,aAEvCmD,IAAMI,WAAU,WAEf2f,YAAmBxe,IAASoB,KAAV,uCAAgB,WAAMpC,GAAN,iBAAAnF,EAAA,yDAC7BsG,EAAO,OADsB,OAG7BnB,QAH6B,IAG7BA,OAH6B,EAG7BA,EAAWyf,KAHkB,gCAInBle,IAAUX,UAAUZ,EAAUyf,KAJX,cAIhCte,EAJgC,OAO1Bue,EAAkBC,KAAiBC,yBAAjB,qBAAwDze,EAAKhB,KAPrD,SAQ1Buf,EAAgBG,gBAAgB,CAAEC,GAAG,GAAS,KARpB,OAWhCH,KAAiB3R,IAAjB,qBAAmC7M,EAAKhB,IAAM,CAAE2f,GAAG,IAXnB,OAcjC/f,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYE,kBAClB4E,SAhBgC,4CAAhB,wDAoBb2E,UAAUia,UAAUpZ,QAAQ,YAChC5G,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYyB,4BAClBihB,aAAc,kBACb,qCACC,wCADD,+CAC2D,qCAD3D,oHAMD,IAGF,sBAAK9Z,UAAU,MAAf,UACC,cAAC,GAAD,IAEA,qBAAKA,UAAU,OAAf,SACC,cAACqa,GAAD,MAGqD,SAArDzZ,OAAO+K,SAASwO,KAAK1nB,MAAM,KAAK,GAAGA,MAAM,KAAK,IAAiB,cAAC,EAAD,IAEhE,cAAC6N,EAAA,EAAD,IACA,cAACU,EAAA,EAAD,IACA,cAAC,IAAY+Z,QAAb,S,yHCvHkB1e,E,WAGpB,WAAYvB,EAAYkgB,GAAiB,IAAD,OAGvC,GAHuC,yBAFxCC,WAAa,IAAInhB,IAGhBD,KAAKqhB,YAAcpgB,EAEa,kBAApBkgB,EAA8B,CAAC,IAAD,WAC9BrhB,GACVmB,EAAWD,UAAUlB,GAAO,SAAAQ,GAAW,IAAD,GACD,KAApC,UAAA6gB,EAAerhB,UAAf,oBAAAqhB,EAAwB7gB,KAAqB,EAAKghB,iBAFpD,IAAK,IAAMxhB,KAASqhB,EAAiB,EAA1BrhB,GAOZE,KAAKuhB,gBAAkBJ,E,8CAMxB,WAAa,oBAEWnhB,KAAKohB,YAFhB,IAEZ,2BAAwC,EACvC7gB,EADuC,YAF5B,iC,yBAYb,SAAYA,GACX,OAAOP,KAAKohB,WAAWlhB,IAAIK,K,4BAQ5B,SAAeA,GACd,OAAOP,KAAKohB,WAAW/gB,OAAOE,K,oBAG/B,WAAgB,IAAD,OACd,OAAO,WAAkC,IAAjCihB,EAAgC,uDAAtB,SAAArnB,GAAC,OAAIA,GAAGuG,EAAc,uDAAP,GAChC,EAA0BC,IAAMuE,SAASsc,EAAQ,IAAjD,mBAAO1X,EAAP,KAAcU,EAAd,KAUA,OARA7J,IAAMI,WAAU,WACf,IAAM0gB,EAAe,kBAAMjX,EAASgX,EAAQ,KAI5C,OAFA,EAAK7O,YAAY8O,GAEV,WAAW,EAAK/O,eAAe+O,MALvC,CAMI3X,GANJ,mBAMcpJ,KAEPoJ,O,sICtDK,SAASjB,EAAT,GAA8G,IAAD,IAA1FxC,gBAA0F,MAA/E,KAA+E,MAAzEyR,iBAAyE,MAA7D,KAA6D,MAAvD3R,iBAAuD,MAA3C,GAA2C,EAAvC6C,EAAuC,EAAvCA,MAAuC,IAAhCxO,aAAgC,MAAxB,KAAwB,MAAlB8N,eAAkB,MAAR,KAAQ,EAC3H,EAA8B3H,IAAMuE,UAAS,GAA7C,mBAAOwc,EAAP,KACM1d,GADN,KACYrD,IAAMyL,UAUlB,OARAzL,IAAMI,WAAU,WAGf,OAFAiD,EAAIuI,QAAQoV,cAAcC,UAAU1hB,IAAI,cAEjC,WACN8D,EAAIuI,SAAWvI,EAAIuI,QAAQoV,cAAcC,UAAU/V,OAAO,iBAEzD,CAACxF,EAAUyR,IAGb,sBAAK9T,IAAKA,EAAKmC,UAAWtO,YAAe,mBAAoBigB,EAAU3F,cAAe,CAACuP,EAAS,WAAYvb,GAAY3L,MAAOA,EAAO8N,QAASA,EAA/I,UACC,qBAAKnC,UAAU,UAAU3L,MAAO,CAAEkP,gBAAiBV,GAAnD,SAA6D3C,IAC7D,qBAAKF,UAAU,eAAe3L,MAAO,CAAEkP,gBAAiBV,U,yLCPrDuO,E,4MACLvT,IAAMwJ,sB,EAENqU,WAAa,SAAApc,IACR,EAAKzB,IAAIuI,SAAY,EAAKvI,IAAIuI,QAAQuV,SAASrc,EAAE8C,SAAYlO,SAAS0nB,uBAAuB,eAAe,GAAGD,SAASrc,EAAE8C,SAC7H,EAAKyZ,S,2CAIP,WACKzK,EAAY0K,eACf1K,EAAY0K,cAAczX,SAAS,CAAE8M,KAAM,KAAMlG,MAAM,M,+BAIzD,WACC/W,SAASgC,iBAAiB,QAAS2D,KAAK6hB,c,kCAGzC,WACCxnB,SAAS8P,oBAAoB,QAASnK,KAAK6hB,c,oBAG5C,WACC,OACC,cAAC,IAAD,UACC,6CAAK1b,UAAU,eAAkBnG,KAAKoG,OAAtC,IAA6CpC,IAAKhE,KAAKgE,IAAvD,SACEhE,KAAKoG,MAAMC,kB,GA3BS1F,IAAM2F,WAkChCiR,EAAY2J,SAAZ,gKAGC,WACC,OACC,cAAC,IAAD,UACC,qBAAKld,IAAKuT,EAAY2J,QAAQld,IAAKmC,UAAU,sDANjD,GAAoCxF,IAAM2F,WAA1C,EACQtC,IAAMwJ,sBADd,GAcA+J,EAAYF,QAAZ,4MACCvN,MAAQ,CAAEwN,KAAM,KAAMlG,MAAM,GAD7B,EAECpN,IAAMwJ,sBAFP,EAQC0U,kBAAoB,SAAAzc,GAAM,IAAD,QAIxB,GAHkC,oBAAtBA,EAAE0c,gBACb1c,EAAE0c,iBAEC5K,EAAY0K,cAAe,CAC9B,GAAI,EAAKje,IAAIuI,QAAQuV,SAASvK,EAAY0K,cAAcje,IAAIuI,UAAYgL,EAAY0K,cAAc7b,MAAMkR,OAAS,EAAKlR,MAAMkR,KAC3H,OACDC,EAAY0K,cAAczX,SAAS,CAAE8M,KAAM,KAAMlG,MAAM,IAGxDmG,EAAY0K,cAAZ,eAKA,IAHA,IAAIG,GAAM,eAAKhc,MAAMkR,KAAKlR,OAAMic,iBAAtB,yBAAuC5c,EAAE6Q,QAC/CgM,GAAO,eAAKlc,MAAMkR,KAAKlR,OAAMmc,iBAAtB,yBAAuC9c,EAAE2Q,QAE7CkM,EAAO,IAAMvb,OAAOyb,YAC1BF,GAAQ,GAET,EAAK9X,SAAS,CACb8M,KAAMmL,IAASC,aACd,6CAAKvc,UAAU,oCAAuC,EAAKwc,aAA3D,IAAwEnoB,MAAO,CAC9EiU,SAAU,QACV2T,MAAKE,QAFN,SAGI,EAAKlc,MAAMkR,QAAaC,EAAY2J,QAAQld,IAAIuI,SAAU6E,MAAM,KA/BxE,+CAIC,WACC,OA5DF,SAAiBwR,GAAuB,IACvC,IAAMC,EAAS1mB,OAAO/B,OAAO,GAAIwoB,GADM,mBAAZE,EAAY,iCAAZA,EAAY,kBAGvC,cAAwBA,EAAxB,uBAA2CD,EAAvB,MACpB,OAAOA,EAwDCE,CAAQ/iB,KAAKoG,MAAO,OAAQ,cAAe,mBAAoB,YAAa,eALrF,uEAmCC,WAAyB4c,EAAWC,EAAWhf,GAA/C,qBAAAlI,EAAA,sDACKwb,EAAY0K,gBAAkBjiB,MAASA,KAAK8J,MAAMsH,OACrDmG,EAAY0K,cAAgB,MAEzBjiB,KAAK8J,MAAMsH,MAAQpR,KAAKgE,IAAIuI,UAAU,EAC1BlS,SAAS0nB,uBAAuB,wBADP,mBACjCzK,EADiC,KAElC4L,EAAO5L,EAAKc,wBAElBd,EAAK9c,MAAMmc,UAAYuM,EAAKC,EAAID,EAAKtS,OAAS7J,OAAOqc,YAA9B,qBACNrc,OAAOqc,aAAeF,EAAKC,EAAID,EAAKtS,QAAU,GADxC,OAEpB,MAVL,gDAnCD,+EAiDC,WAAU,IAAD,OACR,OAAO5Q,KAAKoG,MAAMkR,KACjB,cAAC,IAAD,UACC,8CAAKtT,IAAKhE,KAAKgE,IAAKmC,UAAW,uBAAyBnG,KAAKoG,MAAMoR,kBAAoB,IAAKlP,QAAStI,KAAKoG,MAAMid,YAAc,SAAA5d,GAC3F,oBAAtBA,EAAE8C,OAAOD,SAGrB,EAAK4Z,kBAAkB,EAAK9b,MAAMid,gBAC/B,MACCrjB,KAAK2iB,aANV,IAMuBW,cAAetjB,KAAKkiB,kBAN3C,UAOEliB,KAAKoG,MAAMC,SAEZ,cAAC,IAAD,UACErG,KAAK8J,MAAMsH,KAAOpR,KAAK8J,MAAMwN,KAAO,aAIrCtX,KAAKoG,MAAMC,aAlEjB,GAAoC1F,IAAM2F,WAsE1CiR,EAAYgM,KAAZ,4MACCC,YAAc,SAAA/d,GACbA,EAAE0c,iBACF1c,EAAEge,kBAEElM,EAAY0K,eAAiB,EAAK7b,MAAMsd,WAC3CnM,EAAY0K,cAAczX,SAAS,CAAE8M,KAAM,KAAMlG,MAAM,IAGpD,EAAKhL,MAAMkC,SACd,EAAKlC,MAAMkC,QAAX,iBAVH,4CAcC,WACC,IAAMlC,EAAQjK,OAAO/B,OAAO,GAAI4F,KAAKoG,OAKrC,cAHOA,EAAMsd,iBACNtd,EAAMsZ,KAGZ,8CAAKvZ,UAAU,mBAAsBC,GAArC,IAA4CkC,QAAStI,KAAKwjB,YAA1D,UACExjB,KAAKoG,MAAMsZ,KAEX1f,KAAKoG,MAAMC,iBAxBhB,GAAiC1F,IAAM2F,WA8BvCiR,EAAYoM,YAAZ,4MACC7Z,MAAQ,CAAEsH,MAAM,GADjB,EAGC/E,iBAAmB,WAClB,EAAK7B,SAAS,CAAE4G,MAAM,KAJxB,EAOC3E,iBAAmB,WAClB,EAAKjC,SAAS,CAAE4G,MAAM,KARxB,EAWCoS,YAAc,SAAA/d,GACTA,EAAE8C,SAAW9C,EAAE+C,gBAIf+O,EAAY0K,eAAiB,EAAK7b,MAAMsd,WAC3CnM,EAAY0K,cAAczX,SAAS,CAAE8M,KAAM,KAAMlG,MAAM,IAGpD,EAAKhL,MAAMkC,SACd,EAAKlC,MAAMkC,QAAX,kBArBH,2CAyBC,SAAMgP,GACL,GAAKA,EAAL,CACA,IAAM4L,EAAO5L,EAAKc,wBAElBd,EAAK9c,MAAMmc,UAAYuM,EAAKC,EAAID,EAAKtS,OAAS7J,OAAOqc,YAA9B,qBACNrc,OAAOqc,aAAeF,EAAKC,EAAID,EAAKtS,QAAU,GADxC,OAEpB,KAECsS,EAAKriB,EAAIqiB,EAAKvS,MAAQ5J,OAAOyb,aAChClL,EAAK9c,MAAM8nB,KAAO,QAClBhL,EAAK9c,MAAMopB,MAAQ,WAnCtB,oBAuCC,WACC,IAAMxd,EAAQjK,OAAO/B,OAAO,GAAI4F,KAAKoG,OAMrC,cAJOA,EAAMsd,iBACNtd,EAAM2T,aACN3T,EAAMsZ,KAGZ,8CAAKvZ,UAAU,8BAAiCC,GAAhD,IAAuDkC,QAAStI,KAAKwjB,YAAa3W,aAAc7M,KAAKqM,iBAAkBS,aAAc9M,KAAKyM,iBAA1I,UACEzM,KAAKoG,MAAMsZ,KACX1f,KAAKoG,MAAM2T,MAFb,IAEoB,cAAC,IAAD,CAAc5T,UAAU,0BAC1CnG,KAAK8J,MAAMsH,KACX,qBAAKjL,UAAU,oDAAoDnC,IAAKhE,KAAK6jB,MAA7E,SACC,qBAAK1d,UAAU,sBAAf,SACEnG,KAAKoG,MAAMC,aAGX,aAxDR,GAAwC1F,IAAM2F,WA8D9CiR,EAAYuM,WAAZ,4MACCha,MAAQ,CAAEia,SAAS,GADpB,EAGChkB,SAAW,WACNwX,EAAY0K,eAAiB,EAAK7b,MAAMsd,WAC3CnM,EAAY0K,cAAczX,SAAS,CAAE8M,KAAM,KAAMlG,MAAM,IAGxD,IAAM2S,GAAW,EAAKja,MAAMia,QAExB,EAAK3d,MAAMrG,UACd,EAAKqG,MAAMrG,SAASgkB,GAGrB,EAAKvZ,SAAS,CAAEuZ,aAdlB,uDAiBC,WACC/jB,KAAKwK,SAAS,CAAEuZ,QAAS/jB,KAAKoG,MAAM2d,YAlBtC,oBAqBC,WACC,IAAM3d,EAAQjK,OAAO/B,OAAO,GAAI4F,KAAKoG,OAKrC,cAHOA,EAAMsd,iBACNtd,EAAMrG,SAGZ,8CAAKoG,UAAU,8BAAiCC,GAAhD,IAAuDkC,QAAStI,KAAKD,SAArE,UACC,qBAAKoG,UAAW,aAAenG,KAAK8J,MAAMia,QAAU,WAAa,IAAjE,SACE/jB,KAAK8J,MAAMia,QAAW,qBAAK5d,UAAU,kBAAsB,OAE5DnG,KAAKoG,MAAMC,iBAhChB,GAAuC1F,IAAM2F,WAsC7CiR,EAAYyM,QAAZ,4JACC,WACC,OACC,iCAAK7d,UAAU,sBAAyBnG,KAAKoG,YAHhD,GAAoCzF,IAAM2F,WAQ3BiR,O,qPCnQR,SAASN,EAAYlX,EAAUkkB,GAA0C,IAAnCC,EAAkC,wDAAXxjB,EAAW,uDAAJ,GAE1EC,IAAMI,WAAU,WAEf,IAAMojB,EAAWC,YAAYrkB,EAAUkkB,GAKvC,OAHAC,GAAiBnkB,IAGV,kBAAMskB,cAAcF,MACzBzjB,GAiBG,SAAS4jB,IACf,IAAMxa,EAAQnJ,IAAMyL,QAAO,GAQ3B,OANAzL,IAAMI,WAAU,WAGf,OAFA+I,EAAMyC,SAAU,EAET,WAAYzC,EAAMyC,SAAU,KACjC,IAEIzC,EAqBD,SAASyU,EAAiBgG,EAAWxkB,GAAyB,IAAf3G,EAAc,uDAAJ,GAC/D,EAIIA,EAHHmP,cADD,MACUlO,SADV,IAIIjB,EAFHorB,oBAFD,MAEgB,GAFhB,IAIIprB,EADHqrB,YAHD,SAMA9jB,IAAMI,WAAU,WAIf,OAHAwH,EAAOlM,iBAAiBkoB,EAAWxkB,GACnC0kB,GAAQ1kB,IAED,kBAAMwI,EAAO4B,oBAAoBoa,EAAWxkB,MACjDykB,GAGG,SAASnG,EAAWte,GAC1BY,IAAMI,WAAU,WACfhB,MACE,IASG,SAASgW,EAAc7b,EAAM+a,GACnC,IAAMrG,EAAQjO,IAAMuL,SAAQ,kBAAMnF,OAAO2d,WAAP,WAAsBxqB,EAAtB,aAA+B+a,EAA/B,UAA2C,CAAC/a,EAAM+a,IACpF,EAA0BtU,IAAMuE,SAAS0J,EAAM+V,SAA/C,mBAAO7a,EAAP,KAAcU,EAAd,KASA,OAPA7J,IAAMI,WAAU,WACf,IAAMR,EAAW,SAAAkF,GAAC,OAAI+E,EAAS/E,EAAEkf,UAGjC,OADA/V,EAAMvS,iBAAiB,SAAUkE,GAC1B,kBAAMqO,EAAMzE,oBAAoB,SAAU5J,MAC/C,CAACrG,EAAM+a,IAEHnL,I,+JCjGF3I,EAAQ,GACRyjB,EAAa,GACbC,EAAY,GAEdC,GAA+B,EAE7BC,EAAsB,oNAC3B,4BAAAhpB,EAAA,yDAEUmF,EAAYuB,IAAUkM,eAFhC,gCAGQ,IAAI3U,SAAQ,SAAAC,GAAC,OAAIwQ,WAAWxQ,EAAG,QAHvC,6BAKCiI,IAASC,uBACRD,IAASE,IAAI,eAAgBlB,EAAUG,GAAI,KAAM,eACjD,SAAApF,GAGC,IAAK,IAAM0R,KAFX1R,EAAOiG,IAASsD,gBAAgBvJ,GAG/B,IAAK,IAAM2R,KAAW3R,EAAK0R,GAC1B1M,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYa,kBAClBuP,WAAUC,UACVhR,MAAOX,EAAK0R,GAAUC,GACtBoX,QAAQ,IAKXF,GAA+B,KArBlC,2CAD2B,0FA2B3B,SAAuBnX,GAAW,IAAD,OAC5BkX,EAAUlX,KAEdkX,EAAUlX,GAAYzL,IAASC,uBAC9BD,IAASE,IAAI,gBAAiBuL,IAC9B,SAAA1R,GACCA,EAAOiG,IAASsD,gBAAgBvJ,GAEhC,IAAMuiB,EAAgBvP,IAAWoE,mBAEjC,IAAK,IAAMzF,KAAW3R,EACL,MAAZ2R,IAEJ3M,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYY,qBAClBwP,WAAUC,UACVhR,MAAOX,EAAK2R,IAAY,KAGR,OAAb4Q,QAAa,IAAbA,OAAA,EAAAA,EAAend,MAAOuM,GAAWvT,SAASuS,YAC7C,EAAKiT,SAASlS,EAAUC,IAI1B3M,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYY,qBAClBwP,WACAC,QAAS,UACThR,MAAOX,EAAKsR,GAAK,KAGD,OAAbiR,QAAa,IAAbA,OAAA,EAAAA,EAAe5Q,WAAYD,GAAYtT,SAASuS,YACnD,EAAKiT,SAASlS,SA3DS,6BAiE3B,SAAgBA,GAA2B,IAAjBC,EAAgB,uDAAN,KAGnC,OAFKiX,EAAUlX,IAAW3N,KAAKilB,uBAAuBtX,GAE/CxT,IAAE2T,IAAI3M,EAAO,CAACwM,EAAD,OAAWC,QAAX,IAAWA,IAAW,aAAe,IApE/B,mCAuE3B,SAAsBD,GAA2B,IAAjBC,EAAgB,uDAAN,KACpCiX,EAAUlX,IAAW3N,KAAKilB,uBAAuBtX,GAEtD,IAAIuX,EAAQ,EACR1P,EAAO,EAEX,GAAe,MAAX5H,IAAqBD,EAAS/U,MAAM,KAAKiP,QAAQpF,IAAUkM,eAAetN,IAS7E6jB,EAAQllB,KAAKmlB,gBAAgBxX,EAAUC,GACvC4H,EAAOrb,IAAE2T,IAAI8W,EAAY,CAACjX,EAAD,OAAWC,QAAX,IAAWA,IAAW,iBAT/C,IAAK,IAAMA,KAAX,UAAsBzM,EAAMwM,UAA5B,QAAyC,GAAI,CAAC,IAAD,EAC5B,YAAZC,IAEJsX,GAASllB,KAAKmlB,gBAAgBxX,EAAUC,GACxC4H,GAAQrb,IAAE2T,IAAI8W,EAAY,CAACjX,EAAUC,GAAU,IAQjD,QAAM4H,GAAQ0P,EAAQ1P,IAAS0P,IAAU1P,GACxCrb,IAAE+U,IAAI0V,EAAY,CAACjX,EAAUC,GAAUsX,GAEhCA,GAGDA,EAAQ1P,GAAQ,EAAI,EAAI0P,EAAQ1P,IAhGb,sBAmG3B,SAAS7H,GAAyC,IAA/BC,EAA8B,uDAApB,KAAMhR,EAAc,uDAAN,KAC1CqE,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYa,kBAClBuP,WACAC,QAAO,OAAEA,QAAF,IAAEA,IAAW,UACpBhR,MAAK,OAAEA,QAAF,IAAEA,IAASoD,KAAKmlB,gBAAgBxX,EAAUC,OAxGtB,uBA4G3B,SAAUD,EAAUC,GAAqB,IAAZhR,EAAW,uDAAH,EAC9B2P,EAAUpS,IAAE2T,IAAI3M,EAAO,CAACwM,EAAUC,IAClCwX,EAAejrB,IAAE2T,IAAI3M,EAAO,CAACwM,EAAU,YAE7C,KAAK,CAACpB,EAAS6Y,GAAcvd,aAAQ1C,GAArC,CAIAhL,IAAE+U,IAAI/N,EAAO,CAACwM,EAAUC,GAAUrB,EAAU3P,GAC5CzC,IAAE+U,IAAI/N,EAAO,CAACwM,EAAU,WAAYpB,EAAU3P,GAE9C,IAAM4hB,EAAgBvP,IAAWoE,mBAC7BmL,GAAiBA,EAAc7Q,WAAaA,GAAY6Q,EAAcnd,KAAOuM,GAChF5N,KAAK6f,SAASlS,EAAUC,QAzHC,GAAmCpL,KA8HzD6iB,EAAiBlrB,IAAE0Y,UAAS,WAC5BiS,GAEL5iB,IAASgN,IACRhN,IAASE,IAAI,eAAgBK,IAAUkM,eAAetN,GAAI,KAAM,cAChEujB,KAEC,KAEGpF,EAAoB,IAAIuF,EAAuB9jB,KAA3B,mBACxB1D,IAAYY,sBAAuB,YAAmC,IAAhCwP,EAA+B,EAA/BA,SAAUC,EAAqB,EAArBA,QAAShR,EAAY,EAAZA,MACzDzC,IAAE+U,IAAI/N,EAAO,CAACwM,EAAUC,GAAUhR,MAFV,cAIxBW,IAAYa,mBAAoB,YAA2C,IAAxCuP,EAAuC,EAAvCA,SAAUC,EAA6B,EAA7BA,QAAShR,EAAoB,EAApBA,MAAOooB,EAAa,EAAbA,OAC7D7qB,IAAE+U,IAAI0V,EAAY,CAACjX,EAAUC,GAAUhR,IAEtCooB,GAAUK,OAPa,IAW1B7F,EAAkB8F,0BAEH9F,O,+FC/JA,SAAStU,EAAc9E,GACrC,OACC,8CAAKD,UAAU,0BAA6BC,GAA5C,cACC,qBAAKD,UAAU,UACf,qBAAKA,UAAU,UACf,qBAAKA,UAAU,gB,uKCCZhF,EAAQ,GAERokB,EAAgB,+JACrB,SAAU5X,GAAW,IAAD,EACnB,iBAAOxM,EAAMwM,UAAb,SACC3N,KAAKme,YAAYxQ,GACjB,IAAIsR,IAAO,CACV5d,GAAIsM,EACJ5L,SAAS,EACTyW,KAAM,WAPY,wBAYrB,WACC,OAAOrX,IAba,gEAgBrB,WAAkBwM,GAAlB,2BAAA5R,EAAA,6DAA4BiG,EAA5B,kDACQ,IAAIhI,SAAQ,SAAAC,GAClB,IAAMgI,EAASC,IAASC,uBACvBD,IAASE,IAAI,UAAWuL,IACxB,SAAAvL,GAAQ,IAAD,EACA+L,EAAS/L,EACZjI,IAAEmI,OAAF,UAASnB,EAAMwM,UAAf,QAA4B,IAAIsR,IAAU7c,GAC1C,IAAI6c,IAAO,CACZ5d,GAAIsM,EACJ6K,KAAM,mBAGRjF,IAAYiS,qBAAqB7X,GAEjC1M,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYI,cAClBwQ,WAGDnM,GAAWC,IAEXhI,EAAEkU,UArBN,2CAhBqB,kFA2CrB,SAAcR,GAAW,IAAD,EACjBQ,EAAShN,EAAMwM,GACrB,GAAKQ,EAAL,CAEAA,EAAOnJ,kBAEP,IAAMygB,EAAQ,UAAG7P,IAAa8P,kBAAkB/X,UAAlC,QAA+C,GAE7D,IAAK,IAAMC,KAAW6X,EACrB7P,IAAa+P,QAAQhY,EAAUC,UAGzBzM,EAAMwM,QAvDO,GAA6BnL,KA2D7C4L,EAAc,IAAImX,EAAiBtkB,KAArB,mBAClB1D,IAAYI,eAAgB,YAAiB,IAAdwQ,EAAa,EAAbA,OAC/BhN,EAAMgN,EAAO9M,IAAM8M,KAFD,cAIlB5Q,IAAYM,sBAAuB,YAAyB,IAAtBsQ,EAAqB,EAArBA,OAAQO,EAAa,EAAbA,OAC9CvN,EAAMgN,EAAO9M,IAAIwX,QAAUnK,KALT,IASLN,O,4LCzEFwX,EACI,iBADJA,EAEA,aAFAA,EAGH,UAHGA,EAIA,aAJAA,EAMD,YANCA,EAOF,WAPEA,EAQiB,mBARjBA,EASM,mBATNA,EAUS,sBAGhBlR,EAAc,qDACnBC,YAAc,KADK,qFAGnB,mCAAA5Y,EAAA,0DACKiE,KAAK6lB,YADV,iDAEC7lB,KAAK6lB,aAAc,EAEH,gBACK9e,OAAO+K,SAASgU,SACxB,QAEPC,EAAY,kBAAM,IAAIC,UAAJ,eAJR,gBAIQ,YAFX,WAGbhmB,KAAKimB,OAASF,IAEd/lB,KAAKimB,OAAOC,QAAU,SAAA1pB,GAAG,OAAIC,QAAQC,MAAM,WAAYF,IAEvDC,QAAQsc,IAAI,SAAU/Y,KAAKimB,QAE3BjmB,KAAKimB,OAAO5pB,iBAAiB,WAAW,YAAe,IAAZJ,EAAW,EAAXA,KACpC6D,EAAQqmB,KAAKC,MAAMnqB,GAOzB,GALAQ,QAAQsc,IACP,mBACAjZ,GAGOA,EAAM5F,OACR0rB,EACJ3kB,IAAWsB,SAAX,2BACIzC,GADJ,IAEC5F,KAAMqD,IAAYS,2BAUtBiD,IAAWD,UAAUzD,IAAYK,eAAjC,uCAAiD,+BAAA7B,EAAA,sDAASqiB,EAAT,EAASA,QACnDiI,EAAYjI,EAAQtlB,KAAI,SAAAwtB,GAAC,OAAIA,EAAEjlB,MADW,UAGzC,EAAK4kB,OAAOM,aAAeP,UAAUQ,KAHI,gCAIzC,IAAIxsB,SAAQ,SAAAC,GAAC,OAAIwsB,EAAaxsB,MAJW,6BAMhD,EAAKgsB,OAAOS,KACXP,KAAKQ,UAAU,CACdzsB,KAAM0rB,EACN/jB,OAAQY,IAAUkM,eAAetN,GACjCglB,eAV8C,2CAAjD,uDArCD,iDAHmB,0DAAG,IAyDjBO,EAAa,CAClBC,WAAY,CAAC,CACZC,KAAM,CAAC,8BAERC,qBAAsB,IAGVC,EAAb,WAGC,WAAYrZ,EAAUC,GAAU,yBAFhCqZ,YAAc,GAGb,IAAMpZ,EAAQoB,IAAWjB,SAASL,EAAUC,GAE5C,IAAKC,EAGJ,OAFApR,QAAQC,MAAM,8BAA+B,CAAEiR,WAAUC,YAElD,KAGR5N,KAAK6N,MAAQA,EAGb7N,KAAKknB,cAAgBlnB,KAAKknB,cAAc9mB,KAAKJ,MAf/C,8CAkBC,SAAWF,GACVrD,QAAQsc,IAAI,wBAAyBjZ,GACrC4U,EAAYuR,OAAOS,KAAKP,KAAKQ,UAAU7mB,MApBzC,4DAuBC,sBAAA/D,EAAA,0DACK2Y,EAAYC,YADjB,gCAEQD,EAAYC,YAAYwS,aAFhC,OAIC1qB,QAAQsc,IAAI,kBAEZrE,EAAYuR,OAAO5pB,iBAAiB,UAAW2D,KAAKknB,eAEpDlnB,KAAKonB,2BAA2B7qB,MAC/BE,QAAQC,MAAM0D,KAAK,0CAGpBa,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYU,oBAClByR,KAAM1P,OAGP0U,EAAYC,YAAc3U,KAjB3B,gDAvBD,wFA2CC,WACC,OAAO7F,IAAEmI,OACR,IAAI+kB,kBAAkBT,GACtB,CACCU,eAAgBtnB,KAAKunB,mBAAmBnnB,KAAKJ,MAC7CwnB,oBAAqBxnB,KAAKynB,kBAAkBrnB,KAAKJ,UAhDrD,uEAqDC,+BAAAjE,EAAA,uDACC,QAD0B2rB,EAA3B,EAA2BA,iBAC1B,IAAIA,GAAJ,UAAIA,EAAWA,iBAAf,aAAI,EAAsBzvB,SACzB+H,KAAK2nB,WAAW,CACfztB,KAAM0rB,EACNgC,IAAKF,IAJR,gDArDD,6HA8DC,WAAwBG,EAAM3tB,GAA9B,eAAA6B,EAAA,6DACCU,QAAQsc,IAAI,4CADb,SAGqB/Y,KAAK8nB,GAAGC,cAH7B,cAGOC,EAHP,gBAIOhoB,KAAK8nB,GAAGG,oBAAoBD,GAJnC,OAMCvrB,QAAQsc,IAAI,qBAEZ/Y,KAAK2nB,WAAW,CACfztB,KAAM0rB,EACNoC,QACAra,SAAU3N,KAAK6N,MAAMF,SACrBC,QAAS5N,KAAK6N,MAAMxM,KAZtB,gDA9DD,sIA8EC,kCAAAtF,EAAA,sEACsBiL,UAAUkhB,aAAaC,aAAa,CACxD/N,OAAO,EACPle,OAAO,IAHT,OACOksB,EADP,OAMCpoB,KAAKqoB,YAAYD,EAAQ3lB,IAAUkM,eAAetN,IAClDrB,KAAKsoB,YAAcF,EAEnBpoB,KAAK8nB,GAAK9nB,KAAKuoB,uBACfvoB,KAAK8nB,GAAGU,eAAe,QAAS,CAAE1Q,UAAW,aAC7C9X,KAAK8nB,GAAGU,eAAe,QAAS,CAAE1Q,UAAW,aAE7C9X,KAAK8nB,GAAGW,oBAAsB,SAAAhjB,GAC7BhJ,QAAQC,MAAM,4BAA6B+I,IAd7C,cAiBqB2iB,EAAOM,aAjB5B,IAiBC,2BAAWC,EAA6B,QACvC3oB,KAAK8nB,GAAGc,SAASD,EAAOP,GACxB3rB,QAAQsc,IAAI,yBAA0B4P,GAnBxC,+EA9ED,+EAqGC,SAAYP,EAAQvmB,GAAS,IAAD,EAI3B,GAHApF,QAAQsc,IAAI,eAAgBlX,GAGxBA,IAAWY,IAAUkM,eAAetN,GAAxC,CAEA,IAAMA,EAAE,iBAAaQ,GAEf3F,EAAQ/B,IAAEC,OAAF,UACbC,SAAS8Q,eAAe9J,UADX,QACkBhH,SAASC,cAAc,SACtD,CACC+G,KACA7G,MAAO,eACPsB,OAAQ,KAIVW,QAAQsc,IAAI,CAAE7c,QAAOksB,SAAQvmB,WAE7BxH,SAASM,KAAKE,YAAYqB,GAG1BA,EAAM2sB,UAAYT,EAClBlsB,EAAM4sB,UAAW,KA5HnB,+DA+HC,sBAAA/sB,EAAA,sDACCU,QAAQsc,IAAI,qBAEZrE,EAAYuR,OAAO9b,oBAAoB,UAAWnK,KAAKknB,eAEvDlnB,KAAK2nB,WAAW,CAAEztB,KAAM0rB,IAExB3kB,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYU,oBAClByR,KAAM,OAGPgF,EAAYC,YAAc,KAZ3B,gDA/HD,0HA8IC,WAAsB9S,GAAtB,0BAAA9F,EAAA,6DACCU,QAAQsc,IAAI,oBAAqBlX,GAC3BimB,EAAK,IAAIT,kBAAkBT,GAEjCzsB,IAAEmI,OAAOtC,KAAKinB,YAAd,eACEplB,EAAS,CACTimB,QAIIiB,EAAqB,CAC1BjR,UAAW,YAGZgQ,EAAGU,eAAe,QAASO,GAC3BjB,EAAGU,eAAe,QAASO,GAf5B,SAiBqBjB,EAAGC,cAjBxB,cAiBOC,EAjBP,iBAkBOF,EAAGG,oBAAoBD,GAlB9B,QAoBCF,EAAGR,eAAiB,YAAoB,IAAD,EAAhBI,EAAgB,EAAhBA,WACtB,OAAIA,QAAJ,IAAIA,GAAJ,UAAIA,EAAWA,iBAAf,aAAI,EAAsBzvB,SACzB,EAAK0vB,WAAW,CACfztB,KAAM0rB,EACNgC,IAAKF,EACL7lB,YAKHimB,EAAGW,oBAAsB,SAAAhjB,GACxBhJ,QAAQC,MAAM,+BAAgC+I,IAG/CqiB,EAAGkB,QAAU,SAAAvjB,GAAC,OAAI,EAAK4iB,YAAY5iB,EAAEwjB,QAAQ,GAAIpnB,IAEjD7B,KAAK2nB,WAAW,CACfztB,KAAM0rB,EACN/jB,SACAmmB,UAvCF,iDA9ID,kFAyLC,YAAyB,IAAT/rB,EAAQ,EAARA,KACT6D,EAAQqmB,KAAKC,MAAMnqB,GAEzB,OAAQ6D,EAAM5F,MACb,KAAK0rB,EACJ,IAAMsD,EAAM,IAAIC,sBAAsBrpB,EAAMspB,QAC5CppB,KAAK8nB,GAAGuB,qBAAqBH,GAAK3sB,MAAME,QAAQC,OAC/C,MAEF,KAAKkpB,EAEJ,IAAK,IAAM/jB,KAAU7B,KAAKinB,YACzB,KAAMnnB,EAAMwpB,MAAMzhB,QAAQhG,KACzB7B,KAAKinB,YAAYplB,GAAQimB,GAAG9F,eAErBhiB,KAAKinB,YAAYplB,GAGpBA,IAAWY,IAAUkM,eAAetN,IACvC,IAAK,IAAMQ,KAAU7B,KAAKinB,YACzBjnB,KAAKinB,YAAYplB,GAAQimB,GAAG9F,eAErBhiB,KAAKinB,YAAYplB,GAbI,oBAoBX/B,EAAMwpB,OApBK,IAoBhC,2BAAkC,CAAC,IAAxBznB,EAAuB,QAC7BA,IAAWY,IAAUkM,eAAetN,KAClCrB,KAAKinB,YAAYplB,IACrB7B,KAAKupB,gBAAgB1nB,GAAQtF,MAC5BE,QAAQC,MAAM0D,KACb,KACA,kCA1B2B,8BAiChC3D,QAAQsc,IAAI/Y,KAAKinB,aAChB,MAEF,KAAKrB,EACJ,IAAMsD,EAAM,IAAIC,sBAAsBrpB,EAAMspB,QACpCtB,EAAO3tB,IAAE2T,IAAI9N,KAAKinB,YAAa,CAACnnB,EAAM+B,QAAS,IAA/CimB,GAERrrB,QAAQsc,IAAI,2BAA4B+O,EAAIhoB,EAAM+B,QAEhD,OAAFimB,QAAE,IAAFA,KAAIuB,qBAAqBH,GACvB3sB,MAAME,QAAQC,MAAM0D,KAAK,KAAM,qCA7OrC,KAmPesU,Q,iZCtTA,SAAS8U,EAAT,GAAuC,IAAD,EAAV3nB,EAAU,EAAVA,OACpCQ,EAAOI,IAAUyC,UAAS,kBAAMzC,IAAU8R,QAAQ1S,MAClDX,EAAYuB,IAAUkM,eAEtB8a,EAAQ9oB,IAAMyL,SACdsd,EAAY/oB,IAAMyL,SAExB,EAAgCzL,IAAMuE,UAAS,GAA/C,mBAAOykB,EAAP,KAAiBC,EAAjB,KACA,EAAqCjpB,IAAMuE,UAAS,GAApD,mBAAO2kB,EAAP,KAAuBC,EAAvB,KARoD,SAerCC,IAfqC,2EAepD,8CAAAhuB,EAAA,6DAAuCiuB,EAAvC,yCACsBjwB,YAAe,CAAEG,KAAM,YAD7C,sCACQ8L,EADR,2DAIKA,EAAKiP,KAAOtY,YAAI,KAJrB,0CAKSwK,IAAOC,UACb,6CACA,YAPH,QAUClF,IAAS+nB,cAAcjkB,EAAMgkB,EAAO,gBAAkB,YAAa9oB,EAAUG,IAC3ElG,MAAK,SAAAlB,GAAC,OACNiH,EAAU8oB,EAAO,wBAA0B,qBAAuB/vB,EAAEe,IACpEmM,IAAOC,UAAU,kEAAmE,UAAW,OAE/F7K,OAAM,SAAAC,GAAG,OAAKC,QAAQC,MAAMF,GAAM2K,IAAOC,UAAU,qDAAsD,cAf5G,4CAfoD,wBAiCpD,OAvBAnG,IAAW6R,gBACVvV,IAAYG,aACZ,qBAAG2E,KAAgBhB,KAAOQ,KAsB1B,sBAAKsE,UAAU,wCAAf,UACC,sBAAKA,UAAU,wBAAf,UACE9D,EAAK6nB,mBAAqB,cAAChf,EAAA,EAAD,IAE3B,qBACClH,IAAKylB,EACLtjB,UAAU,QACVtK,IAAKwG,EAAK6nB,kBACVvhB,OAAQ,SAAAlD,GAAC,OAAIA,EAAE8C,OAAO/N,MAAM8hB,QAAU,KAGtCja,EAAKX,uBAAyBN,EAAK+oB,gBACnC,qBACCnmB,IAAK0lB,EACLvjB,UAAU,QACVtK,IAAKwG,EAAKX,2BAKb,sBAAKyE,UAAU,mBAAf,UACC,cAAC9D,EAAK2S,gBAAN,CAAsBC,KAAM,MAE5B,oBAAI9O,UAAU,WAAd,SAA0B9D,EAAKf,cAE9BqoB,EAEC,cAAClW,EAAA,EAAD,CAAcxI,aAAc5I,EAAKV,KAAMN,GAAG,WAA1C,sEAKAgB,EAAKV,MACJ,qBAAKwE,UAAU,OAAf,SACEikB,IAAiBhE,MAAM/jB,EAAKV,QAKjC,qBAAKwE,UAAU,cAAf,mBACE9D,EAAKgoB,aADP,aACE,EAAYvxB,KAAI,SAACuxB,EAAOviB,GAAR,OAChB,sBAAK3B,UAAU,aAAf,UACC,oBAAIA,UAAU,QAAd,SAAuBkkB,EAAM/iB,QAC7B,qBAAKnB,UAAU,OAAf,SAAuBkkB,EAAM5M,UAFG3V,QAOlC6hB,GACA,eAAC,IAAM9X,SAAP,WACC,oBACC1L,UAAU,SACVmC,QAAS,kBAAMyhB,KAFhB,mCAKA,oBACC5jB,UAAU,SACVmC,QAAS,kBAAMyhB,GAAwB,IAFxC,qCAOD1nB,EAAKX,uBAAyBN,EAAK+oB,gBACnC,qBACChkB,UAAU,oBACVmC,QAAS,kBACRwhB,GAAYD,GACZH,EAAUnd,QAAQ/R,MAAM8hB,QAAUuN,EAAiB,EAAI,GAJzD,UAOEA,EAAiB,OAAS,OAP5B,yBAYF,qBAAK1jB,UAAU,oBAAf,SACC,gCACC,oBAAIA,UAAU,SAAd,iBACA,qBAAKA,UAAWtO,YAAe,mBAAoB,CAAC8xB,EAAU,aAA9D,SACEA,EAEC,cAAClW,EAAA,EAAD,CAAcxI,aAAc5I,EAAKioB,IAAKjpB,GAAG,UAAzC,oDAKAgB,EAAKioB,IACFF,IAAiBhE,MAAM/jB,EAAKioB,KAE7B,qBAAKnkB,UAAU,cAAf,0CASP,sBAAKA,UAAU,UAAf,UACE9D,IAASnB,IACTyoB,EAEE,cAAC,IAAD,CACCxjB,UAAU,SACVmC,QAAS,kBACRshB,GAAY,GACZztB,OAAO/B,OACN8G,EACA,CACCS,KAAMtH,SAAS8Q,eAAe,YAAYvO,MAC1C0tB,IAAKjwB,SAAS8Q,eAAe,WAAWvO,QAG1CsF,IAAS8b,OACR9c,EAAUgD,KACV/J,IAAEsb,KACDvU,EACA,CACC,cACA,OACA,MACA,YACA,kBACA,yBAGD/F,MAAK,kBACNgM,IAAOC,UACN,sCAOJ,cAAC,IAAD,CACCjB,UAAU,SACVmC,QAAS,kBAAMshB,GAAY,OAK/B,cAAC,IAAD,CACCzjB,UAAU,SACVmC,QAAS,kBAAM7B,IAAOG,e,YCnLNxF,E,WAKpB,WAAYiB,GAAO,IAAD,gCAJlBhB,GAAK,GAIa,KAHlBC,YAAc,GAGI,KAFlBE,UAAY,GAEM,KAIlBwT,gBAAkB,SAAA5O,GAAK,OACtB,cAACmkB,EAAD,aAAqBloB,KAAM,GAAU+D,KALpB,KAOlBqR,WAAa,SAAArR,GAAK,OACjB,cAACokB,EAAD,aAAgBnoB,KAAM,GAAU+D,KARf,KAUlBqkB,QAAU,kBACT,cAACC,EAAD,CAAaroB,KAAM,KAXF,KAalBkV,YAAc,kBACb,cAACoT,EAAD,CAAiBtoB,KAAM,KAbvBlI,IAAEmI,OAAOtC,KAAMqC,G,4FAgBhB,+GACsBtI,YAAe,CAAEG,KAAM,YAD7C,sCACQ8L,EADR,2DAIKA,EAAKiP,KAAOtY,YAAI,IAJrB,yCAKSwK,IAAOC,UACb,yCACA,YAPH,OAUClF,IAAS+nB,cAAcjkB,EAAM,SAAUvD,IAAUkM,eAAetN,IAC9DlG,MAAK,SAAAlB,GAAC,OAAK,EAAKuH,UAAYvH,EAAEe,IAAKmM,IAAOC,UAAU,qBACpD7K,OAAM,SAAAC,GAAG,OAAKC,QAAQC,MAAMF,GAAM2K,IAAOC,UAAU,2CAA4C,cAZlG,4C,gFAeA,WAA6B,IAAD,EAC3B,iBAAO3E,IAAUkM,sBAAjB,aAAO,EAA0Bic,iB,KAI5B,SAASL,EAAT,GAAmE,IAApCloB,EAAmC,EAAnCA,KAAmC,IAA7B4S,YAA6B,MAAtB,GAAsB,MAAlB9O,iBAAkB,MAAN,GAAM,EAClE3E,EAAYiB,IAAUyC,UAAS,kBAAM7C,EAAKb,aAC1CF,EAAcmB,IAAUyC,UAAS,kBAAM7C,EAAKf,eAElD,EAA4BX,IAAMuE,UAAS,GAA3C,mBAAO2lB,EAAP,KAAe1iB,EAAf,KAEA,OACC,qBACChC,UAAWtO,YAAe,yCAA0CsO,GACpE3L,MAAO,CAAEmW,MAAOsE,EAAMrE,OAAQqE,GAF/B,SAIE4V,EAEC,cAAC,IAAD,CACC1kB,UAAU,gBACV3L,MAAO,CAAEmW,MAAOsE,EAAO,IAAKrE,OAAQqE,EAAO,OAI5C,qBACC9O,UAAU,SACVtK,IAAK2F,EACLkH,IAAKpH,EACLqP,MAAOsE,EAAMrE,OAAQqE,EAErBrM,QAAS,kBAAMT,GAAU,QAOxB,SAASqiB,EAAT,GAA+D,IAArCnoB,EAAoC,EAApCA,KAAoC,IAA9ByoB,wBAA8B,MAAX,QAAW,EAC9DvpB,EAASkB,IAAUyC,UAAS,kBAAM7C,EAAKd,UACvCwpB,EAAa1oB,EAAK0oB,WAAa,IAAItxB,KAAK4I,EAAK0oB,YAAc,KAEjE,OAAQxpB,GACP,QACA,KAAKjC,IAAWC,QACf,OACC,sBAAK4G,UAAU,uBAAf,UACC,qBAAKA,UAAU,mBACf,0CAEC4kB,GAAmC,SAArBD,GACd,eAACjiB,EAAA,EAAD,CAASiP,UAAWgT,EAApB,yBACc5xB,YAAiB6xB,GAD/B,OACgDA,EAAWztB,mBAAmB,eAOlF,KAAKgC,IAAWE,OACf,OACC,sBAAK2G,UAAU,uBAAf,UACC,qBAAKA,UAAU,kBACf,4CAKH,KAAK7G,IAAWG,KACf,OACC,sBAAK0G,UAAU,uBAAf,UACC,qBAAKA,UAAU,gBACf,0CAKH,KAAK7G,IAAWI,KACf,OACC,sBAAKyG,UAAU,uBAAf,UACC,qBAAKA,UAAU,gBACf,0CAKH,KAAK7G,IAAWK,IACf,OACC,sBAAKwG,UAAU,uBAAf,UACC,qBAAKA,UAAU,eACf,0CAOE,SAASukB,EAAT,GAAsD,IAA/BroB,EAA8B,EAA9BA,KAA8B,IAAxBmS,oBAAwB,SAU3D,OATAvT,IAAW6R,gBACVvV,IAAYG,aACZ,SAAA+H,GAAC,OAAIA,EAAEpD,KAAKhB,KAAOgB,EAAKhB,MAKzBgB,EAAOI,IAAU8R,QAAQlS,EAAKhB,IAG7B,eAAC,IAAYgW,QAAb,CACCC,KAAM,cAACjV,EAAKkV,YAAN,IACNC,iBAAiB,cAFlB,UAIC,cAAC+S,EAAD,CAAqBloB,KAAMA,EAAM4S,KAAM,KACvC,qBAAK9O,UAAU,WAAf,SACEqO,GAAgBnS,EAAKhB,KAAOoB,IAAUkM,eAAetN,GACnD,MACAgB,EAAKf,iBAMZ,SAASqpB,EAAT,GAAoC,IAATtoB,EAAQ,EAARA,KAC1B,OACC,eAAC,IAAD,WACC,cAAC,IAAYkhB,KAAb,CACC7D,KAAM,cAAC,IAAD,IACNpX,QAAS,kBAAM7B,IAAOC,KAAK,cAAC,EAAD,CAAkB7E,OAAQQ,EAAKhB,OAC1DqiB,WAAS,EAHV,qBAMA,cAAC,IAAYH,KAAb,CACC7D,KAAM,cAAC,IAAD,IACNpX,QAAS,kBAAM8W,YAAiB,WAAD,OAAY/c,EAAKhB,MAChDqiB,WAAS,EAHV,qBAMCrhB,EAAKb,WACL,eAAC,IAAYmiB,YAAb,CACC5J,MAAM,SACN2F,KAAM,cAAC,IAAD,IAFP,UAIC,cAAC,IAAY6D,KAAb,CACC7D,KAAM,cAAC,IAAD,IACNpX,QAAS,kBAAMY,YAAe7G,EAAKb,YACnCkiB,WAAS,EAHV,kBAMA,cAAC,IAAYH,KAAb,CACC7D,KAAM,cAAC,IAAD,IACNpX,QAAS,kBAAMzB,YAAgBxE,EAAKb,YACpCkiB,WAAS,EAHV,8B,sJC9LCviB,EAAQ,GACR6pB,EAAe,GAEfC,EAAgB,4MAsFrBC,eAAiB/wB,IAAE0Y,SAAS,EAAKW,WAAWpT,KAAhB,gBAA4B,KAtFnC,iDACrB,SAAYuN,GAA2B,IAAjBC,EAAgB,uDAAN,KAC/B,MAAoB,QAAbD,EAAA,+BACoBmB,IAAQ8P,MAAMhR,IACtCA,EAAO,2BACcD,EADd,YAC0BC,GAD1B,2BAEcD,KANJ,qCASrB,SAAwBA,GACvB,GAAiB,QAAbA,EACH,MAAM,IAAIwd,MAAM,kDAGjB,OAAOhxB,IAAE2T,IAAI3M,EAAO,CAACwM,MAdD,oCAiBrB,SAAuBA,EAAUC,GAChC,OAAOzT,IAAE2T,IAAI3M,EAAO,CAACwM,EAAUC,GAAU,MAlBrB,+BAqBrB,WACC,OAAOzM,IAtBa,kCAyBrB,SAAqBwM,GAA0B,IAAhB9L,EAAe,uDAAN,KACvC,IAAImpB,EAAY,OAACnpB,QAAD,IAACA,IAAU8L,KAAcA,GAAa9L,GAAtD,CAIA,IAAMupB,EAAgBprB,KAAKqrB,YAAY1d,EAAU9L,GAE3CypB,EAAqBzK,IAAiBC,yBAAjB,UACvBsK,EADuB,YACN3oB,IAAUkM,eAAetN,KAG9CiqB,EAAmBzf,SAEnB,IAAM5J,EAAS4e,IAAiB0K,eAC/BH,GACA,SAAAnnB,GACC,IAAMhI,EAAOgI,EAASunB,MAEtBvqB,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYwB,yBAClB0sB,WAAYxvB,EACZ0R,WAAU9L,cAKbmpB,EAAY,OAACnpB,QAAD,IAACA,IAAU8L,GAAY,WAClC1L,IACAqpB,EAAmBI,gBAEZV,EAAY,OAACnpB,QAAD,IAACA,IAAU8L,OAvDX,yBA2DrB,WACC,IAAME,EAAQoB,IAAWoE,mBACzB,GAAKxF,EAAL,CAEA,IAAM/J,EAAI,UAAM9D,KAAKqrB,YAAYxd,EAAMF,SAAUE,EAAMxM,IAA7C,YAAoDoB,IAAUkM,eAAetN,IAElFlH,IAAE2T,IAAI9N,KAAKsU,uBAAuBzG,EAAMF,SAAUE,EAAMxM,IAAK,CAACoB,IAAUkM,eAAetN,MAC3Fwf,IAAiB3R,IAAIpL,EAAM,CAAEyJ,GAAG,IAAQhR,MAAME,QAAQC,MAAM0D,KAAK,KAAM,gCAGxEJ,KAAKkrB,eAAerd,EAAMF,SAAUE,EAAMxM,OArEtB,wBAwErB,SAAWsM,EAAUC,GACpB,IAAKD,EAAU,CACd,IAAME,EAAQoB,IAAWoE,mBACzB,IAAKxF,EAAO,OAEZF,EAAWE,EAAMF,SACjBC,EAAUC,EAAMxM,GAGjB,IAAMyC,EAAI,UAAM9D,KAAKqrB,YAAY1d,EAAUC,GAAjC,YAA6CnL,IAAUkM,eAAetN,IAEhFwf,IAAiB3R,IAAIpL,EAAM,MAAMvH,MAAME,QAAQC,MAAM0D,KAAK,KAAM,+BAnF5C,GAA6BoC,KAyF7C+Q,EAAc,IAAI0X,EAAiBhqB,IAArB,eAClB1D,IAAYwB,0BAA2B,YAAuC,IAApC4O,EAAmC,EAAnCA,SAAU9L,EAAyB,EAAzBA,OAAQ4pB,EAAiB,EAAjBA,WAC5DtxB,IAAE+U,IAAI/N,EAAO,CAACU,GAAU8L,GAAW8d,OAItBlY,O,qWCtFMjF,E,WAIpB,WAAYT,GAAQ,IAAD,gCAHnBxM,GAAK,GAGc,KAFnBiG,MAAQ,GAEW,KAiCnBhB,UAAY,SAAAF,GAAK,OAChB,cAACulB,EAAD,aAAgB9d,MAAO,GAAUzH,KAjCjCjM,IAAEmI,OAAOtC,KAAM6N,G,wCAGhB,WACC,OAAO7N,KAAKgqB,O,kBAGb,WACC,OAAO5b,IAAYC,UAAUrO,KAAK2N,Y,yBAGnC,SAAYie,GAAU,IAAD,SAIpB,OAFAnhB,YAAW,kBAAM,EAAKgU,eAAc,KAE7BoN,YAAO9nB,YAAW/D,KAAKkE,KAAM,YAAa,CAChD4nB,SAAQ,UAAErpB,IAAUkM,sBAAZ,aAAE,EAA0BtN,GACpCuqB,UACAhU,aAAciH,kB,wBAKhB,WACK7e,KAAK+O,KACRyQ,IAAkBK,SAAS7f,KAAK4N,SAGhC4R,IAAkBK,SAAS7f,KAAK2N,SAAU3N,KAAKqB,Q,KAQlD,SAASsqB,EAAT,GAAqD,IAA3B9d,EAA0B,EAA1BA,MAA0B,IAAnBxH,gBAAmB,MAAR,KAAQ,EAOnD,GANApF,IAAW6R,gBACVvV,IAAYQ,cACZ,gBAAGoQ,EAAH,EAAGA,OAAQN,EAAX,EAAWA,MAAX,OAAuBM,EAAO9M,KAAOwM,EAAMF,UACvCE,EAAMxM,KAAOwM,EAAMxM,MAGpBwM,EAAMke,SAAW3qB,IAAK+oB,eACzB,OAAO,KAER,OAAQtc,EAAM3T,MACb,QAAS,OAAO,KAEhB,KAAK+E,IAAUC,OACd,OACC,cAAC8sB,EAAD,CAAane,MAAOA,EAApB,SACExH,IAKJ,KAAKpH,IAAUE,KACd,OAAO,cAAC8sB,EAAD,CAAWpe,MAAOA,IAG1B,KAAK5O,IAAUG,MACd,OAAO,cAAC8sB,EAAD,CAAYre,MAAOA,IAG3B,KAAK5O,IAAUI,cACd,OAAO,cAAC8sB,EAAD,CAAoBte,MAAOA,KAK9B,SAASme,EAAT,GAA2C,IAApBne,EAAmB,EAAnBA,MAAOxH,EAAY,EAAZA,SACpC,OACC,sBAAKF,UAAU,mBAAf,UACC,sBAAKA,UAAU,QAAf,UACC,cAAC,IAAD,IADD,IACkB0H,EAAMvG,SAGxB,qBAAKnB,UAAU,iBAAf,SACEE,OAML,SAAS+lB,EAAYve,GACpBuR,YACCvR,EAAMM,OAAOke,aAAb,sBACexe,EAAMF,SADrB,mBACwCE,EAAMxM,KAG/Cme,IAAkBK,SAAShS,EAAMM,OAAO9M,GAAIwM,EAAMxM,IAGnD,SAAS4qB,EAAT,GAA+B,IAAVpe,EAAS,EAATA,MACdqF,EAAS,CACd5K,QAAS,kBAAM8jB,EAAYve,KAG5B,OACC,qBAAK1H,UACJtO,YACC,QACA,WACA,CAACoX,IAAWoE,qBAAuBxF,EAAO,aAJ5C,SAOC,8CAAK1H,UAAU,SAAY+M,GAA3B,cACC,cAAC,IAAD,IADD,IACoBrF,EAAMvG,MAEzB,cAACglB,EAAD,CAAkBze,MAAOA,UAM7B,SAASye,EAAT,GAAsC,IAAVze,EAAS,EAATA,MACrB8R,EAAcH,IAAkBta,UAAS,kBAC9Csa,IAAkBC,sBAAsB5R,EAAMF,SAAUE,EAAMxM,OAEzDkrB,EAAchZ,IAAYrO,UAAS,kBACxC/K,IAAE8a,KAAK1B,IAAYe,uBAAuBzG,EAAMF,SAAUE,EAAMxM,QAEjE,OACC,sBAAK8E,UAAU,mBAAf,UACC,cAAC,IAAD,CAAe3L,MAAO,CAAE8hB,QAASiQ,EAAc,EAAI,OAEhD5M,GACF,qBAAKxZ,UAAU,cAAf,SACEwZ,EAAc,IAAd,UACKrnB,KAAKqB,MAAMgmB,EAAc,KAD9B,KAEEA,OAOR,SAASuM,EAAT,GAAgC,IAAD,IAATre,EAAS,EAATA,MACf2e,EAAU3X,IAAiB3P,UAAS,kBACzC2P,IAAiBC,gBAAgBjH,EAAMF,SAAUE,EAAMxM,OAexD,OACC,sBAAK8E,UAAU,kBAAf,UACC,sBAAKA,UAAU,QAAf,UACC,cAAC,IAAD,IADD,IACU0H,EAAMvG,SAGhB,sBAAKnB,UAAU,iBAAf,UACC,qBACCA,UACCtO,YACC,QACA,WACA,CAACoX,IAAWoE,qBAAuBxF,EAAO,aAG5CvF,QA5BJ,WACC8jB,EAAYve,IAmBV,SAUC,sBAAK1H,UAAU,QAAf,UACC,cAAC,IAAD,IADD,aAGC,cAACmmB,EAAD,CAAkBze,MAAOA,SAI3B,sBACC1H,UACCtO,YACC,QACA,WACA,EAAC,UAAA6c,IAAYC,mBAAZ,eAAyB9G,SAAUA,EAAO,aAG7CvF,QAzCJ,WAA2B,IAAD,GACrB,UAAAoM,IAAYC,mBAAZ,eAAyB9G,MAAMxM,MAAOwM,EAAMxM,GAC/C+d,YAAiB,gBAAD,OAAiBvR,EAAMF,SAAvB,UAGhB,IAAIqZ,IAASnZ,EAAMF,SAAUE,EAAMxM,IAAIorB,WA4BtC,UAUC,sBAAKtmB,UAAU,QAAf,UACC,cAAC,IAAD,IADD,KACY,UAAAuO,IAAYC,mBAAZ,eAAyB9G,SAAUA,EAC3C,YAAc,eAGlB,qBAAK1H,UAAU,iBAAf,SACEqmB,GAAWA,EAAQ1zB,KAAI,SAAA+I,GAAM,OAC7B,cAAC6qB,EAAD,CAA8B7qB,OAAQA,GAAhBA,iBAS7B,SAAS6qB,EAAT,GAAsC,IAAX7qB,EAAU,EAAVA,OACpB8qB,EAAOjY,IAAYC,YACnBtS,EAAOI,IAAUyC,UAAS,kBAAMzC,IAAU8R,QAAQ1S,MAIxD,OAFApF,QAAQsc,IAAI,CAAE4T,SAGb,qBAAKxmB,UAAU,0BAAf,SACC,sBAAKA,UAAU,QAAf,UACC,cAAC9D,EAAK2S,gBAAN,CAAsBC,KAAM,KAE3B5S,EAAKf,iBAMV,SAAS6qB,EAAT,GAAwC,IAAVte,EAAS,EAATA,MAC7B,OACC,qBAAK1H,UAAU,yBAAf,SACC,sBAAKA,UAAU,QAAf,UACC,cAAC,IAAD,IADD,IACU0H,EAAMvG,WAMZ,IAAMwH,EAAb,kDAIC,aAAsB,IAAD,iDAANuD,EAAM,yBAANA,EAAM,uBACpB,+BAASA,KAJVxQ,OAAS,GAGY,EAqBrByE,UAAY,kBACX,cAACsmB,EAAD,CAAkB/e,MAAK,kBAnBvB0F,IAAYiS,qBAAqB,MAAO,EAAK3jB,QAHzB,EAJtB,0CAUC,WACC,MAAO,QAXT,kBAcC,WACC,OAAO,IAfT,gBAkBC,WACC,OAAOK,IAASE,IACf,iBACA0M,EAAQ8P,MAAM5e,KAAK6B,YArBtB,oBA4BC,SAAaA,GACZ,MAAO,CAACY,IAAUkM,eAAetN,GAAIQ,GAAQoX,OAAOjgB,KAAK,SA7B3D,GAA6BsV,GAiCtB,SAASse,EAAT,GAAsC,IAAV/e,EAAS,EAATA,MAC5BxL,EAAOI,IAAUyC,UAAS,kBAAMzC,IAAU8R,QAAQ1G,EAAMhM,WAE9D,OAAW,OAAJQ,QAAI,IAAJA,OAAA,EAAAA,EAAMf,aACZ,eAAC,IAAY+V,QAAb,CACCC,KAAM,cAACjV,EAAKkV,YAAN,IACNC,iBAAiB,sCACjBlP,QAAS,kBAAM8W,YAAiB,YAAD,OAAa/c,EAAKhB,MAHlD,UAKC,cAACgB,EAAK2S,gBAAN,IAEA,sBAAK7O,UAAU,UAAf,UACC,oBAAIA,UAAU,WAAd,SAA0B9D,EAAKf,cAE/B,cAACe,EAAKoV,WAAN,CAAiBqT,iBAAiB,eAGjC,O,mTCnSgB7L,E,WAKpB,WAAY9Q,GAAS,IAAD,gCAJpB9M,GAAK,GAIe,KAHpBmX,KAAO,GAGa,KAFpBD,QAAU,GAEU,KAIpBM,QAAU,KAJU,KAqEpBqG,gBAAkB,kBACjB,cAAC2N,EAAD,CAAc1e,OAAQ,KAtEH,KAwEpBoJ,YAAc,kBACb,cAACuV,EAAD,CAAmB3e,OAAQ,KAxE3BhU,IAAEmI,OAAOtC,KAAMmO,G,6CAKhB,WACC,OAAOc,IAAW6J,UAAU9Y,KAAKqB,M,gEAGlC,sBAAAtF,EAAA,sEAC4BoN,YAAc,CACxC7B,MAAO,gBACPC,YAAY,YAAD,OAAcvH,KAAKwY,KAAnB,WAHb,kFASOtW,IAAS7B,OACd6B,IAASE,IAAI,UAAWpC,KAAKqB,GAAI,UAAWoB,IAAUkM,eAAetN,KAVvE,uBAcOa,IAAS7B,OACd6B,IAASE,IAAI,WAAYK,IAAUkM,eAAetN,GAAI,UAAWrB,KAAKqB,KAfxE,OAkBK0F,OAAO+K,SAAS7I,KAAKmL,SAASpU,KAAKqB,KACtC+d,YAAiB,OAGlBjY,IAAOC,UAAU,yCAAW,kCAAKpH,KAAKwY,YACtCpK,IAAY2e,cAAc/sB,KAAKqB,IAvBhC,iD,gFA0BA,WACC,IAAMwX,EAAU7Y,KAAK8Y,YAErB,GAAID,EAAS,CACZ,IAAMnK,EAASvS,OAAO6c,OAAOH,GAASI,MAAK,SAACld,EAAGmd,GAAJ,OAAUnd,EAAE0S,SAAWyK,EAAEzK,YAQpE,MAAM,CACL,qBACCtI,UAAWtO,YACV,mBACA,CAAoB,aAAnBkW,IAAY,GAAmB,aAHlC,SAOC,sBACC5H,UAAU,QACVmC,QAAS,kBAAM8W,YAAiB,gBAAD,OAAiBrR,IAAY,GAA7B,eAFhC,UAIC,cAAC,IAAD,IAJD,gBAFI,eANN,mBAgBIW,EAAO/G,QAAO,SAAAqlB,GAAC,OAAKA,EAAEze,SAAWsK,EAAQmU,EAAEze,WAASzV,KAtBvC,SAAXm0B,EAAWpf,GAAK,OACrB,cAACA,EAAMvH,UAAP,UACEoI,EAAO/G,QAAO,SAAAqlB,GAAC,OAAIA,EAAEze,SAAWV,EAAMxM,MAAIvI,IAAIm0B,IAD1Bpf,EAAMxM,a,0DAgC/B,WAAkBsM,EAAUuf,GAA5B,gGAAsCrrB,EAAtC,+BAA+CY,IAAUkM,eAAetN,GAIjEe,EAAMF,IAASE,IAAI,UAAWuL,EAAU,UAAW9L,GAJ1D,SAOWK,IAASkC,OAAOhC,GAP3B,mFAUyBF,IAASgN,IAAI9M,EAAK,CACzC+qB,SAAUtO,cACVqO,aACE/xB,MAAK,iBAAO,CAAEuB,MAAO,SAASH,OAAM,SAAAG,GAAK,MAAK,CAAEA,YAbpD,qBAUSA,EAVT,EAUSA,OAVT,wBAiBEyK,IAAOC,UAAU,oCAAqC,WAjBxD,kBAmBS3K,QAAQC,MAAM,uBAAwBA,IAnB/C,yBAuBOwF,IAASgN,IACdhN,IAASE,IAAI,WAAYP,EAAQ,UAAW8L,GAC5C,CAAEc,SAAU,IAzBd,4C,gEA8BM,SAASqe,EAAT,GAAwC,IAAX3e,EAAU,EAAVA,OACnC,OACC,cAAC,IAAD,UACC,cAAC,IAAYoV,KAAb,CACC7D,KAAM,cAAC,IAAD,IACNllB,MAAO,CAAEwO,MAAO,qBAChB0a,WAAS,EACTpb,QAAS6F,EAAOif,YAAYhtB,KAAK+N,GAJlC,qBAUI,SAAS0e,EAAT,GAAgE,IAAxC1e,EAAuC,EAAvCA,OAAuC,IAA/BuR,YAA+B,MAAxB,KAAwB,MAAlBpX,eAAkB,MAAR,KAAQ,EACrErH,IAAW6R,gBACVvV,IAAYI,eACZ,SAAA8H,GAAC,OAAIA,EAAE0I,OAAO9M,KAAO8M,EAAO9M,MAG7B,IAAMse,EAAcH,IAAkBta,UAAS,kBAC9Csa,IAAkBC,sBAAsBtR,EAAO9M,OAE1C6R,EAAS,CACd5K,QAAS,WACR,GAAIA,EAAS,OAAOA,IAEpB,IAAMuF,EAAQwf,aAAaC,QAAb,oBAAkCnf,EAAO9M,MAAS,WAE5D8M,EAAOke,aACVjN,YAAiBjR,EAAOke,cAGxBjN,YAAiB,eAAD,OAAgBjR,EAAO9M,GAAvB,YAA6BwM,MAKhD,OACC,cAAC,IAAYwJ,QAAb,CAAqBC,KAAMnJ,aAAkB8Q,EAAS,cAAC9Q,EAAOoJ,YAAR,IAAyB,KAA/E,SACC,8CAAKpR,UAAU,UAAa+M,GAA5B,cACEwM,IAEEvR,EAAOoK,QACN,qBACDpS,UAAU,OACVtK,IAAKsS,EAAOoK,QACZ7P,IAAKyF,EAAOqK,OAEX,oBAAIrS,UAAU,eAAd,SACAzN,YAAWyV,EAAOqK,SAGtB,qBAAKrS,UAAU,mBAAf,SACEwZ,EAAc,GACd,qBAAKxZ,UAAU,cAAf,SACEwZ,EAAc,IAAd,UACKrnB,KAAKqB,MAAMgmB,EAAc,KAD9B,KAEEA,MAKN,cAAC,IAAD,CAAS7H,UAAU,QAAnB,SAA4B3J,EAAOqK,e,qMCnLjCrX,EAAQ,GACR6pB,EAAe,GACfuC,EAAW,GAEJC,EAAiB,gKAC7B,SAAW7f,EAAUC,EAASuH,GAC7B,OAAOhb,IAAE2T,IAAI3M,EAAO,CAACwM,EAAUC,EAASuH,MAFZ,yBAK7B,SAAYxH,EAAUC,GAAU,IAAD,EAC9B,iBAAOzT,IAAE2T,IAAI3M,EAAO,CAACwM,EAAUC,WAA/B,SACC5N,KAAKytB,cAAc9f,EAAUC,GAC7B,QAR2B,8BAY7B,SAAiBD,EAAUC,GAG1B,IAAM8f,EAAY1tB,KAAK0e,YAAY/Q,EAAUC,GAC7C,IAAK8f,EAAW,OAAO,KAQvB,IANA,IAGIC,EACAC,EAHElf,EAAS,GAKf,MANiBvS,OAAO6c,OAAO0U,GAM/B,eAAgC,CAAC,IAAD,IAArBta,EAAO,KACXya,GAA4B,QAAX,EAAAF,SAAA,eAAa7B,YAAa1Y,EAAQ0Y,SACnDgC,EAAiB1a,EAAQwE,cAAR,UAAuB+V,SAAvB,aAAuB,EAAa/V,cAAe,MAErE+V,GAAeE,GAAkBC,KACrCF,GAAgBD,GAAejf,EAAOhI,KAAK,CAC1CuD,IAAK,MAAQ0jB,EAAYtsB,GACzBQ,OAAQ8rB,EAAY7B,SACpBnW,SAAUiY,IAGXA,EAAe,IAGhBA,EAAalnB,KAAK0M,GAClBua,EAAcva,EASf,OANAwa,GAAgBlf,EAAOhI,KAAK,CAC3BuD,IAAK,MAAQ2jB,EAAa,GAAGvsB,GAC7BQ,OAAQ+rB,EAAa,GAAG9B,SACxBnW,SAAUiY,IAGJlf,EAAOqf,YAhDc,kCAmD7B,WACC,OAAO5sB,IApDqB,6BAuD7B,WACC,OAAO6pB,IAxDqB,uBA2D7B,SAAUrd,EAAUC,GAAU,IAAD,EACtB+X,EAAUxrB,IAAE2T,IAAIkd,EAAc,CAACrd,EAAUC,GAAU,IAEzD,UAAA+X,EAAQqI,YAAR,cAAArI,KA9D4B,qBAiE7B,SAAQhY,EAAUC,GAAU,IAAD,EACpB+X,EAAUxrB,IAAE2T,IAAIkd,EAAc,CAACrd,EAAUC,GAAU,IAEzD,UAAA+X,EAAQsI,iBAAR,cAAAtI,KApE4B,kEAuE7B,WAAoBhY,EAAUC,GAA9B,sBAAA7R,EAAA,0DACK5B,IAAE2T,IAAIyf,EAAU,CAAC5f,EAAUC,IADhC,wDAECzT,IAAE+U,IAAIqe,EAAU,CAAC5f,EAAUC,IAAU,GAE/BsgB,EAAoB,QAAbvgB,EACVmB,IAAQ8P,MAAMhR,GACd,KANJ,kBAQQ,IAAI5T,SAAQ,SAAAC,GAClB,IAAM+J,EAAmB,QAAb2J,EACTzL,IAAS6B,WACV,iBACAmqB,EACA,YAEChsB,IAAS6B,WACV,UACA4J,EACA,SACAC,EACA,YAGI3L,EAASC,IAASC,uBACvByM,YACC5K,EACA6K,YAAQ,gBACRsf,YAAY,MAEb,WAA4B,IAAD,yDAAP,GAAO,IAAxBvpB,eAAwB,MAAd,GAAc,EAC1BzK,IAAE+U,IAAIqe,EAAU,CAAC5f,EAAUC,GAAU,MADX,oBAGLhJ,GAHK,IAG1B,2BAA8B,CAAC,IAApBE,EAAmB,QAC7B,OAAQA,EAAO5K,MACd,IAAK,QACJ+G,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYkB,eAClBkP,WAAUC,UACVwF,QAAS,IAAIgb,IAAQtpB,EAAO7I,QAGzB2I,EAAQ3M,QAAU,GACrBunB,IAAkB6O,UAAU1gB,EAAUC,GAEtC,MAEF,IAAK,WAAa,IAAD,EAChB3M,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYmB,eAClBiP,WAAUC,UACVwF,QAASjZ,IAAEmI,OAAF,UACR,EAAKgsB,WAAW3gB,EAAUC,UADlB,QAEL,IAAIwgB,IAAQtpB,EAAO7I,MACtB6I,EAAO7I,QAGR,MAEF,IAAK,UACJgF,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYoB,eAClBgP,WAAUC,UACVuH,UAAWrQ,EAAO1C,IAAIf,OAjCA,8BAuC1BolB,GAAa,WACZxlB,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYqB,YAClB+O,WAAUC,eAIZ3T,EAAEE,IAAE2T,IAAI3M,EAAO,CAACwM,EAAUC,QAItB2gB,EAAuB,QAAb5gB,EACbzL,IAAS6B,WACV,iBACAmqB,EACA,YAEChsB,IAAS6B,WACV,UACA4J,EACA,SACAC,EACA,YAGI4gB,EAAqBtsB,IAASC,uBACnCyM,YACC2f,EACA1f,YAAQ,aACRsf,YAAY,MAEb,WAA0B,IAAD,yDAAP,GAAO,IAAtBppB,aAAsB,MAAd,GAAc,EACxB9D,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYuB,aAClB6O,WACAC,UACAwH,MAAOrQ,OAKJ4gB,EAAU,WACf1jB,IACAusB,WAEOrtB,EAAMwM,GAAUC,UAChBod,EAAard,GAAUC,IAG/BzT,IAAE+U,IAAI8b,EAAc,CAACrd,EAAUC,GAAU,CACxCqgB,UAAWtI,EACXqI,KAAM7zB,IAAE0Y,SAAS8S,EAAS,WAvH7B,2CAvE6B,8DAA8BnjB,KAoMtDoT,EAAe,IAAI4X,EAAkBvsB,KAAtB,mBACnB1D,IAAYkB,gBAAiB,YAAqC,IAAlCkP,EAAiC,EAAjCA,SAAUC,EAAuB,EAAvBA,QAASwF,EAAc,EAAdA,QACnDjZ,IAAE+U,IAAI/N,EAAO,CAACwM,EAAUC,EAASwF,EAAQ/R,IAAK+R,MAF3B,cAInB7V,IAAYmB,gBAAiB,YAAqC,IAAlCiP,EAAiC,EAAjCA,SAAUC,EAAuB,EAAvBA,QAASwF,EAAc,EAAdA,QACnDjZ,IAAE+U,IAAI/N,EAAO,CAACwM,EAAUC,EAASwF,EAAQ/R,IAAK+R,MAL3B,cAOnB7V,IAAYoB,gBAAiB,YAAuC,IAAD,IAAnCgP,EAAmC,EAAnCA,SAAUC,EAAyB,EAAzBA,QAASuH,EAAgB,EAAhBA,UACnD,UAAOhU,EAAMwM,UAAb,kBAAO,EAAkBC,UAAzB,cAAO,EAA6BuH,OARjB,IAYNS,Q,gMCvNA,SAAS6Y,EAAT,GAAiD,IAAxB5yB,EAAuB,EAAvBA,IACvC,GAD8D,EAAlBuX,QAChBzS,IAAMuE,UAAS,IAA3C,mBAAOwpB,EAAP,KAAexmB,EAAf,KACA,EAA4BvH,IAAMuE,UAAS,GAA3C,mBAAO2lB,EAAP,KAAe1iB,EAAf,KACMwmB,EAAYrK,cAkBlB,OAhBA3jB,IAAMI,WAAU,WACf,IAAM+Y,EAAQ3d,OAAO/B,OACpBC,SAASC,cAAc,OACvB,CACCE,MAAO,eACPqB,MACAL,OAAQ,kBAAOmzB,GAAazmB,GAAU,GAAO4R,EAAMjO,UACnDqa,QAAS,kBAAOyI,GAAaxmB,GAAU,GAAO2R,EAAMjO,YAMtD,OAFAxR,SAASM,KAAKE,YAAYif,GAEnB,kBAAMA,EAAMjO,YACjB,CAAChQ,IAGH,qBACCsK,UAAU,4BACVmC,QAAS,kBAAMY,YAAerN,GAAK,kBAClC,YAAIxB,SAASu0B,iBAAiB,6BAC5Bb,UAAUj1B,KAAI,SAAA2M,GAAC,OAAIA,EAAE5J,WAJzB,SAMEgvB,EAEC,sBAAK1kB,UAAU,+BAAf,UACC,cAAC,IAAD,IACA,8CAIDuoB,EAEE,qBACCvoB,UAAU,QACVtK,IAAKA,IAIN,qBAAKsK,UAAU,gCAAf,SACC,cAAC+E,EAAA,EAAD,Q,iFC7Ca2jB,G,OAKpB,WAAYC,GAAQ,IAAD,gCAInBxoB,UAAY,kBACX,cAACyoB,EAAD,CAAgBD,MAAO,KAJvB30B,IAAEmI,OAAOtC,KAAM8uB,KAOV,SAASC,EAAT,GAAoC,IAAVD,EAAS,EAATA,MAC1B9qB,EAAMrD,IAAMyL,SAClB,EAAwBzL,IAAMuE,SAAS,UAAvC,mBAAO+P,EAAP,KAAa+Z,EAAb,KAEMh0B,EAAMi0B,EAAW/pB,UAAS,kBAAM4pB,EAAM9zB,OAQ5C,OANA2F,IAAMI,WAAU,WAAO,IAAD,IACiC,KAAlD,UAAAiD,EAAIuI,eAAJ,mBAAaoV,qBAAb,eAA4BuN,WAAWj3B,SAC1C+2B,EAAQ,SAEP,IAGF,qBACC7oB,UAAU,QACVnC,IAAKA,EACLxJ,MAAO,CACNmW,MAAOsE,EACPrE,OAAQqE,GALV,SAQC,qBACC9O,UAAU,aAEVtK,IAAKb,EACL0N,IAAI,OCtCR,IAAMvH,EAAQ,GAEDguB,EAAe,8JAC3B,SAASC,EAAQC,GAAU,IAAD,EACzB,iBAAOl1B,IAAE2T,IAAI3M,EAAO,CAACiuB,EAAQC,WAA7B,SACCrvB,KAAKsvB,WAAWF,EAAQC,GACxBl1B,IAAE+U,IAAI/N,EAAO,CAACiuB,EAAQC,GAAU,IAAIR,EAAM,CAAEO,SAAQ/tB,GAAIguB,EAASttB,SAAS,KAC1E5H,IAAE2T,IAAI3M,EAAO,CAACiuB,EAAQC,OALG,6BAS3B,WACC,OAAOluB,IAVmB,+DAa3B,WAAiBiuB,EAAQC,GAAzB,mBAAAtzB,EAAA,sEACmBmG,IAASkC,OAC1BlC,IAASE,IAAI,aAAcgtB,EAAQ,SAAUC,IAF/C,cACOjtB,EADP,OAKO0sB,EAAQ30B,IAAEmI,OAAF,UACbnI,IAAE2T,IAAI3M,EAAO,CAACiuB,EAAQC,WADT,QACsB,IAAIR,EAD1B,2BAGTzsB,GAHS,IAIZgtB,SACArtB,SAAS,KAIXd,IAAWsB,SAAS,CACnBrI,KAAMqD,IAAYsB,YAClBuwB,SAAQC,UAASP,UAhBnB,kBAmBQA,GAnBR,2CAb2B,8DAA4BtsB,KA0CzCysB,EANI,IAAIE,EAAgBluB,IAApB,eACjB1D,IAAYsB,aAAc,YAAiC,IAA9BuwB,EAA6B,EAA7BA,OAAQC,EAAqB,EAArBA,QAASP,EAAY,EAAZA,MAC9C30B,IAAE+U,IAAI/N,EAAO,CAACiuB,EAAQC,GAAUP,O,QCtCnB,yDACdS,MAAQp1B,IAAEmI,OACT,GACAktB,eACA,CACC1V,MAAO,CACN2V,MAAO,GACP7Y,MAAO,SAAA/a,GAAG,MAAI,mDAAmD6zB,KAAK7zB,IACtEuqB,MAAO,SAACuJ,EAASx1B,EAAG2P,GAAb,MAAwB,CAC9BjO,IAAK8zB,EAAQ,GAAGv3B,OAChBgb,QAAO,OAAEtJ,QAAF,IAAEA,OAAF,EAAEA,EAAOsJ,QAChBtJ,UAED8lB,MAAO,SAACC,EAAM11B,EAAG2P,GAAV,OACN+lB,EAAK/lB,MAAMgmB,QACR,sBAAM3pB,UAAU,aAAhB,oBAAkC2D,EAAMG,KACxC,cAAC,EAAD,CAA+BpO,IAAKg0B,EAAKh0B,IAAKuX,QAASyc,EAAKzc,SAAxCtJ,EAAMG,OAG/B8lB,YAAa,CACZN,MAAO,GACP7Y,MAAO,SAAA/a,GAAG,MAAI,aAAa6zB,KAAK7zB,IAChCuqB,MAAO,SAACuJ,EAASx1B,EAAG2P,GAAb,MAAwB,CAAEjI,OAAQ8tB,EAAQ,GAAI7lB,UACrD8lB,MAAO,SAACC,EAAM11B,EAAG2P,GAChB,OACCnJ,IAAMrG,cACLmI,IAAU8R,QAAQsb,EAAKhuB,QAAQ4oB,QAC/B,CAAExgB,IAAKH,EAAMG,QAKjB6kB,MAAO,CACNW,MAAO,GACP7Y,MAAO,SAAA/a,GAAG,MAAI,gCAAgC6zB,KAAK7zB,IACnDuqB,MAAO,SAACuJ,EAASx1B,EAAG2P,GAAb,MAAwB,CAAEslB,OAAQO,EAAQ,GAAIN,QAASM,EAAQ,GAAI9zB,IAAK8zB,EAAQ9zB,IAAKiO,UAC5F8lB,MAAO,SAACC,EAAM11B,EAAG2P,GAChB,IAAMglB,EAAQG,EAAWe,SAASH,EAAKT,OAAQS,EAAKR,SAEpD,OAAOP,EACNnuB,IAAMrG,cACLw0B,EAAMxoB,UACN,CAAE2D,IAAKH,EAAMG,MAEX,OAGNmQ,MAAO,CACNqV,MAAO,GACP7Y,MAAO,SAAA/a,GAAG,MAAI,sCAAsC6zB,KAAK7zB,IACzDuqB,MAAO,SAACuJ,EAASx1B,EAAG2P,GAAb,MAAwB,CAAEjO,IAAK8zB,EAAQ,GAAI7lB,UAClD8lB,MAAO,SAACC,EAAM11B,EAAG2P,GAAV,OAEN,aADA,CACA,SAECjO,IAAKg0B,EAAKh0B,IACVo0B,UAAQ,GAFHnmB,EAAMG,OAMd/N,MAAO,CACNuzB,MAAO,GACP7Y,MAAO,SAAA/a,GAAG,MAAI,yCAAyC6zB,KAAK7zB,IAC5DuqB,MAAO,SAACuJ,EAASx1B,EAAG2P,GAAb,MAAwB,CAAEjO,IAAK8zB,EAAQ,GAAI7lB,UAClD8lB,MAAO,SAACC,EAAM11B,EAAG2P,GAAV,OAEN,aADA,CACA,SAECjO,IAAKg0B,EAAKh0B,IACVo0B,UAAQ,GAFHnmB,EAAMG,OAMdimB,QAAS,CACRT,MAAO,GACP7Y,MAAO,SAAA/a,GAAG,MAAI,8DAA8D6zB,KAAK7zB,IACjFuqB,MAAO,SAACuJ,EAASx1B,EAAG2P,GAAb,MAAwB,CAAEzI,GAAIsuB,EAAQ,GAAI7lB,UACjD8lB,MAAO,SAACC,EAAM11B,EAAG2P,GAAV,OACN,wBAEC3D,UAAU,eACVtK,IAAG,wCAAmCg0B,EAAKxuB,IAC3C8uB,iBAAe,GAHVrmB,EAAMG,SA/EF,KAmGdmmB,OAASC,oBAAUrwB,KAAKuvB,OAnGV,KAoGde,OAASC,mBAASC,qBAAWxwB,KAAKuvB,MAAO,UApG3B,yCAsGd,SAAM3D,EAASxY,GAAsB,IAAbhN,EAAY,uDAAJ,GAC/B,OAAOpG,KAAKswB,OACXtwB,KAAKowB,OACJxE,EADD,aAGE6E,QAAQ,EACRrd,WACGhN,SA7GO,O,uGCNA,yDACd5C,GAAKktB,cADS,mDAGd,SAAgBrrB,GACf,OAAOlL,IAAEmL,KAAF,eAAYD,GAAO,CACzB,OACA,kBACA,SAPY,iBAWd,SAAIvB,GACH,OAAOE,YAAIhE,KAAKwD,GAAIM,KAZP,4BAed,SAAeA,EAAM/D,GACpB,OAAO4wB,YACN3wB,KAAKgE,IAAIF,GACT/D,KAlBY,sCAsBd,SAAyB+D,GACxB,OAAO8sB,YAAa5wB,KAAKgE,IAAIF,MAvBhB,wDA0Bd,WAAUA,GAAV,SAAA/H,EAAA,sEACc+R,YAAI9N,KAAKgE,IAAIF,IAD3B,wFA1Bc,+GA8Bd,WAAUA,EAAM7H,GAAhB,SAAAF,EAAA,sEACcmT,YAAIlP,KAAKgE,IAAIF,GAAO7H,EAAO+D,KAAKwF,gBAAgBvJ,GAAQ,MADtE,wFA9Bc,kE,wICCMoO,E,kDAGjB,WAAYjE,GAAQ,IAAD,8BACf,cAAMA,IAHV0D,MAAQ,CAAEpN,MAAO,KAAMm0B,UAAW,KAAMC,UAAU,GAE/B,E,qDAInB,SAAkBp0B,EAAOm0B,GAGrB7wB,KAAKwK,SAAS,CAAE9N,QAAOm0B,gB,2BAG3B,WACI,MAA6B7wB,KAAK8J,MAA1BpN,EAAR,EAAQA,MAAOm0B,EAAf,EAAeA,UAEftqB,YACI,sBAAKJ,UAAU,2BAA2BmC,QAAS,kBAAM3B,eAAzD,UACI,6BAAKjK,EAAM0W,UACTyd,EAAUE,eAAen4B,MAAM,MAAMC,MAAM,EAAG,IAAIC,KAAI,SAACk4B,EAAKj5B,GAAN,OAAY,6BAAai5B,GAAJj5B,Y,yBAKzF,WAAe,IAAD,OACWiI,KAAK8J,MAAlBgnB,SAER,OACI,sBAAK3qB,UAAU,uBAAf,UACI,yEACA,qFAEA,sBAAKA,UAAU,sBAAf,UACI,qBAAKA,UAAU,iCAAiCmC,QAAS,kBAAM,EAAK2oB,iBAApE,uBACA,qBAAK9qB,UAAU,uCAAuCmC,QAAS,kBAAM,EAAKkC,SAAS,CAAE9N,MAAO,QAA5F,2B,oBAMhB,WACI,OAAIsD,KAAK8J,MAAMpN,MACJsD,KAAKkxB,cAETlxB,KAAKoG,MAAMC,a,GA5CiB1F,IAAM2F,Y,sMCGlC,SAASmN,EAAarN,GAAQ,IAAD,EACrC+qB,EAAexwB,IAAMyL,SACrBglB,EAAczwB,IAAMyL,SACpBpI,EAAMrD,IAAMyL,SAElB,EAA4BzL,IAAMuE,SAAS,GAA3C,mBAAO0L,EAAP,KAAeygB,EAAf,KACA,EAA0B1wB,IAAMuE,SAAN,UAAekB,EAAM6E,oBAArB,QAAqC,IAA/D,mBAAOrO,EAAP,KAAc00B,EAAd,KACA,EAA8B3wB,IAAMuE,UAAS,GAA7C,mBAAOqsB,EAAP,KAAgBC,EAAhB,KACA,EAAkC7wB,IAAMuE,SAAS,CAAC,EAAG,IAArD,mBAAOusB,EAAP,KAAkBC,EAAlB,KAEMC,EAAQhxB,IAAMuL,SAAQ,kBAC3B,qBAAK/F,UAAU,SAAa9N,iBAAoB,CAACuE,EAAO60B,IAEzD9wB,IAAMI,WAAU,WACf0lB,GAAa,wBACZ4K,EAAS,UAACD,EAAY7kB,eAAb,aAAC,EAAqB6L,wBAAwBxH,aAEtD,CAAChU,IAEJ,IAAMsW,EAAS,CACdS,QAAS,SAAAlO,GAAM,IAAD,EACb,UAAAW,EAAMuN,eAAN,cAAAvN,EAAgBX,GAEhB6rB,EAAS7rB,EAAE8C,OAAO3L,QAEnBg1B,UAAU,WAAD,4BAAE,WAAMnsB,GAAN,iBAAA1J,EAAA,sDACV,UAAAqK,EAAMwrB,iBAAN,cAAAxrB,GADU,KAGFX,EAAEwE,IAHA,OAIJ,UAJI,0BAKHxE,EAAEwO,SALC,wBAMPxO,EAAE0c,iBANK,mBAQI/b,EAAMsN,cARV,aAQI,OAAAtN,EAAexJ,GARnB,uBAQ+B,IAR/B,sBASN00B,EAAS,IACTttB,EAAIuI,QAAQ3P,MAAQ,GAVd,gFAAF,mDAAC,GAgBVi1B,QAAS,kBAAML,GAAW,IAC1B9T,OAAQ,kBAAM8T,GAAW,KAc1B,OAXAjT,YAAiB,mBAAmB,WACnC,IAAMkT,EAAYp3B,SAASy3B,gBAEd,OAATL,QAAS,IAATA,OAAA,EAAAA,EAAWM,cAAeZ,EAAa5kB,SAC1CmlB,EAAa,CACZ1tB,EAAIuI,QAAQylB,eACZhuB,EAAIuI,QAAQ0lB,kBAMd,sBACCjuB,IAAKmtB,EACLhrB,UAAWtO,YAAe,eAAgB,CAAC05B,EAAS,YACpDjpB,QAAS,kBAAMme,GAAa,kBAAMziB,EAAIuI,QAAQ2lB,YAC9C13B,MAAO,CACN,qBAAqB,GAArB,OAAyBoW,EAAzB,OALF,UAQExK,EAAMyN,kBAEP,kDACC7P,IAAKA,GACD7J,IAAEmL,KACLc,EACA,WAAY,UAAW,WAAY,SACnC,YAAa,sBAEV8M,IAGJtW,EAEC,sBAAKuJ,UAAU,WAAWnC,IAAKotB,EAA/B,UACEhH,IAAiBhE,MAAMxpB,EAAM/D,MAAM,EAAG44B,EAAU,KAEhDA,EAAU,GAAKA,EAAU,GAAK,GAC9B,sBAAMtrB,UAAU,eAAhB,SACEvJ,EAAM/D,MAAM44B,EAAU,GAAIA,EAAU,MAItCE,EAEAvH,IAAiBhE,MAAMxpB,EAAM/D,MAAM44B,EAAU,QAI/C,sBAAKtrB,UAAU,uBAAuBnC,IAAKotB,EAA3C,UACEO,EACAvrB,EAAMC,kB,qJCvGE,MAA0B,mCCA1B,MAA0B,oC,QCSnClF,EAAQ,GAERgxB,EAAqB,qKAC1B,SAAgBxkB,EAAUC,GACzB,OAAOzT,IAAE2T,IAAI3M,EAAO,CAACwM,EAAUC,MAFN,gCAK1B,WACC,OAAOzM,MANkB,GAAkCqB,KAUvDqS,EAAmB,IAAIsd,EAAsBlxB,IAA1B,eACvB1D,IAAYS,sBAAuB,YAAmC,IAAD,EAA/B2P,EAA+B,EAA/BA,SAAUC,EAAqB,EAArBA,QAAS0b,EAAY,EAAZA,MACnDjJ,EAAOlmB,IAAE2T,IAAI3M,EAAO,CAACwM,EAAUC,GAAU,IAE/C,IAAI,UAAA8G,IAAYC,mBAAZ,eAAyB9G,MAAMxM,MAAOuM,EAAS,qBAE7ByS,GAF6B,IAElD,2BAA2B,CAAC,IAAjBxe,EAAgB,SACpBynB,EAAMzhB,QAAQhG,IACnBjG,YAAUw2B,EAAS,KAJ6B,kDAS7B9I,GAT6B,IASlD,2BAA4B,CAAC,IAAlBznB,EAAiB,SACrBwe,EAAKxY,QAAQhG,IAClBjG,YAAUy2B,EAAQ,KAX8B,+BAgBnDl4B,IAAE+U,IAAI/N,EAAO,CAACwM,EAAUC,GAAU0b,OAIrBzU,O,oQC/BA,SAAS9C,EAAT,GAAwC,IAAD,IAAlBC,cAAkB,SACrD,EAAoCrR,IAAMuE,SAAS8M,GAAnD,mBAAOsgB,EAAP,KAAmBC,EAAnB,KACA,EAAwB5xB,IAAMuE,UAAS,GAAvC,mBAAOstB,EAAP,KAAaC,EAAb,KACMzuB,EAAMrD,IAAMyL,SAGZ8G,EAAS,CACdwf,aAAc,WACb,IAAIF,EAAJ,CAGA,MAAyExuB,EAAIuI,QAAQomB,qBAAqB,SAA1G,mBAAOC,EAAP,KAAsBC,EAAtB,KAAkCC,EAAlC,KAAiDC,EAAjD,KAGA,IAAKH,EAAch2B,MAClB,OAAOuK,IAAOC,UAAU,8BAA+B,WAExD,GAAI2rB,EAAqBn2B,QAAUk2B,EAAcl2B,MAChD,OAAOuK,IAAOC,UAAU,uBAAwB,WAEjD,IAAKyrB,EAAWj2B,MAAMxE,OACrB,OAAO+O,IAAOC,UAAU,kCAAmC,WAE5D,IAAK0rB,EAAcl2B,MAAMxE,OACxB,OAAO+O,IAAOC,UAAU,4BAA6B,WAGtDqrB,GAAQ,GAGRO,YAA+B9wB,IAASoB,KAAMuvB,EAAWj2B,MAAOk2B,EAAcl2B,OAE5EzB,KAFF,uCAEO,+BAAAY,EAAA,6DAASsG,EAAT,EAASA,KAERf,EAAcsxB,EAAch2B,MAF7B,SAGCq2B,YAAc5wB,EAAM,CAAEf,gBAHvB,uBAMCY,IAASgN,IACdhN,IAASE,IAAI,WAAYC,EAAKse,KAC9B,CACCrf,cACA4xB,eAAgB5xB,EAAY6Q,cAC5ByF,aAAciH,gBAXX,uBAgBCI,IAAOjmB,KAAK,uBAAwB,kBAAmBqJ,EAAKse,KAhB7D,OAmBLla,IAAOG,MACPO,IAAOC,UAAU,qBAAsB,WACvCqf,GAAa,kBAAMrH,YAAiB,UArB/B,4CAFP,uDA0BE7iB,OAAM,SAAAkJ,GACN0B,IAAOC,UAAU,2DAA4D,WAC7E3K,QAAQC,MAAM+I,QAGjB0tB,YAAa,WACZ,IAAIX,EAAJ,CAGA,MAAoCxuB,EAAIuI,QAAQomB,qBAAqB,SAArE,mBAAOE,EAAP,KAAmBC,EAAnB,KAGAL,GAAQ,GAGRW,YAA2BlxB,IAASoB,KAAMuvB,EAAWj2B,MAAOk2B,EAAcl2B,OAExEzB,MAAK,kBAAOsL,IAAOG,MAAOG,OAAO+K,SAAS1X,OAAO,WAEjDmC,OAAM,SAAAkJ,GACN,IAAI2N,EAAU,UAEd,OAAQ3N,EAAE4tB,MACT,IAAK,qBACJjgB,EAAU,wBACV,MAED,IAAK,sBACJA,EAAU,gCACV,MAED,IAAK,sBACJA,EAAU,qBAIZjM,IAAOC,UAAP,sCAAgDgM,GAAW,UAAW,IACtE3W,QAAQC,MAAM+I,SAUlB,OALA8Y,YACC,WACA,SAAA9Y,GAAC,MAAc,UAAVA,EAAEwE,MAAoBqoB,EAAapf,EAAOwf,eAAiBxf,EAAOigB,kBAIvE,sBAAKhtB,UAAU,YAAYnC,IAAKA,EAAhC,UACC,cAAC,IAAD,CAAWmC,UAAU,cAAcmC,QAAS7B,IAAOG,IAAIxG,KAAKqG,OAE3D6rB,EACA,eAAC,IAAMzgB,SAAP,WACC,sBAAK1L,UAAU,mBAAf,UACC,sBAAKA,UAAU,cAAf,UACC,qBAAKA,UAAU,QAAf,kBAEA,0DACwB,uBADxB,8BAE4B,uBAC3B,mBAAG8C,KAAK,SAAR,8BAAqC,uBACrC,mBAAGA,KAAK,cAAR,kCAA8C,uBAC9C,mBAAGA,KAAK,WAAR,4BAAqC,6BAIvC,sBAAK9C,UAAU,SAAf,UACC,yCAEA,qBAAKA,UAAU,iBAAf,SACC,uBAAOjM,KAAK,WAAWgjB,YAAY,WAAWoW,UAAW,OAG1D,qBAAKntB,UAAU,iBAAf,SACC,uBAAOjM,KAAK,QAAQgjB,YAAY,oBAGjC,qBAAK/W,UAAU,iBAAf,SACC,uBAAOjM,KAAK,WAAWgjB,YAAY,eAGpC,qBAAK/W,UAAU,iBAAf,SACC,uBAAOjM,KAAK,WAAWgjB,YAAY,6BAKtC,sBAAK/W,UAAU,qBAAf,UACC,sBAAKA,UAAU,SAASmC,QAAS,kBAAMiqB,GAAc,IAArD,UACC,cAAC,IAAD,IACA,8DAGD,sBAAKpsB,UAAU,SAAS3L,MAAO,CAAE+4B,WAAY,QAAUjrB,QAAS4K,EAAOwf,aAAvE,UACC,cAAC,IAAD,IACA,mDAKH,eAAC,IAAM7gB,SAAP,WACC,sBAAK1L,UAAU,mBAAf,UACC,sBAAKA,UAAU,cAAf,UACC,qBAAKA,UAAU,QAAf,oBAEA,6DAKD,sBAAKA,UAAU,SAAf,UACC,uCAEA,qBAAKA,UAAU,iBAAf,SACC,uBAAOjM,KAAK,QAAQgjB,YAAY,oBAGjC,qBAAK/W,UAAU,iBAAf,SACC,uBAAOjM,KAAK,WAAWgjB,YAAY,qBAKtC,sBAAK/W,UAAU,qBAAf,UACC,sBAAKA,UAAU,SAASmC,QAAS,kBAAMiqB,GAAc,IAArD,UACC,cAAC,IAAD,IACA,4DAGD,sBAAKpsB,UAAU,SAAS3L,MAAO,CAAE+4B,WAAY,QAA7C,UACC,cAAC,IAAD,IACA,oDAGD,sBAAKptB,UAAU,SAASmC,QAAS4K,EAAOigB,YAAxC,UACC,cAAC,IAAD,IACA,wD,gJC1Mc/E,E,WAOpB,WAAYhb,GAAU,yBANtB/R,GAAK,GAMgB,KALrBuqB,QAAU,GAKW,KAJrBE,SAAW,GAIU,KAHrBlU,aAAe,KAGM,KAFrB4b,SAAW,GAGVr5B,IAAEmI,OAAOtC,KAAMoT,G,8CAGhB,WAAwB,IAAbhN,EAAY,uDAAJ,GAClB,OAAOgkB,IAAiBhE,MAAMpmB,KAAK4rB,QAAS5rB,KAAMoG,K,6BAGnD,SAAgBjJ,GACf,OAAOD,YAAe,OAACC,QAAD,IAACA,IAAS6C,KAAK4X,kB,inBCRnB6b,QACW,cAA7B1sB,OAAO+K,SAASgU,UAEe,UAA7B/e,OAAO+K,SAASgU,UAEhB/e,OAAO+K,SAASgU,SAASlP,MACvB,2D,WCbN6L,IAAS6N,OACR,cAAC,IAAMoD,WAAP,UACC,cAACjT,EAAA,EAAD,MAEDpmB,SAAS8Q,eAAe,SD0HnB,kBAAmBnE,WACrBA,UAAU2sB,cAAcC,MACrBz4B,MAAK,SAAA04B,GACJA,EAAaC,gBAEdv3B,OAAM,SAAAG,GACLD,QAAQC,MAAMA,EAAM0W,c","file":"static/js/main.0745bf15.chunk.js","sourcesContent":["import _ from \"lodash\";\r\n\r\nexport function joinClassNames() {\r\n\tlet final = \"\";\r\n\r\n\tfor (let i = 0; i < arguments.length; i++) {\r\n\t\tswitch (typeof (arguments[i])) {\r\n\t\t\tcase (Array.isArray(arguments[i]) && typeof (arguments[i][0]) === \"boolean\" && \"object\"):\r\n\t\t\t\tif (arguments[i][0] === true)\r\n\t\t\t\t\tfinal += arguments[i][1];\r\n\t\t\t\telse if (arguments[i][2])\r\n\t\t\t\t\tfinal += arguments[i][2];\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tfinal += arguments[i];\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tfinal += \" \";\r\n\t}\r\n\r\n\treturn final.trim();\r\n}\r\n\r\nexport function getRandomKey() { return Math.random().toString(36).substr(7); }\r\n\r\nexport function getAcronym(input) {\r\n\tconst split = input.split(/\\s/).slice(0, 2);\r\n\r\n\treturn split.map(w => w[0]).join(\"\").toUpperCase();\r\n}\r\n\r\nexport function formatDateString(date, options = {}) {\r\n\tconst { prependOn = true } = options;\r\n\r\n\tconst day = 86400000;\r\n\tconst days = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\r\n\r\n\tconst now = new Date();\r\n\tconst daysPassed = (Math.round(now - date) / day).toFixed(0);\r\n\r\n\tlet returnValue;\r\n\r\n\tif (daysPassed < 0)\r\n\t\treturnValue = \"in the future apparently\";\r\n\telse if (daysPassed === \"0\")\r\n\t\treturnValue = \"today\";\r\n\telse if (daysPassed === \"1\")\r\n\t\treturnValue = \"yesterday\";\r\n\telse if (daysPassed < 7)\r\n\t\treturnValue = (prependOn ? \"on \" : \"\") + days[date.getDay()];\r\n\telse\r\n\t\treturnValue = (prependOn ? \"on \" : \"\") + date.toLocaleDateString();\r\n\r\n\treturn returnValue;\r\n}\r\n\r\nexport function openFileDialog(options = {}) {\r\n\treturn new Promise(r => {\r\n\t\tconst { type = \"*\" } = options;\r\n\t\tconst input = _.assign(document.createElement(\"input\"), {\r\n\t\t\ttype: \"file\",\r\n\t\t\taccept: type,\r\n\t\t\tstyle: \"display:none\",\r\n\t\t\tonchange: () => (\r\n\t\t\t\tr(input.files),\r\n\r\n\t\t\t\tdocument.body.removeChild(input)\r\n\t\t\t)\r\n\t\t});\r\n\r\n\t\tdocument.body.appendChild(input);\r\n\t\tinput.click();\r\n\t});\r\n}\r\n\r\nexport function fetchToBase64(url) {\r\n\treturn new Promise(resolve =>\r\n\t\tfetch(url).then(res => res.blob())\r\n\t\t\t.then(blob => {\r\n\t\t\t\tconst reader = new FileReader();\r\n\r\n\t\t\t\treader.onload = () => resolve(reader.result);\r\n\t\t\t\treader.readAsDataURL(blob);\r\n\t\t\t}));\r\n}\r\n\r\nconst spaghettiAudioCache = {};\r\n\r\nexport function playSound(src, volume = 1) {\r\n\treturn new Promise(async resolve => {\r\n\t\tconst data = spaghettiAudioCache[src] ?? await fetchToBase64(src).then(base64 => spaghettiAudioCache[src] = base64);\r\n\t\tconst audio = Object.assign(new Audio(data), { volume });\r\n\r\n\t\taudio.addEventListener(\"ended\", resolve);\r\n\t\taudio.play().catch(err => console.error(\"Error playing sound!\", src, err));\r\n\t});\r\n}\r\n\r\nexport function playSoundLoop(src, volume = 1) {\r\n\tconst audio = Object.assign(new Audio(spaghettiAudioCache[src]), { volume, loop: true });\r\n\tconst play = () => audio.play().catch(err => console.error(\"Error playing sound!\", src, err));\r\n\r\n\tif (spaghettiAudioCache[src] === undefined)\r\n\t\tfetchToBase64(src).then(base64 => [spaghettiAudioCache[src] = audio.src = base64, play()]);\r\n\telse play();\r\n\r\n\treturn {\r\n\t\tstop: () => audio.pause(),\r\n\t\tget paused() { return audio.paused; },\r\n\t\tset paused(value) { value ? audio.pause() : audio.play(); }\r\n\t};\r\n}\r\n\r\nexport function kib(value) {\r\n\treturn value * 1024;\r\n}\r\n\r\nexport function mib(value) {\r\n\treturn kib(value) * 1024;\r\n}\r\n\r\nexport function formatCamelCase(camelCase) {\r\n\tconst r = camelCase.replace(/([A-Z])/g, \" $1\");\r\n\r\n\treturn r.charAt(0).toUpperCase() + r.slice(1);\r\n}\r\n\r\nexport function formatTimestamp(_time) {\r\n\tif (!_time) return \"\";\r\n\tconst time = _time?.toDate?.() ?? _time;\r\n\r\n\treturn `${formatDateString(time)} at ${time.toLocaleTimeString(\"en-US\")}`;\r\n}\r\n\r\nexport const ActionTypes = {\r\n\tPAGE_UPDATE: \"PAGE_UPDATE\",\r\n\tLOCAL_USER_UPDATE: \"LOCAL_USER_UPDATE\",\r\n\tUSER_UPDATE: \"USER_UPDATE\",\r\n\tCIRCLE_UPDATE: \"CIRCLE_UPDATE\",\r\n\tCIRCLES_UPDATE: \"CIRCLES_UPDATE\",\r\n\tCIRCLE_UPDATE_GROUPS: \"CIRCLE_UPDATE_GROUPS\",\r\n\tBATCH_UPDATE_DMS: \"BATCH_UPDATE_DMS\",\r\n\tGROUP_UPDATE: \"GROUP_UPDATE\",\r\n\tUPDATE_VOICE_MEMBERS: \"UPDATE_VOICE_MEMBERS\",\r\n\tUPDATE_CURRENT_CALL: \"UPDATE_CURRENT_CALL\",\r\n\tDM_UPDATE: \"DM_UPDATE\",\r\n\tUPDATE_MESSAGE_COUNT: \"UPDATE_MESSAGE_COUNT\",\r\n\tUPDATE_READ_COUNT: \"UPDATE_READ_COUNT\",\r\n\tUPDATE_CSS_VAR: \"UPDATE_CSS_VAR\",\r\n\tBATCH_UPDATE_CSS_VARS: \"BATCH_UPDATE_CSS_VARS\",\r\n\tUPDATE_SETTING: \"UPDATE_SETTING\",\r\n\tBATCH_UPDATE_SETTINGS: \"BATCH_UPDATE_SETTINGS\",\r\n\tMESSAGE_CREATE: \"MESSAGE_CREATE\",\r\n\tMESSAGE_UPDATE: \"MESSAGE_UPDATE\",\r\n\tMESSAGE_DELETE: \"MESSAGE_DELETE\",\r\n\tCHAT_UPDATE: \"CHAT_UPDATE\",\r\n\tFETCH_EMOTE: \"FETCH_EMOTE\",\r\n\tUPDATE_READS: \"UPDATE_READS\",\r\n\tUPDATE_TYPING_INDICATORS: \"UPDATING_TYPING_INDICATORS\",\r\n\tDISPLAY_BANNER_NOTIFICATION: \"DISPLAY_BANNER_NOTIFICATION\"\r\n};\r\n\r\nexport const GroupType = {\r\n\tFOLDER: 0,\r\n\tTEXT: 1,\r\n\tVOICE: 2,\r\n\tANNOUNCEMENTS: 3\r\n};\r\n\r\nexport const UserStatus = {\r\n\tOFFLINE: 0,\r\n\tONLINE: 1,\r\n\tAWAY: 2,\r\n\tBUSY: 3,\r\n\tBOT: 100\r\n};","import React from \"react\";\r\n\r\nexport default class Dispatcher {\r\n\t_callbacks = {};\r\n\r\n\tsubscribe(event, callback) {\r\n\t\tif (!this._callbacks[event]) {\r\n\t\t\tthis._callbacks[event] = new Set;\r\n\t\t}\r\n\r\n\t\tthis._callbacks[event].add(callback);\r\n\r\n\t\treturn this.unsubscribe.bind(this, event, callback);\r\n\t}\r\n\r\n\tunsubscribe(event, callback) {\r\n\t\tif (!this._callbacks[event]) return;\r\n\r\n\t\tthis._callbacks[event].delete(callback);\r\n\t}\r\n\r\n\tdispatch(action) {\r\n\t\tconst event = action.type;\r\n\t\tif (!this._callbacks[event]) return;\r\n\r\n\t\tfor (const listener of this._callbacks[event]) {\r\n\t\t\tlistener(action);\r\n\t\t}\r\n\t}\r\n\r\n\tget useForceUpdater() {\r\n\t\treturn (actionType, condition = null, deps = []) => {\r\n\t\t\tconst [, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n\r\n\t\t\tReact.useEffect(() => {\r\n\t\t\t\treturn this.subscribe(actionType, data => {\r\n\t\t\t\t\tif (typeof (condition) === \"function\") {\r\n\t\t\t\t\t\tif (condition(data)) {\r\n\t\t\t\t\t\t\tforceUpdate();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse forceUpdate();\r\n\t\t\t\t});\r\n\t\t\t}, deps);\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport const dispatcher = new Dispatcher;","import _ from \"lodash\";\r\nimport { ActionTypes, UserStatus } from \"../../Constants\";\r\nimport Database from \"../../Database\";\r\nimport { dispatcher } from \"../../Dispatcher\";\r\nimport Store from \"../../Store\";\r\nimport User from \"../User\";\r\nimport CirlosLogo from \"../../../Assets/Logo.svg\";\r\n\r\nlet localUser;\r\nconst cache = {\r\n\t\"SYSTEM\": new User({\r\n\t\tid: \"SYSTEM\",\r\n\t\tdisplayName: \"System\",\r\n\t\tstatus: UserStatus.BOT,\r\n\t\tavatarUrl: CirlosLogo,\r\n\t\tprofileBackgroundNsfw: \"https://c.tenor.com/Z6gmDPeM6dgAAAAC/dance-moves.gif\",\r\n\t\tfeed: \"Giving friendly welcomes and farewells. \"\r\n\t})\r\n};\r\n\r\nconst UserStoreClass = class UserStore extends Store {\r\n\tgetLocalUser() {\r\n\t\treturn localUser;\r\n\t}\r\n\r\n\tgetUser(userId) {\r\n\t\treturn cache[userId] ?? (\r\n\t\t\tthis.fetchUser(userId),\r\n\t\t\tcache[userId] = new User({\r\n\t\t\t\tid: userId,\r\n\t\t\t\tloading: true,\r\n\t\t\t\tdisplayName: \"...\"\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tgetUsers() {\r\n\t\treturn cache;\r\n\t}\r\n\r\n\tfetchUser(userId, oneTime = false) {\r\n\t\tif (!userId) return null;\r\n\r\n\t\treturn new Promise(r => {\r\n\t\t\tconst unbind = Database.createSnapshotListener(\r\n\t\t\t\tDatabase.doc(\"userdata\", userId),\r\n\t\t\t\tdoc => {\r\n\t\t\t\t\tif (cache[userId]?.loading) {\r\n\t\t\t\t\t\tdelete cache[userId];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst user = doc\r\n\t\t\t\t\t\t? _.extend(cache[userId] ?? new User(), doc)\r\n\t\t\t\t\t\t: new User({\r\n\t\t\t\t\t\t\tid: userId,\r\n\t\t\t\t\t\t\tdisplayName: \"Deleted User\"\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\ttype: ActionTypes.USER_UPDATE,\r\n\t\t\t\t\t\tuser\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\toneTime && unbind();\r\n\r\n\t\t\t\t\tr(user);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nconst UserStore = new UserStoreClass(dispatcher, {\r\n\t[ActionTypes.LOCAL_USER_UPDATE]: ({ user }) => {\r\n\t\tlocalUser = user;\r\n\t},\r\n\t[ActionTypes.USER_UPDATE]: ({ user }) => {\r\n\t\tcache[user.id] = user;\r\n\t}\r\n});\r\n\r\nexport default UserStore;","export default __webpack_public_path__ + \"static/media/Logo.8c80fb7a.svg\";","import { initializeApp } from \"firebase/app\";\r\nimport { getAuth } from \"firebase/auth\";\r\nimport { getStorage, ref as storageRef, getDownloadURL, uploadBytes } from \"firebase/storage\";\r\nimport { getFirestore, doc, getDoc, setDoc, updateDoc, collection, onSnapshot, getDocs, DocumentReference, deleteDoc } from \"firebase/firestore\";\r\nimport React from \"react\";\r\nimport _, { set } from \"lodash\";\r\n\r\nconst config = {\r\n\tapiKey: \"AIzaSyCWL2SBBGhjsKq922QaI2W6XwDEeFZ-YQY\",\r\n\tauthDomain: \"www.cirlos.net\",\r\n\tprojectId: \"cirlos\",\r\n\tstorageBucket: \"cirlos.appspot.com\",\r\n\tmessagingSenderId: \"624454143510\",\r\n\tappId: \"1:624454143510:web:beb8a88238bc3b9ea72f37\",\r\n\tmeasurementId: \"G-ZYXVMY55WD\",\r\n\ttosUrl: \"https://www.cirlos.net/terms\",\r\n\tprivacyPolicyUrl: \"https://www.cirlos.net/privacy\"\r\n};\r\n\r\n// if (!firebase.apps.length)\r\n//     firebase.initializeApp(firebaseConfig);\r\n// firebase.analytics();\r\n// firebase.appCheck().activate(\"6LcWSkAbAAAAAL8MhDO1Fq5K7VyJYEEt7TvNu8m4\");\r\n\r\n// Long story short, I fucking hate the new Firebase API. (V9)\r\n// This is my attempt at at least making it tolerable.\r\nexport default new class Database {\r\n\tapp = initializeApp(config);\r\n\tauth = getAuth();\r\n\tdb = getFirestore();\r\n\tstorage = getStorage();\r\n\tstorageCache = {};\r\n\r\n\tconstructor() {\r\n\t\tObject.freeze(this);\r\n\t}\r\n\r\n\tdoc(...path) { return doc(this.db, ...path); }\r\n\tcollection(...path) { return collection(this.db, ...path); }\r\n\r\n\tformatDocument(ref, snapshot) {\r\n\t\treturn snapshot ? {\r\n\t\t\t_ref: ref,\r\n\t\t\t_snapshot: snapshot,\r\n\t\t\tid: snapshot.id,\r\n\t\t\t...snapshot.data()\r\n\t\t} : null;\r\n\t}\r\n\r\n\tasync getDoc(ref) {\r\n\t\tconst snapshot = await getDoc(ref);\r\n\t\tif (!snapshot.exists()) return null;\r\n\r\n\t\treturn this.formatDocument(ref, snapshot);\r\n\t}\r\n\r\n\tasync getDocs(ref) {\r\n\t\tconst snapshot = await getDocs(ref);\r\n\r\n\t\treturn snapshot.docs.map(\r\n\t\t\tdoc => (\r\n\t\t\t\tthis.formatDocument(doc.ref, doc)\r\n\t\t\t)\r\n\t\t);\r\n\t}\r\n\r\n\tcreateSnapshotListener(ref, callback, options = {}) {\r\n\t\tlet { onReady } = options;\r\n\r\n\t\tconst unbind = onSnapshot(ref, _snapshot => {\r\n\t\t\tconst snapshot = ref instanceof DocumentReference\r\n\t\t\t\t? this.formatDocument(ref, _snapshot)\r\n\t\t\t\t: {\r\n\t\t\t\t\tchanges: _snapshot.docChanges().map(change => ({\r\n\t\t\t\t\t\t...change,\r\n\t\t\t\t\t\tdata: this.formatDocument(change.doc.ref, change.doc)\r\n\t\t\t\t\t})),\r\n\t\t\t\t\titems: _snapshot.docs.map(doc => this.formatDocument(doc.ref, doc))\r\n\t\t\t\t};\r\n\r\n\t\t\tif (snapshot) {\r\n\t\t\t\tsnapshot._unbindListener = unbind;\r\n\t\t\t}\r\n\r\n\t\t\tcallback(snapshot);\r\n\r\n\t\t\tonReady?.(snapshot);\r\n\t\t\tonReady = null;\r\n\t\t});\r\n\r\n\t\treturn unbind;\r\n\t}\r\n\r\n\tget useSnapshot() {\r\n\t\treturn (ref, options = {}) => {\r\n\t\t\tconst { processor } = options;\r\n\t\t\tconst [data, setData] = React.useState(undefined);\r\n\r\n\t\t\tReact.useEffect(() => {\r\n\t\t\t\treturn this.createSnapshotListener(ref, async data => {\r\n\t\t\t\t\tif (typeof (processor) !== \"function\") return setData(data);\r\n\r\n\t\t\t\t\tif (Array.isArray(data.items)) {\r\n\t\t\t\t\t\tfor (const i in data.items) {\r\n\t\t\t\t\t\t\tdata.items[i] = await processor(data.items[i]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse data = await processor(data);\r\n\r\n\t\t\t\t\tsetData(data);\r\n\t\t\t\t}, options);\r\n\t\t\t}, []);\r\n\r\n\t\t\treturn data;\r\n\t\t};\r\n\t}\r\n\r\n\tserializeObject(obj) {\r\n\t\treturn _.omit({ ...obj }, [\r\n\t\t\t\"_ref\",\r\n\t\t\t\"_snapshot\",\r\n\t\t\t\"_unbindListener\",\r\n\t\t\t\"id\"\r\n\t\t]);\r\n\t}\r\n\r\n\tasync set(ref, data) {\r\n\t\treturn await setDoc(ref, this.serializeObject(data))\r\n\t\t\t.catch(e => console.error(`Error setting doc data at \"${ref.path}\"\\n${e.stack}`));\r\n\t}\r\n\r\n\tasync delete(ref, data) {\r\n\t\treturn await deleteDoc(ref)\r\n\t\t\t.catch(e => console.error(`Error deleting doc at \"${ref.path}\"\\n${e.stack}`));\r\n\t}\r\n\r\n\tasync update(ref, data) {\r\n\t\treturn await updateDoc(ref, this.serializeObject(data))\r\n\t\t\t// .catch(() => this.set(ref, data))\r\n\t\t\t.catch(e => console.error(`Error updating doc data at \"${ref.path}\"\\n${e.stack}`));\r\n\t}\r\n\r\n\t// Storage\r\n\tasync getStorageUrl(...pathSegments) {\r\n\t\tconst path = pathSegments.join(\"/\");\r\n\t\t// if (this.storageCache[path]) return this.storageCache[path];\r\n\r\n\t\tconst ref = storageRef(this.storage, path);\r\n\t\tconst url = await getDownloadURL(ref);\r\n\r\n\t\treturn this.storageCache[path] = url;\r\n\t}\r\n\r\n\tuploadStorage(file, ...pathSegments) {\r\n\t\tconst path = pathSegments.join(\"/\");\r\n\t\tconst ref = storageRef(this.storage, path);\r\n\r\n\t\treturn uploadBytes(ref, file).then(async result => ({\r\n\t\t\tresult,\r\n\t\t\turl: await this.getStorageUrl(...pathSegments)\r\n\t\t}));\r\n\t}\r\n}","import React from \"react\";\r\nimport \"./LinkWrapper.scss\";\r\n\r\nexport default class extends React.Component {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<a className=\"LinkWrapper\" {...this.props}>\r\n\t\t\t\t{ this.props.children }\r\n\t\t\t</a>\r\n\t\t);\r\n\t}\r\n}","import React from \"react\";\r\nimport \"./Modals.scss\";\r\nimport ErrorBoundary from \"./ErrorBoundary\";\r\nimport Toasts from \"./Toasts\";\r\nimport InlineLoading from \"./InlineLoading\";\r\nimport { joinClassNames } from \"../Classes/Constants\";\r\nimport Tooltip from \"./Tooltip\";\r\nimport LinkWrapper from \"./LinkWrapper\";\r\nimport * as Feather from \"react-feather\";\r\n\r\n/**\r\n * Pushes a component to the modal stack.\r\n * @deprecated Use Modals.push(modal) instead.\r\n * @param modal The React component modal.\r\n */\r\nexport function openModal(modal) {\r\n\tModals.push(modal);\r\n}\r\n\r\n/**\r\n * Close the last modal in the stack.\r\n * @deprecated Use Modals.pop() instead.\r\n */\r\nexport function closeModal() {\r\n\tModals.pop().catch(console.error.bind(console, \"Failed to pop modal!\"));\r\n}\r\n\r\n/**\r\n * Copies the specified text to the clipboard\r\n * @param text The text to copy.\r\n * @returns {Promise<void>}\r\n */\r\nexport async function copyToClipboard(text) {\r\n\ttry {\r\n\t\tawait window.navigator.clipboard.writeText(text);\r\n\r\n\t\tToasts.showToast(<span><b>{text.length >= 100 ? text.substr(0, 100) + \"...\" : text}</b> copied to clipboard</span>, \"Success\");\r\n\t}\r\n\tcatch (e) {\r\n\t\topenStringModal({\r\n\t\t\ttitle: \"Failed To Copy\",\r\n\t\t\tdescription: \"Your browser does not support copying to clipboard, you can manually copy here.\",\r\n\t\t\tvalue: text\r\n\t\t});\r\n\t}\r\n}\r\n\r\n// TODO update this\r\nexport function ImageModal({ url, getSources }) {\r\n\t// Get the sources or create a single-item array\r\n\tconst sources = typeof (getSources) === \"function\" ? getSources().filter(u => u) : [url];\r\n\r\n\t// Create a state based on the index of the current url\r\n\tconst [index, setIndex] = React.useState(sources.indexOf(url));\r\n\t// Create a navigate function to handle safely navigating images\r\n\tconst nav = dir =>\r\n\t\tsources[index + dir]\r\n\t\t\t? (setLoaded(false), setFailed(false), setIndex(index + dir))\r\n\t\t\t: Toasts.showToast(\"No more images in this direction!\", \"Failure\");\r\n\t// Create an expanded state based on the serialized settings state\r\n\tconst [expanded, setExpandedState] = React.useState(false);\r\n\r\n\t// These are placeholders, I'm too lazy to add them\r\n\tconst [loading, setLoaded] = React.useState(false);\r\n\tconst [failed, setFailed] = React.useState(false);\r\n\r\n\t// Render bender\r\n\treturn (\r\n\t\t<div className=\"ImageModal\" onClick={e => e.target === e.currentTarget && Modals.pop()}>\r\n\t\t\t<div className={joinClassNames(\"ImageContainer\", [expanded, \"Expanded\"])}\r\n\t\t\t\tonMouseDown={Modals.pop.bind(Modals)}>\r\n\t\t\t\t<img src={sources[index]} alt=\"Image failed to load\"\r\n\t\t\t\t\tonLoad={() => (setLoaded(true), setFailed(false))}\r\n\t\t\t\t\tonError={() => (setLoaded(true), setFailed(true))} />\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"Footer\">\r\n\t\t\t\t<div className={joinClassNames(\"Button Arrow Left\",\r\n\t\t\t\t\t[!sources.length || !index, \"Disabled\"])} onClick={() => nav(-1)}>\r\n\t\t\t\t\t<Feather.ChevronLeft />\r\n\t\t\t\t\t<Tooltip>Previous Image</Tooltip>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"Divider\" />\r\n\r\n\t\t\t\t<div className=\"Filename\">{\r\n\t\t\t\t\tsources[index].split(\"?\")[0].split(\"/\").slice(-1)[0].split(\"_\").slice(-1)[0].replaceAll(\"%20\", \" \")\r\n\t\t\t\t}</div>\r\n\r\n\t\t\t\t<div className=\"Divider\" />\r\n\r\n\t\t\t\t<div className=\"Button\" onClick={() => (setExpandedState(!expanded))}>\r\n\t\t\t\t\t{expanded ? <Feather.Minimize2 /> : <Feather.Maximize2 />}\r\n\t\t\t\t\t<Tooltip>{expanded ? \"Compress\" : \"Expand\"}</Tooltip>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"Button\">\r\n\t\t\t\t\t<Feather.Clipboard />\r\n\t\t\t\t\t<Tooltip>Copy URL</Tooltip>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<LinkWrapper className=\"Button\" style={{ display: \"block\", color: \"white\" }}\r\n\t\t\t\t\thref={sources[index]}>\r\n\t\t\t\t\t<Feather.ExternalLink />\r\n\t\t\t\t\t<Tooltip>Open In Browser</Tooltip>\r\n\t\t\t\t</LinkWrapper>\r\n\r\n\t\t\t\t<div className=\"Divider\" />\r\n\r\n\t\t\t\t<div className={joinClassNames(\"Button Arrow Right\",\r\n\t\t\t\t\t[!sources.length || index + 1 >= sources.length, \"Disabled\"])} onClick={() => nav(1)}>\r\n\t\t\t\t\t<Feather.ChevronRight />\r\n\t\t\t\t\t<Tooltip>Next Image</Tooltip>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n/**\r\n * Pushes an image modal to the modal stack.\r\n * @param url The URI for the image to focus.\r\n * @param getSources? An option callback function that returns an array of URIs.\r\n */\r\nexport function openImageModal(url, getSources = null) {\r\n\tModals.push(<ImageModal url={url} getSources={getSources} />);\r\n}\r\n\r\n/**\r\n * Displays a two-choice modal to the user.\r\n * @param title\r\n * @param description\r\n * @param yesText\r\n * @param noText\r\n * @param yesColor\r\n * @param noColor\r\n * @returns {Promise<boolean>}\r\n */\r\nexport async function openBoolModal({\r\n\ttitle = \"\",\r\n\tdescription = \"\",\r\n\tyesText = \"Yes\",\r\n\tnoText = \"No\",\r\n\tyesColor = \"var(--busy-color)\",\r\n\tnoColor = \"\"\r\n}) {\r\n\tconst response = await new Promise(resolve => {\r\n\t\tModals.push(\r\n\t\t\t<div className=\"BoolModal PrimaryBg\">\r\n\t\t\t\t<div className=\"Title\" dangerouslySetInnerHTML={{ __html: title }} />\r\n\t\t\t\t<div className=\"Description\" dangerouslySetInnerHTML={{ __html: description }} />\r\n\r\n\t\t\t\t<div className=\"Footer\">\r\n\t\t\t\t\t<div className=\"Button TertiaryBg\" onClick={() => resolve(false)} style={{ backgroundColor: noColor }}>{noText}</div>\r\n\t\t\t\t\t<div className=\"Button TertiaryBg\" onClick={() => resolve(true)} style={{ backgroundColor: yesColor }}>{yesText}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\r\n\tModals.pop();\r\n\r\n\treturn response;\r\n}\r\n\r\n/**\r\n * Displays a string choice modal to the user.\r\n * @param options\r\n * @returns {Promise<string | null>}\r\n */\r\nexport async function openStringModal(options = {}) {\r\n\tconst { async = false } = options;\r\n\r\n\tconst response = await new Promise(resolve => {\r\n\t\tModals.push(\r\n\t\t\t<StringModal resolve={resolve} {...options} />\r\n\t\t);\r\n\t});\r\n\r\n\t!async && Modals.pop();\r\n\r\n\treturn response;\r\n}\r\n\r\nexport class Modals extends React.Component {\r\n\tstatic instance;\r\n\r\n\t/**\r\n\t * Pushes a component to the modal stack.\r\n\t * @param modal The React component modal.\r\n\t */\r\n\tstatic push(modal) {\r\n\t\tthis.instance.setState({ stack: [...this.instance.state.stack, modal] });\r\n\t}\r\n\r\n\t/**\r\n\t * Closes the last modal in the stack.\r\n\t * @returns {Promise<void>}\r\n\t */\r\n\tstatic async pop() {\r\n\t\t// Destructure the instance state\r\n\t\tconst { stack, closing } = this.instance.state;\r\n\t\tconst modal = stack[stack.length - 1];\r\n\r\n\t\t// If there is nothing to close, return\r\n\t\tif (!stack.length || !modal) return;\r\n\r\n\t\t// Push the modal to the closing state, activating the transition\r\n\t\tthis.instance.setState({ closing: [...closing, modal] });\r\n\r\n\t\t// Wait for the transition\r\n\t\tawait new Promise(r => setTimeout(r, 150));\r\n\r\n\t\t// Set the new state, removing the modal from both stack states\r\n\t\tthis.instance.setState({\r\n\t\t\tstack: this.instance.state.stack.filter(m => m !== modal),\r\n\t\t\tclosing: this.instance.state.closing.filter(m => m !== modal)\r\n\t\t});\r\n\t}\r\n\r\n\tstate = { stack: [], closing: [] };\r\n\r\n\tcomponentDidMount() {\r\n\t\t// Assign the static instance variable\r\n\t\tModals.instance = this;\r\n\r\n\t\tdocument.addEventListener(\"keydown\", this.handleKey);\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tdocument.removeEventListener(\"keydown\", this.handleKey);\r\n\t}\r\n\r\n\thandleKey = e => {\r\n\t\tif (e.key === \"Escape\") {\r\n\t\t\tModals.pop();\r\n\t\t}\r\n\t};\r\n\r\n\thandleBackdropClick(e) {\r\n\t\t// Ensure that we're actually clicking the modal background\r\n\t\tif (e.target !== e.currentTarget) return;\r\n\r\n\t\t// If the modal has an on backdrop click prop, run it and return\r\n\t\tconst { stack } = this.state;\r\n\t\tif (stack[stack.length - 1] && typeof (stack[stack.length - 1].props?.onBackdropClick) === \"function\")\r\n\t\t\treturn stack[stack.length - 1].props.onBackdropClick();\r\n\r\n\t\t// K I L L\r\n\t\tModals.pop().catch(console.error.bind(console, \"Failed to pop modal!\"));\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { stack, closing } = this.state;\r\n\r\n\t\treturn (\r\n\t\t\t<div className={\"ModalStack\" + (stack.length > closing.length ? \" Active\" : \"\")}>\r\n\t\t\t\t{stack.map((modal, id) => (\r\n\t\t\t\t\t<ErrorBoundary>\r\n\t\t\t\t\t\t<div className={\"ModalContainer\" +\r\n\t\t\t\t\t\t\t(~closing.indexOf(modal) || id < stack.length - 1 ? \" Closing\" : \"\")}\r\n\t\t\t\t\t\t\tkey={id}\r\n\t\t\t\t\t\t\tonMouseDown={this.handleBackdropClick.bind(this)}\r\n\t\t\t\t\t\t\tstyle={{ zIndex: id * 10 }}>{modal}</div>\r\n\t\t\t\t\t</ErrorBoundary>\r\n\t\t\t\t))}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport function StringModal(props) {\r\n\tconst { title = \"\", description = \"\", yesText = \"Confirm\", noText = \"Cancel\", yesColor = \"\", noColor = \"\", value = \"\", onChange = null, rich = false, resolve, id } = props;\r\n\tconst [no, setNoState] = React.useState(false);\r\n\tconst [yes, setYesState] = React.useState(false);\r\n\r\n\treturn (\r\n\t\t<div className=\"StringModal PrimaryBg\">\r\n\t\t\t<div className=\"Title\" dangerouslySetInnerHTML={{ __html: title }} />\r\n\t\t\t<div className=\"Description\" dangerouslySetInnerHTML={{ __html: description }} />\r\n\r\n\t\t\t<input id={id} className=\"Field TertiaryBg\" defaultValue={value} onChange={onChange} />\r\n\r\n\t\t\t<div className=\"Footer\">\r\n\t\t\t\t<div className=\"Button TertiaryBg\" onClick={() => (resolve(null), setNoState(true))} style={{ backgroundColor: noColor }}>{no ? <InlineLoading /> : noText}</div>\r\n\t\t\t\t<div className=\"Button TertiaryBg\" onClick={() => (resolve(document.getElementById(id).value), setYesState(true))} style={{ backgroundColor: yesColor }}>{yes ? <InlineLoading /> : yesText}</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","export default class Timer {\r\n    id;\r\n    startTime;\r\n    remainingTime;\r\n    callback;\r\n    duration;\r\n    \r\n    constructor(callback, duration, playAutomatically = true) {\r\n        this.callback = callback;\r\n        this.duration = duration;\r\n        this.remainingTime = duration;\r\n        \r\n        if (playAutomatically)\r\n            this.resume();\r\n    }\r\n    \r\n    resume() {\r\n        this.startTime = Date.now();\r\n        \r\n        clearTimeout(this.id);\r\n        this.id = setTimeout(this.callback, this.remainingTime);\r\n    }\r\n    \r\n    pause() {\r\n        clearTimeout(this.id);\r\n        this.remainingTime -= Date.now() - this.startTime;\r\n    }\r\n    \r\n    end() {\r\n        clearTimeout(this.id);\r\n        this.callback();\r\n    }\r\n}","import React from \"react\";\r\nimport \"./Toasts.scss\";\r\nimport { getRandomKey, joinClassNames } from \"../Classes/Constants\";\r\nimport Timer from \"../Classes/TimerClass\";\r\n\r\nexport function Toast({ children, type, life, remove, callback, color, fixedTime = false }) {\r\n\tconst handleRemove = () => {\r\n\t\tsetClosing(true);\r\n\r\n\t\tsetTimeout(remove, 500);\r\n\t};\r\n\t\r\n\tconst [closing, setClosing] = React.useState(false);\r\n\tconst timer = React.useMemo(() => new Timer(handleRemove, life * 1000, false), []);\r\n\tconst progressBar = React.useRef();\r\n\t\r\n\tconst handleMouseEnter = () => {\r\n\t\ttimer.pause();\r\n\t\tprogressBar.current.style.animationPlayState = \"paused\";\r\n\t};\r\n\t\r\n\tconst handleMouseLeave = () => {\r\n\t\ttimer.resume();\r\n\t\tprogressBar.current.style.animationPlayState = \"running\";\r\n\t};\r\n\t\r\n\tReact.useEffect(() => {\r\n\t\tconst handleFocus = () => !fixedTime && handleMouseLeave();\r\n\t\tconst handleBlur = () => !fixedTime && handleMouseEnter();\r\n\t\t\r\n\t\twindow.addEventListener(\"focus\", handleFocus);\r\n\t\twindow.addEventListener(\"blur\", handleBlur);\r\n\t\t\r\n\t\t(fixedTime || document.hasFocus()) && handleMouseLeave();\r\n\t\t\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener(\"focus\", handleFocus);\r\n\t\t\twindow.removeEventListener(\"blur\", handleBlur);\r\n\t\t};\r\n\t});\r\n\t\r\n\treturn (\r\n\t\t<div className={joinClassNames(\"Toast\", [closing, \"Closing\"], type)}\r\n\t\t\t onMouseEnter={fixedTime ? null : handleMouseEnter}\r\n\t\t\t onMouseLeave={fixedTime ? null : handleMouseLeave}\r\n\t\t\t onClick={callback ? e => { callback(e); timer.end(); } : () => { timer.end(); }}\r\n\t\t\t style={{ cursor: callback ? \"pointer\" : null, backgroundColor: color }}>\r\n\t\t\t{ children }\r\n\r\n\t\t\t<div className=\"ProgressBarContainer\">\r\n\t\t\t\t<div ref={progressBar} className=\"ProgressBar\" style={{ animationDuration: life + \"s\" }}/>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default class Toasts extends React.Component {\r\n\tstatic instance;\r\n\tstatic ref = React.createRef();\r\n\t\r\n\tstate = { toasts: [] };\r\n\r\n\tcomponentDidMount() {\r\n\t\tToasts.instance = this;\r\n\t}\r\n\t\r\n\tstatic showToast(children, type = \"\", life = 5, additionalOptions = {}) {\r\n\t\tconst { callback = null, color = null, fixedTime = false } = additionalOptions;\r\n\t\t\r\n\t\tconst toast = React.createElement(Toast, {\r\n\t\t\tkey: getRandomKey(),\r\n\t\t\tchildren, type, life, color, fixedTime,\r\n\t\t\tremove: () => {\r\n\t\t\t\tthis.instance.setState({ toasts: this.instance.state.toasts.filter(t => t !== toast) });\r\n\t\t\t},\r\n\t\t\tcallback\r\n\t\t});\r\n\r\n\t\tthis.instance.setState({ toasts: [ ...this.instance.state.toasts, toast ] });\r\n\t\treturn toast;\r\n\t}\r\n\t\r\n\tget horizontalStyle() {\r\n\t\treturn \"Center\";\r\n\t\t\r\n\t\t// switch (Settings.props.notifications.toasts.positionX) {\r\n\t\t// \tcase 0:\r\n\t\t// \t\treturn \"Left\";\r\n\t\t// \tcase 1:\r\n\t\t// \t\treturn \"Center\";\r\n\t\t// \tcase 2:\r\n\t\t// \t\treturn \"Right\";\r\n\t\t// }\r\n\t}\r\n\t\r\n\tget verticalStyle() {\r\n\t\treturn \"Bottom\";\r\n\t\t\r\n\t\t// switch (Settings.props.notifications.toasts.positionY) {\r\n\t\t// \tcase 0:\r\n\t\t// \t\treturn \"Top\";\r\n\t\t// \tcase 1:\r\n\t\t// \t\treturn \"Bottom\";\r\n\t\t// }\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div ref={Toasts.ref} className={joinClassNames(\"ToastsContainer\", this.horizontalStyle, this.verticalStyle)}>\r\n\t\t\t\t<div className={joinClassNames(\"ClearButton\", [!!this.state.toasts?.length, \"Visible\"])} onClick={() => this.setState({ toasts: [] })}>\r\n\t\t\t\t\t<u>Close all</u>\r\n\t\t\t\t</div>\r\n\t\t\t\t\r\n\t\t\t\t{ this.state.toasts }\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}","import { doc, limitToLast, orderBy, query } from \"@firebase/firestore\";\r\nimport _ from \"lodash\";\r\nimport { appHashArgs } from \"../../../App\";\r\nimport { ActionTypes } from \"../../Constants\";\r\nimport Database from \"../../Database\";\r\nimport { dispatcher } from \"../../Dispatcher\";\r\nimport Store from \"../../Store\";\r\nimport Group, { GroupDm } from \"../Group\";\r\nimport CircleStore from \"./CircleStore\";\r\nimport UserStore from \"./UserStore\";\r\n\r\nconst cache = {};\r\nconst groupListeners = {};\r\n\r\nconst GroupStoreClass = class GroupStore extends Store {\r\n\tgetGroup(circleId, groupId) {\r\n\t\tif (circleId === \"*\") {\r\n\t\t\tfor (const circleId in cache) {\r\n\t\t\t\tconst group = cache[circleId][groupId];\r\n\r\n\t\t\t\tif (group) return group;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn _.get(cache, [circleId, groupId]);\r\n\t}\r\n\r\n\tgetSelectedGroup() {\r\n\t\tif (appHashArgs[0] === \"dms\")\r\n\t\t\treturn this.getGroup(\"dms\", appHashArgs[1]);\r\n\r\n\t\treturn this.getGroup(appHashArgs[1], appHashArgs[3]);\r\n\t}\r\n\r\n\tgetGroups(circleId) {\r\n\t\tif (!cache[circleId]) {\r\n\t\t\tthis.fetchGroups(circleId);\r\n\t\t}\r\n\r\n\t\treturn cache[circleId];\r\n\t}\r\n\r\n\tasync fetchGroups(circleId) {\r\n\t\tif (groupListeners[circleId]) return;\r\n\t\tif (circleId === \"dms\") return await this.fetchDms();\r\n\r\n\t\tconst circle = CircleStore.getCircle(circleId);\r\n\t\tif (!circle) return console.error(\r\n\t\t\t`Can't fetch groups for uncached circle with ID \"${circleId}\"!`\r\n\t\t);\r\n\r\n\t\t// TODO make sure this actually completes\r\n\t\twhile (circle.loading)\r\n\t\t\tawait new Promise(r => setTimeout(r, 100));\r\n\r\n\t\treturn new Promise(r => {\r\n\t\t\tconst unbind = Database.createSnapshotListener(\r\n\t\t\t\tDatabase.collection(\"circles\", circleId, \"groups\"),\r\n\t\t\t\t({ items = [] } = {}) => {\r\n\t\t\t\t\tfor (const doc of items) {\r\n\t\t\t\t\t\tconst group = _.extend(\r\n\t\t\t\t\t\t\t_.get(cache, [circleId, doc.id]) ?? new Group(),\r\n\t\t\t\t\t\t\tdoc,\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tparent: circle.groupPositions?.[doc.id]?.[0],\r\n\t\t\t\t\t\t\t\tposition: circle.groupPositions?.[doc.id]?.[1]\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\t\ttype: ActionTypes.GROUP_UPDATE,\r\n\t\t\t\t\t\t\tcircle,\r\n\t\t\t\t\t\t\tgroup\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\ttype: ActionTypes.CIRCLE_UPDATE_GROUPS,\r\n\t\t\t\t\t\tcircle,\r\n\t\t\t\t\t\tgroups: cache[circleId]\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tr(cache[circleId]);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tgroupListeners[circleId] = unbind;\r\n\t\t});\r\n\t}\r\n\r\n\tasync fetchDms() {\r\n\t\tlet user;\r\n\t\twhile (!(user = UserStore.getLocalUser()))\r\n\t\t\tawait new Promise(r => setTimeout(r, 100));\r\n\r\n\t\treturn new Promise(r => {\r\n\t\t\tconst unbind = Database.createSnapshotListener(\r\n\t\t\t\tquery(\r\n\t\t\t\t\tDatabase.collection(\"userdata\", user.id, \"dms\"),\r\n\t\t\t\t\torderBy(\"lastMessageDate\", \"desc\")\r\n\t\t\t\t),\r\n\t\t\t\t({ items = [] } = {}) => {\r\n\t\t\t\t\tfor (const doc of items) {\r\n\t\t\t\t\t\tconst group = _.extend(\r\n\t\t\t\t\t\t\t_.get(cache, [\"dms\", doc.id]) ?? new GroupDm(),\r\n\t\t\t\t\t\t\tdoc,\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tcircleId: \"dms\",\r\n\t\t\t\t\t\t\t\tisDm: true,\r\n\t\t\t\t\t\t\t\tuserId: doc.id\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\t\ttype: ActionTypes.DM_UPDATE,\r\n\t\t\t\t\t\t\tgroup,\r\n\t\t\t\t\t\t\tuserId: doc.id\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\ttype: ActionTypes.BATCH_UPDATE_DMS,\r\n\t\t\t\t\t\tgroups: cache.dms\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tr(cache.dms);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tgroupListeners.dms = unbind;\r\n\t\t});\r\n\t}\r\n}\r\n\r\nconst GroupStore = new GroupStoreClass(dispatcher, {\r\n\t[ActionTypes.GROUP_UPDATE]: ({ circle, group }) => {\r\n\t\t_.set(cache, [circle.id, group.id], group);\r\n\t},\r\n\t[ActionTypes.DM_UPDATE]: ({ group, userId }) => {\r\n\t\t_.set(cache, [\"dms\", userId], group);\r\n\t}\r\n});\r\n\r\nexport default GroupStore;","var _defs, _g;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgWaveVector(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    xmlnsXlink: \"http://www.w3.org/1999/xlink\",\n    style: {\n      isolation: \"isolate\"\n    },\n    viewBox: \"0 0 3840 1080\",\n    width: \"3840pt\",\n    height: \"1080pt\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _defs || (_defs = /*#__PURE__*/React.createElement(\"defs\", null, /*#__PURE__*/React.createElement(\"clipPath\", {\n    id: \"_clipPath_9ysGc3cj8hVy9CQFlwXLbt9IIMadCtby\"\n  }, /*#__PURE__*/React.createElement(\"rect\", {\n    width: 3840,\n    height: 1080\n  })))), _g || (_g = /*#__PURE__*/React.createElement(\"g\", {\n    clipPath: \"url(#_clipPath_9ysGc3cj8hVy9CQFlwXLbt9IIMadCtby)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \" M 0 540 Q 440.909 859.091 960 540 Q 1479.091 220.909 1920 540 L 1920 1080 L 0 1080 L 0 540 Z \",\n    fill: \"currentColor\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \" M 1920 540 Q 2360.909 859.091 2880 540 Q 3399.091 220.909 3840 540 L 3840 1080 L 1920 1080 L 1920 540 Z \",\n    fill: \"currentColor\"\n  }))));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgWaveVector);\nexport default __webpack_public_path__ + \"static/media/WaveVector.d8601ff9.svg\";\nexport { ForwardRef as ReactComponent };","export default __webpack_public_path__ + \"static/media/TwemojiHeart.a32c5071.svg\";","import React from \"react\";\r\nimport \"./PageFooter.scss\";\r\nimport * as Feather from \"react-feather\";\r\n\r\nimport Icon from \"../../Assets/icon50x50.png\";\r\nimport Heart from \"../../Assets/TwemojiHeart.svg\";\r\nimport Tooltip from \"../Tooltip\";\r\nimport { copyToClipboard } from \"../Modals\";\r\n\r\nexport default function PageFooter() {\r\n    const contacts = {\r\n        website: () => window.open(\"https://metalloriff.github.io/\", \"_blank\"),\r\n        github: () => window.open(\"https://github.com/metalloriff\", \"_blank\"),\r\n        twitter: () => window.open(\"https://twitter.com/Metalloriff\", \"_blank\"),\r\n        email: () => window.open(\"mailto:metalloriff@gmail.com\", \"_blank\"),\r\n        discord: () => copyToClipboard(\"Metalloriff #2891\")\r\n    };\r\n    \r\n    return (\r\n        <footer>\r\n            <div className=\"Flex\">\r\n                <div className=\"LeftSections\">\r\n                    <div className=\"HeadSection FlexCenter\">\r\n                        <img className=\"Logo\" src={Icon} alt=\"Logo\"/>\r\n\r\n                        <div>\r\n                            <h2>Metalloriff</h2>\r\n                            <div>\r\n                                Made with <img src={Heart} alt=\"\" width={15} height={15}/>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"ContactSection Flex\">\r\n                        <div className=\"ContactEntry\" onClick={contacts.website}>\r\n                            <Feather.Globe/>\r\n                            <Tooltip>Website</Tooltip>\r\n                        </div>\r\n\r\n                        <div className=\"ContactEntry\" onClick={contacts.github}>\r\n                            <Feather.GitHub/>\r\n                            <Tooltip>GitHub</Tooltip>\r\n                        </div>\r\n\r\n                        <div className=\"ContactEntry\" onClick={contacts.twitter}>\r\n                            <Feather.Twitter/>\r\n                            <Tooltip>Twitter</Tooltip>\r\n                        </div>\r\n\r\n                        <div className=\"ContactEntry\" onClick={contacts.email}>\r\n                            <Feather.Mail/>\r\n                            <Tooltip>Email</Tooltip>\r\n                        </div>\r\n\r\n                        <div className=\"ContactEntry\" onClick={contacts.discord}>\r\n                            <Feather.MessageSquare/>\r\n                            <Tooltip>Discord</Tooltip>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                \r\n                <div className=\"MiddleSection\">\r\n                    {/*  TODO add some shit here.  */}\r\n                </div>\r\n                \r\n                <div className=\"RightSections FlexCenter\">\r\n                    <div className=\"LinksSection\">\r\n                        <a href=\"#clearlyiforgottoaddthis\">Source Code</a>\r\n                        <a href=\"https://feathericons.com/\">Icons Used</a>\r\n                        <a href=\"https://metalloriff.github.io/city-fog\">Color Palette</a>\r\n                        <a href=\"https://paypal.me/israelboone\">\r\n                            <img src={Heart} alt=\"\" width={15} height={15}/>\r\n                            <span style={{ margin: \"0 7px\" }}>Donate</span>\r\n                            <img src={Heart} alt=\"\" width={15} height={15}/>\r\n                        </a>\r\n                        \r\n                        <div className=\"Copyright\">\r\n                            Copyright  {new Date().getFullYear()} Israel Boone\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </footer>\r\n    );\r\n}","export default \"data:image/png;base64,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\"","import React from \"react\";\r\nimport \"./Home.scss\";\r\n\r\nimport { ReactComponent as WaveVector } from \"../Assets/WaveVector.svg\";\r\nimport * as Feather from \"react-feather\";\r\nimport { Modals } from \"../Components/Modals\";\r\nimport AuthModal from \"../Components/Modals/AuthModal\";\r\nimport UserStore from \"../Classes/Types/Stores/UserStore\";\r\nimport PageFooter from \"../Components/PageElements/PageFooter\";\r\n\r\nexport default function HomePage() {\r\n\tconst localUser = UserStore.useState(UserStore.getLocalUser);\r\n\r\n\treturn (\r\n\t\t<div className=\"HomePage\">\r\n\t\t\t<div className=\"HomeBackgroundContainer\">\r\n\t\t\t\t<div className=\"HomeBackground\">\r\n\t\t\t\t\t<WaveVector />\r\n\t\t\t\t\t<WaveVector />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"Hero\">\r\n\t\t\t\t<h1>Cirlos</h1>\r\n\r\n\t\t\t\t<h3>\r\n\t\t\t\t\tA simpler way to connect with friends and family,<br />\r\n\t\t\t\t\twith powerful ways to personalize your experience.<br />\r\n\t\t\t\t</h3>\r\n\r\n\t\t\t\t<div className=\"Buttons\">\r\n\t\t\t\t\t{localUser !== null\r\n\t\t\t\t\t\t? <React.Fragment>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"Button Focus\"\r\n\t\t\t\t\t\t\t\tonClick={() => window.location.assign(\"#app\")}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<Feather.CheckCircle />\r\n\r\n\t\t\t\t\t\t\t\tContinue To App\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</React.Fragment>\r\n\r\n\t\t\t\t\t\t: <React.Fragment>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"Button Focus\"\r\n\t\t\t\t\t\t\t\tonClick={() => Modals.push(<AuthModal signUp />)}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<Feather.Edit />\r\n\r\n\t\t\t\t\t\t\t\tSign Up\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName=\"Button\"\r\n\t\t\t\t\t\t\t\tonClick={() => Modals.push(<AuthModal />)}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<Feather.LogIn />\r\n\r\n\t\t\t\t\t\t\t\tSign In\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</React.Fragment>}\r\n\r\n\t\t\t\t\t<div className=\"Button\">\r\n\t\t\t\t\t\t<Feather.Download />\r\n\r\n\t\t\t\t\t\tDownload\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div >\r\n\t);\r\n}","import _ from \"lodash\";\r\nimport React from \"react\";\r\nimport { ActionTypes } from \"../../Constants\";\r\nimport Database from \"../../Database\";\r\nimport { dispatcher } from \"../../Dispatcher\";\r\nimport Store from \"../../Store\";\r\nimport UserStore from \"./UserStore\";\r\n\r\nconst styles = {\r\n\t\"group-panel-size\": 250\r\n};\r\n\r\nfunction toKebabCase(camelCase) {\r\n\treturn camelCase.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g, \"$1-$2\").toLowerCase();\r\n}\r\n\r\nconst CssStoreClass = class CssStore extends Store {\r\n\tconstructor(...args) {\r\n\t\tsuper(...args);\r\n\r\n\t\tconst localUserListener = () => {\r\n\t\t\tconst localUser = UserStore.getLocalUser();\r\n\r\n\t\t\tif (localUser) {\r\n\t\t\t\tthis._databaseReference = Database.doc(\"usersettings\", UserStore.getLocalUser().id, \"v2\", \"cssVars\");\r\n\r\n\t\t\t\tDatabase.getDoc(\r\n\t\t\t\t\tthis._databaseReference,\r\n\t\t\t\t).then(data => {\r\n\t\t\t\t\tthis._hasLoaded = true;\r\n\r\n\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\ttype: ActionTypes.BATCH_UPDATE_CSS_VARS,\r\n\t\t\t\t\t\tentries: data ?? {}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tUserStore.removeListener(localUserListener);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tUserStore.addListener(localUserListener);\r\n\r\n\t\tthis._save = _.debounce(this._save.bind(this), 5000);\r\n\t}\r\n\r\n\t_save() {\r\n\t\tif (!this._hasLoaded) return;\r\n\r\n\t\tDatabase.set(this._databaseReference, styles)\r\n\t\t\t.catch(err => console.error(\"Error saving CSS variables!\", err.stack));\r\n\t}\r\n\r\n\tgetStyle(key) {\r\n\t\treturn styles[toKebabCase(key)];\r\n\t}\r\n\r\n\tgetStyles() {\r\n\t\treturn styles;\r\n\t}\r\n\r\n\tget Renderer() {\r\n\t\treturn () => {\r\n\t\t\tdispatcher.useForceUpdater(ActionTypes.UPDATE_CSS_VAR);\r\n\t\t\tdispatcher.useForceUpdater(ActionTypes.BATCH_UPDATE_CSS_VARS);\r\n\r\n\t\t\treturn React.createElement(\r\n\t\t\t\t\"style\",\r\n\t\t\t\t{},\r\n\t\t\t\t`#root {\r\n\t\t\t\t\t${Object.entries(styles).map(([key, value]) => `--${key}: ${value};`).join(\"\\n\")}\r\n\t\t\t\t}`\r\n\t\t\t);\r\n\t\t};\r\n\t}\r\n}\r\n\r\nconst CssStore = new CssStoreClass(dispatcher, {\r\n\t[ActionTypes.UPDATE_CSS_VAR]: ({ key, value }) => {\r\n\t\tstyles[toKebabCase(key)] = value;\r\n\r\n\t\tCssStore._save();\r\n\t},\r\n\t[ActionTypes.BATCH_UPDATE_CSS_VARS]: ({ entries }) => {\r\n\t\tfor (const key in entries) {\r\n\t\t\tconst types = [\"string\", \"number\"];\r\n\t\t\tif (!~types.indexOf(typeof (key)) || !~types.indexOf(typeof (entries[key])))\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tstyles[key] = entries[key];\r\n\t\t}\r\n\t}\r\n});\r\n\r\nexport default CssStore;","import React from \"react\";\r\nimport { Film, MessageSquare, Send } from \"react-feather\";\r\nimport { ActionTypes, joinClassNames } from \"../../Classes/Constants\";\r\nimport { dispatcher } from \"../../Classes/Dispatcher\";\r\nimport GroupStore from \"../../Classes/Types/Stores/GroupStore\";\r\nimport TypingStore from \"../../Classes/Types/Stores/TypingStore\";\r\nimport UserStore from \"../../Classes/Types/Stores/UserStore\";\r\nimport { UserMention } from \"../../Classes/Types/User\";\r\nimport Toasts from \"../Toasts\";\r\nimport \"./ChatTextArea.scss\";\r\nimport RichTextArea from \"./RichTextArea\";\r\n\r\nexport default function ChatTextArea() {\r\n\tconst events = {\r\n\t\thandleSend: async message => {\r\n\t\t\tif (message.trim()) {\r\n\t\t\t\tconst group = GroupStore.getSelectedGroup();\r\n\t\t\t\tif (!group) return Toasts.showToast(\"No selected group!\", \"Failure\");\r\n\r\n\t\t\t\tgroup.sendMessage(message);\r\n\t\t\t\tTypingStore.stopTyping(group.circleId, group.id);\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div className=\"ChatTextAreaContainer Flex\">\r\n\t\t\t<RichTextArea\r\n\t\t\t\tid=\"ChatTextArea\"\r\n\t\t\t\tclassName=\"ChatTextArea\"\r\n\t\t\t\tonSend={events.handleSend}\r\n\t\t\t\tonInput={e => e.target.value ? TypingStore.startTyping() : TypingStore.stopTyping()}\r\n\t\t\t\tcontainerChildren={<TypingIndicators />}\r\n\t\t\t><MessageSquare /> Say hi! </RichTextArea>\r\n\r\n\t\t\t<div className=\"Button\">\r\n\t\t\t\t<Film />\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"Button\" onClick={() => (\r\n\t\t\t\tdocument.getElementById(\"ChatTextArea\").dispatchEvent(\r\n\t\t\t\t\tnew KeyboardEvent(\"keydown\", {\r\n\t\t\t\t\t\tkey: \"Enter\",\r\n\t\t\t\t\t\tshiftKey: false,\r\n\t\t\t\t\t\tbubbles: true\r\n\t\t\t\t\t})\r\n\t\t\t\t)\r\n\t\t\t)}>\r\n\t\t\t\t<Send />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nfunction TypingIndicators() {\r\n\tdispatcher.useForceUpdater(ActionTypes.PAGE_UPDATE);\r\n\tdispatcher.useForceUpdater(\r\n\t\tActionTypes.UPDATE_TYPING_INDICATORS,\r\n\t\t({ circleId, userId }) =>\r\n\t\t\t[circleId, userId].some(id => window.location.href.includes(id))\r\n\t);\r\n\r\n\tconst group = GroupStore.getSelectedGroup() ?? {};\r\n\r\n\tconst typingUserIds = Object.keys(\r\n\t\tTypingStore.getTypingUsersForGroup(group.circleId, group.id) ?? {}\r\n\t);\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={\r\n\t\t\t\tjoinClassNames(\r\n\t\t\t\t\t\"TypingIndicators\",\r\n\t\t\t\t\t[!!typingUserIds.length, \"Active\"]\r\n\t\t\t\t)\r\n\t\t\t}\r\n\t\t>\r\n\t\t\t{typingUserIds.map((userId, i) => (\r\n\t\t\t\t<React.Fragment key={userId}>\r\n\t\t\t\t\t<UserMention user={UserStore.getUser(userId)} convertToYou />\r\n\r\n\t\t\t\t\t{i !== typingUserIds.length - 1 && (\r\n\t\t\t\t\t\t<div className=\"Comma\">\r\n\t\t\t\t\t\t\t, {i === typingUserIds.length - 2 && \"and\"}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</React.Fragment>\r\n\t\t\t))}\r\n\r\n\t\t\t{typingUserIds.length > 1 || ~typingUserIds.indexOf(UserStore.getLocalUser().id)\r\n\t\t\t\t? \" are\"\r\n\t\t\t\t: \" is\"} typing...\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\nimport { PhoneOff } from \"react-feather\";\nimport { ActionTypes } from \"../../Classes/Constants\";\nimport { dispatcher } from \"../../Classes/Dispatcher\";\nimport UserStore from \"../../Classes/Types/Stores/UserStore\";\nimport VoiceMemberStore from \"../../Classes/Types/Stores/VoiceMemberStore\";\nimport VoiceModule from \"../../Classes/VoiceModule\";\nimport \"./CallPanel.scss\";\n\nexport default function CallPanel() {\n\tdispatcher.useForceUpdater(ActionTypes.UPDATE_CURRENT_CALL);\n\n\tconst call = VoiceModule.currentRoom;\n\n\tdispatcher.useForceUpdater(\n\t\tActionTypes.UPDATE_VOICE_MEMBERS,\n\t\t({ groupId }) => groupId === call?.group.id\n\t);\n\n\tconst memberIds = (call?.group\n\t\t? VoiceMemberStore.getVoiceMembers(call.group.circleId, call.group.id)\n\t\t: []) ?? [];\n\n\treturn call\n\t\t? (\n\t\t\t<div className=\"Panel PanelCall\">\n\t\t\t\t<div className=\"Members FlexCenter\">\n\t\t\t\t\t{memberIds.map(userId => (\n\t\t\t\t\t\t<VoiceCallMember key={userId} userId={userId} />\n\t\t\t\t\t))}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t)\n\t\t: (\n\t\t\t<div className=\"Panel PanelCall NoCall\">\n\t\t\t\t<PhoneOff /> Call ended.\n\t\t\t</div>\n\t\t);\n}\n\nfunction VoiceCallMember({ userId }) {\n\tconst user = UserStore.useState(() => UserStore.getUser(userId));\n\n\treturn user ? (\n\t\t<div className=\"VoiceMember\">\n\t\t\t<user.AvatarComponent size={200} />\n\n\t\t\t<h4 className=\"Username\">{user.displayName}</h4>\n\t\t</div>\n\t) : null;\n}","import _ from \"lodash\";\r\nimport { ActionTypes } from \"../../Constants\";\r\nimport { dispatcher } from \"../../Dispatcher\";\r\nimport Store from \"../../Store\";\r\nimport UserStore from \"./UserStore\";\r\n\r\nconst cache = {};\r\n\r\nconst MessageReadStoreClass = class MessageReadStore extends Store {\r\n\tgetReads(circleId, groupId) {\r\n\t\treturn _.get(cache, [circleId, groupId]);\r\n\t}\r\n\r\n\tgetReadsForMessage(circleId, groupId, messageId) {\r\n\t\tconst reads = this.getReads(circleId, groupId) ?? {};\r\n\r\n\t\treturn Object.entries(reads)\r\n\t\t\t.filter(([, read]) => read.messageId === messageId)\r\n\t\t\t.map(([userId, read]) => ({\r\n\t\t\t\tuserId,\r\n\t\t\t\ttimestamp: read.timestamp\r\n\t\t\t}));\r\n\t}\r\n\r\n\tgetAllCachedReads() {\r\n\t\treturn cache;\r\n\t}\r\n}\r\n\r\nconst MessageReadStore = new MessageReadStoreClass(dispatcher, {\r\n\t[ActionTypes.UPDATE_READS]: ({ circleId, groupId, reads }) => {\r\n\t\t// Assign it so we know that read counts have been loaded\r\n\t\tif (!_.get(cache, [circleId, groupId])) {\r\n\t\t\t_.set(cache, [circleId, groupId], {});\r\n\t\t}\r\n\r\n\t\t// And assign each read count\r\n\t\tfor (const read of reads) {\r\n\t\t\tcache[circleId][groupId][read.id] =\r\n\t\t\t\t_.pick(read, \"messageId\", \"timestamp\");\r\n\t\t}\r\n\t}\r\n});\r\n\r\nexport default MessageReadStore;","import _ from \"lodash\";\r\nimport React from \"react\";\r\nimport { Check, User } from \"react-feather\";\r\nimport { ActionTypes, formatTimestamp, joinClassNames } from \"../../Classes/Constants\";\r\nimport { dispatcher } from \"../../Classes/Dispatcher\";\r\nimport { useInterval, useMediaQuery } from \"../../Classes/Hooks\";\r\nimport CssStore from \"../../Classes/Types/Stores/CssStore\";\r\nimport GroupStore from \"../../Classes/Types/Stores/GroupStore\";\r\nimport MessageReadStore from \"../../Classes/Types/Stores/MessageReadStore\";\r\nimport MessageStore from \"../../Classes/Types/Stores/MessageStore\";\r\nimport UserStore from \"../../Classes/Types/Stores/UserStore\";\r\nimport { UserAvatarComponent, UserMention } from \"../../Classes/Types/User\";\r\nimport ContextMenu from \"../ContextMenuHandler\";\r\nimport InlineLoading from \"../InlineLoading\";\r\nimport Tooltip from \"../Tooltip\";\r\nimport \"./ChatPanel.scss\";\r\n\r\nexport default function ChatPanel({ circleId, groupId }) {\r\n\tdispatcher.useForceUpdater(\r\n\t\tActionTypes.CHAT_UPDATE,\r\n\t\te => e.circleId == circleId && e.groupId == groupId\r\n\t);\r\n\r\n\tconst ref = React.useRef();\r\n\r\n\tconst messages = MessageStore.getMessageGroups(circleId, groupId);\r\n\tconst isMobile = useMediaQuery(\"max-width\", 700);\r\n\r\n\tconst mobileEvents = React.useMemo(() => isMobile ? {\r\n\t\tonTouchStart: e => {\r\n\t\t\tconst tapX = e.touches[0].clientX;\r\n\t\t\tconst tapY = e.touches[0].clientY;\r\n\t\t\tconst target = CssStore.getStyle(\"groupPanelSize\") + 60;\r\n\r\n\t\t\tlet translation = 0;\r\n\t\t\tlet lastTranslation = parseFloat(ref.current.style.transform.match(/[0-9]+/g));\r\n\t\t\tif (isNaN(lastTranslation)) lastTranslation = 0;\r\n\r\n\t\t\tconst handler = e => {\r\n\t\t\t\tconst alias = 50;\r\n\t\t\t\ttranslation = e.touches[0].clientX - tapX;\r\n\r\n\t\t\t\tif (Math.abs(translation) < alias || Math.abs(e.touches[0].clientY - tapY) > 50) return;\r\n\t\t\t\tif (translation < 0) translation += alias;\r\n\t\t\t\telse translation -= alias;\r\n\r\n\t\t\t\tObject.assign(ref.current.style, {\r\n\t\t\t\t\ttransform: `translateX(${_.clamp(lastTranslation + translation, 0, target)}px)`\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tdocument.addEventListener(\"touchmove\", handler);\r\n\r\n\t\t\tlet remove;\r\n\t\t\tdocument.addEventListener(\"touchend\", remove = () => {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tObject.assign(ref.current.style, {\r\n\t\t\t\t\t\ttransform: translation > target / 3 ? `translateX(${target}px)` : \"none\"\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tdocument.removeEventListener(\"touchmove\", handler);\r\n\t\t\t\t\tdocument.removeEventListener(\"touchend\", remove);\r\n\t\t\t\t}, 100);\r\n\t\t\t});\r\n\t\t}\r\n\t} : {}, [isMobile]);\r\n\r\n\tuseInterval(\r\n\t\t() => MessageStore.tickCache(circleId, groupId),\r\n\t\t1000,\r\n\t\ttrue,\r\n\t\t[circleId, groupId]\r\n\t);\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"Panel PanelChat\"\r\n\t\t\tref={ref}\r\n\t\t\t{...mobileEvents}\r\n\t\t>\r\n\t\t\t{messages\r\n\t\t\t\t? (\r\n\t\t\t\t\t<div className=\"Messages\">\r\n\t\t\t\t\t\t{messages.map(group => (\r\n\t\t\t\t\t\t\t<MessageGroup {...group} />\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)\r\n\t\t\t\t: (\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"FlexCenter\"\r\n\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\tmarginTop: 50\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<InlineLoading />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function MessageGroup({ userId, messages }) {\r\n\tconst user = UserStore.useState(() => UserStore.getUser(userId));\r\n\r\n\treturn (\r\n\t\t<div className={\r\n\t\t\tjoinClassNames(\r\n\t\t\t\t\"MessageGroup\",\r\n\t\t\t\t[userId === UserStore.getLocalUser()?.id, \"LocalUser\"]\r\n\t\t\t)}\r\n\t\t>\r\n\t\t\t<ContextMenu.Wrapper\r\n\t\t\t\tmenu={<user.ContextMenu />}\r\n\t\t\t\twrapperClassName=\"UserSection Flex\"\r\n\t\t\t>\r\n\t\t\t\t{user && <user.AvatarComponent />}\r\n\r\n\t\t\t\t<div className=\"Details\">\r\n\t\t\t\t\t<h3 className=\"Username\">{user.displayName}</h3>\r\n\r\n\t\t\t\t\t<user.StatusText />\r\n\t\t\t\t</div>\r\n\t\t\t</ContextMenu.Wrapper>\r\n\r\n\t\t\t{messages.map(message => (\r\n\t\t\t\t<MessageComponent message={message} key={message.id} />\r\n\t\t\t))}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction MessageComponent({ message }) {\r\n\tconst group = GroupStore.getSelectedGroup();\r\n\r\n\tdispatcher.useForceUpdater(\r\n\t\tActionTypes.UPDATE_READS,\r\n\t\t({ circleId, groupId }) =>\r\n\t\t\tgroup?.circleId === circleId && group?.id === groupId\r\n\t);\r\n\r\n\tconst reads = MessageReadStore.getReadsForMessage(\r\n\t\tgroup?.circleId,\r\n\t\tgroup?.id,\r\n\t\tmessage.id\r\n\t).filter(({ userId }) => userId !== UserStore.getLocalUser().id);\r\n\r\n\treturn (\r\n\t\t<div className=\"Message Flex\" key={message.id}>\r\n\t\t\t<div className=\"TimestampContainer\">\r\n\t\t\t\t<span className=\"Timestamp\">\r\n\t\t\t\t\t{message.creationDate?.toDate().toLocaleTimeString(\"en-US\", { hour12: false }).slice(0, -3)}\r\n\t\t\t\t</span>\r\n\r\n\t\t\t\t<Tooltip direction=\"right\">\r\n\t\t\t\t\t<div>Sent {message.getCreationDate()}</div>\r\n\r\n\t\t\t\t\t{message.editedAt && (\r\n\t\t\t\t\t\t<div>Edited {message.getCreationDate(message.editedAt)}</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</Tooltip>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"MessageContent\">\r\n\t\t\t\t{message.getContent()}\r\n\t\t\t</div>\r\n\r\n\t\t\t{!!reads.length && (\r\n\t\t\t\t<div className=\"ReadIndicators\">\r\n\t\t\t\t\t<Check className=\"Icon\" />\r\n\r\n\t\t\t\t\t<Tooltip direction=\"left\">\r\n\t\t\t\t\t\t<h4>Read by</h4>\r\n\r\n\t\t\t\t\t\t<div className=\"Flex Indicators\">\r\n\t\t\t\t\t\t\t{reads.map(({ userId, timestamp }) => (\r\n\t\t\t\t\t\t\t\t<div key={userId}>\r\n\t\t\t\t\t\t\t\t\t<UserMention user={UserStore.getUser(userId)} /> {formatTimestamp(timestamp)}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</Tooltip>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n}","import _ from \"lodash\";\r\nimport React from \"react\";\r\nimport { ActionTypes } from \"../../Classes/Constants\";\r\nimport { dispatcher } from \"../../Classes/Dispatcher\";\r\n\r\nexport default function GroupsPanel({ children }) {\r\n\tconst ref = React.useRef();\r\n\r\n\tconst handleScaler = React.useMemo(() => e => {\r\n\t\tdispatcher.dispatch({\r\n\t\t\ttype: ActionTypes.UPDATE_CSS_VAR,\r\n\t\t\tkey: \"groupPanelSize\",\r\n\t\t\tvalue: _.clamp(\r\n\t\t\t\te.clientX - ref.current.getBoundingClientRect().x,\r\n\t\t\t\t100, 500\r\n\t\t\t)\r\n\t\t});\r\n\t}, [children]);\r\n\r\n\tconst events = {\r\n\t\tonMouseDown: () => {\r\n\t\t\tdocument.addEventListener(\"mousemove\", handleScaler);\r\n\r\n\t\t\tlet remove;\r\n\t\t\tdocument.addEventListener(\"mouseup\", remove = () => {\r\n\t\t\t\tdocument.removeEventListener(\"mousemove\", handleScaler);\r\n\t\t\t\tdocument.removeEventListener(\"mouseup\", remove);\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div className=\"Panel PanelGroups\" ref={ref}>\r\n\t\t\t{children}\r\n\r\n\t\t\t<div className=\"GroupsScaler\" {...events} />\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport { appHashArgs } from \"../../App\";\r\nimport { getAcronym } from \"../../Classes/Constants\";\r\nimport CircleStore from \"../../Classes/Types/Stores/CircleStore\";\r\nimport UserStore from \"../../Classes/Types/Stores/UserStore\";\r\nimport { openImageModal } from \"../Modals\";\r\nimport \"./CircleOverview.scss\";\r\n\r\nexport default function CircleOverview({ circleId }) {\r\n\tconst circle = CircleStore.getCircle(circleId);\r\n\tconst owner = UserStore.useState(() => UserStore.getUser(circle?.ownerId));\r\n\r\n\treturn circle ? (\r\n\t\t<div className=\"CircleOverview FlexCenter\">\r\n\t\t\t<div className=\"Hero FlexCenter\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"Circle\"\r\n\t\t\t\t\tonClick={() => openImageModal(circle.iconUrl)}\r\n\t\t\t\t>\r\n\t\t\t\t\t{circle.iconUrl\r\n\t\t\t\t\t\t? <img\r\n\t\t\t\t\t\t\tclassName=\"Icon\"\r\n\t\t\t\t\t\t\tsrc={circle.iconUrl}\r\n\t\t\t\t\t\t\talt={getAcronym(circle.name)}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t: <h3 className=\"Icon Acronym\">\r\n\t\t\t\t\t\t\t{getAcronym(circle.name)}\r\n\t\t\t\t\t\t</h3>}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"Banner\">\r\n\t\t\t\t\t{circle.iconUrl && (\r\n\t\t\t\t\t\t// TODO add banner images\r\n\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\tclassName=\"BannerImage Default\"\r\n\t\t\t\t\t\t\tsrc={circle.iconUrl}\r\n\t\t\t\t\t\t\talt=\"banner\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<h1 className=\"Title\">{circle.name}</h1>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t) : null;\r\n}","import _ from \"lodash\";\r\nimport React from \"react\";\r\nimport { appHashArgs } from \"../../App\";\r\nimport { ActionTypes } from \"../../Classes/Constants\";\r\nimport { dispatcher } from \"../../Classes/Dispatcher\";\r\nimport CallPanel from \"../Panels/CallPanel\";\r\nimport ChatPanel from \"../Panels/ChatPanel\";\r\nimport GroupsPanel from \"../Panels/GroupsPanel\";\r\nimport CircleOverview from \"./CircleOverview\";\r\nimport \"./CirclePage.scss\";\r\n\r\nexport default function CirclePage({ circle }) {\r\n\tdispatcher.useForceUpdater(ActionTypes.PAGE_UPDATE);\r\n\r\n\tdispatcher.useForceUpdater(\r\n\t\tActionTypes.CIRCLE_UPDATE_GROUPS,\r\n\t\te => e.circle.id === circle.id,\r\n\t\t[circle]\r\n\t);\r\n\r\n\tfunction RightHandRenderer() {\r\n\t\tswitch (appHashArgs[2]) {\r\n\t\t\tcase \"groups\": {\r\n\t\t\t\treturn <ChatPanel circleId={circle.id} groupId={appHashArgs[3]} />;\r\n\t\t\t}\r\n\r\n\t\t\tcase \"overview\": {\r\n\t\t\t\treturn <CircleOverview circleId={circle.id} />\r\n\t\t\t}\r\n\r\n\t\t\tcase \"call\": {\r\n\t\t\t\treturn <CallPanel />;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"CirclePage Flex\">\r\n\t\t\t<GroupsPanel>\r\n\t\t\t\t{circle.renderGroups()}\r\n\t\t\t</GroupsPanel>\r\n\r\n\t\t\t<RightHandRenderer />\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport \"./DmsPage.scss\";\r\nimport { appHashArgs } from \"../../App\";\r\nimport { ActionTypes } from \"../../Classes/Constants\";\r\nimport { dispatcher } from \"../../Classes/Dispatcher\";\r\nimport GroupStore from \"../../Classes/Types/Stores/GroupStore\";\r\nimport GroupsPanel from \"../Panels/GroupsPanel\";\r\nimport ChatPanel from \"../Panels/ChatPanel\";\r\n\r\nfunction renderGroups(_groups) {\r\n\tif (!_groups) return null;\r\n\tconst groups = Object.values(_groups).sort((a, b) => b.lastMessageDate - a.lastMessageDate);\r\n\r\n\treturn groups.map(group => (\r\n\t\t<group.Component key={group.groupId} />\r\n\t));\r\n}\r\n\r\nexport default function DmsPage() {\r\n\tdispatcher.useForceUpdater(ActionTypes.PAGE_UPDATE);\r\n\tdispatcher.useForceUpdater(ActionTypes.BATCH_UPDATE_DMS);\r\n\r\n\tconst groups = GroupStore.getGroups(\"dms\");\r\n\r\n\tfunction RightHandRenderer() {\r\n\t\tswitch (appHashArgs[1]?.trim() ?? \"\") {\r\n\t\t\tcase \"\": {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tdefault: {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<ChatPanel\r\n\t\t\t\t\t\tcircleId=\"dms\"\r\n\t\t\t\t\t\tgroupId={appHashArgs[1]}\r\n\t\t\t\t\t/>\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tconsole.log(groups);\r\n\r\n\treturn (\r\n\t\t<div className=\"DmsPage Flex\">\r\n\t\t\t<GroupsPanel>\r\n\t\t\t\t{renderGroups(groups)}\r\n\t\t\t</GroupsPanel>\r\n\r\n\t\t\t<RightHandRenderer />\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport { appHashArgs } from \"../../App\";\r\nimport { ActionTypes } from \"../../Classes/Constants\";\r\nimport { dispatcher } from \"../../Classes/Dispatcher\";\r\nimport CircleStore from \"../../Classes/Types/Stores/CircleStore\";\r\nimport CirclePage from \"../AppPages/CirclePage\";\r\nimport DmsPage from \"../AppPages/DmsPage\";\r\nimport \"./CorePanel.scss\";\r\n\r\nexport default function CorePanel() {\r\n\tdispatcher.useForceUpdater(ActionTypes.PAGE_UPDATE);\r\n\r\n\tswitch (appHashArgs[0]) {\r\n\t\tcase undefined:\r\n\t\tcase \"\": {\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"AppHome FlexCenter\">\r\n\t\t\t\t\t<h2>\r\n\t\t\t\t\t\tWelcome to the new Cirlos!\r\n\t\t\t\t\t</h2>\r\n\r\n\t\t\t\t\t<p>\r\n\t\t\t\t\t\tCirlos has been completely redesigned and rewritten, from the ground up.\r\n\t\t\t\t\t</p>\r\n\r\n\t\t\t\t\t<p>\r\n\t\t\t\t\t\tThis means better UI/UX, stability, and performance.\r\n\t\t\t\t\t</p>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tcase \"circles\": {\r\n\t\t\tconst circle = CircleStore.getCircle(appHashArgs[1]);\r\n\r\n\t\t\tif (circle) {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<CirclePage circle={circle} />\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div className=\"AppHome FlexCenter\">\r\n\t\t\t\t\t\t<h2>\r\n\t\t\t\t\t\t\tOops!\r\n\t\t\t\t\t\t</h2>\r\n\r\n\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\tThis circle could not be loaded properly.\r\n\t\t\t\t\t\t</p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcase \"dms\":\r\n\t\t\treturn <DmsPage />;\r\n\t}\r\n\r\n\t// TODO add 404\r\n\treturn (\r\n\t\t<div className=\"AppHome FlexCenter\">\r\n\t\t\tThis page does not exist.\r\n\t\t</div>\r\n\t);\r\n}","export default __webpack_public_path__ + \"static/media/alert.7584e772.ogg\";","import _ from \"lodash\";\r\nimport { Aperture, Bell, Eye, FileText, Grid, HelpCircle, Image, Layout, Package, Phone, Smile, User } from \"react-feather\";\r\nimport { ActionTypes } from \"../../Constants\";\r\nimport Database from \"../../Database\";\r\nimport Dispatcher from \"../../Dispatcher\";\r\nimport Store from \"../../Store\";\r\nimport UserStore from \"./UserStore\";\r\n\r\nexport const defaultSettingsSchematic = {\r\n\taccount: {\r\n\t\t__icon: <User />,\r\n\r\n\t\tprofile: {\r\n\r\n\t\t},\r\n\r\n\t\tprivacy: {\r\n\r\n\t\t},\r\n\r\n\t\tlogOut: {\r\n\r\n\t\t}\r\n\t},\r\n\r\n\tappearance: {\r\n\t\t__icon: <Layout />,\r\n\r\n\t\tcolors: {\r\n\r\n\t\t},\r\n\r\n\t\tstyles: {\r\n\r\n\t\t},\r\n\r\n\t\tbackground: {\r\n\t\t\timage: {\r\n\t\t\t\tlabel: \"Image URL\",\r\n\t\t\t\tnote: \"Must link directly to an image.\",\r\n\t\t\t\ttype: \"string\",\r\n\t\t\t\tvalue: \"\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tnotifications: {\r\n\t\t__icon: <Bell />,\r\n\r\n\t\ttoasts: {\r\n\r\n\t\t},\r\n\r\n\t\taudio: {\r\n\r\n\t\t}\r\n\t},\r\n\r\n\tcommunication: {\r\n\t\t__icon: <Phone />,\r\n\r\n\t\tvoice: {\r\n\r\n\t\t},\r\n\r\n\t\tvideo: {\r\n\r\n\t\t}\r\n\t},\r\n\r\n\temotes: {\r\n\t\t__icon: <Smile />,\r\n\r\n\t\tlibrary: {\r\n\r\n\t\t},\r\n\r\n\t\tstore: {\r\n\r\n\t\t}\r\n\t},\r\n\r\n\textensions: {\r\n\t\t__icon: <Package />,\r\n\r\n\t\tstore: {\r\n\r\n\t\t},\r\n\r\n\t\tplugins: {\r\n\r\n\t\t},\r\n\r\n\t\tthemes: {\r\n\r\n\t\t},\r\n\r\n\t\tcustomStyles: {\r\n\r\n\t\t}\r\n\t},\r\n\r\n\tmiscellaneous: {\r\n\t\t__icon: <Grid />,\r\n\r\n\t\taboutMe: {\r\n\r\n\t\t},\r\n\r\n\t\tchangeLogs: {\r\n\r\n\t\t},\r\n\r\n\t\tdeveloperTools: {\r\n\r\n\t\t}\r\n\t},\r\n\r\n\thelp: {\r\n\t\t__icon: <HelpCircle />,\r\n\r\n\t\tguides: {\r\n\r\n\t\t},\r\n\r\n\t\tmarkdownRules: {\r\n\r\n\t\t},\r\n\r\n\t\tshortcutsMap: {\r\n\r\n\t\t}\r\n\t},\r\n\r\n\tlegal: {\r\n\t\t__icon: <FileText />,\r\n\r\n\t\tguidelines: {\r\n\r\n\t\t},\r\n\r\n\t\ttermsOfService: {\r\n\r\n\t\t},\r\n\r\n\t\tprivacyPolicy: {\r\n\r\n\t\t},\r\n\r\n\t\tcookiesPolicy: {\r\n\r\n\t\t}\r\n\t},\r\n\r\n\t__properties: {\r\n\r\n\t}\r\n};\r\n\r\nconst settings = {};\r\n\r\nconst SettingsStoreClass = class SettingsStore extends Store {\r\n\tconstructor(...args) {\r\n\t\tsuper(...args);\r\n\r\n\t\tconst localUserListener = () => {\r\n\t\t\tconst localUser = UserStore.getLocalUser();\r\n\r\n\t\t\tif (localUser) {\r\n\t\t\t\tthis._databaseReference = Database.doc(\"usersettings\", UserStore.getLocalUser().id, \"v2\", \"properties\");\r\n\r\n\t\t\t\tDatabase.getDoc(\r\n\t\t\t\t\tthis._databaseReference,\r\n\t\t\t\t).then(data => {\r\n\t\t\t\t\tthis._hasLoaded = true;\r\n\r\n\t\t\t\t\tsettingsDispatcher.dispatch({\r\n\t\t\t\t\t\ttype: ActionTypes.BATCH_UPDATE_SETTINGS,\r\n\t\t\t\t\t\tentries: data ?? {}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tUserStore.removeListener(localUserListener);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tUserStore.addListener(localUserListener);\r\n\r\n\t\tthis._save = _.debounce(this._save.bind(this), 5000);\r\n\t}\r\n\r\n\t_save() {\r\n\t\tif (!this._hasLoaded) return;\r\n\r\n\t\tDatabase.set(this._databaseReference, settings)\r\n\t\t\t.catch(err => console.error(\"Error saving settings!\", err.stack));\r\n\t}\r\n\r\n\tgetSettingValue(...path) {\r\n\t\t// In case we pass an array instead of a de-structured array\r\n\t\tif (Array.isArray(path[0])) path = path[0];\r\n\r\n\t\tconst def = _.get(defaultSettingsSchematic, path);\r\n\r\n\t\tif (typeof (def) === \"undefined\") {\r\n\t\t\treturn console.error(\"No setting at path\", path.join(\".\"));\r\n\t\t}\r\n\r\n\t\treturn _.get(settings, [...path, \"value\"], def.value);\r\n\t}\r\n}\r\n\r\nexport const settingsDispatcher = new Dispatcher;\r\n\r\nconst SettingsStore = new SettingsStoreClass(settingsDispatcher, {\r\n\t[ActionTypes.UPDATE_SETTING]: ({ path, value }) => {\r\n\t\tif (_.get(defaultSettingsSchematic, path)) {\r\n\t\t\t_.set(settings, [...path, \"value\"], value);\r\n\r\n\t\t\tSettingsStore._save();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.warn(\"Invalid setting was passed!\", { path, value });\r\n\t\t}\r\n\t},\r\n\t[ActionTypes.BATCH_UPDATE_SETTINGS]: ({ entries }) => {\r\n\t\t_.extend(settings, entries);\r\n\t}\r\n});\r\n\r\nexport default SettingsStore;\r\n\r\nexport function SettingsCssRenderer() {\r\n\tsettingsDispatcher.useForceUpdater(ActionTypes.UPDATE_SETTING);\r\n\tsettingsDispatcher.useForceUpdater(ActionTypes.BATCH_UPDATE_SETTINGS);\r\n\r\n\tconst renderers = {\r\n\t\t\"appearance.background.image\": value => value && `\r\n\t\t\t.Core::before,\r\n\t\t\t.SettingsModal::before {\r\n\t\t\t\tcontent: \"\";\r\n\r\n\t\t\t\tbackground-image: url(\"${value}\");\r\n\t\t\t\tbackground-position: center;\r\n\t\t\t\tbackground-size: cover;\r\n\r\n\t\t\t\tposition: fixed;\r\n\t\t\t\twidth: 100vw;\r\n\t\t\t\theight: 100vh;\r\n\r\n\t\t\t\tz-index: -1000;\r\n\t\t\t}\r\n\r\n\t\t\t.SettingsModal:before { z-index: 0; }\r\n\r\n\t\t\t.SettingsModal .Section, .SettingsModal .CategoryBubble {\r\n\t\t\t\tbackdrop-filter: blur(20px);\r\n\t\t\t}\r\n\r\n\t\t\t.MessageGroup, #root .RichTextArea .Renderer {\r\n\t\t\t\tbackground-color: rgba(0,0,0, 0.5);\r\n\t\t\t}\r\n\r\n\t\t\t.MessageGroup {\r\n\t\t\t\tborder: none;\r\n\t\t\t\tmargin-top: 5px;\r\n\t\t\t}\r\n\t\t`\r\n\t};\r\n\r\n\treturn (\r\n\t\t<style>\r\n\t\t\t{Object.keys(renderers).map(path => (\r\n\t\t\t\trenderers[path](SettingsStore.getSettingValue(...path.split(\".\")))\r\n\t\t\t)).join(\"\\n\")}\r\n\t\t</style>\r\n\t);\r\n}","import React from \"react\";\nimport { ArrowLeft, X } from \"react-feather\";\nimport { ActionTypes, formatCamelCase } from \"../../Classes/Constants\";\nimport SettingsStore, { defaultSettingsSchematic as schema, settingsDispatcher } from \"../../Classes/Types/Stores/SettingsStore\";\nimport { Modals } from \"../Modals\";\nimport \"./SettingsModal.scss\";\n\nexport default function SettingsModal() {\n\tconst [selected, _select] = React.useState(null);\n\tconst [opacity, setOpacity] = React.useState(1);\n\tconst [query, search] = React.useState(\"\");\n\n\tlet transitioning = false;\n\tasync function select(category) {\n\t\tif (transitioning) return;\n\t\ttransitioning = true;\n\n\t\tsetOpacity(0);\n\n\t\tawait new Promise(r => setTimeout(r, 150));\n\n\t\t_select(category);\n\t\tsetOpacity(1);\n\t}\n\n\tconst filters = {\n\t\troot: category => {\n\t\t\tif (!query) return true;\n\t\t\tif (category.toLowerCase().includes(query)) return true;\n\n\t\t\tfor (const subCategory in schema[category]) {\n\t\t\t\tif (filters.sub(subCategory)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (filters.items(category, subCategory)) return true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\tsub: subCategory => {\n\t\t\tif (!query) return true;\n\t\t\tif (subCategory.toLowerCase().includes(query)) return true;\n\t\t},\n\t\titems: (root, sub) => {\n\t\t\tif (!query) return true;\n\n\t\t\tfor (const item in schema[root][sub]) {\n\t\t\t\tif (item.toLowerCase().includes(query)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\t};\n\n\treturn (\n\t\t<div className=\"SettingsModal FullScreenModal FlexCenter\">\n\t\t\t<div className=\"Inner\">\n\t\t\t\t<input\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tclassName=\"SearchField\"\n\t\t\t\t\tplaceholder=\"Search...\"\n\t\t\t\t\tonInput={e => search(e.target.value.toLowerCase())}\n\t\t\t\t/>\n\n\t\t\t\t<div style={{ opacity }} className=\"Contents\">\n\t\t\t\t\t{!selected && (\n\t\t\t\t\t\t<div className=\"Categories FlexCenter\">\n\t\t\t\t\t\t\t{Object.keys(schema).filter(filters.root).map(category => !category.startsWith(\"__\") && (\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclassName=\"CategoryBubble\"\n\t\t\t\t\t\t\t\t\tkey={category}\n\t\t\t\t\t\t\t\t\tonClick={() => select(category)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div className=\"FlexCenter\">\n\t\t\t\t\t\t\t\t\t\t{schema[category].__icon}\n\n\t\t\t\t\t\t\t\t\t\t<h4 className=\"Title\">\n\t\t\t\t\t\t\t\t\t\t\t{formatCamelCase(category)}\n\t\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div className=\"Sections\">\n\t\t\t\t\t\t\t\t\t\t{Object.keys(schema[category]).map(subCategory => (\n\t\t\t\t\t\t\t\t\t\t\tformatCamelCase(subCategory).toLowerCase()\n\t\t\t\t\t\t\t\t\t\t)).filter(s => !s.startsWith(\"__\")).join(\", \")}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{selected && (\n\t\t\t\t\t\t<React.Fragment>\n\t\t\t\t\t\t\t<div className=\"Categories FlexCenter BackButton\">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclassName=\"CategoryBubble\"\n\t\t\t\t\t\t\t\t\tonClick={() => select(null)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div className=\"FlexCenter\">\n\t\t\t\t\t\t\t\t\t\t<ArrowLeft />\n\n\t\t\t\t\t\t\t\t\t\t<h4 className=\"Title\">Back To Menus</h4>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div className=\"Sections\">\n\t\t\t\t\t\t\t\t{Object.keys(schema[selected]).map(sub => (\n\t\t\t\t\t\t\t\t\t!!Object.keys(schema[selected][sub]).length && !sub.startsWith(\"__\") && (\n\t\t\t\t\t\t\t\t\t\t<Section\n\t\t\t\t\t\t\t\t\t\t\tkey={sub}\n\t\t\t\t\t\t\t\t\t\t\tcat={selected}\n\t\t\t\t\t\t\t\t\t\t\tsub={sub}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t</React.Fragment>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div className=\"Buttons\">\n\t\t\t\t<X\n\t\t\t\t\tclassName=\"Button\"\n\t\t\t\t\tonClick={() => Modals.pop()}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction Section({ cat, sub }) {\n\treturn (\n\t\t<div className=\"Section\">\n\t\t\t<h3 className=\"Title\">{formatCamelCase(sub)}</h3>\n\n\t\t\t<div className=\"Fields\">\n\t\t\t\t{Object.entries(schema[cat][sub]).map(e => (\n\t\t\t\t\t<Field\n\t\t\t\t\t\tkey={e[0]}\n\t\t\t\t\t\tpath={[cat, sub, e[0]]}\n\t\t\t\t\t\tsetting={e[1]}\n\t\t\t\t\t/>\n\t\t\t\t))}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction Field({ path, setting }) {\n\tconst value = SettingsStore.getSettingValue(path);\n\n\tconst field = React.useMemo(() => {\n\t\tswitch (setting.type) {\n\t\t\tdefault: return null;\n\n\t\t\tcase \"string\": {\n\t\t\t\treturn (\n\t\t\t\t\t<input\n\t\t\t\t\t\tclassName=\"InputField StringField\"\n\t\t\t\t\t\tdefaultValue={value}\n\t\t\t\t\t\tonBlur={e => settingsDispatcher.dispatch({\n\t\t\t\t\t\t\ttype: ActionTypes.UPDATE_SETTING,\n\t\t\t\t\t\t\tvalue: e.target.value,\n\t\t\t\t\t\t\tpath\n\t\t\t\t\t\t})}\n\t\t\t\t\t\t{...(setting.props ?? {})}\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}, []);\n\n\treturn (\n\t\t<div className=\"SettingField\">\n\t\t\t<h4 className=\"Title\">\n\t\t\t\t{formatCamelCase(path[path.length - 1])}\n\t\t\t</h4>\n\n\t\t\t{setting.note && (\n\t\t\t\t<div className=\"Note\">\n\t\t\t\t\t{setting.note}\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t<div className=\"Field\">\n\t\t\t\t{field}\n\t\t\t</div>\n\t\t</div>\n\t);\n}","import _ from \"lodash\";\r\nimport React from \"react\";\r\nimport { Settings, Users } from \"react-feather\";\r\nimport { pushHistoryState } from \"../App\";\r\nimport { ActionTypes, joinClassNames, playSound, UserStatus } from \"../Classes/Constants\";\r\nimport Database from \"../Classes/Database\";\r\nimport { dispatcher } from \"../Classes/Dispatcher\";\r\nimport { useEventListener, useInterval, useOnMount } from \"../Classes/Hooks\";\r\nimport Circle, { CircleBubble } from \"../Classes/Types/Circle\";\r\nimport CircleStore from \"../Classes/Types/Stores/CircleStore\";\r\nimport CssStore from \"../Classes/Types/Stores/CssStore\";\r\nimport GroupStore from \"../Classes/Types/Stores/GroupStore\";\r\nimport MessageCountStore from \"../Classes/Types/Stores/MessageCountStore\";\r\nimport UserStore from \"../Classes/Types/Stores/UserStore\";\r\nimport VoiceModule, { initializeVoiceModule } from \"../Classes/VoiceModule\";\r\nimport ChatTextArea from \"../Components/Chat/ChatTextArea\";\r\nimport ContextMenu from \"../Components/ContextMenuHandler\";\r\nimport InlineLoading from \"../Components/InlineLoading\";\r\nimport CorePanel from \"../Components/Panels/CorePanel\";\r\nimport Toasts from \"../Components/Toasts\";\r\nimport Tooltip from \"../Components/Tooltip\";\r\nimport AlertSound from \"../Assets/Audio/alert.ogg\";\r\nimport \"./AppPage.scss\";\r\nimport { SettingsCssRenderer } from \"../Classes/Types/Stores/SettingsStore\";\r\nimport { Modals } from \"../Components/Modals\";\r\nimport SettingsModal from \"../Components/Modals/SettingsModal\";\r\nimport MessageStore from \"../Classes/Types/Stores/MessageStore\";\r\nimport MessageReadStore from \"../Classes/Types/Stores/MessageReadStore\";\r\nimport { GroupDm } from \"../Classes/Types/Group\";\r\nimport { serverTimestamp } from \"@firebase/firestore\";\r\n\r\nexport default function AppPage() {\r\n\tconst localUser = UserStore.useState(UserStore.getLocalUser);\r\n\r\n\tif (localUser === null) {\r\n\t\tToasts.showToast(\"You must be signed in to access the app\", \"Failure\");\r\n\r\n\t\twindow.location.assign(window.location.origin);\r\n\t}\r\n\r\n\treturn localUser ? (\r\n\t\t<div className=\"AppPage\">\r\n\t\t\t<Core localUser={localUser} />\r\n\t\t</div>\r\n\t) : null;\r\n}\r\n\r\nconst tickAwayStatus = _.debounce(() => {\r\n\tconst localUser = UserStore.getLocalUser();\r\n\r\n\tif (localUser.status === UserStatus.ONLINE) {\r\n\t\tDatabase.update(localUser._ref, {\r\n\t\t\tstatus: UserStatus.AWAY\r\n\t\t});\r\n\t}\r\n}, 10 * 1000 * 60);\r\n\r\nlet lastCircles;\r\nfunction Core({ localUser }) {\r\n\tconst { items: circles } = Database.useSnapshot(\r\n\t\tDatabase.collection(\"userdata\", localUser.id, \"circles\"),\r\n\t\t{\r\n\t\t\t// TODO handle circle stores\r\n\t\t\tprocessor: async doc => {\r\n\t\t\t\tconst circle = CircleStore.getCircles()[doc.id] ?? await CircleStore.fetchCircle(doc.id);\r\n\r\n\t\t\t\treturn _.assign(circle, doc);\r\n\t\t\t}\r\n\t\t}\r\n\t) ?? {};\r\n\r\n\tif (circles && lastCircles !== circles) {\r\n\t\tdispatcher.dispatch({\r\n\t\t\ttype: ActionTypes.CIRCLES_UPDATE,\r\n\t\t\tcircles\r\n\t\t});\r\n\r\n\t\tlastCircles = circles;\r\n\t}\r\n\r\n\tuseOnMount(() => {\r\n\t\tVoiceModule.initialize();\r\n\t});\r\n\r\n\tuseEventListener(\"focus\", () => {\r\n\t\tconst selectedGroup = GroupStore.getSelectedGroup();\r\n\t\tselectedGroup?.markAsRead();\r\n\t}, { target: window });\r\n\r\n\t// Handle statuses\r\n\tuseInterval(() => {\r\n\t\t// Get the local user\r\n\t\tconst localUser = UserStore.getLocalUser();\r\n\r\n\t\tif (document.hasFocus() && localUser) {\r\n\t\t\t// Handling refreshing idle status\r\n\t\t\ttickAwayStatus();\r\n\r\n\t\t\t// Wake status\r\n\t\t\tif (~[UserStatus.AWAY, UserStatus.OFFLINE, undefined].indexOf(localUser.status)) {\r\n\t\t\t\tDatabase.update(localUser._ref, {\r\n\t\t\t\t\tstatus: UserStatus.ONLINE\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Handle marking messages as read\r\n\t\t\tif (localUser.status !== UserStatus.AWAY) {\r\n\t\t\t\t// Get selected group\r\n\t\t\t\tconst group = GroupStore.getSelectedGroup();\r\n\t\t\t\tif (!group) return;\r\n\r\n\t\t\t\t// Get the last message\r\n\t\t\t\tconst messageId = Object.keys(MessageStore.getMessages(group.circleId, group.id) ?? {})\r\n\t\t\t\t\t.slice(-1)[0];\r\n\r\n\t\t\t\t// Ensure that shit be loaded\r\n\t\t\t\tif (messageId && _.get(\r\n\t\t\t\t\tMessageReadStore.getAllCachedReads(),\r\n\t\t\t\t\t[group.circleId, group.id]\r\n\t\t\t\t)) {\r\n\t\t\t\t\t// ensure we haven't already marked the message as read\r\n\t\t\t\t\tif (!(_.get(\r\n\t\t\t\t\t\tMessageReadStore.getReads(group.circleId, group.id),\r\n\t\t\t\t\t\t[localUser.id]\r\n\t\t\t\t\t)?.messageId === messageId)) {\r\n\t\t\t\t\t\tconst ref = Database.doc(...(\r\n\t\t\t\t\t\t\tgroup.isDm\r\n\t\t\t\t\t\t\t\t? [\"directmessages\", GroupDm.getId(group.id)]\r\n\t\t\t\t\t\t\t\t: [\"circles\", group.circleId, \"groups\", group.id]\r\n\t\t\t\t\t\t), \"lastread\", localUser.id);\r\n\r\n\t\t\t\t\t\tDatabase.set(ref, {\r\n\t\t\t\t\t\t\tmessageId,\r\n\t\t\t\t\t\t\ttimestamp: serverTimestamp()\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}, 2000);\r\n\r\n\tif (circles === undefined) {\r\n\t\treturn <LoadingOverlay />;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"Core\">\r\n\t\t\t<CssStore.Renderer />\r\n\t\t\t<SettingsCssRenderer />\r\n\r\n\t\t\t<LoadingOverlay hidden />\r\n\r\n\t\t\t<div className=\"Panel PanelMain Flex\">\r\n\t\t\t\t<div className=\"Panel PanelCircles\">\r\n\t\t\t\t\t<div className=\"Circles\">\r\n\t\t\t\t\t\t{circles\r\n\t\t\t\t\t\t\t.sort((a, b) => a.position - b.position)\r\n\t\t\t\t\t\t\t.map(circle => circle instanceof Circle && (\r\n\t\t\t\t\t\t\t\t<circle.BubbleComponent key={circle.id} />\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<DmBubbles />\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"Panel PanelCore\">\r\n\t\t\t\t\t<CorePanel />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"Panel PanelFooter FlexCenter\">\r\n\t\t\t\t<div className=\"Circle\" onClick={() => pushHistoryState(\"app/dms/\")}>\r\n\t\t\t\t\t<Users className=\"Icon\" />\r\n\r\n\t\t\t\t\t<Tooltip>DMs</Tooltip>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<ContextMenu.Wrapper\r\n\t\t\t\t\tmenu={<localUser.ContextMenu />}\r\n\t\t\t\t\twrapperClassName=\"LocalUserHead FlexCenter\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<div className=\"Circle\">\r\n\t\t\t\t\t\t<localUser.AvatarComponent className=\"Icon\" />\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"Details\">\r\n\t\t\t\t\t\t<h4 className=\"Username\">\r\n\t\t\t\t\t\t\t{localUser.displayName}\r\n\t\t\t\t\t\t</h4>\r\n\r\n\t\t\t\t\t\t<localUser.StatusText />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</ContextMenu.Wrapper>\r\n\r\n\t\t\t\t<div className=\"Divider\" />\r\n\r\n\t\t\t\t<ChatTextArea />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction LoadingOverlay({ hidden = false }) {\r\n\treturn (\r\n\t\t<div className={joinClassNames(\"LoadingOverlay\", \"FlexCenter\", [hidden, \"Hidden\"])}>\r\n\t\t\t<InlineLoading style={{ fontSize: \"2em\" }} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction DmBubbles() {\r\n\tconst localUser = UserStore.useState(() => UserStore.getLocalUser());\r\n\r\n\tdispatcher.useForceUpdater(\r\n\t\tActionTypes.UPDATE_MESSAGE_COUNT,\r\n\t\t({ circleId }) => ~circleId.split(\"_\").indexOf(localUser?.id)\r\n\t);\r\n\r\n\tdispatcher.useForceUpdater(\r\n\t\tActionTypes.UPDATE_READ_COUNT,\r\n\t\t({ circleId }) => ~circleId.split(\"_\").indexOf(localUser?.id)\r\n\t);\r\n\r\n\tdispatcher.useForceUpdater(ActionTypes.BATCH_UPDATE_DMS);\r\n\r\n\tconst dms = GroupStore.getGroups(\"dms\");\r\n\tconst unreads = Object.values(dms ?? {}).map(dm => (\r\n\t\t[dm.id, MessageCountStore.getUnreadMessageCount(dm.groupId)]\r\n\t), {});\r\n\r\n\treturn (\r\n\t\t<div className=\"DmBubbles\">\r\n\t\t\t<CircleBubble\r\n\t\t\t\tcircle={{\r\n\t\t\t\t\tid: \"__settings\",\r\n\t\t\t\t\tname: \"Settings\"\r\n\t\t\t\t}}\r\n\r\n\t\t\t\ticon={<Settings />}\r\n\t\t\t\tonClick={() => Modals.push(<SettingsModal />)}\r\n\t\t\t/>\r\n\r\n\t\t\t{unreads.map(([userId, unreadCount]) => unreadCount > 0 &&\r\n\t\t\t\t<DmBubble key={userId} userId={userId} unreadCount={unreadCount} />)}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction DmBubble({ userId, unreadCount }) {\r\n\tconst user = UserStore.getUser(userId);\r\n\r\n\tconst selectedGroup = GroupStore.getSelectedGroup();\r\n\tselectedGroup?.id === userId && MessageCountStore.markRead(selectedGroup.groupId);\r\n\r\n\tdispatcher.useForceUpdater(\r\n\t\tActionTypes.USER_UPDATE,\r\n\t\t({ user }) => user.id === userId\r\n\t);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (unreadCount <= 0) return;\r\n\r\n\t\tif (selectedGroup?.id !== userId || !document.hasFocus()) {\r\n\t\t\tplaySound(AlertSound, 0.5);\r\n\t\t}\r\n\t}, [unreadCount]);\r\n\r\n\treturn user ? (\r\n\t\t<div\r\n\t\t\tclassName=\"Circle DmBubble\"\r\n\t\t\tkey={userId}\r\n\t\t\tonClick={() => pushHistoryState(`#app/dms/${userId}`)}\r\n\t\t>\r\n\t\t\t{React.createElement(\r\n\t\t\t\tuser.AvatarComponent,\r\n\t\t\t\t{ size: 40 }\r\n\t\t\t)}\r\n\r\n\t\t\t<div className=\"UnreadBlips Flex\">\r\n\t\t\t\t<div className=\"Blip Mention\">\r\n\t\t\t\t\t{unreadCount > 999\r\n\t\t\t\t\t\t? `${Math.round(unreadCount / 1000)}k`\r\n\t\t\t\t\t\t: unreadCount}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<Tooltip direction=\"right\">{user.displayName}</Tooltip>\r\n\t\t</div>\r\n\t) : null;\r\n}","import React from \"react\";\nimport { X } from \"react-feather\";\nimport { ActionTypes } from \"../../Classes/Constants\";\nimport { dispatcher } from \"../../Classes/Dispatcher\";\nimport \"./BannerNotifications.scss\";\n\nexport default function BannerNotifications() {\n\tconst [notifications, setNotifications] = React.useState([]);\n\n\tReact.useEffect(() => {\n\t\tconst callback = ({ notification }) => {\n\t\t\tsetNotifications([...notifications, notification]);\n\t\t};\n\n\t\tdispatcher.subscribe(ActionTypes.DISPLAY_BANNER_NOTIFICATION, callback);\n\t\treturn () => dispatcher.unsubscribe(ActionTypes.DISPLAY_BANNER_NOTIFICATION, callback);\n\t}, [notifications]);\n\n\treturn (\n\t\t<div className=\"BannerNotifications\">\n\t\t\t{!!notifications.length && (\n\t\t\t\t<div className=\"Notif FlexCenter\">\n\t\t\t\t\t<div className=\"Contents\">\n\t\t\t\t\t\t{React.createElement(notifications[0] ?? \"\")}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<X\n\t\t\t\t\t\tclassName=\"Button CloseButton\"\n\t\t\t\t\t\tonClick={() => setNotifications(notifications.slice(1))}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}","import React, { useEffect } from \"react\";\nimport \"./city-fog-theme.css\";\nimport \"./App.scss\";\nimport { Modals } from \"./Components/Modals\";\nimport HomePage from \"./Pages/Home\";\nimport Toasts from \"./Components/Toasts\";\nimport { ActionTypes, joinClassNames } from \"./Classes/Constants\";\nimport ContextMenu from \"./Components/ContextMenuHandler\";\nimport PageFooter from \"./Components/PageElements/PageFooter\";\nimport { dispatcher } from \"./Classes/Dispatcher\";\nimport { onAuthStateChanged } from \"@firebase/auth\";\nimport Database from \"./Classes/Database\";\nimport AppPage from \"./Pages/AppPage\";\nimport UserStore from \"./Classes/Types/Stores/UserStore\";\nimport RealtimeDatabase from \"./Classes/RealtimeDatabase\";\nimport BannerNotifications from \"./Components/PageElements/BannerNotifications\";\n\nwindow.addEventListener(\"popstate\", () => {\n\tdispatcher.dispatch({\n\t\ttype: ActionTypes.PAGE_UPDATE\n\t});\n});\n\n// Because of GH pages, handle formatting the URL if on pages.\nfunction formatUrl(path) {\n\treturn path.startsWith(\"#\") ? path : `#${path}`;\n}\n\nexport function pushHistoryState(path) {\n\tpath = formatUrl(path);\n\n\twindow.history.pushState({ last: window.location.hash, lastTime: Date.now() }, null, path);\n\n\tdispatcher.dispatch({\n\t\ttype: ActionTypes.PAGE_UPDATE\n\t});\n}\n\nexport function replaceHistoryState(path) {\n\tpath = formatUrl(path);\n\n\twindow.history.replaceState({ last: window.location.hash, lastTime: Date.now() }, null, path);\n\n\tdispatcher.dispatch({\n\t\ttype: ActionTypes.PAGE_UPDATE\n\t});\n}\n\nexport let appHash = \"\";\nexport let appHashArgs = [];\n\nfunction PageElement() {\n\t// Use the force updater from the page update dispatch.\n\tdispatcher.useForceUpdater(ActionTypes.PAGE_UPDATE);\n\n\t// Store the formatted hash in a variable.\n\tconst [hash, ...args] = (window.location.hash\n\t\t.split(/#\\/?/)[1] ?? \"\")\n\t\t.split(\"?\")[0]\n\t\t.split(\"/\");\n\n\t// Set the app hash value.\n\tappHash = hash;\n\tappHashArgs = args;\n\n\t// Zhu Li, do the thing!\n\tswitch (hash) {\n\t\tdefault: return <HomePage />;\n\t\tcase \"app\": return <AppPage />;\n\t}\n}\n\nexport default function App() {\n\tdispatcher.useForceUpdater(ActionTypes.PAGE_UPDATE);\n\n\tReact.useEffect(() => {\n\t\t// Check if the user is signed in.\n\t\tonAuthStateChanged(Database.auth, async localUser => {\n\t\t\tlet user = null;\n\n\t\t\tif (localUser?.uid) {\n\t\t\t\tuser = await UserStore.fetchUser(localUser.uid);\n\n\t\t\t\t// Create a disconnect listener to set the status to offline\n\t\t\t\tconst offlineListener = RealtimeDatabase.createDisconnectListener(`userstatus/${user.id}`);\n\t\t\t\tawait offlineListener.setWithPriority({ o: false }, 100);\n\n\t\t\t\t// Set the status to online\n\t\t\t\tRealtimeDatabase.set(`userstatus/${user.id}`, { o: true });\n\t\t\t}\n\n\t\t\tdispatcher.dispatch({\n\t\t\t\ttype: ActionTypes.LOCAL_USER_UPDATE,\n\t\t\t\tuser\n\t\t\t});\n\t\t});\n\n\t\tif (~navigator.userAgent.indexOf(\"Firefox\")) {\n\t\t\tdispatcher.dispatch({\n\t\t\t\ttype: ActionTypes.DISPLAY_BANNER_NOTIFICATION,\n\t\t\t\tnotification: () => (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<b>WARNING</b> - You're using an unsupported browser. You <b>will</b> run into bugs and issues; please do not report these without testing on a modern web browser beforehand.\n\t\t\t\t\t</>\n\t\t\t\t)\n\t\t\t});\n\t\t}\n\t}, []);\n\n\treturn (\n\t\t<div className=\"App\">\n\t\t\t<BannerNotifications />\n\n\t\t\t<div className=\"Main\">\n\t\t\t\t<PageElement />\n\t\t\t</div>\n\n\t\t\t{window.location.hash.split(\"/\")[0].split(\"?\")[0] !== \"#app\" && <PageFooter />}\n\n\t\t\t<Modals />\n\t\t\t<Toasts />\n\t\t\t<ContextMenu.Handler />\n\t\t</div>\n\t);\n}","import React from \"react\";\r\n\r\nexport default class Store {\r\n\t_listeners = new Set;\r\n\r\n\tconstructor(dispatcher, actionHandlers) {\r\n\t\tthis._dispatcher = dispatcher;\r\n\r\n\t\tif (typeof (actionHandlers) === \"object\") {\r\n\t\t\tfor (const event in actionHandlers) {\r\n\t\t\t\tdispatcher.subscribe(event, action => {\r\n\t\t\t\t\tactionHandlers[event]?.(action) !== false && this.emitChange();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._actionHandlers = actionHandlers;\r\n\t}\r\n\r\n\t/**\r\n\t * Forcefully emit an empty change.\r\n\t */\r\n\temitChange() {\r\n\t\t// @ts-ignore\r\n\t\tfor (const listener of this._listeners) {\r\n\t\t\tlistener();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Attach a listener to the store.\r\n\t * @param {Function} listener \r\n\t * @returns {Set}\r\n\t */\r\n\taddListener(listener) {\r\n\t\treturn this._listeners.add(listener);\r\n\t}\r\n\r\n\t/**\r\n\t * Detach a listener from the store.\r\n\t * @param {Function} listener \r\n\t * @returns {boolean}\r\n\t */\r\n\tremoveListener(listener) {\r\n\t\treturn this._listeners.delete(listener);\r\n\t}\r\n\r\n\tget useState() {\r\n\t\treturn (factory = _ => _, deps = []) => {\r\n\t\t\tconst [state, setState] = React.useState(factory(this));\r\n\r\n\t\t\tReact.useEffect(() => {\r\n\t\t\t\tconst handleChange = () => setState(factory(this));\r\n\r\n\t\t\t\tthis.addListener(handleChange);\r\n\r\n\t\t\t\treturn () => void this.removeListener(handleChange);\r\n\t\t\t}, [state, ...deps]);\r\n\r\n\t\t\treturn state;\r\n\t\t};\r\n\t}\r\n}","import React from \"react\";\r\nimport \"./Tooltip.scss\";\r\nimport { joinClassNames } from \"../Classes/Constants\";\r\nimport ReactDOM from \"react-dom\";\r\n\r\nexport default function Tooltip({ children = null, direction = \"up\", className = \"\", color, style = null, onClick = null }) {\r\n\tconst [visible, setVisible] = React.useState(false);\r\n\tconst ref = React.useRef();\r\n\r\n\tReact.useEffect(() => {\r\n\t\tref.current.parentElement.classList.add(\"HasTooltip\");\r\n\r\n\t\treturn () => {\r\n\t\t\tref.current && ref.current.parentElement.classList.remove(\"HasTooltip\");\r\n\t\t};\r\n\t}, [children, direction]);\r\n\r\n\treturn (\r\n\t\t<div ref={ref} className={joinClassNames(\"TooltipContainer\", direction.toLowerCase(), [visible, \"Visible\"], className)} style={style} onClick={onClick}>\r\n\t\t\t<div className=\"Tooltip\" style={{ backgroundColor: color }}>{children}</div>\r\n\t\t\t<div className=\"TooltipArrow\" style={{ backgroundColor: color }} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function DetachedTooltip({ children, direction = \"up\", className = \"\", color, style, onClick, parentRef }) {\r\n\tconst container = React.useMemo(() => document.getElementsByClassName(\"AppMain\")[0], []);\r\n\tconst [visible, setVisible] = React.useState(false);\r\n\tconst [styles, setStyles] = React.useState(null);\r\n\tconst ref = React.useRef();\r\n\r\n\tReact.useEffect(() => {\r\n\t\tconst parent = parentRef.current;\r\n\r\n\t\tconst events = {\r\n\t\t\tonMouseEnter: () => {\r\n\t\t\t\tif (visible) return;\r\n\r\n\t\t\t\tconst rect = parent.getBoundingClientRect();\r\n\t\t\t\tconst tooltipRect = ref.current.getBoundingClientRect();\r\n\r\n\t\t\t\tswitch (direction) {\r\n\t\t\t\t\tcase \"up\":\r\n\t\t\t\t\t\tsetStyles({\r\n\t\t\t\t\t\t\ttop: rect.y - rect.height - tooltipRect.height,\r\n\t\t\t\t\t\t\tleft: rect.x + (rect.width / 2)\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"left\":\r\n\t\t\t\t\t\tsetStyles({\r\n\t\t\t\t\t\t\ttop: rect.y - (rect.height / 2) + ((tooltipRect.height * 1.25) / 3),\r\n\t\t\t\t\t\t\tleft: rect.x - (tooltipRect.width * 1.25)\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"down\":\r\n\t\t\t\t\t\tsetStyles({\r\n\t\t\t\t\t\t\tbottom: rect.y - (tooltipRect.height * 1.25),\r\n\t\t\t\t\t\t\tleft: rect.x - ((tooltipRect.width * 1.25) / 2) + (rect.width / 2)\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"right\":\r\n\t\t\t\t\t\tsetStyles({\r\n\t\t\t\t\t\t\ttop: rect.y - ((tooltipRect.height * 1.25) / 2) + (rect.height / 2),\r\n\t\t\t\t\t\t\tright: rect.x - tooltipRect.width - 5\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsetVisible(true);\r\n\t\t\t},\r\n\t\t\tonMouseLeave: () => setVisible(false)\r\n\t\t};\r\n\r\n\t\tparent.addEventListener(\"mouseenter\", events.onMouseEnter);\r\n\t\tparent.addEventListener(\"mouseleave\", events.onMouseLeave);\r\n\r\n\t\treturn () => {\r\n\t\t\tparent.removeEventListener(\"mouseenter\", events.onMouseEnter);\r\n\t\t\tparent.removeEventListener(\"mouseleave\", events.onMouseLeave);\r\n\t\t};\r\n\t}, [children, direction]);\r\n\r\n\treturn ReactDOM.createPortal(\r\n\t\t<div ref={ref} className={joinClassNames(\"TooltipContainer Detached\", direction.toLowerCase(), [visible, \"Visible\"], className)}\r\n\t\t\tstyle={{ ...(styles ?? {}), ...(style ?? {}) }} onClick={onClick}>\r\n\t\t\t<div className=\"Tooltip\" style={{ backgroundColor: color }}>{children}</div>\r\n\t\t\t<div className=\"TooltipArrow\" style={{ backgroundColor: color }} />\r\n\t\t</div>,\r\n\t\tcontainer\r\n\t);\r\n}","import React, { createRef } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { ChevronRight } from \"react-feather\";\r\nimport \"./ContextMenuHandler.scss\";\r\nimport ErrorBoundary from \"./ErrorBoundary\";\r\n\r\nfunction exclude(object, ...exclusions) {\r\n\tconst output = Object.assign({}, object);\r\n\r\n\tfor (const exclusion of exclusions) delete output[exclusion];\r\n\treturn output;\r\n}\r\n\r\nclass ContextMenu extends React.Component {\r\n\tref = createRef();\r\n\r\n\tdocClickEv = e => {\r\n\t\tif (this.ref.current && !this.ref.current.contains(e.target) && !document.getElementsByClassName(\"ContextMenu\")[0].contains(e.target)) {\r\n\t\t\tthis.close();\r\n\t\t}\r\n\t}\r\n\r\n\tclose() {\r\n\t\tif (ContextMenu.activeWrapper) {\r\n\t\t\tContextMenu.activeWrapper.setState({ menu: null, open: false });\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tdocument.addEventListener(\"click\", this.docClickEv);\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tdocument.removeEventListener(\"click\", this.docClickEv);\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<ErrorBoundary>\r\n\t\t\t\t<div className=\"ContextMenu\" {...this.props} ref={this.ref}>\r\n\t\t\t\t\t{this.props.children}\r\n\t\t\t\t</div>\r\n\t\t\t</ErrorBoundary>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nContextMenu.Handler = class extends React.Component {\r\n\tstatic ref = createRef();\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<ErrorBoundary>\r\n\t\t\t\t<div ref={ContextMenu.Handler.ref} className=\"ContextMenuWrapper MainContextMenuContainer\">\r\n\r\n\t\t\t\t</div>\r\n\t\t\t</ErrorBoundary>\r\n\t\t);\r\n\t}\r\n};\r\n\r\nContextMenu.Wrapper = class extends React.Component {\r\n\tstate = { menu: null, open: false };\r\n\tref = createRef();\r\n\r\n\tget publicProps() {\r\n\t\treturn exclude(this.props, \"menu\", \"openOnClick\", \"wrapperClassName\", \"overrideX\", \"overrideY\");\r\n\t}\r\n\r\n\thandleContextMenu = e => {\r\n\t\tif (typeof (e.preventDefault) === \"function\")\r\n\t\t\te.preventDefault();\r\n\r\n\t\tif (ContextMenu.activeWrapper) {\r\n\t\t\tif (this.ref.current.contains(ContextMenu.activeWrapper.ref.current) && ContextMenu.activeWrapper.props.menu !== this.props.menu)\r\n\t\t\t\treturn;\r\n\t\t\tContextMenu.activeWrapper.setState({ menu: null, open: false });\r\n\t\t}\r\n\r\n\t\tContextMenu.activeWrapper = this;\r\n\r\n\t\tlet top = this.props.menu.props.overrideY?.() || e.clientY;\r\n\t\tlet left = this.props.menu.props.overrideX?.() || e.clientX;\r\n\r\n\t\twhile (left + 200 > window.innerWidth)\r\n\t\t\tleft -= 10;\r\n\r\n\t\tthis.setState({\r\n\t\t\tmenu: ReactDOM.createPortal(\r\n\t\t\t\t<div className=\"ContextMenuContainer SecondaryBg\" {...this.publicProps} style={{\r\n\t\t\t\t\tposition: \"fixed\",\r\n\t\t\t\t\ttop, left\r\n\t\t\t\t}}>{this.props.menu}</div>, ContextMenu.Handler.ref.current), open: true\r\n\t\t});\r\n\t}\r\n\r\n\tasync componentDidUpdate(prevProps, prevState, snapshot) {\r\n\t\tif (ContextMenu.activeWrapper === this && !this.state.open)\r\n\t\t\tContextMenu.activeWrapper = null;\r\n\r\n\t\tif (this.state.open && this.ref.current) {\r\n\t\t\tconst [menu] = document.getElementsByClassName(\"ContextMenuContainer\");\r\n\t\t\tconst rect = menu.getBoundingClientRect();\r\n\r\n\t\t\tmenu.style.transform = rect.y + rect.height > window.innerHeight\r\n\t\t\t\t? `translateY(${window.innerHeight - (rect.y + rect.height) - 20}px)`\r\n\t\t\t\t: null;\r\n\t\t}\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn this.props.menu ? (\r\n\t\t\t<ErrorBoundary>\r\n\t\t\t\t<div ref={this.ref} className={\"ContextMenuWrapper \" + (this.props.wrapperClassName || \"\")} onClick={this.props.openOnClick ? e => {\r\n\t\t\t\t\tif (typeof (e.target.onClick) === \"function\")\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tthis.handleContextMenu(this.props.openOnClick());\r\n\t\t\t\t} : null}\r\n\t\t\t\t\t{...this.publicProps} onContextMenu={this.handleContextMenu}>\r\n\t\t\t\t\t{this.props.children}\r\n\r\n\t\t\t\t\t<ErrorBoundary>\r\n\t\t\t\t\t\t{this.state.open ? this.state.menu : null}\r\n\t\t\t\t\t</ErrorBoundary>\r\n\t\t\t\t</div>\r\n\t\t\t</ErrorBoundary>\r\n\t\t) : this.props.children;\r\n\t}\r\n}\r\n\r\nContextMenu.Item = class extends React.Component {\r\n\thandleClick = e => {\r\n\t\te.preventDefault();\r\n\t\te.stopPropagation();\r\n\r\n\t\tif (ContextMenu.activeWrapper && this.props.autoClose) {\r\n\t\t\tContextMenu.activeWrapper.setState({ menu: null, open: false });\r\n\t\t}\r\n\r\n\t\tif (this.props.onClick) {\r\n\t\t\tthis.props.onClick(this);\r\n\t\t}\r\n\t};\r\n\r\n\trender() {\r\n\t\tconst props = Object.assign({}, this.props);\r\n\r\n\t\tdelete props.autoClose;\r\n\t\tdelete props.icon;\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"ContextMenuItem\" {...props} onClick={this.handleClick}>\r\n\t\t\t\t{this.props.icon}\r\n\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nContextMenu.SubMenuItem = class extends React.Component {\r\n\tstate = { open: false };\r\n\r\n\thandleMouseEnter = () => {\r\n\t\tthis.setState({ open: true });\r\n\t}\r\n\r\n\thandleMouseLeave = () => {\r\n\t\tthis.setState({ open: false });\r\n\t}\r\n\r\n\thandleClick = e => {\r\n\t\tif (e.target !== e.currentTarget) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (ContextMenu.activeWrapper && this.props.autoClose) {\r\n\t\t\tContextMenu.activeWrapper.setState({ menu: null, open: false });\r\n\t\t}\r\n\r\n\t\tif (this.props.onClick) {\r\n\t\t\tthis.props.onClick(this);\r\n\t\t}\r\n\t}\r\n\r\n\tmount(menu) {\r\n\t\tif (!menu) return;\r\n\t\tconst rect = menu.getBoundingClientRect();\r\n\r\n\t\tmenu.style.transform = rect.y + rect.height > window.innerHeight\r\n\t\t\t? `translateY(${window.innerHeight - (rect.y + rect.height) - 20}px)`\r\n\t\t\t: null;\r\n\r\n\t\tif (rect.x + rect.width > window.innerWidth) {\r\n\t\t\tmenu.style.left = \"unset\";\r\n\t\t\tmenu.style.right = \"100%\";\r\n\t\t}\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst props = Object.assign({}, this.props);\r\n\r\n\t\tdelete props.autoClose;\r\n\t\tdelete props.label;\r\n\t\tdelete props.icon;\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"ContextMenuItem HasSubMenu\" {...props} onClick={this.handleClick} onMouseEnter={this.handleMouseEnter} onMouseLeave={this.handleMouseLeave}>\r\n\t\t\t\t{this.props.icon}\r\n\t\t\t\t{this.props.label} <ChevronRight className=\"ContextSubMenuChevron\" />\r\n\t\t\t\t{this.state.open ? (\r\n\t\t\t\t\t<div className=\"ContextMenuContainer SubMenuContainer SecondaryBg\" ref={this.mount}>\r\n\t\t\t\t\t\t<div className=\"ContextMenu SubMenu\">\r\n\t\t\t\t\t\t\t{this.props.children}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t) : null}\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nContextMenu.ToggleItem = class extends React.Component {\r\n\tstate = { checked: false };\r\n\r\n\tcallback = () => {\r\n\t\tif (ContextMenu.activeWrapper && this.props.autoClose) {\r\n\t\t\tContextMenu.activeWrapper.setState({ menu: null, open: false });\r\n\t\t}\r\n\r\n\t\tconst checked = !this.state.checked;\r\n\r\n\t\tif (this.props.callback) {\r\n\t\t\tthis.props.callback(checked);\r\n\t\t}\r\n\r\n\t\tthis.setState({ checked });\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.setState({ checked: this.props.checked });\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst props = Object.assign({}, this.props);\r\n\r\n\t\tdelete props.autoClose;\r\n\t\tdelete props.callback;\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"ContextMenuItem ToggleItem\" {...props} onClick={this.callback}>\r\n\t\t\t\t<div className={\"ToggleBox\" + (this.state.checked ? \" Checked\" : \"\")}>\r\n\t\t\t\t\t{this.state.checked ? (<div className=\"ToggleBoxTick\" />) : null}\r\n\t\t\t\t</div>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nContextMenu.Divider = class extends React.Component {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div className=\"ContextMenuDivider\" {...this.props} />\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default ContextMenu;","import React from \"react\";\r\nimport App from \"../App\";\r\n\r\n/**\r\n * A setInterval hook for React components.\r\n * @param callback The function to call for the interval.\r\n * @param delay The delay between each call.\r\n * @param callInstantly Whether or not the callback will call instantly upon registering the hook.\r\n * @param deps The dependencies array for the hook.\r\n */\r\nexport function useInterval(callback, delay, callInstantly = false, deps = []) {\r\n\t// Create side effect\r\n\tReact.useEffect(() => {\r\n\t\t// Create interval based on delay\r\n\t\tconst interval = setInterval(callback, delay);\r\n\t\t// If call instantly is truthy, run the callback\r\n\t\tcallInstantly && callback();\r\n\r\n\t\t// On unmount, clear the interval\r\n\t\treturn () => clearInterval(interval);\r\n\t}, deps);\r\n}\r\n\r\nexport function useDependentState(factory, deps = []) {\r\n\tconst [state, setState] = React.useState(factory());\r\n\r\n\tReact.useMemo(() => {\r\n\t\tconst newState = factory(state);\r\n\r\n\t\tif (newState !== state) {\r\n\t\t\tsetState(newState);\r\n\t\t}\r\n\t}, [state, ...deps]);\r\n\r\n\treturn [state, setState];\r\n}\r\n\r\nexport function useMounted() {\r\n\tconst state = React.useRef(false);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tstate.current = true;\r\n\r\n\t\treturn () => void (state.current = false);\r\n\t}, []);\r\n\r\n\treturn state;\r\n}\r\n\r\nconst promiseCache = {};\r\nexport function usePromise(promise, useCache = true, deps = []) {\r\n\tconst [value, setValue] = useDependentState(\r\n\t\t() => useCache ? promiseCache[promise] : null,\r\n\t\t[promise, ...deps]\r\n\t);\r\n\tconst isMounted = useMounted();\r\n\r\n\tReact.useEffect(() => {\r\n\t\t!value && promise().then(v => (\r\n\t\t\tisMounted.current && setValue(v),\r\n\t\t\tpromiseCache[promise] = v\r\n\t\t));\r\n\t}, deps);\r\n\r\n\treturn value;\r\n}\r\n\r\nexport function useEventListener(eventType, callback, options = {}) {\r\n\tconst {\r\n\t\ttarget = document,\r\n\t\tdependencies = [],\r\n\t\tinit = false\r\n\t} = options;\r\n\r\n\tReact.useEffect(() => {\r\n\t\ttarget.addEventListener(eventType, callback);\r\n\t\tinit && callback();\r\n\r\n\t\treturn () => target.removeEventListener(eventType, callback);\r\n\t}, dependencies);\r\n}\r\n\r\nexport function useOnMount(callback) {\r\n\tReact.useEffect(() => {\r\n\t\tcallback();\r\n\t}, []);\r\n}\r\n\r\nexport function useOnUnmount(callback) {\r\n\tReact.useEffect(() => {\r\n\t\treturn callback;\r\n\t}, []);\r\n}\r\n\r\nexport function useMediaQuery(type, size) {\r\n\tconst query = React.useMemo(() => window.matchMedia(`(${type}: ${size}px)`), [type, size]);\r\n\tconst [state, setState] = React.useState(query.matches);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tconst listener = e => setState(e.matches);\r\n\r\n\t\tquery.addEventListener(\"change\", listener);\r\n\t\treturn () => query.removeEventListener(\"change\", listener);\r\n\t}, [type, size]);\r\n\r\n\treturn state;\r\n}","import _ from \"lodash\";\r\nimport { ActionTypes, playSound } from \"../../Constants\";\r\nimport Database from \"../../Database\";\r\nimport { dispatcher } from \"../../Dispatcher\";\r\nimport Store from \"../../Store\";\r\nimport GroupStore from \"./GroupStore\";\r\nimport UserStore from \"./UserStore\";\r\n\r\nconst cache = {};\r\nconst readCounts = {};\r\nconst listeners = {};\r\n\r\nlet readCountListenerInitialized = false;\r\n\r\nconst MessageCountStoreClass = class MessageCountStore extends Store {\r\n\tasync _initializeReadListener() {\r\n\t\tlet localUser;\r\n\t\twhile (!(localUser = UserStore.getLocalUser()))\r\n\t\t\tawait new Promise(r => setTimeout(r, 250));\r\n\r\n\t\tDatabase.createSnapshotListener(\r\n\t\t\tDatabase.doc(\"usersettings\", localUser.id, \"v2\", \"readCounts\"),\r\n\t\t\tdata => {\r\n\t\t\t\tdata = Database.serializeObject(data);\r\n\r\n\t\t\t\tfor (const circleId in data) {\r\n\t\t\t\t\tfor (const groupId in data[circleId]) {\r\n\t\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\t\ttype: ActionTypes.UPDATE_READ_COUNT,\r\n\t\t\t\t\t\t\tcircleId, groupId,\r\n\t\t\t\t\t\t\tvalue: data[circleId][groupId],\r\n\t\t\t\t\t\t\tfromDb: true\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treadCountListenerInitialized = true;\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\t_initializeListenerFor(circleId) {\r\n\t\tif (listeners[circleId]) return;\r\n\r\n\t\tlisteners[circleId] = Database.createSnapshotListener(\r\n\t\t\tDatabase.doc(\"messageCounts\", circleId),\r\n\t\t\tdata => {\r\n\t\t\t\tdata = Database.serializeObject(data);\r\n\r\n\t\t\t\tconst selectedGroup = GroupStore.getSelectedGroup();\r\n\r\n\t\t\t\tfor (const groupId in data) {\r\n\t\t\t\t\tif (groupId === \"t\") continue;\r\n\r\n\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\ttype: ActionTypes.UPDATE_MESSAGE_COUNT,\r\n\t\t\t\t\t\tcircleId, groupId,\r\n\t\t\t\t\t\tvalue: data[groupId] || 0\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (selectedGroup?.id === groupId && document.hasFocus()) {\r\n\t\t\t\t\t\tthis.markRead(circleId, groupId);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\ttype: ActionTypes.UPDATE_MESSAGE_COUNT,\r\n\t\t\t\t\tcircleId,\r\n\t\t\t\t\tgroupId: \"__total\",\r\n\t\t\t\t\tvalue: data.t || 0\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (selectedGroup?.groupId === circleId && document.hasFocus()) {\r\n\t\t\t\t\tthis.markRead(circleId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tgetMessageCount(circleId, groupId = null) {\r\n\t\tif (!listeners[circleId]) this._initializeListenerFor(circleId);\r\n\r\n\t\treturn _.get(cache, [circleId, groupId ?? \"__total\"]) || 0;\r\n\t}\r\n\r\n\tgetUnreadMessageCount(circleId, groupId = null) {\r\n\t\tif (!listeners[circleId]) this._initializeListenerFor(circleId);\r\n\r\n\t\tlet total = 0;\r\n\t\tlet read = 0;\r\n\r\n\t\tif (groupId == null && !~circleId.split(\"_\").indexOf(UserStore.getLocalUser().id)) {\r\n\t\t\tfor (const groupId in cache[circleId] ?? {}) {\r\n\t\t\t\tif (groupId === \"__total\") continue;\r\n\r\n\t\t\t\ttotal += this.getMessageCount(circleId, groupId);\r\n\t\t\t\tread += _.get(readCounts, [circleId, groupId], 0);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttotal = this.getMessageCount(circleId, groupId);\r\n\t\t\tread = _.get(readCounts, [circleId, groupId ?? \"__total\"]);\r\n\t\t}\r\n\r\n\t\tif ((!read || total < read) && total !== read) {\r\n\t\t\t_.set(readCounts, [circleId, groupId], total);\r\n\r\n\t\t\treturn total;\r\n\t\t}\r\n\r\n\t\treturn total - read <= 0 ? 0 : total - read;\r\n\t}\r\n\r\n\tmarkRead(circleId, groupId = null, value = null) {\r\n\t\tdispatcher.dispatch({\r\n\t\t\ttype: ActionTypes.UPDATE_READ_COUNT,\r\n\t\t\tcircleId,\r\n\t\t\tgroupId: groupId ?? \"__total\",\r\n\t\t\tvalue: value ?? this.getMessageCount(circleId, groupId)\r\n\t\t});\r\n\t}\r\n\r\n\tpushValue(circleId, groupId, value = 1) {\r\n\t\tconst current = _.get(cache, [circleId, groupId]);\r\n\t\tconst currentTotal = _.get(cache, [circleId, \"__total\"]);\r\n\r\n\t\tif (~[current, currentTotal].indexOf(undefined)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t_.set(cache, [circleId, groupId], current + value);\r\n\t\t_.set(cache, [circleId, \"__total\"], current + value);\r\n\r\n\t\tconst selectedGroup = GroupStore.getSelectedGroup();\r\n\t\tif (selectedGroup && selectedGroup.circleId === circleId && selectedGroup.id === groupId) {\r\n\t\t\tthis.markRead(circleId, groupId);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst updateDatabase = _.debounce(() => {\r\n\tif (!readCountListenerInitialized) return;\r\n\r\n\tDatabase.set(\r\n\t\tDatabase.doc(\"usersettings\", UserStore.getLocalUser().id, \"v2\", \"readCounts\"),\r\n\t\treadCounts\r\n\t);\r\n}, 3000);\r\n\r\nconst MessageCountStore = new MessageCountStoreClass(dispatcher, {\r\n\t[ActionTypes.UPDATE_MESSAGE_COUNT]: ({ circleId, groupId, value }) => {\r\n\t\t_.set(cache, [circleId, groupId], value);\r\n\t},\r\n\t[ActionTypes.UPDATE_READ_COUNT]: ({ circleId, groupId, value, fromDb }) => {\r\n\t\t_.set(readCounts, [circleId, groupId], value);\r\n\r\n\t\t!fromDb && updateDatabase();\r\n\t}\r\n});\r\n\r\nMessageCountStore._initializeReadListener();\r\n\r\nexport default MessageCountStore;","import React from \"react\";\r\nimport \"./InlineLoading.scss\";\r\n\r\nexport default function InlineLoading(props) {\r\n\treturn (\r\n\t\t<div className=\"InlineLoadingContainer\" {...props}>\r\n\t\t\t<div className=\"Dot A\" />\r\n\t\t\t<div className=\"Dot B\" />\r\n\t\t\t<div className=\"Dot C\" />\r\n\t\t</div>\r\n\t)\r\n}","import _ from \"lodash\";\r\nimport { ActionTypes } from \"../../Constants\";\r\nimport Database from \"../../Database\";\r\nimport { dispatcher } from \"../../Dispatcher\";\r\nimport Store from \"../../Store\";\r\nimport Circle from \"../Circle\";\r\nimport MessageStore from \"./MessageStore\";\r\nimport TypingStore from \"./TypingStore\";\r\n\r\nconst cache = {};\r\n\r\nconst CircleStoreClass = class CircleStore extends Store {\r\n\tgetCircle(circleId) {\r\n\t\treturn cache[circleId] ?? (\r\n\t\t\tthis.fetchCircle(circleId),\r\n\t\t\tnew Circle({\r\n\t\t\t\tid: circleId,\r\n\t\t\t\tloading: true,\r\n\t\t\t\tname: \"...\"\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tgetCircles() {\r\n\t\treturn cache;\r\n\t}\r\n\r\n\tasync fetchCircle(circleId, oneTime = false) {\r\n\t\treturn new Promise(r => {\r\n\t\t\tconst unbind = Database.createSnapshotListener(\r\n\t\t\t\tDatabase.doc(\"circles\", circleId),\r\n\t\t\t\tdoc => {\r\n\t\t\t\t\tconst circle = doc\r\n\t\t\t\t\t\t? _.extend(cache[circleId] ?? new Circle(), doc)\r\n\t\t\t\t\t\t: new Circle({\r\n\t\t\t\t\t\t\tid: circleId,\r\n\t\t\t\t\t\t\tname: \"Invalid Circle\"\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\tTypingStore.tryCreateListenerFor(circleId);\r\n\r\n\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\ttype: ActionTypes.CIRCLE_UPDATE,\r\n\t\t\t\t\t\tcircle\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\toneTime && unbind();\r\n\r\n\t\t\t\t\tr(circle);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tdestroyCircle(circleId) {\r\n\t\tconst circle = cache[circleId];\r\n\t\tif (!circle) return;\r\n\r\n\t\tcircle._unbindListener();\r\n\r\n\t\tconst cleanups = MessageStore.getCleanupCache()[circleId] ?? {};\r\n\r\n\t\tfor (const groupId in cleanups) {\r\n\t\t\tMessageStore.cleanup(circleId, groupId);\r\n\t\t}\r\n\r\n\t\tdelete cache[circleId];\r\n\t}\r\n}\r\n\r\nconst CircleStore = new CircleStoreClass(dispatcher, {\r\n\t[ActionTypes.CIRCLE_UPDATE]: ({ circle }) => {\r\n\t\tcache[circle.id] = circle;\r\n\t},\r\n\t[ActionTypes.CIRCLE_UPDATE_GROUPS]: ({ circle, groups }) => {\r\n\t\tcache[circle.id]._groups = groups;\r\n\t}\r\n});\r\n\r\nexport default CircleStore;","import _ from \"lodash\";\r\nimport { ActionTypes } from \"./Constants\";\r\nimport { dispatcher } from \"./Dispatcher\";\r\nimport GroupStore from \"./Types/Stores/GroupStore\";\r\nimport UserStore from \"./Types/Stores/UserStore\";\r\n\r\nexport const VoiceEvents = {\r\n\tUPDATE_MEMBERS: \"UPDATE_MEMBERS\",\r\n\tINITIALIZE: \"INITIALIZE\",\r\n\tCONNECT: \"CONNECT\",\r\n\tDISCONNECT: \"DISCONNECT\",\r\n\tADD_TRACK: \"ADD_TRACK\",\r\n\tPC_ANSWER: \"PC_ANSWER\",\r\n\tSEND_ICE: \"SEND_ICE\",\r\n\tREQUEST_CONSUMER_CONNECTION: \"REQUEST_CONSUMER\",\r\n\tRECEIVE_CONSUMER: \"RECEIVE_CONSUMER\",\r\n\tUPDATE_CONSUMER_ICE: \"UPDATE_CONSUMER_ICE\"\r\n};\r\n\r\nconst VoiceModule = new class VoiceModule {\r\n\tcurrentRoom = null;\r\n\r\n\tasync initialize() {\r\n\t\tif (this.initialized) return;\r\n\t\tthis.initialized = true;\r\n\r\n\t\tconst address = \"192.99.69.216\";\r\n\t\tconst debugAddress = window.location.hostname;\r\n\t\tconst port = \"46236\";\r\n\r\n\t\tconst newSocket = () => new WebSocket(`ws://${address}:${port}`);\r\n\t\tthis.socket = newSocket();\r\n\r\n\t\tthis.socket.onerror = err => console.error(\"your mom\", err);\r\n\r\n\t\tconsole.log(\"socket\", this.socket);\r\n\r\n\t\tthis.socket.addEventListener(\"message\", ({ data }) => {\r\n\t\t\tconst event = JSON.parse(data);\r\n\r\n\t\t\tconsole.log(\r\n\t\t\t\t\"voice ws message\",\r\n\t\t\t\tevent\r\n\t\t\t);\r\n\r\n\t\t\tswitch (event.type) {\r\n\t\t\t\tcase VoiceEvents.UPDATE_MEMBERS: {\r\n\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\t...event,\r\n\t\t\t\t\t\ttype: ActionTypes.UPDATE_VOICE_MEMBERS\r\n\t\t\t\t\t});\r\n\t\t\t\t} break;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// this.socket.addEventListener(\"close\", () => {\r\n\t\t// \tthis.socket = newSocket();\r\n\t\t// });\r\n\r\n\t\tdispatcher.subscribe(ActionTypes.CIRCLES_UPDATE, async ({ circles }) => {\r\n\t\t\tconst circleIds = circles.map(c => c.id);\r\n\r\n\t\t\twhile (this.socket.readyState !== WebSocket.OPEN)\r\n\t\t\t\tawait new Promise(r => setImmediate(r));\r\n\r\n\t\t\tthis.socket.send(\r\n\t\t\t\tJSON.stringify({\r\n\t\t\t\t\ttype: VoiceEvents.INITIALIZE,\r\n\t\t\t\t\tuserId: UserStore.getLocalUser().id,\r\n\t\t\t\t\tcircleIds\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nconst iceOptions = {\r\n\ticeServers: [{\r\n\t\turls: [\"stun:192.99.69.216:46235\"]\r\n\t}],\r\n\ticeCandidatePoolSize: 10\r\n};\r\n\r\nexport class ChatRoom {\r\n\tconnections = {};\r\n\r\n\tconstructor(circleId, groupId) {\r\n\t\tconst group = GroupStore.getGroup(circleId, groupId);\r\n\r\n\t\tif (!group) {\r\n\t\t\tconsole.error(\"Unable to find voice group!\", { circleId, groupId });\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tthis.group = group;\r\n\r\n\t\t// Bind events\r\n\t\tthis.handleMessage = this.handleMessage.bind(this);\r\n\t}\r\n\r\n\temitSocket(event) {\r\n\t\tconsole.log(\"emitting socket event\", event);\r\n\t\tVoiceModule.socket.send(JSON.stringify(event));\r\n\t}\r\n\r\n\tasync connect() {\r\n\t\tif (VoiceModule.currentRoom)\r\n\t\t\tawait VoiceModule.currentRoom.disconnect();\r\n\r\n\t\tconsole.log(\"should connect\");\r\n\r\n\t\tVoiceModule.socket.addEventListener(\"message\", this.handleMessage);\r\n\r\n\t\tthis.initializePeerConnection().catch(\r\n\t\t\tconsole.error.bind(\"Failed to initialize peer connection!\")\r\n\t\t);\r\n\r\n\t\tdispatcher.dispatch({\r\n\t\t\ttype: ActionTypes.UPDATE_CURRENT_CALL,\r\n\t\t\tcall: this\r\n\t\t});\r\n\r\n\t\tVoiceModule.currentRoom = this;\r\n\t}\r\n\r\n\tcreatePeerConnection() {\r\n\t\treturn _.extend(\r\n\t\t\tnew RTCPeerConnection(iceOptions),\r\n\t\t\t{\r\n\t\t\t\tonicecandidate: this.handleIceCandidate.bind(this),\r\n\t\t\t\tonnegotiationneeded: this.handleNegotiation.bind(this)\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tasync handleIceCandidate({ candidate }) {\r\n\t\tif (candidate?.candidate?.length) {\r\n\t\t\tthis.emitSocket({\r\n\t\t\t\ttype: VoiceEvents.SEND_ICE,\r\n\t\t\t\tice: candidate\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tasync handleNegotiation(peer, type) {\r\n\t\tconsole.log(\"negotiation is needed on the client side\");\r\n\r\n\t\tconst offer = await this.pc.createOffer();\r\n\t\tawait this.pc.setLocalDescription(offer);\r\n\r\n\t\tconsole.log(\"offer was created\");\r\n\r\n\t\tthis.emitSocket({\r\n\t\t\ttype: VoiceEvents.CONNECT,\r\n\t\t\toffer,\r\n\t\t\tcircleId: this.group.circleId,\r\n\t\t\tgroupId: this.group.id\r\n\t\t});\r\n\t}\r\n\r\n\tasync initializePeerConnection() {\r\n\t\tconst stream = await navigator.mediaDevices.getUserMedia({\r\n\t\t\tvideo: false,\r\n\t\t\taudio: true\r\n\t\t});\r\n\r\n\t\tthis.handleTrack(stream, UserStore.getLocalUser().id);\r\n\t\tthis.localStream = stream;\r\n\r\n\t\tthis.pc = this.createPeerConnection();\r\n\t\tthis.pc.addTransceiver(\"video\", { direction: \"sendonly\" });\r\n\t\tthis.pc.addTransceiver(\"audio\", { direction: \"sendonly\" });\r\n\r\n\t\tthis.pc.onicecandidateerror = e => {\r\n\t\t\tconsole.error(\"local ice candidate error\", e);\r\n\t\t}\r\n\r\n\t\tfor (const track of stream.getTracks()) {\r\n\t\t\tthis.pc.addTrack(track, stream);\r\n\t\t\tconsole.log(\"adding track to stream\", track);\r\n\t\t}\r\n\t}\r\n\r\n\thandleTrack(stream, userId) {\r\n\t\tconsole.log(\"handle track\", userId);\r\n\r\n\t\t// TODO handle video\r\n\t\tif (userId === UserStore.getLocalUser().id) return;\r\n\r\n\t\tconst id = `vc-aud-${userId}`;\r\n\r\n\t\tconst audio = _.assign(\r\n\t\t\tdocument.getElementById(id) ?? document.createElement(\"audio\"),\r\n\t\t\t{\r\n\t\t\t\tid,\r\n\t\t\t\tstyle: \"display:none\",\r\n\t\t\t\tvolume: 0.5\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tconsole.log({ audio, stream, userId });\r\n\r\n\t\tdocument.body.appendChild(audio);\r\n\r\n\t\t// Shitzilla Shitfox\r\n\t\taudio.srcObject = stream;\r\n\t\taudio.autoplay = true;\r\n\t}\r\n\r\n\tasync disconnect() {\r\n\t\tconsole.log(\"should disconnect\");\r\n\r\n\t\tVoiceModule.socket.removeEventListener(\"message\", this.handleMessage);\r\n\r\n\t\tthis.emitSocket({ type: VoiceEvents.DISCONNECT });\r\n\r\n\t\tdispatcher.dispatch({\r\n\t\t\ttype: ActionTypes.UPDATE_CURRENT_CALL,\r\n\t\t\tcall: null\r\n\t\t});\r\n\r\n\t\tVoiceModule.currentRoom = null;\r\n\t}\r\n\r\n\tasync requestConsumer(userId) {\r\n\t\tconsole.log(\"HANDLING CONSUMER\", userId);\r\n\t\tconst pc = new RTCPeerConnection(iceOptions);\r\n\r\n\t\t_.extend(this.connections, {\r\n\t\t\t[userId]: {\r\n\t\t\t\tpc\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst transceiverOptions = {\r\n\t\t\tdirection: \"recvonly\"\r\n\t\t};\r\n\r\n\t\tpc.addTransceiver(\"video\", transceiverOptions);\r\n\t\tpc.addTransceiver(\"audio\", transceiverOptions);\r\n\r\n\t\tconst offer = await pc.createOffer();\r\n\t\tawait pc.setLocalDescription(offer);\r\n\r\n\t\tpc.onicecandidate = ({ candidate }) => {\r\n\t\t\tif (candidate?.candidate?.length) {\r\n\t\t\t\tthis.emitSocket({\r\n\t\t\t\t\ttype: VoiceEvents.UPDATE_CONSUMER_ICE,\r\n\t\t\t\t\tice: candidate,\r\n\t\t\t\t\tuserId\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tpc.onicecandidateerror = e => {\r\n\t\t\tconsole.error(\"consumer ice candidate error\", e);\r\n\t\t};\r\n\r\n\t\tpc.ontrack = e => this.handleTrack(e.streams[0], userId);\r\n\r\n\t\tthis.emitSocket({\r\n\t\t\ttype: VoiceEvents.REQUEST_CONSUMER_CONNECTION,\r\n\t\t\tuserId,\r\n\t\t\toffer\r\n\t\t});\r\n\t}\r\n\r\n\thandleMessage({ data }) {\r\n\t\tconst event = JSON.parse(data);\r\n\r\n\t\tswitch (event.type) {\r\n\t\t\tcase VoiceEvents.PC_ANSWER: {\r\n\t\t\t\tconst sdp = new RTCSessionDescription(event.answer);\r\n\t\t\t\tthis.pc.setRemoteDescription(sdp).catch(console.error);\r\n\t\t\t} break;\r\n\r\n\t\t\tcase VoiceEvents.UPDATE_MEMBERS: {\r\n\t\t\t\t// Handle disconnected users\r\n\t\t\t\tfor (const userId in this.connections) {\r\n\t\t\t\t\tif (!~event.users.indexOf(userId)) {\r\n\t\t\t\t\t\tthis.connections[userId].pc.close();\r\n\r\n\t\t\t\t\t\tdelete this.connections[userId];\r\n\r\n\t\t\t\t\t\t// Local user left the call, do cleanups\r\n\t\t\t\t\t\tif (userId === UserStore.getLocalUser().id) {\r\n\t\t\t\t\t\t\tfor (const userId in this.connections) {\r\n\t\t\t\t\t\t\t\tthis.connections[userId].pc.close();\r\n\r\n\t\t\t\t\t\t\t\tdelete this.connections[userId];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Handle new users\r\n\t\t\t\tfor (const userId of event.users) {\r\n\t\t\t\t\tif (userId !== UserStore.getLocalUser().id) {\r\n\t\t\t\t\t\tif (!this.connections[userId]) {\r\n\t\t\t\t\t\t\tthis.requestConsumer(userId).catch(\r\n\t\t\t\t\t\t\t\tconsole.error.bind(\r\n\t\t\t\t\t\t\t\t\tnull,\r\n\t\t\t\t\t\t\t\t\t\"Failed to request consumer!\"\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconsole.log(this.connections);\r\n\t\t\t} break;\r\n\r\n\t\t\tcase VoiceEvents.RECEIVE_CONSUMER: {\r\n\t\t\t\tconst sdp = new RTCSessionDescription(event.answer);\r\n\t\t\t\tconst { pc } = _.get(this.connections, [event.userId], {});\r\n\r\n\t\t\t\tconsole.log(\"received consumer answer\", pc, event.userId);\r\n\r\n\t\t\t\tpc?.setRemoteDescription(sdp)\r\n\t\t\t\t\t.catch(console.error.bind(null, \"Failed to receive consumer!\"));\r\n\t\t\t} break;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default VoiceModule;","import _ from \"lodash\";\r\nimport React from \"react\";\r\nimport { Check, Edit2, Edit3, Info, X } from \"react-feather\";\r\nimport { ActionTypes, joinClassNames, mib, openFileDialog, UserStatus } from \"../../Classes/Constants\";\r\nimport Database from \"../../Classes/Database\";\r\nimport { dispatcher } from \"../../Classes/Dispatcher\";\r\nimport MessageFormatter from \"../../Classes/MessageFormatter\";\r\nimport UserStore from \"../../Classes/Types/Stores/UserStore\";\r\nimport User from \"../../Classes/Types/User\";\r\nimport RichTextArea from \"../Chat/RichTextArea\";\r\nimport InlineLoading from \"../InlineLoading\";\r\nimport { Modals } from \"../Modals\";\r\nimport Toasts from \"../Toasts\";\r\nimport \"./UserProfileModal.scss\";\r\n\r\n// TODO add change confirmation when closing modal\r\nexport default function UserProfileModal({ userId }) {\r\n\tconst user = UserStore.useState(() => UserStore.getUser(userId));\r\n\tconst localUser = UserStore.getLocalUser();\r\n\r\n\tconst bgRef = React.useRef();\r\n\tconst bgRefNsfw = React.useRef();\r\n\r\n\tconst [editMode, setEditMode] = React.useState(false);\r\n\tconst [isNsfwRevealed, revealNsfw] = React.useState(false);\r\n\r\n\tdispatcher.useForceUpdater(\r\n\t\tActionTypes.USER_UPDATE,\r\n\t\t({ user }) => user.id === userId\r\n\t);\r\n\r\n\tasync function selectProfileBackground(nsfw = false) {\r\n\t\tconst [file] = await openFileDialog({ type: \"image/*\" });\r\n\t\tif (!file) return;\r\n\r\n\t\tif (file.size > mib(10))\r\n\t\t\treturn Toasts.showToast(\r\n\t\t\t\t\"You cannot upload a background above 10MiB\",\r\n\t\t\t\t\"Failure\"\r\n\t\t\t);\r\n\r\n\t\tDatabase.uploadStorage(file, nsfw ? \"profilebgNsfw\" : \"profilebg\", localUser.id)\r\n\t\t\t.then(r => (\r\n\t\t\t\tlocalUser[nsfw ? \"profileBackgroundNsfw\" : \"profileBackground\"] = r.url,\r\n\t\t\t\tToasts.showToast(\"Background updated - changes will show after confirming changes\", \"Warning\", 10)\r\n\t\t\t))\r\n\t\t\t.catch(err => (console.error(err), Toasts.showToast(\"There was an error uploading your background image\", \"Failure\")));\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"UserProfileModal FullScreenModal Flex\">\r\n\t\t\t<div className=\"Background FlexCenter\">\r\n\t\t\t\t{user.profileBackground && <InlineLoading />}\r\n\r\n\t\t\t\t<img\r\n\t\t\t\t\tref={bgRef}\r\n\t\t\t\t\tclassName=\"Image\"\r\n\t\t\t\t\tsrc={user.profileBackground}\r\n\t\t\t\t\tonLoad={e => e.target.style.opacity = 1}\r\n\t\t\t\t/>\r\n\r\n\t\t\t\t{user.profileBackgroundNsfw && User.isNsfwVerified && (\r\n\t\t\t\t\t<img\r\n\t\t\t\t\t\tref={bgRefNsfw}\r\n\t\t\t\t\t\tclassName=\"Image\"\r\n\t\t\t\t\t\tsrc={user.profileBackgroundNsfw}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"LeftSection Flex\">\r\n\t\t\t\t<user.AvatarComponent size={250} />\r\n\r\n\t\t\t\t<h3 className=\"Username\">{user.displayName}</h3>\r\n\r\n\t\t\t\t{editMode\r\n\t\t\t\t\t? (\r\n\t\t\t\t\t\t<RichTextArea defaultValue={user.feed} id=\"UserFeed\">\r\n\t\t\t\t\t\t\tSpecify what you're up to currently with your user feed.\r\n\t\t\t\t\t\t</RichTextArea>\r\n\t\t\t\t\t)\r\n\t\t\t\t\t: (\r\n\t\t\t\t\t\tuser.feed && (\r\n\t\t\t\t\t\t\t<div className=\"Feed\">\r\n\t\t\t\t\t\t\t\t{MessageFormatter.parse(user.feed)}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t<div className=\"AboutFields\">\r\n\t\t\t\t\t{user.about?.map((about, index) => (\r\n\t\t\t\t\t\t<div className=\"AboutField\" key={index}>\r\n\t\t\t\t\t\t\t<h3 className=\"Title\">{about.title}</h3>\r\n\t\t\t\t\t\t\t<div className=\"Body\">{about.field}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t))}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t{editMode && (\r\n\t\t\t\t\t<React.Fragment>\r\n\t\t\t\t\t\t<h4\r\n\t\t\t\t\t\t\tclassName=\"Button\"\r\n\t\t\t\t\t\t\tonClick={() => selectProfileBackground()}\r\n\t\t\t\t\t\t>Pick Background Image</h4>\r\n\r\n\t\t\t\t\t\t<h4\r\n\t\t\t\t\t\t\tclassName=\"Button\"\r\n\t\t\t\t\t\t\tonClick={() => selectProfileBackground(true)}\r\n\t\t\t\t\t\t>Pick NSFW Background</h4>\r\n\t\t\t\t\t</React.Fragment>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t{user.profileBackgroundNsfw && User.isNsfwVerified && (\r\n\t\t\t\t\t<h4\r\n\t\t\t\t\t\tclassName=\"Button NsfwToggle\"\r\n\t\t\t\t\t\tonClick={() => (\r\n\t\t\t\t\t\t\trevealNsfw(!isNsfwRevealed),\r\n\t\t\t\t\t\t\tbgRefNsfw.current.style.opacity = isNsfwRevealed ? 0 : 1\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{isNsfwRevealed ? \"Hide\" : \"Show\"} NSFW Background\r\n\t\t\t\t\t</h4>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"RightSection Flex\">\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<h1 className=\"Header\">Bio</h1>\r\n\t\t\t\t\t<div className={joinClassNames(\"Bio MessageGroup\", [editMode, \"EditMode\"])}>\r\n\t\t\t\t\t\t{editMode\r\n\t\t\t\t\t\t\t? (\r\n\t\t\t\t\t\t\t\t<RichTextArea defaultValue={user.bio} id=\"UserBio\">\r\n\t\t\t\t\t\t\t\t\tDescribe yourself with a personal bio.\r\n\t\t\t\t\t\t\t\t</RichTextArea>\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t: (\r\n\t\t\t\t\t\t\t\tuser.bio\r\n\t\t\t\t\t\t\t\t\t? MessageFormatter.parse(user.bio)\r\n\t\t\t\t\t\t\t\t\t: (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"Placeholder\">\r\n\t\t\t\t\t\t\t\t\t\t\tThis user has no bio.\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"Buttons\">\r\n\t\t\t\t{user === localUser && (\r\n\t\t\t\t\teditMode\r\n\t\t\t\t\t\t? (\r\n\t\t\t\t\t\t\t<Check\r\n\t\t\t\t\t\t\t\tclassName=\"Button\"\r\n\t\t\t\t\t\t\t\tonClick={() => (\r\n\t\t\t\t\t\t\t\t\tsetEditMode(false),\r\n\t\t\t\t\t\t\t\t\tObject.assign(\r\n\t\t\t\t\t\t\t\t\t\tlocalUser,\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tfeed: document.getElementById(\"UserFeed\").value,\r\n\t\t\t\t\t\t\t\t\t\t\tbio: document.getElementById(\"UserBio\").value\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\t\tDatabase.update(\r\n\t\t\t\t\t\t\t\t\t\tlocalUser._ref,\r\n\t\t\t\t\t\t\t\t\t\t_.pick(\r\n\t\t\t\t\t\t\t\t\t\t\tlocalUser,\r\n\t\t\t\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\t\t\t\t\"displayName\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\"feed\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\"bio\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\"avatarUrl\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\"backgroundImage\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\"backgroundImageNsfw\"\r\n\t\t\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t).then(() => (\r\n\t\t\t\t\t\t\t\t\t\tToasts.showToast(\r\n\t\t\t\t\t\t\t\t\t\t\t\"Successfully updated profile\"\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t))\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t: (\r\n\t\t\t\t\t\t\t<Edit3\r\n\t\t\t\t\t\t\t\tclassName=\"Button\"\r\n\t\t\t\t\t\t\t\tonClick={() => setEditMode(true)}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t<X\r\n\t\t\t\t\tclassName=\"Button\"\r\n\t\t\t\t\tonClick={() => Modals.pop()}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport _ from \"lodash\";\r\nimport \"./Styles/User.scss\";\r\nimport { ActionTypes, formatDateString, joinClassNames, mib, openFileDialog, UserStatus } from \"../Constants\";\r\nimport UserStore from \"./Stores/UserStore\";\r\nimport Tooltip from \"../../Components/Tooltip\";\r\nimport { Clipboard, Image, Maximize, MessageSquare, User as UserFeather } from \"react-feather\";\r\nimport ContextMenu from \"../../Components/ContextMenuHandler\";\r\nimport { copyToClipboard, Modals, openImageModal } from \"../../Components/Modals\";\r\nimport UserProfileModal from \"../../Components/Modals/UserProfileModal\";\r\nimport Toasts from \"../../Components/Toasts\";\r\nimport Database from \"../Database\";\r\nimport { dispatcher } from \"../Dispatcher\";\r\nimport { pushHistoryState } from \"../../App\";\r\n\r\nexport default class User {\r\n\tid = \"\";\r\n\tdisplayName = \"\";\r\n\tavatarUrl = \"\";\r\n\r\n\tconstructor(user) {\r\n\t\t_.extend(this, user);\r\n\t}\r\n\r\n\tAvatarComponent = props =>\r\n\t\t<UserAvatarComponent user={this} {...props} />;\r\n\r\n\tStatusText = props =>\r\n\t\t<UserStatusText user={this} {...props} />;\r\n\r\n\tMention = () =>\r\n\t\t<UserMention user={this} />;\r\n\r\n\tContextMenu = () =>\r\n\t\t<UserContextMenu user={this} />;\r\n\r\n\t// TODO add modal\r\n\tstatic async selectAvatar() {\r\n\t\tconst [file] = await openFileDialog({ type: \"image/*\" });\r\n\t\tif (!file) return;\r\n\r\n\t\tif (file.size > mib(8))\r\n\t\t\treturn Toasts.showToast(\r\n\t\t\t\t\"You cannot upload an avatar above 8MiB\",\r\n\t\t\t\t\"Failure\"\r\n\t\t\t);\r\n\r\n\t\tDatabase.uploadStorage(file, \"avatar\", UserStore.getLocalUser().id)\r\n\t\t\t.then(r => (this.avatarUrl = r.url, Toasts.showToast(\"Avatar updated\")))\r\n\t\t\t.catch(err => (console.error(err), Toasts.showToast(\"There was an error uploading your avatar\", \"Failure\")))\r\n\t}\r\n\r\n\tstatic get isNsfwVerified() {\r\n\t\treturn UserStore.getLocalUser()?.nsfwVerified;\r\n\t}\r\n}\r\n\r\nexport function UserAvatarComponent({ user, size = 40, className = \"\" }) {\r\n\tconst avatarUrl = UserStore.useState(() => user.avatarUrl);\r\n\tconst displayName = UserStore.useState(() => user.displayName);\r\n\r\n\tconst [failed, setFailed] = React.useState(false);\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={joinClassNames(\"AvatarContainer StyleSquare FlexCenter\", className)}\r\n\t\t\tstyle={{ width: size, height: size }}\r\n\t\t>\r\n\t\t\t{failed\r\n\t\t\t\t? (\r\n\t\t\t\t\t<UserFeather\r\n\t\t\t\t\t\tclassName=\"DefaultAvatar\"\r\n\t\t\t\t\t\tstyle={{ width: size / 1.5, height: size / 1.5 }}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)\r\n\t\t\t\t: (\r\n\t\t\t\t\t<img\r\n\t\t\t\t\t\tclassName=\"Avatar\"\r\n\t\t\t\t\t\tsrc={avatarUrl}\r\n\t\t\t\t\t\talt={displayName}\r\n\t\t\t\t\t\twidth={size} height={size}\r\n\r\n\t\t\t\t\t\tonError={() => setFailed(true)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function UserStatusText({ user, tooltipDirection = \"right\" }) {\r\n\tconst status = UserStore.useState(() => user.status);\r\n\tconst lastOnline = user.lastOnline ? new Date(user.lastOnline) : null;\r\n\r\n\tswitch (status) {\r\n\t\tdefault:\r\n\t\tcase UserStatus.OFFLINE: {\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"Flex StatusContainer\">\r\n\t\t\t\t\t<div className=\"Status Offline\" />\r\n\t\t\t\t\t<div>Offline</div>\r\n\r\n\t\t\t\t\t{lastOnline && tooltipDirection !== \"none\" && (\r\n\t\t\t\t\t\t<Tooltip direction={tooltipDirection}>\r\n\t\t\t\t\t\t\tLast online {formatDateString(lastOnline)} at {lastOnline.toLocaleTimeString(\"en-US\")}\r\n\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tcase UserStatus.ONLINE: {\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"Flex StatusContainer\">\r\n\t\t\t\t\t<div className=\"Status Online\" />\r\n\t\t\t\t\t<div>Online</div>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tcase UserStatus.AWAY: {\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"Flex StatusContainer\">\r\n\t\t\t\t\t<div className=\"Status Away\" />\r\n\t\t\t\t\t<div>Away</div>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tcase UserStatus.BUSY: {\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"Flex StatusContainer\">\r\n\t\t\t\t\t<div className=\"Status Busy\" />\r\n\t\t\t\t\t<div>Busy</div>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tcase UserStatus.BOT: {\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"Flex StatusContainer\">\r\n\t\t\t\t\t<div className=\"Status Bot\" />\r\n\t\t\t\t\t<div>Bot</div>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function UserMention({ user, convertToYou = false }) {\r\n\tdispatcher.useForceUpdater(\r\n\t\tActionTypes.USER_UPDATE,\r\n\t\te => e.user.id === user.id\r\n\t);\r\n\r\n\t// Do this garbage because of inline mentions.\r\n\t// Don't remove this, you'll get angry later.\r\n\tuser = UserStore.getUser(user.id);\r\n\r\n\treturn (\r\n\t\t<ContextMenu.Wrapper\r\n\t\t\tmenu={<user.ContextMenu />}\r\n\t\t\twrapperClassName=\"UserMention\"\r\n\t\t>\r\n\t\t\t<UserAvatarComponent user={user} size={19} />\r\n\t\t\t<div className=\"Username\">\r\n\t\t\t\t{convertToYou && user.id === UserStore.getLocalUser().id\r\n\t\t\t\t\t? \"You\"\r\n\t\t\t\t\t: user.displayName}\r\n\t\t\t</div>\r\n\t\t</ContextMenu.Wrapper>\r\n\t);\r\n}\r\n\r\nfunction UserContextMenu({ user }) {\r\n\treturn (\r\n\t\t<ContextMenu>\r\n\t\t\t<ContextMenu.Item\r\n\t\t\t\ticon={<UserFeather />}\r\n\t\t\t\tonClick={() => Modals.push(<UserProfileModal userId={user.id} />)}\r\n\t\t\t\tautoClose\r\n\t\t\t>Profile</ContextMenu.Item>\r\n\r\n\t\t\t<ContextMenu.Item\r\n\t\t\t\ticon={<MessageSquare />}\r\n\t\t\t\tonClick={() => pushHistoryState(`app/dms/${user.id}`)}\r\n\t\t\t\tautoClose\r\n\t\t\t>Message</ContextMenu.Item>\r\n\r\n\t\t\t{user.avatarUrl && (\r\n\t\t\t\t<ContextMenu.SubMenuItem\r\n\t\t\t\t\tlabel=\"Avatar\"\r\n\t\t\t\t\ticon={<Image />}\r\n\t\t\t\t>\r\n\t\t\t\t\t<ContextMenu.Item\r\n\t\t\t\t\t\ticon={<Maximize />}\r\n\t\t\t\t\t\tonClick={() => openImageModal(user.avatarUrl)}\r\n\t\t\t\t\t\tautoClose\r\n\t\t\t\t\t>View</ContextMenu.Item>\r\n\r\n\t\t\t\t\t<ContextMenu.Item\r\n\t\t\t\t\t\ticon={<Clipboard />}\r\n\t\t\t\t\t\tonClick={() => copyToClipboard(user.avatarUrl)}\r\n\t\t\t\t\t\tautoClose\r\n\t\t\t\t\t>Copy URL</ContextMenu.Item>\r\n\t\t\t\t</ContextMenu.SubMenuItem>\r\n\t\t\t)}\r\n\t\t</ContextMenu>\r\n\t);\r\n}","import _ from \"lodash\";\r\nimport { ActionTypes } from \"../../Constants\";\r\nimport { dispatcher } from \"../../Dispatcher\";\r\nimport RealtimeDatabase from \"../../RealtimeDatabase\";\r\nimport Store from \"../../Store\";\r\nimport { GroupDm } from \"../Group\";\r\nimport GroupStore from \"./GroupStore\";\r\nimport UserStore from \"./UserStore\";\r\n\r\nconst cache = {};\r\nconst cleanupCache = {};\r\n\r\nconst TypingStoreClass = class TypingStore extends Store {\r\n\t_getRefPath(circleId, groupId = null) {\r\n\t\treturn circleId === \"dms\"\r\n\t\t\t? `typingIndicators/dms/${GroupDm.getId(groupId)}`\r\n\t\t\t: groupId\r\n\t\t\t\t? `typingIndicators/${circleId}/${groupId}`\r\n\t\t\t\t: `typingIndicators/${circleId}`;\r\n\t}\r\n\r\n\tgetTypingUsersForCircle(circleId) {\r\n\t\tif (circleId === \"dms\") {\r\n\t\t\tthrow new Error(\"Not allowed to fetch all DM typing indicators!\");\r\n\t\t}\r\n\r\n\t\treturn _.get(cache, [circleId]);\r\n\t}\r\n\r\n\tgetTypingUsersForGroup(circleId, groupId) {\r\n\t\treturn _.get(cache, [circleId, groupId], {});\r\n\t}\r\n\r\n\tgetAllTypingUsers() {\r\n\t\treturn cache;\r\n\t}\r\n\r\n\ttryCreateListenerFor(circleId, userId = null) {\r\n\t\tif (cleanupCache[userId ?? circleId] || !circleId && !userId) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst typingRefPath = this._getRefPath(circleId, userId);\r\n\r\n\t\tconst disconnectListener = RealtimeDatabase.createDisconnectListener(\r\n\t\t\t`${typingRefPath}/${UserStore.getLocalUser().id}`\r\n\t\t);\r\n\r\n\t\tdisconnectListener.remove();\r\n\r\n\t\tconst unbind = RealtimeDatabase.createListener(\r\n\t\t\ttypingRefPath,\r\n\t\t\tsnapshot => {\r\n\t\t\t\tconst data = snapshot.val();\r\n\r\n\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\ttype: ActionTypes.UPDATE_TYPING_INDICATORS,\r\n\t\t\t\t\tindicators: data,\r\n\t\t\t\t\tcircleId, userId\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tcleanupCache[userId ?? circleId] = () => {\r\n\t\t\tunbind();\r\n\t\t\tdisconnectListener.cancel();\r\n\r\n\t\t\tdelete cleanupCache[userId ?? circleId];\r\n\t\t};\r\n\t}\r\n\r\n\tstartTyping() {\r\n\t\tconst group = GroupStore.getSelectedGroup();\r\n\t\tif (!group) return;\r\n\r\n\t\tconst path = `${this._getRefPath(group.circleId, group.id)}/${UserStore.getLocalUser().id}`;\r\n\r\n\t\tif (!_.get(this.getTypingUsersForGroup(group.circleId, group.id), [UserStore.getLocalUser().id])) {\r\n\t\t\tRealtimeDatabase.set(path, { t: true }).catch(console.error.bind(null, \"Failed to set typing state!\"));\r\n\t\t}\r\n\r\n\t\tthis.stopTypingSoft(group.circleId, group.id);\r\n\t}\r\n\r\n\tstopTyping(circleId, groupId) {\r\n\t\tif (!circleId) {\r\n\t\t\tconst group = GroupStore.getSelectedGroup();\r\n\t\t\tif (!group) return;\r\n\r\n\t\t\tcircleId = group.circleId;\r\n\t\t\tgroupId = group.id;\r\n\t\t}\r\n\r\n\t\tconst path = `${this._getRefPath(circleId, groupId)}/${UserStore.getLocalUser().id}`;\r\n\r\n\t\tRealtimeDatabase.set(path, null).catch(console.error.bind(null, \"Failed to stop typing!\"));\r\n\t}\r\n\r\n\tstopTypingSoft = _.debounce(this.stopTyping.bind(this), 5000);\r\n}\r\n\r\nconst TypingStore = new TypingStoreClass(dispatcher, {\r\n\t[ActionTypes.UPDATE_TYPING_INDICATORS]: ({ circleId, userId, indicators }) => {\r\n\t\t_.set(cache, [userId || circleId], indicators);\r\n\t}\r\n});\r\n\r\nexport default TypingStore;","import _ from \"lodash\";\r\nimport \"./Styles/Groups.scss\";\r\nimport { ChevronDown, MessageSquare, Mic, Phone, Rss } from \"react-feather\";\r\nimport { ActionTypes, GroupType, joinClassNames } from \"../Constants\";\r\nimport { dispatcher } from \"../Dispatcher\";\r\nimport { pushHistoryState } from \"../../App\";\r\nimport { addDoc, collection, serverTimestamp } from \"@firebase/firestore\";\r\nimport UserStore from \"./Stores/UserStore\";\r\nimport GroupStore from \"./Stores/GroupStore\";\r\nimport Database from \"../Database\";\r\nimport CircleStore from \"./Stores/CircleStore\";\r\nimport User from \"./User\";\r\nimport VoiceModule, { ChatRoom } from \"../VoiceModule\";\r\nimport React from \"react\";\r\nimport { useInterval } from \"../Hooks\";\r\nimport MessageCountStore from \"./Stores/MessageCountStore\";\r\nimport VoiceMemberStore from \"./Stores/VoiceMemberStore\";\r\nimport TypingStore from \"./Stores/TypingStore\";\r\nimport InlineLoading from \"../../Components/InlineLoading\";\r\nimport ContextMenu from \"../../Components/ContextMenuHandler\";\r\n\r\nexport default class Group {\r\n\tid = \"\";\r\n\ttitle = \"\";\r\n\r\n\tconstructor(group) {\r\n\t\t_.extend(this, group);\r\n\t}\r\n\r\n\tget isNsfw() {\r\n\t\treturn this.nsfw;\r\n\t}\r\n\r\n\tget circle() {\r\n\t\treturn CircleStore.getCircle(this.circleId);\r\n\t}\r\n\r\n\tsendMessage(content) {\r\n\t\t// I fucking hate Firebase with a passion.\r\n\t\tsetTimeout(() => this.markAsRead(), 2000);\r\n\r\n\t\treturn addDoc(collection(this._ref, \"messages\"), {\r\n\t\t\tsenderId: UserStore.getLocalUser()?.id,\r\n\t\t\tcontent,\r\n\t\t\tcreationDate: serverTimestamp()\r\n\t\t\t// TODO add mentions\r\n\t\t});\r\n\t}\r\n\r\n\tmarkAsRead() {\r\n\t\tif (this.isDm) {\r\n\t\t\tMessageCountStore.markRead(this.groupId);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tMessageCountStore.markRead(this.circleId, this.id);\r\n\t\t}\r\n\t}\r\n\r\n\tComponent = props =>\r\n\t\t<GroupComponent group={this} {...props} />;\r\n}\r\n\r\nfunction GroupComponent({ group, children = null }) {\r\n\tdispatcher.useForceUpdater(\r\n\t\tActionTypes.GROUP_UPDATE,\r\n\t\t({ circle, group }) => circle.id === group.circleId\r\n\t\t\t&& group.id === group.id\r\n\t);\r\n\r\n\tif (group.isNsfw && !User.isNsfwVerified)\r\n\t\treturn null;\r\n\r\n\tswitch (group.type) {\r\n\t\tdefault: return null;\r\n\r\n\t\tcase GroupType.FOLDER: {\r\n\t\t\treturn (\r\n\t\t\t\t<GroupFolder group={group}>\r\n\t\t\t\t\t{children}\r\n\t\t\t\t</GroupFolder>\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tcase GroupType.TEXT: {\r\n\t\t\treturn <GroupText group={group} />;\r\n\t\t}\r\n\r\n\t\tcase GroupType.VOICE: {\r\n\t\t\treturn <GroupVoice group={group} />;\r\n\t\t}\r\n\r\n\t\tcase GroupType.ANNOUNCEMENTS: {\r\n\t\t\treturn <GroupAnnouncements group={group} />;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function GroupFolder({ group, children }) {\r\n\treturn (\r\n\t\t<div className=\"Group TypeFolder\">\r\n\t\t\t<div className=\"Title\">\r\n\t\t\t\t<ChevronDown /> {group.title}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"FolderContents\">\r\n\t\t\t\t{children}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction selectGroup(group) {\r\n\tpushHistoryState(\r\n\t\tgroup.circle.lastLocation =\r\n\t\t`app/circles/${group.circleId}/groups/${group.id}`\r\n\t);\r\n\r\n\tMessageCountStore.markRead(group.circle.id, group.id);\r\n}\r\n\r\nfunction GroupText({ group }) {\r\n\tconst events = {\r\n\t\tonClick: () => selectGroup(group)\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div className={\r\n\t\t\tjoinClassNames(\r\n\t\t\t\t\"Group\",\r\n\t\t\t\t\"TypeText\",\r\n\t\t\t\t[GroupStore.getSelectedGroup() === group, \"Selected\"]\r\n\t\t\t)\r\n\t\t}>\r\n\t\t\t<div className=\"Title\" {...events}>\r\n\t\t\t\t<MessageSquare /> {group.title}\r\n\r\n\t\t\t\t<GroupUnreadBlips group={group} />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction GroupUnreadBlips({ group }) {\r\n\tconst unreadCount = MessageCountStore.useState(() =>\r\n\t\tMessageCountStore.getUnreadMessageCount(group.circleId, group.id));\r\n\r\n\tconst typingCount = TypingStore.useState(() =>\r\n\t\t_.size(TypingStore.getTypingUsersForGroup(group.circleId, group.id)));\r\n\r\n\treturn (\r\n\t\t<div className=\"UnreadBlips Flex\">\r\n\t\t\t<InlineLoading style={{ opacity: typingCount ? 1 : 0 }} />\r\n\r\n\t\t\t{!!unreadCount && (\r\n\t\t\t\t<div className=\"Blip Unread\">\r\n\t\t\t\t\t{unreadCount > 999\r\n\t\t\t\t\t\t? `${Math.round(unreadCount / 1000)}k`\r\n\t\t\t\t\t\t: unreadCount}\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction GroupVoice({ group }) {\r\n\tconst members = VoiceMemberStore.useState(() =>\r\n\t\tVoiceMemberStore.getVoiceMembers(group.circleId, group.id));\r\n\r\n\tfunction selectText() {\r\n\t\tselectGroup(group);\r\n\t}\r\n\r\n\tfunction connectToVoice() {\r\n\t\tif (VoiceModule.currentRoom?.group.id === group.id) {\r\n\t\t\tpushHistoryState(`#app/circles/${group.circleId}/call`);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnew ChatRoom(group.circleId, group.id).connect();\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"Group TypeVoice\">\r\n\t\t\t<div className=\"Title\">\r\n\t\t\t\t<Mic /> {group.title}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"FolderContents\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={\r\n\t\t\t\t\t\tjoinClassNames(\r\n\t\t\t\t\t\t\t\"Group\",\r\n\t\t\t\t\t\t\t\"TypeText\",\r\n\t\t\t\t\t\t\t[GroupStore.getSelectedGroup() === group, \"Selected\"]\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonClick={selectText}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div className=\"Title\">\r\n\t\t\t\t\t\t<MessageSquare /> Text Chat\r\n\r\n\t\t\t\t\t\t<GroupUnreadBlips group={group} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={\r\n\t\t\t\t\t\tjoinClassNames(\r\n\t\t\t\t\t\t\t\"Group\",\r\n\t\t\t\t\t\t\t\"TypeText\",\r\n\t\t\t\t\t\t\t[VoiceModule.currentRoom?.group === group, \"Selected\"]\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonClick={connectToVoice}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div className=\"Title\">\r\n\t\t\t\t\t\t<Phone /> {VoiceModule.currentRoom?.group === group\r\n\t\t\t\t\t\t\t? \"Connected\" : \"Join Room\"}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"FolderContents\">\r\n\t\t\t\t\t\t{members && members.map(userId => (\r\n\t\t\t\t\t\t\t<VoiceRoomMember key={userId} userId={userId} />\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction VoiceRoomMember({ userId }) {\r\n\tconst room = VoiceModule.currentRoom;\r\n\tconst user = UserStore.useState(() => UserStore.getUser(userId));\r\n\r\n\tconsole.log({ room });\r\n\r\n\treturn (\r\n\t\t<div className=\"Group TypeText TypeUser\">\r\n\t\t\t<div className=\"Title\">\r\n\t\t\t\t<user.AvatarComponent size={17} />\r\n\r\n\t\t\t\t{user.displayName}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction GroupAnnouncements({ group }) {\r\n\treturn (\r\n\t\t<div className=\"Group TypeAnnouncement\">\r\n\t\t\t<div className=\"Title\">\r\n\t\t\t\t<Rss /> {group.title}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport class GroupDm extends Group {\r\n\tuserId = \"\";\r\n\tlastMessageDate;\r\n\r\n\tconstructor(...args) {\r\n\t\tsuper(...args);\r\n\r\n\t\tTypingStore.tryCreateListenerFor(\"dms\", this.userId);\r\n\t}\r\n\r\n\tget circleId() {\r\n\t\treturn \"dms\";\r\n\t}\r\n\r\n\tget isNsfw() {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tget _ref() {\r\n\t\treturn Database.doc(\r\n\t\t\t\"directmessages\",\r\n\t\t\tGroupDm.getId(this.userId)\r\n\t\t);\r\n\t}\r\n\r\n\tComponent = () =>\r\n\t\t<DmGroupComponent group={this} />;\r\n\r\n\tstatic getId(userId) {\r\n\t\treturn [UserStore.getLocalUser().id, userId].sort().join(\"_\");\r\n\t}\r\n}\r\n\r\nexport function DmGroupComponent({ group }) {\r\n\tconst user = UserStore.useState(() => UserStore.getUser(group.userId));\r\n\r\n\treturn user?.displayName ? (\r\n\t\t<ContextMenu.Wrapper\r\n\t\t\tmenu={<user.ContextMenu />}\r\n\t\t\twrapperClassName=\"DirectMessageGroup UserSection Flex\"\r\n\t\t\tonClick={() => pushHistoryState(`#app/dms/${user.id}`)}\r\n\t\t>\r\n\t\t\t<user.AvatarComponent />\r\n\r\n\t\t\t<div className=\"Details\">\r\n\t\t\t\t<h3 className=\"Username\">{user.displayName}</h3>\r\n\r\n\t\t\t\t<user.StatusText tooltipDirection=\"none\" />\r\n\t\t\t</div>\r\n\t\t</ContextMenu.Wrapper>\r\n\t) : null;\r\n}","import \"./Styles/Circles.scss\";\r\nimport _ from \"lodash\";\r\nimport Tooltip from \"../../Components/Tooltip\";\r\nimport { ActionTypes, getAcronym, joinClassNames } from \"../Constants\";\r\nimport { dispatcher } from \"../Dispatcher\";\r\nimport { appHashArgs, pushHistoryState } from \"../../App\";\r\nimport Database from \"../Database\";\r\nimport { serverTimestamp } from \"@firebase/firestore\";\r\nimport GroupStore from \"./Stores/GroupStore\";\r\nimport { Compass, LogOut } from \"react-feather\";\r\nimport MessageCountStore from \"./Stores/MessageCountStore\";\r\nimport UserStore from \"./Stores/UserStore\";\r\nimport Toasts from \"../../Components/Toasts\";\r\nimport { openBoolModal } from \"../../Components/Modals\";\r\nimport ContextMenu from \"../../Components/ContextMenuHandler\";\r\nimport CircleStore from \"./Stores/CircleStore\";\r\n\r\nexport default class Circle {\r\n\tid = \"\";\r\n\tname = \"\";\r\n\ticonUrl = \"\";\r\n\r\n\tconstructor(circle) {\r\n\t\t_.extend(this, circle);\r\n\t}\r\n\r\n\t_groups = null;\r\n\r\n\tgetGroups() {\r\n\t\treturn GroupStore.getGroups(this.id);\r\n\t}\r\n\r\n\tasync leaveCircle() {\r\n\t\tconst confirmation = await openBoolModal({\r\n\t\t\ttitle: \"Are you sure?\",\r\n\t\t\tdescription: `Leave <b>${this.name}</b>?`\r\n\t\t});\r\n\r\n\t\tif (!confirmation) return;\r\n\r\n\t\t// Delete member item\r\n\t\tawait Database.delete(\r\n\t\t\tDatabase.doc(\"circles\", this.id, \"members\", UserStore.getLocalUser().id)\r\n\t\t);\r\n\r\n\t\t// Delete circle from user data\r\n\t\tawait Database.delete(\r\n\t\t\tDatabase.doc(\"userdata\", UserStore.getLocalUser().id, \"circles\", this.id)\r\n\t\t);\r\n\r\n\t\tif (window.location.href.includes(this.id)) {\r\n\t\t\tpushHistoryState(\"app\");\r\n\t\t}\r\n\r\n\t\tToasts.showToast(<span>Left <b>${this.name}</b></span>);\r\n\t\tCircleStore.destroyCircle(this.id);\r\n\t}\r\n\r\n\trenderGroups() {\r\n\t\tconst _groups = this.getGroups();\r\n\r\n\t\tif (_groups) {\r\n\t\t\tconst groups = Object.values(_groups).sort((a, b) => a.position - b.position);\r\n\r\n\t\t\tconst populate = group => (\r\n\t\t\t\t<group.Component key={group.id}>\r\n\t\t\t\t\t{groups.filter(g => g.parent === group.id).map(populate)}\r\n\t\t\t\t</group.Component>\r\n\t\t\t);\r\n\r\n\t\t\treturn [\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={joinClassNames(\r\n\t\t\t\t\t\t\"Group TypeButton\",\r\n\t\t\t\t\t\t[appHashArgs[2] === \"overview\", \"Selected\"]\r\n\t\t\t\t\t)}\r\n\t\t\t\t\tkey=\"__overview\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"Title\"\r\n\t\t\t\t\t\tonClick={() => pushHistoryState(`#app/circles/${appHashArgs[1]}/overview`)}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Compass /> Overview\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>,\r\n\r\n\t\t\t\t...groups.filter(g => !g.parent || !_groups[g.parent]).map(populate)\r\n\t\t\t];\r\n\t\t}\r\n\t}\r\n\r\n\tBubbleComponent = () =>\r\n\t\t<CircleBubble circle={this} />;\r\n\r\n\tContextMenu = () =>\r\n\t\t<CircleContextMenu circle={this} />;\r\n\r\n\tstatic async join(circleId, inviteId, userId = UserStore.getLocalUser().id) {\r\n\t\t// TODO add circle rules modal\r\n\r\n\t\t// Get member doc\r\n\t\tconst doc = Database.doc(\"circles\", circleId, \"members\", userId);\r\n\r\n\t\t// Check if the user is already in the circle\r\n\t\tif (await Database.getDoc(doc)) return;\r\n\r\n\t\t// Attempt to join\r\n\t\tconst { error } = await Database.set(doc, {\r\n\t\t\tjoinDate: serverTimestamp(),\r\n\t\t\tinviteId\r\n\t\t}).then(() => ({ error: null })).catch(error => ({ error }));\r\n\r\n\t\t// Handle any errors\r\n\t\tif (error) {\r\n\t\t\tToasts.showToast(\"There was an error joining circle\", \"Failure\");\r\n\r\n\t\t\treturn console.error(\"Error joining circle\", error);\r\n\t\t}\r\n\r\n\t\t// Add the circle to the user data\r\n\t\tawait Database.set(\r\n\t\t\tDatabase.doc(\"userdata\", userId, \"circles\", circleId),\r\n\t\t\t{ position: 0 }\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport function CircleContextMenu({ circle }) {\r\n\treturn (\r\n\t\t<ContextMenu>\r\n\t\t\t<ContextMenu.Item\r\n\t\t\t\ticon={<LogOut />}\r\n\t\t\t\tstyle={{ color: \"var(--busy-color)\" }}\r\n\t\t\t\tautoClose\r\n\t\t\t\tonClick={circle.leaveCircle.bind(circle)}\r\n\t\t\t>Leave</ContextMenu.Item>\r\n\t\t</ContextMenu>\r\n\t);\r\n}\r\n\r\nexport function CircleBubble({ circle, icon = null, onClick = null }) {\r\n\tdispatcher.useForceUpdater(\r\n\t\tActionTypes.CIRCLE_UPDATE,\r\n\t\te => e.circle.id === circle.id\r\n\t);\r\n\r\n\tconst unreadCount = MessageCountStore.useState(() =>\r\n\t\tMessageCountStore.getUnreadMessageCount(circle.id));\r\n\r\n\tconst events = {\r\n\t\tonClick: () => {\r\n\t\t\tif (onClick) return onClick();\r\n\r\n\t\t\tconst group = localStorage.getItem(`lastGroup.${circle.id}`) || \"overview\";\r\n\r\n\t\t\tif (circle.lastLocation) {\r\n\t\t\t\tpushHistoryState(circle.lastLocation);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tpushHistoryState(`app/circles/${circle.id}/${group}`);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<ContextMenu.Wrapper menu={circle instanceof Circle ? <circle.ContextMenu /> : null}>\r\n\t\t\t<div className=\"Circle\" {...events}>\r\n\t\t\t\t{icon\r\n\t\t\t\t\t? icon\r\n\t\t\t\t\t: circle.iconUrl\r\n\t\t\t\t\t\t? <img\r\n\t\t\t\t\t\t\tclassName=\"Icon\"\r\n\t\t\t\t\t\t\tsrc={circle.iconUrl}\r\n\t\t\t\t\t\t\talt={circle.name}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t: <h3 className=\"Icon Acronym\">\r\n\t\t\t\t\t\t\t{getAcronym(circle.name)}\r\n\t\t\t\t\t\t</h3>}\r\n\r\n\t\t\t\t<div className=\"UnreadBlips Flex\">\r\n\t\t\t\t\t{unreadCount > 0 && (\r\n\t\t\t\t\t\t<div className=\"Blip Unread\">\r\n\t\t\t\t\t\t\t{unreadCount > 999\r\n\t\t\t\t\t\t\t\t? `${Math.round(unreadCount / 1000)}k`\r\n\t\t\t\t\t\t\t\t: unreadCount}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<Tooltip direction=\"right\">{circle.name}</Tooltip>\r\n\t\t\t</div>\r\n\t\t</ContextMenu.Wrapper>\r\n\t);\r\n}","import { limitToLast, orderBy, query } from \"@firebase/firestore\";\r\nimport _ from \"lodash\";\r\nimport { ActionTypes } from \"../../Constants\";\r\nimport Database from \"../../Database\";\r\nimport { dispatcher } from \"../../Dispatcher\";\r\nimport Store from \"../../Store\";\r\nimport { GroupDm } from \"../Group\";\r\nimport Message from \"../Message\";\r\nimport MessageCountStore from \"./MessageCountStore\";\r\n\r\nconst cache = {};\r\nconst cleanupCache = {};\r\nconst fetching = {};\r\n\r\nexport const MessageStoreClass = class MessageStore extends Store {\r\n\tgetMessage(circleId, groupId, messageId) {\r\n\t\treturn _.get(cache, [circleId, groupId, messageId]);\r\n\t}\r\n\r\n\tgetMessages(circleId, groupId) {\r\n\t\treturn _.get(cache, [circleId, groupId]) ?? (\r\n\t\t\tthis.fetchMessages(circleId, groupId),\r\n\t\t\tnull\r\n\t\t);\r\n\t}\r\n\r\n\tgetMessageGroups(circleId, groupId) {\r\n\t\t// TODO add unread divider\r\n\r\n\t\tconst _messages = this.getMessages(circleId, groupId);\r\n\t\tif (!_messages) return null;\r\n\r\n\t\tconst messages = Object.values(_messages);\r\n\t\tconst groups = [];\r\n\r\n\t\tlet lastMessage;\r\n\t\tlet currentGroup;\r\n\r\n\t\tfor (const message of messages) {\r\n\t\t\tconst isSeparateUser = lastMessage?.senderId !== message.senderId;\r\n\t\t\tconst isSeparateTime = message.creationDate - lastMessage?.creationDate > 600;\r\n\r\n\t\t\tif (!lastMessage || isSeparateUser || isSeparateTime) {\r\n\t\t\t\tcurrentGroup && lastMessage && groups.push({\r\n\t\t\t\t\tkey: \"mg-\" + lastMessage.id,\r\n\t\t\t\t\tuserId: lastMessage.senderId,\r\n\t\t\t\t\tmessages: currentGroup\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcurrentGroup = [];\r\n\t\t\t}\r\n\r\n\t\t\tcurrentGroup.push(message);\r\n\t\t\tlastMessage = message;\r\n\t\t}\r\n\r\n\t\tcurrentGroup && groups.push({\r\n\t\t\tkey: \"mg-\" + currentGroup[0].id,\r\n\t\t\tuserId: currentGroup[0].senderId,\r\n\t\t\tmessages: currentGroup\r\n\t\t});\r\n\r\n\t\treturn groups.reverse();\r\n\t}\r\n\r\n\tgetAllCachedMessages() {\r\n\t\treturn cache;\r\n\t}\r\n\r\n\tgetCleanupCache() {\r\n\t\treturn cleanupCache;\r\n\t}\r\n\r\n\ttickCache(circleId, groupId) {\r\n\t\tconst cleanup = _.get(cleanupCache, [circleId, groupId], {});\r\n\r\n\t\tcleanup.tick?.();\r\n\t}\r\n\r\n\tcleanup(circleId, groupId) {\r\n\t\tconst cleanup = _.get(cleanupCache, [circleId, groupId], {});\r\n\r\n\t\tcleanup.instantly?.();\r\n\t}\r\n\r\n\tasync fetchMessages(circleId, groupId) {\r\n\t\tif (_.get(fetching, [circleId, groupId])) return;\r\n\t\t_.set(fetching, [circleId, groupId], true);\r\n\r\n\t\tconst dmId = circleId === \"dms\"\r\n\t\t\t? GroupDm.getId(groupId)\r\n\t\t\t: null;\r\n\r\n\t\treturn new Promise(r => {\r\n\t\t\tconst ref = circleId === \"dms\"\r\n\t\t\t\t? Database.collection(\r\n\t\t\t\t\t\"directmessages\",\r\n\t\t\t\t\tdmId,\r\n\t\t\t\t\t\"messages\"\r\n\t\t\t\t)\r\n\t\t\t\t: Database.collection(\r\n\t\t\t\t\t\"circles\",\r\n\t\t\t\t\tcircleId,\r\n\t\t\t\t\t\"groups\",\r\n\t\t\t\t\tgroupId,\r\n\t\t\t\t\t\"messages\"\r\n\t\t\t\t);\r\n\r\n\t\t\tconst unbind = Database.createSnapshotListener(\r\n\t\t\t\tquery(\r\n\t\t\t\t\tref,\r\n\t\t\t\t\torderBy(\"creationDate\"),\r\n\t\t\t\t\tlimitToLast(50)\r\n\t\t\t\t),\r\n\t\t\t\t({ changes = [] } = {}) => {\r\n\t\t\t\t\t_.set(fetching, [circleId, groupId], null);\r\n\r\n\t\t\t\t\tfor (const change of changes) {\r\n\t\t\t\t\t\tswitch (change.type) {\r\n\t\t\t\t\t\t\tcase \"added\": {\r\n\t\t\t\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\t\t\t\ttype: ActionTypes.MESSAGE_CREATE,\r\n\t\t\t\t\t\t\t\t\tcircleId, groupId,\r\n\t\t\t\t\t\t\t\t\tmessage: new Message(change.data)\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\tif (changes.length <= 2) {\r\n\t\t\t\t\t\t\t\t\tMessageCountStore.pushValue(circleId, groupId);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} break;\r\n\r\n\t\t\t\t\t\t\tcase \"modified\": {\r\n\t\t\t\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\t\t\t\ttype: ActionTypes.MESSAGE_UPDATE,\r\n\t\t\t\t\t\t\t\t\tcircleId, groupId,\r\n\t\t\t\t\t\t\t\t\tmessage: _.extend(\r\n\t\t\t\t\t\t\t\t\t\tthis.getMessage(circleId, groupId)\r\n\t\t\t\t\t\t\t\t\t\t?? new Message(change.data),\r\n\t\t\t\t\t\t\t\t\t\tchange.data\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} break;\r\n\r\n\t\t\t\t\t\t\tcase \"removed\": {\r\n\t\t\t\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\t\t\t\ttype: ActionTypes.MESSAGE_DELETE,\r\n\t\t\t\t\t\t\t\t\tcircleId, groupId,\r\n\t\t\t\t\t\t\t\t\tmessageId: change.doc.id\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} break;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsetImmediate(() => {\r\n\t\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\t\ttype: ActionTypes.CHAT_UPDATE,\r\n\t\t\t\t\t\t\tcircleId, groupId\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tr(_.get(cache, [circleId, groupId]));\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tconst readRef = circleId === \"dms\"\r\n\t\t\t\t? Database.collection(\r\n\t\t\t\t\t\"directmessages\",\r\n\t\t\t\t\tdmId,\r\n\t\t\t\t\t\"lastread\"\r\n\t\t\t\t)\r\n\t\t\t\t: Database.collection(\r\n\t\t\t\t\t\"circles\",\r\n\t\t\t\t\tcircleId,\r\n\t\t\t\t\t\"groups\",\r\n\t\t\t\t\tgroupId,\r\n\t\t\t\t\t\"lastread\"\r\n\t\t\t\t);\r\n\r\n\t\t\tconst unbindReadListener = Database.createSnapshotListener(\r\n\t\t\t\tquery(\r\n\t\t\t\t\treadRef,\r\n\t\t\t\t\torderBy(\"timestamp\"),\r\n\t\t\t\t\tlimitToLast(10)\r\n\t\t\t\t),\r\n\t\t\t\t({ items = [] } = {}) => {\r\n\t\t\t\t\tdispatcher.dispatch({\r\n\t\t\t\t\t\ttype: ActionTypes.UPDATE_READS,\r\n\t\t\t\t\t\tcircleId,\r\n\t\t\t\t\t\tgroupId,\r\n\t\t\t\t\t\treads: items\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tconst cleanup = () => {\r\n\t\t\t\tunbind();\r\n\t\t\t\tunbindReadListener();\r\n\r\n\t\t\t\tdelete cache[circleId][groupId];\r\n\t\t\t\tdelete cleanupCache[circleId][groupId];\r\n\t\t\t};\r\n\r\n\t\t\t_.set(cleanupCache, [circleId, groupId], {\r\n\t\t\t\tinstantly: cleanup,\r\n\t\t\t\ttick: _.debounce(cleanup, 10 * 60 * 1000)\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n}\r\n\r\nconst MessageStore = new MessageStoreClass(dispatcher, {\r\n\t[ActionTypes.MESSAGE_CREATE]: ({ circleId, groupId, message }) => {\r\n\t\t_.set(cache, [circleId, groupId, message.id], message);\r\n\t},\r\n\t[ActionTypes.MESSAGE_UPDATE]: ({ circleId, groupId, message }) => {\r\n\t\t_.set(cache, [circleId, groupId, message.id], message);\r\n\t},\r\n\t[ActionTypes.MESSAGE_DELETE]: ({ circleId, groupId, messageId }) => {\r\n\t\tdelete cache[circleId]?.[groupId]?.[messageId];\r\n\t}\r\n})\r\n\r\nexport default MessageStore;","import React from \"react\";\r\nimport { AlertOctagon } from \"react-feather\";\r\nimport { useMounted } from \"../../../Classes/Hooks\";\r\nimport InlineLoading from \"../../InlineLoading\";\r\nimport { openImageModal } from \"../../Modals\";\r\nimport \"./Styles/ImageRenderer.scss\";\r\n\r\nexport default function ImageRenderer({ src, message = null }) {\r\n\tconst [loaded, setLoaded] = React.useState(false);\r\n\tconst [failed, setFailed] = React.useState(false);\r\n\tconst isMounted = useMounted();\r\n\r\n\tReact.useEffect(() => {\r\n\t\tconst image = Object.assign(\r\n\t\t\tdocument.createElement(\"img\"),\r\n\t\t\t{\r\n\t\t\t\tstyle: \"display:none\",\r\n\t\t\t\tsrc,\r\n\t\t\t\tonload: () => (isMounted && setLoaded(true), image.remove()),\r\n\t\t\t\tonerror: () => (isMounted && setFailed(true), image.remove())\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tdocument.body.appendChild(image);\r\n\r\n\t\treturn () => image.remove();\r\n\t}, [src]);\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"ImageContainer FlexCenter\"\r\n\t\t\tonClick={() => openImageModal(src, () =>\r\n\t\t\t\t[...document.querySelectorAll(\".ImageContainer > .Image\")]\r\n\t\t\t\t\t.reverse().map(e => e.src))}\r\n\t\t>\r\n\t\t\t{failed\r\n\t\t\t\t? (\r\n\t\t\t\t\t<div className=\"FailedPlaceholder FlexCenter\">\r\n\t\t\t\t\t\t<AlertOctagon />\r\n\t\t\t\t\t\t<h4>Image 404</h4>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)\r\n\t\t\t\t: (\r\n\t\t\t\t\tloaded\r\n\t\t\t\t\t\t? (\r\n\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\tclassName=\"Image\"\r\n\t\t\t\t\t\t\t\tsrc={src}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t: (\r\n\t\t\t\t\t\t\t<div className=\"LoadingPlaceholder FlexCenter\">\r\n\t\t\t\t\t\t\t\t<InlineLoading />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n}","import _ from \"lodash\";\r\nimport React from \"react\";\r\nimport { ActionTypes, joinClassNames } from \"../Constants\";\r\nimport { dispatcher } from \"../Dispatcher\";\r\nimport EmoteStore from \"./Stores/EmoteStore\";\r\nimport \"./Styles/Emote.scss\";\r\n\r\nexport default class Emote {\r\n\tid;\r\n\turl;\r\n\tpackId;\r\n\r\n\tconstructor(emote) {\r\n\t\t_.extend(this, emote);\r\n\t}\r\n\r\n\tComponent = () =>\r\n\t\t<EmoteComponent emote={this} />;\r\n}\r\n\r\nexport function EmoteComponent({ emote }) {\r\n\tconst ref = React.useRef();\r\n\tconst [size, setSize] = React.useState(\"1.25em\");\r\n\r\n\tconst url = EmoteStore.useState(() => emote.url);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (ref.current?.parentElement?.childNodes.length === 1) {\r\n\t\t\tsetSize(\"4em\");\r\n\t\t}\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"Emote\"\r\n\t\t\tref={ref}\r\n\t\t\tstyle={{\r\n\t\t\t\twidth: size,\r\n\t\t\t\theight: size\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<img\r\n\t\t\t\tclassName=\"EmoteImage\"\r\n\r\n\t\t\t\tsrc={url}\r\n\t\t\t\talt=\"\"\r\n\t\t\t/>\r\n\t\t</div>\r\n\t);\r\n}","import _ from \"lodash\";\r\nimport { ActionTypes } from \"../../Constants\";\r\nimport Database from \"../../Database\";\r\nimport { dispatcher } from \"../../Dispatcher\";\r\nimport Store from \"../../Store\";\r\nimport Emote from \"../Emote\";\r\n\r\nconst cache = {};\r\n\r\nexport const EmoteStoreClass = class EmoteStore extends Store {\r\n\tgetEmote(packId, emoteId) {\r\n\t\treturn _.get(cache, [packId, emoteId]) ?? (\r\n\t\t\tthis.fetchEmote(packId, emoteId),\r\n\t\t\t_.set(cache, [packId, emoteId], new Emote({ packId, id: emoteId, loading: true })),\r\n\t\t\t_.get(cache, [packId, emoteId])\r\n\t\t);\r\n\t}\r\n\r\n\tgetCachedEmotes() {\r\n\t\treturn cache;\r\n\t}\r\n\r\n\tasync fetchEmote(packId, emoteId) {\r\n\t\tconst doc = await Database.getDoc(\r\n\t\t\tDatabase.doc(\"emotepacks\", packId, \"emotes\", emoteId)\r\n\t\t);\r\n\r\n\t\tconst emote = _.extend(\r\n\t\t\t_.get(cache, [packId, emoteId]) ?? new Emote(),\r\n\t\t\t{\r\n\t\t\t\t...doc,\r\n\t\t\t\tpackId,\r\n\t\t\t\tloading: false\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tdispatcher.dispatch({\r\n\t\t\ttype: ActionTypes.FETCH_EMOTE,\r\n\t\t\tpackId, emoteId, emote\r\n\t\t});\r\n\r\n\t\treturn emote;\r\n\t}\r\n}\r\n\r\nconst EmoteStore = new EmoteStoreClass(dispatcher, {\r\n\t[ActionTypes.FETCH_EMOTE]: ({ packId, emoteId, emote }) => {\r\n\t\t_.set(cache, [packId, emoteId], emote);\r\n\t}\r\n});\r\n\r\nexport default EmoteStore;","import _ from \"lodash\";\r\nimport React from \"react\";\r\nimport { defaultRules, parserFor, reactFor, ruleOutput } from \"simple-markdown\";\r\nimport ImageRenderer from \"../Components/Chat/MessageComponents/ImageRenderer\";\r\nimport { ActionTypes } from \"./Constants\";\r\nimport { dispatcher } from \"./Dispatcher\";\r\nimport EmoteStore from \"./Types/Stores/EmoteStore\";\r\nimport UserStore from \"./Types/Stores/UserStore\";\r\n\r\nexport default new class MessageFormatter {\r\n\trules = _.extend(\r\n\t\t{},\r\n\t\tdefaultRules,\r\n\t\t{\r\n\t\t\timage: {\r\n\t\t\t\torder: 10,\r\n\t\t\t\tmatch: src => /^https:\\/\\/(\\S?)+\\.(jpe?g|png|gif|bmp)\\S*(\\s|$)/i.exec(src),\r\n\t\t\t\tparse: (capture, _, state) => ({\r\n\t\t\t\t\tsrc: capture[0].trim(),\r\n\t\t\t\t\tmessage: state?.message,\r\n\t\t\t\t\tstate\r\n\t\t\t\t}),\r\n\t\t\t\treact: (node, _, state) => (\r\n\t\t\t\t\tnode.state.minimal\r\n\t\t\t\t\t\t? <span className=\"MinimalTag\" key={state.key}>[image]</span>\r\n\t\t\t\t\t\t: <ImageRenderer key={state.key} src={node.src} message={node.message} />\r\n\t\t\t\t)\r\n\t\t\t},\r\n\t\t\tuserMention: {\r\n\t\t\t\torder: 10,\r\n\t\t\t\tmatch: src => /^@(\\S{28})/.exec(src),\r\n\t\t\t\tparse: (capture, _, state) => ({ userId: capture[1], state }),\r\n\t\t\t\treact: (node, _, state) => {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\tReact.createElement(\r\n\t\t\t\t\t\t\tUserStore.getUser(node.userId).Mention,\r\n\t\t\t\t\t\t\t{ key: state.key }\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\temote: {\r\n\t\t\t\torder: 10,\r\n\t\t\t\tmatch: src => /^:([^\\/\\s\\\\]+)\\.([^\\/\\s\\\\]+):/.exec(src),\r\n\t\t\t\tparse: (capture, _, state) => ({ packId: capture[1], emoteId: capture[2], src: capture.src, state }),\r\n\t\t\t\treact: (node, _, state) => {\r\n\t\t\t\t\tconst emote = EmoteStore.getEmote(node.packId, node.emoteId);\r\n\r\n\t\t\t\t\treturn emote ? (\r\n\t\t\t\t\t\tReact.createElement(\r\n\t\t\t\t\t\t\temote.Component,\r\n\t\t\t\t\t\t\t{ key: state.key }\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t) : null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tvideo: {\r\n\t\t\t\torder: 10,\r\n\t\t\t\tmatch: src => /^https:\\/\\/(\\S?)+\\.(mp4|webm)(\\S?)+/.exec(src),\r\n\t\t\t\tparse: (capture, _, state) => ({ src: capture[0], state }),\r\n\t\t\t\treact: (node, _, state) => (\r\n\t\t\t\t\t// TODO add custom video component\r\n\t\t\t\t\t<video\r\n\t\t\t\t\t\tkey={state.key}\r\n\t\t\t\t\t\tsrc={node.src}\r\n\t\t\t\t\t\tcontrols\r\n\t\t\t\t\t/>\r\n\t\t\t\t)\r\n\t\t\t},\r\n\t\t\taudio: {\r\n\t\t\t\torder: 10,\r\n\t\t\t\tmatch: src => /^https:\\/\\/(\\S?)+\\.(ogg|mp3|wav)(\\S?)+/.exec(src),\r\n\t\t\t\tparse: (capture, _, state) => ({ src: capture[0], state }),\r\n\t\t\t\treact: (node, _, state) => (\r\n\t\t\t\t\t// TODO add custom audio component\r\n\t\t\t\t\t<audio\r\n\t\t\t\t\t\tkey={state.key}\r\n\t\t\t\t\t\tsrc={node.src}\r\n\t\t\t\t\t\tcontrols\r\n\t\t\t\t\t/>\r\n\t\t\t\t)\r\n\t\t\t},\r\n\t\t\tyoutube: {\r\n\t\t\t\torder: 10,\r\n\t\t\t\tmatch: src => /^https:\\/\\/(www\\.youtube\\.com\\/watch\\?v=|youtu\\.be\\/)(\\S+)/i.exec(src),\r\n\t\t\t\tparse: (capture, _, state) => ({ id: capture[2], state }),\r\n\t\t\t\treact: (node, _, state) => (\r\n\t\t\t\t\t<iframe\r\n\t\t\t\t\t\tkey={state.key}\r\n\t\t\t\t\t\tclassName=\"YouTubeEmbed\"\r\n\t\t\t\t\t\tsrc={`https://www.youtube.com/embed/${node.id}`}\r\n\t\t\t\t\t\tallowFullScreen\r\n\t\t\t\t\t/>\r\n\t\t\t\t)\r\n\t\t\t}\r\n\t\t\t// TODO add file renderer\r\n\t\t\t// TODO add replies\r\n\t\t\t// TODO add color tags\r\n\t\t\t// TODO add size attribute\r\n\t\t\t// TODO add group mention\r\n\t\t\t// TODO add list items\r\n\t\t\t// TODO add polls\r\n\t\t\t// TODO add code blocks\r\n\t\t\t// TODO add invite embeds\r\n\t\t\t// TODO add link embeds\r\n\t\t}\r\n\t);\r\n\r\n\tparser = parserFor(this.rules);\r\n\trender = reactFor(ruleOutput(this.rules, \"react\"));\r\n\r\n\tparse(content, message, props = {}) {\r\n\t\treturn this.render(\r\n\t\t\tthis.parser(\r\n\t\t\t\tcontent,\r\n\t\t\t\t{\r\n\t\t\t\t\tinline: true,\r\n\t\t\t\t\tmessage,\r\n\t\t\t\t\t...props\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t);\r\n\t}\r\n}","import { get, getDatabase, onDisconnect, onValue, ref, set } from \"firebase/database\";\r\nimport _ from \"lodash\";\r\n\r\nexport default new class RealtimeDatabase {\r\n\tdb = getDatabase();\r\n\r\n\tserializeObject(obj) {\r\n\t\treturn _.omit({ ...obj }, [\r\n\t\t\t\"_ref\",\r\n\t\t\t\"_unbindListener\",\r\n\t\t\t\"id\"\r\n\t\t]);\r\n\t}\r\n\r\n\tref(path) {\r\n\t\treturn ref(this.db, path);\r\n\t}\r\n\r\n\tcreateListener(path, callback) {\r\n\t\treturn onValue(\r\n\t\t\tthis.ref(path),\r\n\t\t\tcallback\r\n\t\t);\r\n\t}\r\n\r\n\tcreateDisconnectListener(path) {\r\n\t\treturn onDisconnect(this.ref(path));\r\n\t}\r\n\r\n\tasync get(path) {\r\n\t\treturn await get(this.ref(path));\r\n\t}\r\n\r\n\tasync set(path, data) {\r\n\t\treturn await set(this.ref(path), data ? this.serializeObject(data) : null);\r\n\t}\r\n}","import React from \"react\";\r\nimport \"./ErrorBoundary.scss\";\r\nimport { closeModal, openModal } from \"./Modals\";\r\n\r\nexport default class ErrorBoundary extends React.Component {\r\n    state = { error: null, errorInfo: null, moreInfo: false };\r\n    \r\n    constructor(props) {\r\n        super(props);\r\n    }\r\n    \r\n    componentDidCatch(error, errorInfo) {\r\n        // console.error(error, errorInfo);\r\n        \r\n        this.setState({ error, errorInfo });\r\n    }\r\n    \r\n    showErrorInfo() {\r\n        const { error, errorInfo } = this.state;\r\n        \r\n        openModal(\r\n            <div className=\"ErrorInfoModal PrimaryBg\" onClick={() => closeModal()}>\r\n                <h1>{error.message}</h1>\r\n                { errorInfo.componentStack.split(\"\\n\").slice(0, 10).map((msg, i) => <h2 key={i}>{msg}</h2>) }\r\n            </div>\r\n        );\r\n    }\r\n    \r\n    renderError() {\r\n        const { moreInfo } = this.state;\r\n        \r\n        return (\r\n            <div className=\"ErrorBoundaryHandler\">\r\n                <h1>There was an error with this component!</h1>\r\n                <h2>This is due to a plugin error or application error.</h2>\r\n                \r\n                <div className=\"ErrorBoundaryFooter\">\r\n                    <div className=\"ErrorBoundaryButton TertiaryBg\" onClick={() => this.showErrorInfo()}>More Info</div>\r\n                    <div className=\"ErrorBoundaryButton BackgroundDanger\" onClick={() => this.setState({ error: null })}>Retry</div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    render() {\r\n        if (this.state.error)\r\n            return this.renderError();\r\n        \r\n        return this.props.children;\r\n    }\r\n}","import _ from \"lodash\";\r\nimport React from \"react\";\r\nimport \"./RichTextArea.scss\";\r\nimport { getRandomKey, joinClassNames } from \"../../Classes/Constants\";\r\nimport { useEventListener } from \"../../Classes/Hooks\";\r\nimport MessageFormatter from \"../../Classes/MessageFormatter\";\r\n\r\nexport default function RichTextArea(props) {\r\n\tconst containerRef = React.useRef();\r\n\tconst rendererRef = React.useRef();\r\n\tconst ref = React.useRef();\r\n\r\n\tconst [height, setHeight] = React.useState(0);\r\n\tconst [value, setValue] = React.useState(props.defaultValue ?? \"\");\r\n\tconst [focused, setFocused] = React.useState(false);\r\n\tconst [selection, setSelection] = React.useState([0, 0]);\r\n\r\n\tconst caret = React.useMemo(() =>\r\n\t\t<div className=\"Caret\" key={getRandomKey()} />, [value, selection]);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tsetImmediate(() =>\r\n\t\t\tsetHeight(rendererRef.current?.getBoundingClientRect().height)\r\n\t\t);\r\n\t}, [value]);\r\n\r\n\tconst events = {\r\n\t\tonInput: e => {\r\n\t\t\tprops.onInput?.(e);\r\n\r\n\t\t\tsetValue(e.target.value);\r\n\t\t},\r\n\t\tonKeyDown: async e => {\r\n\t\t\tprops.onKeyDown?.();\r\n\r\n\t\t\tswitch (e.key) {\r\n\t\t\t\tcase \"Enter\": {\r\n\t\t\t\t\tif (!e.shiftKey) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tif ((await props.onSend?.(value)) === true) {\r\n\t\t\t\t\t\t\tsetValue(\"\");\r\n\t\t\t\t\t\t\tref.current.value = \"\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} break;\r\n\t\t\t}\r\n\t\t},\r\n\t\tonFocus: () => setFocused(true),\r\n\t\tonBlur: () => setFocused(false)\r\n\t};\r\n\r\n\tuseEventListener(\"selectionchange\", () => {\r\n\t\tconst selection = document.getSelection();\r\n\r\n\t\tif (selection?.anchorNode === containerRef.current) {\r\n\t\t\tsetSelection([\r\n\t\t\t\tref.current.selectionStart,\r\n\t\t\t\tref.current.selectionEnd\r\n\t\t\t]);\r\n\t\t}\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tref={containerRef}\r\n\t\t\tclassName={joinClassNames(\"RichTextArea\", [focused, \"Focused\"])}\r\n\t\t\tonClick={() => setImmediate(() => ref.current.focus())}\r\n\t\t\tstyle={{\r\n\t\t\t\t\"--rich-text-height\": `${height}px`\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t{props.containerChildren}\r\n\r\n\t\t\t<textarea\r\n\t\t\t\tref={ref}\r\n\t\t\t\t{..._.omit(\r\n\t\t\t\t\tprops,\r\n\t\t\t\t\t\"children\", \"onInput\", \"onChange\", \"onSend\",\r\n\t\t\t\t\t\"onKeyDown\", \"containerChildren\"\r\n\t\t\t\t)}\r\n\t\t\t\t{...events}\r\n\t\t\t/>\r\n\r\n\t\t\t{value\r\n\t\t\t\t? (\r\n\t\t\t\t\t<div className=\"Renderer\" ref={rendererRef}>\r\n\t\t\t\t\t\t{MessageFormatter.parse(value.slice(0, selection[0]))}\r\n\r\n\t\t\t\t\t\t{selection[1] - selection[0] > 0 && (\r\n\t\t\t\t\t\t\t<span className=\"SelectedText\">\r\n\t\t\t\t\t\t\t\t{value.slice(selection[0], selection[1])}\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t{caret}\r\n\r\n\t\t\t\t\t\t{MessageFormatter.parse(value.slice(selection[1]))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)\r\n\t\t\t\t: (\r\n\t\t\t\t\t<div className=\"Renderer Placeholder\" ref={rendererRef}>\r\n\t\t\t\t\t\t{caret}\r\n\t\t\t\t\t\t{props.children}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n}","export default __webpack_public_path__ + \"static/media/ascend.05fa505d.ogg\";","export default __webpack_public_path__ + \"static/media/descend.98a1480b.ogg\";","import _ from \"lodash\";\r\nimport { ActionTypes, playSound } from \"../../Constants\";\r\nimport { dispatcher } from \"../../Dispatcher\";\r\nimport Store from \"../../Store\";\r\n\r\nimport Ascend from \"../../../Assets/Audio/ascend.ogg\";\r\nimport Descend from \"../../../Assets/Audio/descend.ogg\";\r\nimport VoiceModule from \"../../VoiceModule\";\r\n\r\nconst cache = {};\r\n\r\nconst VoiceMemberStoreClass = class VoiceMemberStore extends Store {\r\n\tgetVoiceMembers(circleId, groupId) {\r\n\t\treturn _.get(cache, [circleId, groupId]);\r\n\t}\r\n\r\n\tgetAllVoiceMembers() {\r\n\t\treturn cache;\r\n\t}\r\n}\r\n\r\nconst VoiceMemberStore = new VoiceMemberStoreClass(dispatcher, {\r\n\t[ActionTypes.UPDATE_VOICE_MEMBERS]: ({ circleId, groupId, users }) => {\r\n\t\tconst last = _.get(cache, [circleId, groupId], []);\r\n\r\n\t\tif (VoiceModule.currentRoom?.group.id === groupId) {\r\n\t\t\t// Handle user disconnections\r\n\t\t\tfor (const userId of last) {\r\n\t\t\t\tif (!~users.indexOf(userId)) {\r\n\t\t\t\t\tplaySound(Descend, 0.5);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Handle user connections\r\n\t\t\tfor (const userId of users) {\r\n\t\t\t\tif (!~last.indexOf(userId)) {\r\n\t\t\t\t\tplaySound(Ascend, 0.5);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t_.set(cache, [circleId, groupId], users);\r\n\t}\r\n});\r\n\r\nexport default VoiceMemberStore;","import React from \"react\";\r\nimport \"./AuthModal.scss\";\r\nimport * as Feather from \"react-feather\";\r\nimport { Modals } from \"../Modals\";\r\nimport Toasts from \"../Toasts\";\r\nimport { createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from \"firebase/auth\";\r\nimport Database from \"../../Classes/Database\";\r\nimport { useEventListener } from \"../../Classes/Hooks\";\r\nimport { pushHistoryState } from \"../../App\";\r\nimport { serverTimestamp } from \"@firebase/firestore\";\r\nimport Circle from \"../../Classes/Types/Circle\";\r\n\r\n// TODO add password reset functionality.\r\n\r\nexport default function AuthModal({ signUp = false }) {\r\n\tconst [signUpMode, setSignUpMode] = React.useState(signUp);\r\n\tconst [busy, setBusy] = React.useState(false);\r\n\tconst ref = React.useRef();\r\n\r\n\t// Create an events object.\r\n\tconst events = {\r\n\t\thandleSignUp: () => {\r\n\t\t\tif (busy) return;\r\n\r\n\t\t\t// Get the input fields.\r\n\t\t\tconst [usernameField, emailField, passwordField, confirmPasswordField] = ref.current.getElementsByTagName(\"input\");\r\n\r\n\t\t\t// If the user doesn't specify a username, throw an error to the user and return.\r\n\t\t\tif (!usernameField.value)\r\n\t\t\t\treturn Toasts.showToast(\"You must specify a username\", \"Failure\");\r\n\t\t\t// If the passwords don't match, throw an error to the user and return.\r\n\t\t\tif (confirmPasswordField.value !== passwordField.value)\r\n\t\t\t\treturn Toasts.showToast(\"Passwords must match\", \"Failure\");\r\n\t\t\t// If the email doesn't exist, throw an error to the user and return.\r\n\t\t\tif (!emailField.value.trim())\r\n\t\t\t\treturn Toasts.showToast(\"You must input an email address\", \"Failure\");\r\n\t\t\t// If the password is empty, throw an error to the user and return.\r\n\t\t\tif (!passwordField.value.trim())\r\n\t\t\t\treturn Toasts.showToast(\"You must input a password\", \"Failure\");\r\n\r\n\t\t\t// Set the busy state so users don't spam the API.\r\n\t\t\tsetBusy(true);\r\n\r\n\t\t\t// Create the user account.\r\n\t\t\tcreateUserWithEmailAndPassword(Database.auth, emailField.value, passwordField.value)\r\n\t\t\t\t// Then navigate to the settings.\r\n\t\t\t\t.then(async ({ user }) => {\r\n\t\t\t\t\t// Update the username\r\n\t\t\t\t\tconst displayName = usernameField.value;\r\n\t\t\t\t\tawait updateProfile(user, { displayName });\r\n\r\n\t\t\t\t\t// Create the user object\r\n\t\t\t\t\tawait Database.set(\r\n\t\t\t\t\t\tDatabase.doc(\"userdata\", user.uid),\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tdisplayName,\r\n\t\t\t\t\t\t\tnormalizedName: displayName.toLowerCase(),\r\n\t\t\t\t\t\t\tcreationDate: serverTimestamp()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t// Join the official circle\r\n\t\t\t\t\tawait Circle.join(\"Kz9IW6QOJjdKC5oaT3lK\", \"cirlos-official\", user.uid);\r\n\r\n\t\t\t\t\t// Finalize things\r\n\t\t\t\t\tModals.pop();\r\n\t\t\t\t\tToasts.showToast(\"Welcome to Cirlos!\", \"Success\");\r\n\t\t\t\t\tsetImmediate(() => pushHistoryState(\"app\"));\r\n\t\t\t\t})\r\n\t\t\t\t// Catch any errors that may have occurred.\r\n\t\t\t\t.catch(e => {\r\n\t\t\t\t\tToasts.showToast(\"An unknown error has occurred! Check console for details\", \"Failure\");\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t});\r\n\t\t},\r\n\t\thandleLogIn: () => {\r\n\t\t\tif (busy) return;\r\n\r\n\t\t\t// Get the input fields.\r\n\t\t\tconst [emailField, passwordField] = ref.current.getElementsByTagName(\"input\");\r\n\r\n\t\t\t// Set the busy state so users don't spam the API.\r\n\t\t\tsetBusy(true);\r\n\r\n\t\t\t// Attempt to log in.\r\n\t\t\tsignInWithEmailAndPassword(Database.auth, emailField.value, passwordField.value)\r\n\t\t\t\t// Then navigate to the main app\r\n\t\t\t\t.then(() => (Modals.pop(), window.location.assign(\"#app\")))\r\n\t\t\t\t// Catch any errors that may have occurred.\r\n\t\t\t\t.catch(e => {\r\n\t\t\t\t\tlet message = \"Unknown\";\r\n\r\n\t\t\t\t\tswitch (e.code) {\r\n\t\t\t\t\t\tcase \"auth/invalid-email\":\r\n\t\t\t\t\t\t\tmessage = \"Invalid email address\";\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase \"auth/user-not-found\":\r\n\t\t\t\t\t\t\tmessage = \"No user with this email found\";\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase \"auth/wrong-password\":\r\n\t\t\t\t\t\t\tmessage = \"Incorrect password\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tToasts.showToast(`Failed to sign in! Reason - ${message}`, \"Failure\", 10);\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tuseEventListener(\r\n\t\t\"keydown\",\r\n\t\te => e.key === \"Enter\" && (signUpMode ? events.handleSignUp() : events.handleLogIn())\r\n\t);\r\n\r\n\treturn (\r\n\t\t<div className=\"AuthModal\" ref={ref}>\r\n\t\t\t<Feather.X className=\"CloseButton\" onClick={Modals.pop.bind(Modals)} />\r\n\r\n\t\t\t{signUpMode ? (\r\n\t\t\t\t<React.Fragment>\r\n\t\t\t\t\t<div className=\"MainSection Flex\">\r\n\t\t\t\t\t\t<div className=\"HelpSection\">\r\n\t\t\t\t\t\t\t<div className=\"Title\">NOTE</div>\r\n\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\tBy creating an account,<br />\r\n\t\t\t\t\t\t\t\tyou agree to the following:<br />\r\n\t\t\t\t\t\t\t\t<a href=\"/terms\">Terms of Service</a><br />\r\n\t\t\t\t\t\t\t\t<a href=\"/guidelines\">Community Guidelines</a><br />\r\n\t\t\t\t\t\t\t\t<a href=\"/privacy\">Privacy Policy</a><br />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div className=\"Fields\">\r\n\t\t\t\t\t\t\t<h3>Sign Up</h3>\r\n\r\n\t\t\t\t\t\t\t<div className=\"FieldContainer\">\r\n\t\t\t\t\t\t\t\t<input type=\"username\" placeholder=\"Username\" maxLength={32} />\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div className=\"FieldContainer\">\r\n\t\t\t\t\t\t\t\t<input type=\"email\" placeholder=\"Email Address\" />\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div className=\"FieldContainer\">\r\n\t\t\t\t\t\t\t\t<input type=\"password\" placeholder=\"Password\" />\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div className=\"FieldContainer\">\r\n\t\t\t\t\t\t\t\t<input type=\"password\" placeholder=\"Confirm Password\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"FooterSection Flex\">\r\n\t\t\t\t\t\t<div className=\"Button\" onClick={() => setSignUpMode(false)}>\r\n\t\t\t\t\t\t\t<Feather.LogIn />\r\n\t\t\t\t\t\t\t<div>Already have an account?</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div className=\"Button\" style={{ marginLeft: \"auto\" }} onClick={events.handleSignUp}>\r\n\t\t\t\t\t\t\t<Feather.UserCheck />\r\n\t\t\t\t\t\t\t<div>Sign Up</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</React.Fragment>\r\n\t\t\t) : (\r\n\t\t\t\t<React.Fragment>\r\n\t\t\t\t\t<div className=\"MainSection Flex\">\r\n\t\t\t\t\t\t<div className=\"HelpSection\">\r\n\t\t\t\t\t\t\t<div className=\"Title\">Log In</div>\r\n\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\tWelcome back to Cirlos.\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div className=\"Fields\">\r\n\t\t\t\t\t\t\t<h3>Login</h3>\r\n\r\n\t\t\t\t\t\t\t<div className=\"FieldContainer\">\r\n\t\t\t\t\t\t\t\t<input type=\"email\" placeholder=\"Email Address\" />\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div className=\"FieldContainer\">\r\n\t\t\t\t\t\t\t\t<input type=\"password\" placeholder=\"Password\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"FooterSection Flex\">\r\n\t\t\t\t\t\t<div className=\"Button\" onClick={() => setSignUpMode(true)}>\r\n\t\t\t\t\t\t\t<Feather.UserPlus />\r\n\t\t\t\t\t\t\t<div>Don't have an account?</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div className=\"Button\" style={{ marginLeft: \"auto\" }}>\r\n\t\t\t\t\t\t\t<Feather.Key />\r\n\t\t\t\t\t\t\t<div>Reset Password</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div className=\"Button\" onClick={events.handleLogIn}>\r\n\t\t\t\t\t\t\t<Feather.LogIn />\r\n\t\t\t\t\t\t\t<div>Log In</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</React.Fragment>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t)\r\n}","import _ from \"lodash\";\r\nimport { formatDateString, formatTimestamp } from \"../Constants\";\r\nimport MessageFormatter from \"../MessageFormatter\";\r\n\r\nexport default class Message {\r\n\tid = \"\";\r\n\tcontent = \"\";\r\n\tsenderId = \"\";\r\n\tcreationDate = null;\r\n\tmentions = [];\r\n\r\n\tconstructor(message) {\r\n\t\t_.extend(this, message);\r\n\t}\r\n\r\n\tgetContent(props = {}) {\r\n\t\treturn MessageFormatter.parse(this.content, this, props);\r\n\t}\r\n\r\n\tgetCreationDate(_time) {\r\n\t\treturn formatTimestamp(_time ?? this.creationDate);\r\n\t}\r\n}","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<App />\n\t</React.StrictMode>,\n\tdocument.getElementById(\"root\")\n);\n\nserviceWorker.unregister();"],"sourceRoot":""}